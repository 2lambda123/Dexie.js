/*! For license information please see main.9f72120d.chunk.js.LICENSE.txt */
(this["webpackJsonpdexie-cloud-todo-app"]=this["webpackJsonpdexie-cloud-todo-app"]||[]).push([[0],{44:function(e,t,n){"use strict";n.r(t),n.d(t,"Dexie",(function(){return or})),n.d(t,"RangeSet",(function(){return Qn})),n.d(t,"liveQuery",(function(){return cr})),n.d(t,"mergeRanges",(function(){return Zn})),n.d(t,"rangesOverlap",(function(){return er}));var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function i(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}var o="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,s=Object.keys,u=Array.isArray;function a(e,t){return"object"!==typeof t||s(t).forEach((function(n){e[n]=t[n]})),e}"undefined"===typeof Promise||o.Promise||(o.Promise=Promise);var c=Object.getPrototypeOf,l={}.hasOwnProperty;function f(e,t){return l.call(e,t)}function d(e,t){"function"===typeof t&&(t=t(c(e))),("undefined"===typeof Reflect?s:Reflect.ownKeys)(t).forEach((function(n){p(e,n,t[n])}))}var h=Object.defineProperty;function p(e,t,n,r){h(e,t,a(n&&f(n,"get")&&"function"===typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function v(e){return{from:function(t){return e.prototype=Object.create(t.prototype),p(e.prototype,"constructor",e),{extend:d.bind(null,e.prototype)}}}}var y=Object.getOwnPropertyDescriptor;function b(e,t){var n;return y(e,t)||(n=c(e))&&b(n,t)}var m=[].slice;function g(e,t,n){return m.call(e,t,n)}function _(e,t){return t(e)}function w(e){if(!e)throw new Error("Assertion Failed")}function x(e){o.setImmediate?setImmediate(e):setTimeout(e,0)}function k(e,t){return e.reduce((function(e,n,r){var i=t(n,r);return i&&(e[i[0]]=i[1]),e}),{})}function S(e,t){if(f(e,t))return e[t];if(!t)return e;if("string"!==typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var o=S(e,t[r]);n.push(o)}return n}var s=t.indexOf(".");if(-1!==s){var u=e[t.substr(0,s)];return void 0===u?void 0:S(u,t.substr(s+1))}}function j(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!==typeof t&&"length"in t){w("string"!==typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)j(e,t[r],n[r])}else{var o=t.indexOf(".");if(-1!==o){var s=t.substr(0,o),a=t.substr(o+1);if(""===a)void 0===n?u(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=n;else{var c=e[s];c||(c=e[s]={}),j(c,a,n)}}else void 0===n?u(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function O(e){var t={};for(var n in e)f(e,n)&&(t[n]=e[n]);return t}var E=[].concat;function I(e){return E.apply([],e)}var C="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(I([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return o[e]})),P=C.map((function(e){return o[e]}));k(C,(function(e){return[e,!0]}));var T=null;function A(e){T="undefined"!==typeof WeakMap&&new WeakMap;var t=D(e);return T=null,t}function D(e){if(!e||"object"!==typeof e)return e;var t=T&&T.get(e);if(t)return t;if(u(e)){t=[],T&&T.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(D(e[n]))}else if(P.indexOf(e.constructor)>=0)t=e;else{var i=c(e);for(var o in t=i===Object.prototype?{}:Object.create(i),T&&T.set(e,t),e)f(e,o)&&(t[o]=D(e[o]))}return t}var N={}.toString;function R(e){return N.call(e).slice(8,-1)}var K="undefined"!==typeof Symbol?Symbol.iterator:"@@iterator",B="symbol"===typeof K?function(e){var t;return null!=e&&(t=e[K])&&t.apply(e)}:function(){return null},U={};function M(e){var t,n,r,i;if(1===arguments.length){if(u(e))return e.slice();if(this===U&&"string"===typeof e)return[e];if(i=B(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"===typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var L="undefined"!==typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},F="undefined"!==typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function q(e,t){F=e,W=t}var W=function(){return!0},$=!new Error("").stack;function H(){if($)try{throw H.arguments,new Error}catch(e){return e}return new Error}function V(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(W).map((function(e){return"\n"+e})).join("")):""}var z=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Y=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(z),G={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function J(e,t){this._e=H(),this.name=e,this.message=t}function Q(e,t){return e+". Errors: "+Object.keys(t).map((function(e){return t[e].toString()})).filter((function(e,t,n){return n.indexOf(e)===t})).join("\n")}function X(e,t,n,r){this._e=H(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Q(e,t)}function Z(e,t){this._e=H(),this.name="BulkError",this.failures=Object.keys(t).map((function(e){return t[e]})),this.failuresByPos=t,this.message=Q(e,t)}v(J).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+V(this._e,2))}},toString:function(){return this.name+": "+this.message}}),v(X).from(J),v(Z).from(J);var ee=Y.reduce((function(e,t){return e[t]=t+"Error",e}),{}),te=J,ne=Y.reduce((function(e,t){var n=t+"Error";function r(e,r){this._e=H(),this.name=n,e?"string"===typeof e?(this.message=e+(r?"\n "+r:""),this.inner=r||null):"object"===typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=G[t]||n,this.inner=null)}return v(r).from(te),e[t]=r,e}),{});ne.Syntax=SyntaxError,ne.Type=TypeError,ne.Range=RangeError;var re=z.reduce((function(e,t){return e[t+"Error"]=ne[t],e}),{});var ie=Y.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=ne[t]),e}),{});function oe(){}function se(e){return e}function ue(e,t){return null==e||e===se?t:function(n){return t(e(n))}}function ae(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ce(e,t){return e===oe?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ae(r,this.onsuccess):r),i&&(this.onerror=this.onerror?ae(i,this.onerror):i),void 0!==o?o:n}}function le(e,t){return e===oe?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ae(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ae(r,this.onerror):r)}}function fe(e,t){return e===oe?t:function(n){var r=e.apply(this,arguments);a(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ae(i,this.onsuccess):i),o&&(this.onerror=this.onerror?ae(o,this.onerror):o),void 0===r?void 0===s?void 0:s:a(r,s)}}function de(e,t){return e===oe?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function he(e,t){return e===oe?t:function(){var n=e.apply(this,arguments);if(n&&"function"===typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then((function(){return t.apply(r,o)}))}return t.apply(this,arguments)}}ie.ModifyError=X,ie.DexieError=J,ie.BulkError=Z;var pe={},ve="undefined"===typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"===typeof crypto||!crypto.subtle)return[e,c(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,c(t),e]}(),ye=ve[0],be=ve[1],me=ve[2],ge=be&&be.then,_e=ye&&ye.constructor,we=!!me,xe=!1,ke=me?function(){me.then(Ve)}:o.setImmediate?setImmediate.bind(null,Ve):o.MutationObserver?function(){var e=document.createElement("div");new MutationObserver((function(){Ve(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(Ve,0)},Se=function(e,t){De.push([e,t]),Oe&&(ke(),Oe=!1)},je=!0,Oe=!0,Ee=[],Ie=[],Ce=null,Pe=se,Te={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:bt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(e){try{bt(e[0],e[1])}catch(t){}}))}},Ae=Te,De=[],Ne=0,Re=[];function Ke(e){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=oe,this._lib=!1;var t=this._PSD=Ae;if(F&&(this._stackHolder=H(),this._prev=null,this._numPrev=0),"function"!==typeof e){if(e!==pe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Le(this,this._value))}this._state=null,this._value=null,++t.ref,Me(this,e)}var Be={get:function(){var e=Ae,t=nt;function n(n,r){var i=this,o=!e.global&&(e!==Ae||t!==nt),s=o&&!st(),u=new Ke((function(t,u){qe(i,new Ue(pt(n,e,o,s),pt(r,e,o,s),t,u,e))}));return F&&He(u,this),u}return n.prototype=pe,n},set:function(e){p(this,"then",e&&e.prototype===pe?Be:{get:function(){return e},set:Be.set})}};function Ue(e,t,n,r,i){this.onFulfilled="function"===typeof e?e:null,this.onRejected="function"===typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Me(e,t){try{t((function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&ze();t&&"function"===typeof t.then?Me(e,(function(e,n){t instanceof Ke?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Fe(e)),n&&Ye()}}),Le.bind(null,e))}catch(n){Le(e,n)}}function Le(e,t){if(Ie.push(t),null===e._state){var n=e._lib&&ze();t=Pe(t),e._state=!1,e._value=t,F&&null!==t&&"object"===typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,n)}catch(r){t&&t(r)}}((function(){var n=b(t,"stack");t._promise=e,p(t,"stack",{get:function(){return xe?n&&(n.get?n.get.apply(t):n.value):e.stack}})})),function(e){Ee.some((function(t){return t._value===e._value}))||Ee.push(e)}(e),Fe(e),n&&Ye()}}function Fe(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)qe(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Ne&&(++Ne,Se((function(){0===--Ne&&Ge()}),[]))}function qe(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ne,Se(We,[n,e,t])}else e._listeners.push(t)}function We(e,t,n){try{Ce=t;var r,i=t._value;t._state?r=e(i):(Ie.length&&(Ie=[]),r=e(i),-1===Ie.indexOf(i)&&function(e){var t=Ee.length;for(;t;)if(Ee[--t]._value===e._value)return void Ee.splice(t,1)}(t)),n.resolve(r)}catch(o){n.reject(o)}finally{Ce=null,0===--Ne&&Ge(),--n.psd.ref||n.psd.finalize()}}function $e(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,o,s=e._value;null!=s?(i=s.name||"Error",o=s.message||s,r=V(s,0)):(i=s,o=""),t.push(i+(o?": "+o:"")+r)}return F&&((r=V(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&$e(e._prev,t,n)),t}function He(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Ve(){ze()&&Ye()}function ze(){var e=je;return je=!1,Oe=!1,e}function Ye(){var e,t,n;do{for(;De.length>0;)for(e=De,De=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(De.length>0);je=!0,Oe=!0}function Ge(){var e=Ee;Ee=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Re.slice(0),n=t.length;n;)t[--n]()}function Je(e){return new Ke(pe,!1,e)}function Qe(e,t){var n=Ae;return function(){var r=ze(),i=Ae;try{return lt(n,!0),e.apply(this,arguments)}catch(o){t&&t(o)}finally{lt(i,!1),r&&Ye()}}}d(Ke.prototype,{then:Be,_then:function(e,t){qe(this,new Ue(null,null,e,t,Ae))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"===typeof t?this.then(null,(function(e){return e instanceof t?n(e):Je(e)})):this.then(null,(function(e){return e&&e.name===t?n(e):Je(e)}))},finally:function(e){return this.then((function(t){return e(),t}),(function(t){return e(),Je(t)}))},stack:{get:function(){if(this._stack)return this._stack;try{xe=!0;var e=$e(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{xe=!1}}},timeout:function(e,t){var n=this;return e<1/0?new Ke((function(r,i){var o=setTimeout((function(){return i(new ne.Timeout(t))}),e);n.then(r,i).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!==typeof Symbol&&Symbol.toStringTag&&p(Ke.prototype,Symbol.toStringTag,"Dexie.Promise"),Te.env=ft(),d(Ke,{all:function(){var e=M.apply(null,arguments).map(ut);return new Ke((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((function(i,o){return Ke.resolve(i).then((function(n){e[o]=n,--r||t(e)}),n)}))}))},resolve:function(e){if(e instanceof Ke)return e;if(e&&"function"===typeof e.then)return new Ke((function(t,n){e.then(t,n)}));var t=new Ke(pe,!0,e);return He(t,Ce),t},reject:Je,race:function(){var e=M.apply(null,arguments).map(ut);return new Ke((function(t,n){e.map((function(e){return Ke.resolve(e).then(t,n)}))}))},PSD:{get:function(){return Ae},set:function(e){return Ae=e}},totalEchoes:{get:function(){return nt}},newPSD:it,usePSD:dt,scheduler:{get:function(){return Se},set:function(e){Se=e}},rejectionMapper:{get:function(){return Pe},set:function(e){Pe=e}},follow:function(e,t){return new Ke((function(n,r){return it((function(t,n){var r=Ae;r.unhandleds=[],r.onunhandled=n,r.finalize=ae((function(){var e=this;!function(e){function t(){e(),Re.splice(Re.indexOf(t),1)}Re.push(t),++Ne,Se((function(){0===--Ne&&Ge()}),[])}((function(){0===e.unhandleds.length?t():n(e.unhandleds[0])}))}),r.finalize),e()}),t,n,r)}))}}),_e&&(_e.allSettled&&p(Ke,"allSettled",(function(){var e=M.apply(null,arguments).map(ut);return new Ke((function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach((function(e,i){return Ke.resolve(e).then((function(e){return r[i]={status:"fulfilled",value:e}}),(function(e){return r[i]={status:"rejected",reason:e}})).then((function(){return--n||t(r)}))}))}))})),_e.any&&"undefined"!==typeof AggregateError&&p(Ke,"any",(function(){var e=M.apply(null,arguments).map(ut);return new Ke((function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach((function(e,o){return Ke.resolve(e).then((function(e){return t(e)}),(function(e){i[o]=e,--r||n(new AggregateError(i))}))}))}))})));var Xe={awaits:0,echoes:0,id:0},Ze=0,et=[],tt=0,nt=0,rt=0;function it(e,t,n,r){var i=Ae,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++rt;var s=Te.env;o.env=we?{Promise:Ke,PromiseProp:{value:Ke,configurable:!0,writable:!0},all:Ke.all,race:Ke.race,allSettled:Ke.allSettled,any:Ke.any,resolve:Ke.resolve,reject:Ke.reject,nthen:vt(s.nthen,o),gthen:vt(s.gthen,o)}:{},t&&a(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=dt(o,e,n,r);return 0===o.ref&&o.finalize(),u}function ot(){return Xe.id||(Xe.id=++Ze),++Xe.awaits,Xe.echoes+=100,Xe.id}function st(){return!!Xe.awaits&&(0===--Xe.awaits&&(Xe.id=0),Xe.echoes=100*Xe.awaits,!0)}function ut(e){return Xe.echoes&&e&&e.constructor===_e?(ot(),e.then((function(e){return st(),e}),(function(e){return st(),mt(e)}))):e}function at(e){++nt,Xe.echoes&&0!==--Xe.echoes||(Xe.echoes=Xe.id=0),et.push(Ae),lt(e,!0)}function ct(){var e=et[et.length-1];et.pop(),lt(e,!1)}function lt(e,t){var n=Ae;if((t?!Xe.echoes||tt++&&e===Ae:!tt||--tt&&e===Ae)||ht(t?at.bind(null,e):ct),e!==Ae&&(Ae=e,n===Te&&(Te.env=ft()),we)){var r=Te.env.Promise,i=e.env;be.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(o,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function ft(){var e=o.Promise;return we?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:be.then,gthen:e.prototype.then}:{}}function dt(e,t,n,r,i){var o=Ae;try{return lt(e,!0),t(n,r,i)}finally{lt(o,!1)}}function ht(e){ge.call(ye,e)}function pt(e,t,n,r){return"function"!==typeof e?e:function(){var i=Ae;n&&ot(),lt(t,!0);try{return e.apply(this,arguments)}finally{lt(i,!1),r&&ht(st)}}}function vt(e,t){return function(n,r){return e.call(this,pt(n,t),pt(r,t))}}-1===(""+ge).indexOf("[native code]")&&(ot=st=oe);var yt="unhandledrejection";function bt(e,t){var n;try{n=t.onuncatched(e)}catch(s){}if(!1!==n)try{var r,i={promise:t,reason:e};if(o.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(yt,!0,!0),a(r,i)):o.CustomEvent&&a(r=new CustomEvent(yt,{detail:i}),i),r&&o.dispatchEvent&&(dispatchEvent(r),!o.PromiseRejectionEvent&&o.onunhandledrejection))try{o.onunhandledrejection(r)}catch(u){}F&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(e.stack||e))}catch(s){}}var mt=Ke.reject;function gt(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Ae.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create()}catch(o){return mt(o)}return i._promise(t,(function(e,t){return it((function(){return Ae.trans=i,r(e,t,i)}))})).then((function(e){return i._completion.then((function(){return e}))}))}if(e._state.openComplete)return mt(new ne.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return mt(new ne.DatabaseClosed);e.open().catch(oe)}return e._state.dbReadyPromise.then((function(){return gt(e,t,n,r)}))}var _t,wt="3.2.0-rc.1",xt=String.fromCharCode(65535),kt=-1/0,St="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",jt="String expected.",Ot=[],Et="undefined"!==typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),It=Et,Ct=Et,Pt=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)},Tt="__dbnames",At="readonly",Dt="readwrite";function Nt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}try{_t={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch(vr){_t={indexedDB:null,IDBKeyRange:null}}var Rt=function(e){try{return e.only([[]]),Rt=function(){return[[]]},[[]]}catch(vr){return Rt=function(){return xt},xt}},Kt={type:3,lower:-1/0,lowerOpen:!1,get upper(){return Rt(_t.IDBKeyRange)},upperOpen:!1};function Bt(e){return"string"!==typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=A(t))[e],t}}var Ut=function(){function e(){}return e.prototype._trans=function(e,t,n){var r=this._tx||Ae.trans,i=this.name;function o(e,n,r){if(!r.schema[i])throw new ne.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}var s=ze();try{return r&&r.db===this.db?r===Ae.trans?r._promise(e,o,n):it((function(){return r._promise(e,o,n)}),{trans:r,transless:Ae.transless||Ae}):gt(this.db,e,[this.name],o)}finally{s&&Ye()}},e.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(function(t){return n.core.get({trans:t,key:e}).then((function(e){return n.hook.reading.fire(e)}))})).then(t)},e.prototype.where=function(e){if("string"===typeof e)return new this.db.WhereClause(this,e);if(u(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var t=s(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(e){return e.compound&&t.every((function(t){return e.keyPath.indexOf(t)>=0}))&&e.keyPath.every((function(e){return t.indexOf(e)>=0}))}))[0];if(n&&this.db._maxKey!==xt)return this.where(n.name).equals(n.keyPath.map((function(t){return e[t]})));!n&&F&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+t.join("+")+"]");var r=this.schema.idxByName,i=this.db._deps.indexedDB;function o(e,t){try{return 0===i.cmp(e,t)}catch(vr){return!1}}var a=t.reduce((function(t,n){var i=t[0],s=t[1],a=r[n],c=e[n];return[i||a,i||!a?Nt(s,a&&a.multi?function(e){var t=S(e,n);return u(t)&&t.some((function(e){return o(c,e)}))}:function(e){return o(c,S(e,n))}):s]}),[null,null]),c=a[0],l=a[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(l):n?this.filter(l):this.where(t).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,u(e)?"["+e.join("+")+"]":e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){this.schema.mappedClass=e;var t=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(f(t,r))try{n[r]=t[r]}catch(i){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e},e.prototype.defineClass=function(){return this.mapToClass((function(e){a(this,e)}))},e.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,s=e;return o&&i&&(s=Bt(o)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[s]})})).then((function(e){return e.numFailures?Ke.reject(e.failures[0]):e.lastResult})).then((function(t){if(o)try{j(e,o,t)}catch(n){}return t}))},e.prototype.update=function(e,t){if("object"!==typeof e||u(e))return this.where(":id").equals(e).modify(t);var n=S(e,this.schema.primKey.keyPath);if(void 0===n)return mt(new ne.InvalidArgument("Given object does not contain its primary key"));try{"function"!==typeof t?s(t).forEach((function(n){j(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(Yn){}return this.where(":id").equals(n).modify(t)},e.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,s=e;return o&&i&&(s=Bt(o)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"put",values:[s],keys:null!=t?[t]:null})})).then((function(e){return e.numFailures?Ke.reject(e.failures[0]):e.lastResult})).then((function(t){if(o)try{j(e,o,t)}catch(n){}return t}))},e.prototype.delete=function(e){var t=this;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})})).then((function(e){return e.numFailures?Ke.reject(e.failures[0]):void 0}))},e.prototype.clear=function(){var e=this;return this._trans("readwrite",(function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Kt})})).then((function(e){return e.numFailures?Ke.reject(e.failures[0]):void 0}))},e.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",(function(n){return t.core.getMany({keys:e,trans:n}).then((function(e){return e.map((function(e){return t.hook.reading.fire(e)}))}))}))},e.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=r.schema.primKey,s=n.auto,u=n.keyPath;if(u&&i)throw new ne.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ne.InvalidArgument("Arguments objects and keys must have the same length");var a=e.length,c=u&&s?e.map(Bt(u)):e;return r.core.mutate({trans:t,type:"add",keys:i,values:c,wantResults:o}).then((function(e){var t=e.numFailures,n=e.results,i=e.lastResult,s=e.failures;if(0===t)return o?n:i;throw new Z(r.name+".bulkAdd(): "+t+" of "+a+" operations failed",s)}))}))},e.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,o=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=r.schema.primKey,s=n.auto,u=n.keyPath;if(u&&i)throw new ne.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new ne.InvalidArgument("Arguments objects and keys must have the same length");var a=e.length,c=u&&s?e.map(Bt(u)):e;return r.core.mutate({trans:t,type:"put",keys:i,values:c,wantResults:o}).then((function(e){var t=e.numFailures,n=e.results,i=e.lastResult,s=e.failures;if(0===t)return o?n:i;throw new Z(r.name+".bulkPut(): "+t+" of "+a+" operations failed",s)}))}))},e.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:e})})).then((function(e){var r=e.numFailures,i=e.lastResult,o=e.failures;if(0===r)return i;throw new Z(t.name+".bulkDelete(): "+r+" of "+n+" operations failed",o)}))},e}();function Mt(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return t[n].subscribe.apply(null,o),e}if("string"===typeof n)return t[n]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(e,r,i){if("object"===typeof e)return a(e);r||(r=de),i||(i=oe);var o={subscribers:[],fire:i,subscribe:function(e){-1===o.subscribers.indexOf(e)&&(o.subscribers.push(e),o.fire=r(o.fire,e))},unsubscribe:function(e){o.subscribers=o.subscribers.filter((function(t){return t!==e})),o.fire=o.subscribers.reduce(r,i)}};return t[e]=n[e]=o,o}function a(e){s(e).forEach((function(t){var n=e[t];if(u(n))o(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new ne.InvalidArgument("Invalid event config");var r=o(t,se,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){x((function(){e.apply(null,t)}))}))}))}}))}}function Lt(e,t){return v(t).from({prototype:e}),t}function Ft(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function qt(e,t){e.filter=Nt(e.filter,t)}function Wt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Nt(r(),t())}:t,e.justLimit=n&&!r}function $t(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new ne.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Ht(e,t,n){var r=$t(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Vt(e,t,n,r){var i=e.replayFilter?Nt(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},s=function(e,n,r){if(!i||i(n,r,(function(e){return n.stop(e)}),(function(e){return n.fail(e)}))){var s=n.primaryKey,u=""+s;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(s)),f(o,u)||(o[u]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(s,n),zt(Ht(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return zt(Ht(e,r,n),Nt(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function zt(e,t,n,r){var i=Qe(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then((function(e){if(e)return e.start((function(){var n=function(){return e.continue()};t&&!t(e,(function(e){return n=e}),(function(t){e.stop(t),n=oe}),(function(t){e.fail(t),n=oe}))||i(e.value,e,(function(e){return n=e})),n()}))}))}var Yt=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,mt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,mt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Nt(t.algorithm,e)},e.prototype._iterate=function(e,t){return Vt(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&a(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read((function(n){return Vt(t,e,n,t.table.core)}))},e.prototype.count=function(e){var t=this;return this._read((function(e){var n=t._ctx,r=n.table.core;if(Ft(n,!0))return r.count({trans:e,query:{index:$t(n,r.schema),range:n.range}}).then((function(e){return Math.min(e,n.limit)}));var i=0;return Vt(n,(function(){return++i,!1}),e,r).then((function(){return i}))})).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function o(e,t){return t?o(e[n[t]],t-1):e[r]}var s="next"===this._ctx.dir?1:-1;function u(e,t){var n=o(e,i),r=o(t,i);return n<r?-s:n>r?s:0}return this.toArray((function(e){return e.sort(u)})).then(t)},e.prototype.toArray=function(e){var t=this;return this._read((function(e){var n=t._ctx;if("next"===n.dir&&Ft(n,!0)&&n.limit>0){var r=n.valueMapper,i=$t(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then((function(e){var t=e.result;return r?t.map(r):t}))}var o=[];return Vt(n,(function(e){return o.push(e)}),e,n.table.core).then((function(){return o}))}),e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Ft(t)?Wt(t,(function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n((function(){e.advance(t),t=0})),!1))}})):Wt(t,(function(){var t=e;return function(){return--t<0}}))),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Wt(this._ctx,(function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this},e.prototype.until=function(e,t){return qt(this._ctx,(function(n,r,i){return!e(n.value)||(r(i),t)})),this},e.prototype.first=function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){var t,n;return qt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=Nt(t.isMatch,n),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&Ft(t,!0)&&t.limit>0)return this._read((function(e){var n=$t(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((function(e){return e.result})).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return qt(this._ctx,(function(e){var t=e.primaryKey.toString(),r=f(n,t);return n[t]=!0,!r})),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write((function(r){var i;if("function"===typeof e)i=e;else{var o=s(e),u=o.length;i=function(t){for(var n=!1,r=0;r<u;++r){var i=o[r],s=e[i];S(t,i)!==s&&(j(t,i,s),n=!0)}return n}}var a=n.table.core,c=a.schema.primaryKey,l=c.outbound,f=c.extractKey,d=t.db._options.modifyChunkSize||200,h=t.db.core.cmp,p=[],v=0,y=[],b=function(e,t){var n=t.failures,r=t.numFailures;v+=e-r;for(var i=0,o=s(n);i<o.length;i++){var u=o[i];p.push(n[u])}};return t.clone().primaryKeys().then((function(t){return function o(s){var u=Math.min(d,t.length-s);return a.getMany({trans:r,keys:t.slice(s,s+u),cache:"immutable"}).then((function(c){for(var p=[],v=[],y=l?[]:null,m=[],g=0;g<u;++g){var _=c[g],w={value:A(_),primKey:t[s+g]};!1!==i.call(w,w.value,w)&&(null==w.value?m.push(t[s+g]):l||0===h(f(_),f(w.value))?(v.push(w.value),l&&y.push(t[s+g])):(m.push(t[s+g]),p.push(w.value)))}var x=Ft(n)&&n.limit===1/0&&("function"!==typeof e||e===Gt)&&{index:n.index,range:n.range};return Promise.resolve(p.length>0&&a.mutate({trans:r,type:"add",values:p}).then((function(e){for(var t in e.failures)m.splice(parseInt(t),1);b(p.length,e)}))).then((function(){return(v.length>0||x&&"object"===typeof e)&&a.mutate({trans:r,type:"put",keys:y,values:v,criteria:x,changeSpec:"function"!==typeof e&&e}).then((function(e){return b(v.length,e)}))})).then((function(){return(m.length>0||x&&e===Gt)&&a.mutate({trans:r,type:"delete",keys:m,criteria:x}).then((function(e){return b(m.length,e)}))})).then((function(){return t.length>s+u&&o(s+d)}))}))}(0).then((function(){if(p.length>0)throw new X("Error modifying one or more objects",p,v,y);return t.length}))}))}))},e.prototype.delete=function(){var e=this._ctx,t=e.range;return Ft(e)&&(e.isPrimKey&&!Ct||3===t.type)?this._write((function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then((function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((function(e){var n=e.failures;e.lastResult,e.results;var r=e.numFailures;if(r)throw new X("Could not delete some values",Object.keys(n).map((function(e){return n[e]})),t-r);return t-r}))}))})):this.modify(Gt)},e}(),Gt=function(e,t){return t.value=null};function Jt(e,t){return e<t?-1:e===t?0:1}function Qt(e,t){return e>t?-1:e===t?0:1}function Xt(e,t,n){var r=e instanceof on?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Zt(e){return new e.Collection(e,(function(){return rn("")})).limit(0)}function en(e,t,n,r,i,o){for(var s=Math.min(e.length,r.length),u=-1,a=0;a<s;++a){var c=t[a];if(c!==r[a])return i(e[a],n[a])<0?e.substr(0,a)+n[a]+n.substr(a+1):i(e[a],r[a])<0?e.substr(0,a)+r[a]+n.substr(a+1):u>=0?e.substr(0,u)+t[u]+n.substr(u+1):null;i(e[a],c)<0&&(u=a)}return s<r.length&&"next"===o?e+n.substr(e.length):s<e.length&&"prev"===o?e.substr(0,n.length):u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function tn(e,t,n,r){var i,o,s,u,a,c,l,f=n.length;if(!n.every((function(e){return"string"===typeof e})))return Xt(e,jt);function d(e){i=function(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}(e),o=function(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}(e),s="next"===e?Jt:Qt;var t=n.map((function(e){return{lower:o(e),upper:i(e)}})).sort((function(e,t){return s(e.lower,t.lower)}));u=t.map((function(e){return e.upper})),a=t.map((function(e){return e.lower})),c=e,l="next"===e?"":r}d("next");var h=new e.Collection(e,(function(){return nn(u[0],a[f-1]+r)}));h._ondirectionchange=function(e){d(e)};var p=0;return h._addAlgorithm((function(e,n,r){var i=e.key;if("string"!==typeof i)return!1;var d=o(i);if(t(d,a,p))return!0;for(var h=null,v=p;v<f;++v){var y=en(i,d,u[v],a[v],s,c);null===y&&null===h?p=v+1:(null===h||s(h,y)>0)&&(h=y)}return n(null!==h?function(){e.continue(h+l)}:r),!1})),h}function nn(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function rn(e){return{type:1,lower:e,upper:e}}var on=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Zt(this):new this.Collection(this,(function(){return nn(e,t,!n,!r)}))}catch(vr){return Xt(this,St)}},e.prototype.equals=function(e){return null==e?Xt(this,St):new this.Collection(this,(function(){return rn(e)}))},e.prototype.above=function(e){return null==e?Xt(this,St):new this.Collection(this,(function(){return nn(e,void 0,!0)}))},e.prototype.aboveOrEqual=function(e){return null==e?Xt(this,St):new this.Collection(this,(function(){return nn(e,void 0,!1)}))},e.prototype.below=function(e){return null==e?Xt(this,St):new this.Collection(this,(function(){return nn(void 0,e,!1,!0)}))},e.prototype.belowOrEqual=function(e){return null==e?Xt(this,St):new this.Collection(this,(function(){return nn(void 0,e)}))},e.prototype.startsWith=function(e){return"string"!==typeof e?Xt(this,jt):this.between(e,e+xt,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):tn(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],xt)},e.prototype.equalsIgnoreCase=function(e){return tn(this,(function(e,t){return e===t[0]}),[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=M.apply(U,arguments);return 0===e.length?Zt(this):tn(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=M.apply(U,arguments);return 0===e.length?Zt(this):tn(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,xt)},e.prototype.anyOf=function(){var e=this,t=M.apply(U,arguments),n=this._cmp;try{t.sort(n)}catch(vr){return Xt(this,St)}if(0===t.length)return Zt(this);var r=new this.Collection(this,(function(){return nn(t[0],t[t.length-1])}));r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm((function(e,r,o){for(var s=e.key;n(s,t[i])>0;)if(++i===t.length)return r(o),!1;return 0===n(s,t[i])||(r((function(){e.continue(t[i])})),!1)})),r},e.prototype.notEqual=function(e){return this.inAnyRange([[kt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=M.apply(U,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(vr){return Xt(this,St)}var t=e.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[kt,t]]}),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,o=this._descending,s=this._min,u=this._max;if(0===e.length)return Zt(this);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0})))return Xt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ne.InvalidArgument);var a=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;var l,f=i;function d(e,t){return f(e[0],t[0])}try{(l=e.reduce((function(e,t){for(var n=0,i=e.length;n<i;++n){var o=e[n];if(r(t[0],o[1])<0&&r(t[1],o[0])>0){o[0]=s(o[0],t[0]),o[1]=u(o[1],t[1]);break}}return n===i&&e.push(t),e}),[])).sort(d)}catch(m){return Xt(this,St)}var h=0,p=c?function(e){return i(e,l[h][1])>0}:function(e){return i(e,l[h][1])>=0},v=a?function(e){return o(e,l[h][0])>0}:function(e){return o(e,l[h][0])>=0};var y=p,b=new this.Collection(this,(function(){return nn(l[0][0],l[l.length-1][1],!a,!c)}));return b._ondirectionchange=function(e){"next"===e?(y=p,f=i):(y=v,f=o),l.sort(d)},b._addAlgorithm((function(e,t,r){for(var o=e.key;y(o);)if(++h===l.length)return t(r),!1;return!!function(e){return!p(e)&&!v(e)}(o)||(0===n._cmp(o,l[h][1])||0===n._cmp(o,l[h][0])||t((function(){f===i?e.continue(l[h][0]):e.continue(l[h][1])})),!1)})),b},e.prototype.startsWithAnyOf=function(){var e=M.apply(U,arguments);return e.every((function(e){return"string"===typeof e}))?0===e.length?Zt(this):this.inAnyRange(e.map((function(e){return[e,e+xt]}))):Xt(this,"startsWithAnyOf() only works with strings")},e}();function sn(e){return Qe((function(t){return un(t),e(t.target.error),!1}))}function un(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var an="storagemutated",cn="x-storagemutated-1",ln=Mt(null,an),fn=function(){function e(){}return e.prototype._lock=function(){return w(!Ae.global),++this._reculock,1!==this._reculock||Ae.global||(Ae.lockOwnerFor=this),this},e.prototype._unlock=function(){if(w(!Ae.global),0===--this._reculock)for(Ae.global||(Ae.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{dt(e[1],e[0])}catch(vr){}}return this},e.prototype._locked=function(){return this._reculock&&Ae.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(w(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new ne.DatabaseClosed(r);case"MissingAPIError":throw new ne.MissingAPI(r.message,r);default:throw new ne.OpenFailed(r)}if(!this.active)throw new ne.TransactionInactive;return w(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Qe((function(n){un(n),t._reject(e.error)})),e.onabort=Qe((function(n){un(n),t.active&&t._reject(new ne.Abort(e.error)),t.active=!1,t.on("abort").fire(n)})),e.oncomplete=Qe((function(){t.active=!1,t._resolve(),"mutatedParts"in e&&ln.storagemutated.fire(e.mutatedParts)})),this},e.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return mt(new ne.ReadOnly("Transaction is readonly"));if(!this.active)return mt(new ne.TransactionInactive);if(this._locked())return new Ke((function(i,o){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,o)},Ae])}));if(n)return it((function(){var e=new Ke((function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return e.finally((function(){return r._unlock()})),e._lib=!0,e}));var i=new Ke((function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=Ke.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((function(){return n}));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Ke((function(e,r){n.then((function(n){return t._waitingQueue.push(Qe(e.bind(null,n)))}),(function(e){return t._waitingQueue.push(Qe(r.bind(null,e)))})).finally((function(){t._waitingFor===i&&(t._waitingFor=null)}))}))},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ne.Abort))},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(f(t,e))return t[e];var n=this.schema[e];if(!n)throw new ne.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function dn(e,t,n,r,i,o,s){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+hn(t)}}function hn(e){return"string"===typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function pn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:k(n,(function(e){return[e.name,e]}))}}function vn(e){return null==e?function(){}:"string"===typeof e?function(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return S(t,e)}}(e):function(t){return S(t,e)}}function yn(e){return[].slice.call(e)}var bn=0;function mn(e){return null==e?":id":"string"===typeof e?e:"["+e.join("+")+"]"}function gn(e,t,n,r){var i=t.cmp.bind(t);function o(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var t=e.lower,r=e.upper,i=e.lowerOpen,o=e.upperOpen;return void 0===t?void 0===r?null:n.upperBound(r,!!o):void 0===r?n.lowerBound(t,!!i):n.bound(t,r,!!i,!!o)}var s=function(e,t){var n=yn(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((function(e){return t.objectStore(e)})).map((function(e){var t=e.keyPath,n=e.autoIncrement,r=u(t),i=null==t,o={},s={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:vn(t)},indexes:yn(e.indexNames).map((function(t){return e.index(t)})).map((function(e){var t=e.name,n=e.unique,r=e.multiEntry,i=e.keyPath,s={name:t,compound:u(i),keyPath:i,unique:n,multiEntry:r,extractKey:vn(i)};return o[mn(i)]=s,s})),getIndexByKeyPath:function(e){return o[mn(e)]}};return o[":id"]=s.primaryKey,null!=t&&(o[mn(t)]=s.primaryKey),s}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!==typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),a=s.schema,c=s.hasGetAll,l=a.tables.map((function(e){return function(e){var t=e.name;return{name:t,schema:e,mutate:function(e){var n=e.trans,r=e.type,i=e.keys,s=e.values,u=e.range;return new Promise((function(e,a){e=Qe(e);var c=n.objectStore(t),l=null==c.keyPath,f="put"===r||"add"===r;if(!f&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);var d,h=(i||s||{length:1}).length;if(i&&s&&i.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],v=[],y=0,b=function(e){++y,un(e)};if("deleteRange"===r){if(4===u.type)return e({numFailures:y,failures:v,results:[],lastResult:void 0});3===u.type?p.push(d=c.clear()):p.push(d=c.delete(o(u)))}else{var m=f?l?[s,i]:[s,null]:[i,null],g=m[0],_=m[1];if(f)for(var w=0;w<h;++w)p.push(d=_&&void 0!==_[w]?c[r](g[w],_[w]):c[r](g[w])),d.onerror=b;else for(w=0;w<h;++w)p.push(d=c[r](g[w])),d.onerror=b}var x=function(t){var n=t.target.result;p.forEach((function(e,t){return null!=e.error&&(v[t]=e.error)})),e({numFailures:y,failures:v,results:"delete"===r?i:p.map((function(e){return e.result})),lastResult:n})};d.onerror=function(e){b(e),x(e)},d.onsuccess=x}))},getMany:function(e){var n=e.trans,r=e.keys;return new Promise((function(e,i){e=Qe(e);for(var o,s=n.objectStore(t),u=r.length,a=new Array(u),c=0,l=0,f=function(t){var n=t.target;a[n._pos]=n.result,++l===c&&e(a)},d=sn(i),h=0;h<u;++h)null!=r[h]&&((o=s.get(r[h]))._pos=h,o.onsuccess=f,o.onerror=d,++c);0===c&&e(a)}))},get:function(e){var n=e.trans,r=e.key;return new Promise((function(e,i){e=Qe(e);var o=n.objectStore(t).get(r);o.onsuccess=function(t){return e(t.target.result)},o.onerror=sn(i)}))},query:function(e){return function(n){return new Promise((function(r,i){r=Qe(r);var s=n.trans,u=n.values,a=n.limit,c=n.query,l=a===1/0?void 0:a,f=c.index,d=c.range,h=s.objectStore(t),p=f.isPrimaryKey?h:h.index(f.name),v=o(d);if(0===a)return r({result:[]});if(e){var y=u?p.getAll(v,l):p.getAllKeys(v,l);y.onsuccess=function(e){return r({result:e.target.result})},y.onerror=sn(i)}else{var b=0,m=u||!("openKeyCursor"in p)?p.openCursor(v):p.openKeyCursor(v),g=[];m.onsuccess=function(e){var t=m.result;return t?(g.push(u?t.value:t.primaryKey),++b===a?r({result:g}):void t.continue()):r({result:g})},m.onerror=sn(i)}}))}}(c),openCursor:function(e){var n=e.trans,r=e.values,i=e.query,s=e.reverse,u=e.unique;return new Promise((function(e,a){e=Qe(e);var c=i.index,l=i.range,f=n.objectStore(t),d=c.isPrimaryKey?f:f.index(c.name),h=s?u?"prevunique":"prev":u?"nextunique":"next",p=r||!("openKeyCursor"in d)?d.openCursor(o(l),h):d.openKeyCursor(o(l),h);p.onerror=sn(a),p.onsuccess=Qe((function(t){var r=p.result;if(r){r.___id=++bn,r.done=!1;var i=r.continue.bind(r),o=r.continuePrimaryKey;o&&(o=o.bind(r));var s=r.advance.bind(r),u=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=function(){throw new Error("Cursor not started")},r.fail=Qe(a),r.next=function(){var e=this,t=1;return this.start((function(){return t--?e.continue():e.stop()})).then((function(){return e}))},r.start=function(e){var t=new Promise((function(e,t){e=Qe(e),p.onerror=sn(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=u,e(t)}})),n=function(){if(p.result)try{e()}catch(t){r.fail(t)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Qe((function(e){p.onsuccess=n,n()})),r.continue=i,r.continuePrimaryKey=o,r.advance=s,n(),t},e(r)}else e(null)}),a)}))},count:function(e){var n=e.query,r=e.trans,i=n.index,s=n.range;return new Promise((function(e,n){var u=r.objectStore(t),a=i.isPrimaryKey?u:u.index(i.name),c=o(s),l=c?a.count(c):a.count();l.onsuccess=Qe((function(t){return e(t.target.result)})),l.onerror=sn(n)}))}}}(e)})),f={};return l.forEach((function(e){return f[e.name]=e})),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!f[e])throw new Error("Table '"+e+"' not found");return f[e]},cmp:i,MIN_KEY:-1/0,MAX_KEY:Rt(n),schema:a}}function _n(e,t,n,i){var o=n.IDBKeyRange;return{dbcore:function(e,t){return t.reduce((function(e,t){var n=t.create;return r(r({},e),n(e))}),e)}(gn(t,n.indexedDB,o,i),e.dbcore)}}function wn(e,t){var n=e._novip,r=t.db,i=_n(n._middlewares,r,n._deps,t);n.core=i.dbcore,n.tables.forEach((function(e){var t=e.name;n.core.schema.tables.some((function(e){return e.name===t}))&&(e.core=n.core.table(t),n[t]instanceof n.Table&&(n[t].core=e.core))}))}function xn(e,t,n,r){var i=e._novip;n.forEach((function(e){var n=r[e];t.forEach((function(t){var r=b(t,e);(!r||"value"in r&&void 0===r.value)&&(t===i.Transaction.prototype||t instanceof i.Transaction?p(t,e,{get:function(){return this.table(e)},set:function(t){h(this,e,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):t[e]=new i.Table(e,n))}))}))}function kn(e,t){var n=e._novip;t.forEach((function(e){for(var t in e)e[t]instanceof n.Table&&delete e[t]}))}function Sn(e,t){return e._cfg.version-t._cfg.version}function jn(e,t,n,r){var i=e._dbSchema,o=e._createTransaction("readwrite",e._storeNames,i);o.create(n),o._completion.catch(r);var u=o._reject.bind(o),a=Ae.transless||Ae;it((function(){Ae.trans=o,Ae.transless=a,0===t?(s(i).forEach((function(e){En(n,e,i[e].primKey,i[e].indexes)})),wn(e,n),Ke.follow((function(){return e.on.populate.fire(o)})).catch(u)):function(e,t,n,r){var i=e._novip,o=[],u=i._versions,a=i._dbSchema=Cn(i,i.idbdb,r),c=!1;function l(){return o.length?Ke.resolve(o.shift()(n.idbtrans)).then(l):Ke.resolve()}return u.filter((function(e){return e._cfg.version>=t})).forEach((function(e){o.push((function(){var o=a,u=e._cfg.dbschema;Pn(i,o,r),Pn(i,u,r),a=i._dbSchema=u;var l=On(o,u);l.add.forEach((function(e){En(r,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((function(e){if(e.recreate)throw new ne.Upgrade("Not yet support for changing primary key");var t=r.objectStore(e.name);e.add.forEach((function(e){return In(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),In(t,e)})),e.del.forEach((function(e){return t.deleteIndex(e)}))}));var f=e._cfg.contentUpgrade;if(f&&e._cfg.version>t){wn(i,r),n._memoizedTables={},c=!0;var d=O(u);l.del.forEach((function(e){d[e]=o[e]})),kn(i,[i.Transaction.prototype]),xn(i,[i.Transaction.prototype],s(d),d),n.schema=d;var h,p=L(f);p&&ot();var v=Ke.follow((function(){if((h=f(n))&&p){var e=st.bind(null,null);h.then(e,e)}}));return h&&"function"===typeof h.then?Ke.resolve(h):v.then((function(){return h}))}})),o.push((function(t){c&&It||function(e,t){for(var n=0;n<t.db.objectStoreNames.length;++n){var r=t.db.objectStoreNames[n];null==e[r]&&t.db.deleteObjectStore(r)}}(e._cfg.dbschema,t);kn(i,[i.Transaction.prototype]),xn(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema}))})),l().then((function(){var e,t;t=r,s(e=a).forEach((function(n){t.db.objectStoreNames.contains(n)||En(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,o,n).catch(u)}))}function On(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],o=t[n];if(i){var s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!==""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Et)s.recreate=!0,r.change.push(s);else{var u=i.idxByName,a=o.idxByName,c=void 0;for(c in u)a[c]||s.del.push(c);for(c in a){var l=u[c],f=a[c];l?l.src!==f.src&&s.change.push(f):s.add.push(f)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}else r.add.push([n,o])}return r}function En(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(e){return In(i,e)})),i}function In(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Cn(e,t,n){var r={};return g(t.objectStoreNames,0).forEach((function(e){for(var t=n.objectStore(e),i=t.keyPath,o=dn(hn(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!==typeof i,!0),s=[],u=0;u<t.indexNames.length;++u){var a=t.index(t.indexNames[u]);i=a.keyPath;var c=dn(a.name,i,!!a.unique,!!a.multiEntry,!1,i&&"string"!==typeof i,!1);s.push(c)}r[e]=pn(e,o,s)})),r}function Pn(e,t,n){for(var r=e._novip,i=n.db.objectStoreNames,s=0;s<i.length;++s){var u=i[s],a=n.objectStore(u);r._hasGetAll="getAll"in a;for(var c=0;c<a.indexNames.length;++c){var l=a.indexNames[c],f=a.index(l).keyPath,d="string"===typeof f?f:"["+g(f).join("+")+"]";if(t[u]){var h=t[u].idxByName[d];h&&(h.name=l,delete t[u].idxByName[d],t[u].idxByName[l]=h)}}}"undefined"!==typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}var Tn=function(){function e(){}return e.prototype._parseStoresSpec=function(e,t){s(e).forEach((function(n){if(null!==e[n]){var r=e[n].split(",").map((function(e,t){var n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return dn(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),u(r),0===t)})),i=r.shift();if(i.multi)throw new ne.Schema("Primary key cannot be multi-valued");r.forEach((function(e){if(e.auto)throw new ne.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ne.Schema("Index must have a name and cannot be an empty string")})),t[n]=pn(n,i,r)}}))},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,e):e;var n=t._versions,r={},i={};return n.forEach((function(e){a(r,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(r,i)})),t._dbSchema=i,kn(t,[t._allTables,t,t.Transaction.prototype]),xn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],s(i),i),t._storeNames=s(i),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=he(this._cfg.contentUpgrade||oe,e),this},e}();function An(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new or(Tt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Dn(e){return e&&"function"===typeof e.databases}function Nn(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!Dn(n)&&t!==Tt&&An(n,r).delete(t).catch(oe)}function Rn(e){return it((function(){return Ae.letThrough=!0,e()}))}function Kn(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Bn(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((function(){return t.dbOpenError?mt(t.dbOpenError):e}));F&&(t.openCanceller._stackHolder=H()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller;function i(){if(t.openCanceller!==r)throw new ne.DatabaseClosed("db.open() was cancelled")}var o=t.dbReadyResolve,u=null,a=!1;return Ke.race([r,Kn().then((function(){return new Ke((function(r,o){if(i(),!n)throw new ne.MissingAPI;var c=e.name,l=t.autoSchema?n.open(c):n.open(c,Math.round(10*e.verno));if(!l)throw new ne.MissingAPI;l.onerror=sn(o),l.onblocked=Qe(e._fireOnBlocked),l.onupgradeneeded=Qe((function(r){if(u=l.transaction,t.autoSchema&&!e._options.allowEmptyDB){l.onerror=un,u.abort(),l.result.close();var i=n.deleteDatabase(c);i.onsuccess=i.onerror=Qe((function(){o(new ne.NoSuchDatabase("Database "+c+" doesnt exist"))}))}else{u.onerror=sn(o);var s=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;a=s<1,e._novip.idbdb=l.result,jn(e,s/10,u,o)}}),o),l.onsuccess=Qe((function(){u=null;var n,i=e._novip.idbdb=l.result,o=g(i.objectStoreNames);if(o.length>0)try{var f=i.transaction(1===(n=o).length?n[0]:n,"readonly");t.autoSchema?function(e,t,n){var r=e._novip;r.verno=t.version/10;var i=r._dbSchema=Cn(0,t,n);r._storeNames=g(t.objectStoreNames,0),xn(r,[r._allTables],s(i),i)}(e,i,f):(Pn(e,e._dbSchema,f),function(e,t){var n=On(Cn(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((function(e){return e.add.length||e.change.length})))}(e,f)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),wn(e,f)}catch(vr){}Ot.push(e),i.onversionchange=Qe((function(n){t.vcFired=!0,e.on("versionchange").fire(n)})),i.onclose=Qe((function(t){e.on("close").fire(t)})),a&&function(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!Dn(n)&&t!==Tt&&An(n,r).put({name:t}).catch(oe)}(e._deps,c),r()}),o)}))}))]).then((function(){return i(),t.onReadyBeingFired=[],Ke.resolve(Rn((function(){return e.on.ready.fire(e.vip)}))).then((function n(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(he,oe);return t.onReadyBeingFired=[],Ke.resolve(Rn((function(){return r(e.vip)}))).then(n)}}))})).finally((function(){t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((function(){return e})).catch((function(n){t.dbOpenError=n;try{u&&u.abort()}catch(Yn){}return r===t.openCanceller&&e._close(),mt(n)})).finally((function(){t.openComplete=!0,o()}))}function Un(e){var t=function(t){return e.next(t)},n=i(t),r=i((function(t){return e.throw(t)}));function i(e){return function(t){var i=e(t),o=i.value;return i.done?o:o&&"function"===typeof o.then?o.then(n,r):u(o)?Promise.all(o).then(n,r):n(o)}}return i(t)()}function Mn(e,t,n){var r=arguments.length;if(r<2)throw new ne.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var o=I(i);return[e,o,n]}function Ln(e,t,n,r,i){return Ke.resolve().then((function(){var o=Ae.transless||Ae,s=e._createTransaction(t,n,e._dbSchema,r),u={trans:s,transless:o};r?s.idbtrans=r.idbtrans:s.create();var a,c=L(i);c&&ot();var l=Ke.follow((function(){if(a=i.call(s,s))if(c){var e=st.bind(null,null);a.then(e,e)}else"function"===typeof a.next&&"function"===typeof a.throw&&(a=Un(a))}),u);return(a&&"function"===typeof a.then?Ke.resolve(a).then((function(e){return s.active?e:mt(new ne.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):l.then((function(){return a}))).then((function(e){return r&&s._resolve(),s._completion.then((function(){return e}))})).catch((function(e){return s._reject(e),mt(e)}))}))}function Fn(e,t,n){for(var r=u(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var qn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return r(r({},e),{table:function(t){var n=e.table(t),i=n.schema,o={},s=[];function u(e,t,n){var i=mn(e),a=o[i]=o[i]||[],c=null==e?0:"string"===typeof e?1:e.length,l=t>0,f=r(r({},n),{isVirtual:l,keyTail:t,keyLength:c,extractKey:vn(e),unique:!l&&n.unique});(a.push(f),f.isPrimaryKey||s.push(f),c>1)&&u(2===c?e[0]:e.slice(0,c-1),t+1,n);return a.sort((function(e,t){return e.keyTail-t.keyTail})),f}var a=u(i.primaryKey.keyPath,0,i.primaryKey);o[":id"]=[a];for(var c=0,l=i.indexes;c<l.length;c++){var f=l[c];u(f.keyPath,0,f)}function d(t){var n,i,o=t.query.index;return o.isVirtual?r(r({},t),{query:{index:o,range:(n=t.query.range,i=o.keyTail,{type:1===n.type?2:n.type,lower:Fn(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Fn(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}):t}return r(r({},n),{schema:r(r({},i),{primaryKey:a,indexes:s,getIndexByKeyPath:function(e){var t=o[mn(e)];return t&&t[0]}}),count:function(e){return n.count(d(e))},query:function(e){return n.query(d(e))},openCursor:function(t){var r=t.query.index,i=r.keyTail,o=r.isVirtual,s=r.keyLength;if(!o)return n.openCursor(t);return n.openCursor(d(t)).then((function(n){return n&&function(n){return Object.create(n,{continue:{value:function(r){null!=r?n.continue(Fn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(n.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Fn(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:function(){return n.value}}})}(n)}))}})}})}};function Wn(e,t,n,r){return n=n||{},r=r||"",s(e).forEach((function(i){if(f(t,i)){var o=e[i],s=t[i];if("object"===typeof o&&"object"===typeof s&&o&&s){var u=R(o);u!==R(s)?n[r+i]=t[i]:"Object"===u?Wn(o,s,n,r+i+"."):o!==s&&(n[r+i]=t[i])}else o!==s&&(n[r+i]=t[i])}else n[r+i]=void 0})),s(t).forEach((function(i){f(e,i)||(n[r+i]=t[i])})),n}var $n,Hn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return r(r({},e),{table:function(t){var n=e.table(t),o=n.schema.primaryKey;return r(r({},n),{mutate:function(e){var s=Ae.trans,u=s.table(t).hook,a=u.deleting,c=u.creating,l=u.updating;switch(e.type){case"add":if(c.fire===oe)break;return s._promise("readwrite",(function(){return d(e)}),!0);case"put":if(c.fire===oe&&l.fire===oe)break;return s._promise("readwrite",(function(){return d(e)}),!0);case"delete":if(a.fire===oe)break;return s._promise("readwrite",(function(){return d(e)}),!0);case"deleteRange":if(a.fire===oe)break;return s._promise("readwrite",(function(){return function(e){return h(e.trans,e.range,1e4)}(e)}),!0)}return n.mutate(e);function d(e){var t=Ae.trans,s=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(o,e);if(!s)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?r(r({},e),{keys:s}):r({},e)).type&&(e.values=i([],e.values)),e.keys&&(e.keys=i([],e.keys)),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,s).then((function(r){var i=s.map((function(n,i){var s=r[i],u={onerror:null,onsuccess:null};if("delete"===e.type)a.fire.call(u,n,s,t);else if("add"===e.type||void 0===s){var d=c.fire.call(u,n,e.values[i],t);null==n&&null!=d&&(n=d,e.keys[i]=n,o.outbound||j(e.values[i],o.keyPath,n))}else{var h=Wn(s,e.values[i]),p=l.fire.call(u,h,n,s,t);if(p){var v=e.values[i];Object.keys(p).forEach((function(e){f(v,e)?v[e]=p[e]:j(v,e,p[e])}))}}return u}));return n.mutate(e).then((function(t){for(var n=t.failures,o=t.results,u=t.numFailures,a=t.lastResult,c=0;c<s.length;++c){var l=o?o[c]:s[c],f=i[c];null==l?f.onerror&&f.onerror(n[c]):f.onsuccess&&f.onsuccess("put"===e.type&&r[c]?e.values[c]:l)}return{failures:n,results:o,numFailures:u,lastResult:a}})).catch((function(e){return i.forEach((function(t){return t.onerror&&t.onerror(e)})),Promise.reject(e)}))}))}function h(e,t,i){return n.query({trans:e,values:!1,query:{index:o,range:t},limit:i}).then((function(n){var o=n.result;return d({type:"delete",keys:o,trans:e}).then((function(n){return n.numFailures>0?Promise.reject(n.failures[0]):o.length<i?{failures:[],numFailures:0,lastResult:void 0}:h(e,r(r({},t),{lower:o[o.length-1],lowerOpen:!0}),i)}))}))}}})}})}};function Vn(e,t){if($n)return $n(e,t);var n=_t.indexedDB;if(!n)throw new ne.MissingAPI;return($n=function(e,t){try{return null==e||null==t?NaN:n.cmp(e,t)}catch(Yn){return NaN}})(e,t)}function zn(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<t.keys.length&&o<e.length;++i)0===Vn(t.keys[i],e[o])&&(r.push(n?A(t.values[i]):t.values[i]),++o);return r.length===e.length?r:null}catch(Yn){return null}}var Yn,Gn={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return r(r({},n),{getMany:function(e){if(!e.cache)return n.getMany(e);var t=zn(e.keys,e.trans._cache,"clone"===e.cache);return t?Ke.resolve(t):n.getMany(e).then((function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?A(t):t},t}))},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),n.mutate(e)}})}}}};function Jn(e){return!("from"in e)}var Qn=function e(t,n){if(!this){var r=new e;return t&&"d"in t&&a(r,t),r}a(this,arguments.length?{d:1,from:t,to:arguments.length>1?n:t}:{d:0})};function Xn(e,t,n){var r=Vn(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(Jn(e))return a(e,{from:t,to:n,d:1});var i=e.l,o=e.r;if(Vn(n,e.from)<0)return i?Xn(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},nr(e);if(Vn(t,e.to)>0)return o?Xn(o,t,n):e.r={from:t,to:n,d:1,l:null,r:null},nr(e);Vn(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),Vn(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var s=!e.r;i&&!e.l&&Zn(e,i),o&&s&&Zn(e,o)}}function Zn(e,t){Jn(t)||function e(t,n){var r=n.from,i=n.to,o=n.l,s=n.r;Xn(t,r,i),o&&e(t,o),s&&e(t,s)}(e,t)}function er(e,t){var n=tr(t),r=n.next();if(r.done)return!1;for(var i=r.value,o=tr(e),s=o.next(i.from),u=s.value;!r.done&&!s.done;){if(Vn(u.from,i.to)<=0&&Vn(u.to,i.from)>=0)return!0;Vn(i.from,u.from)<0?i=(r=n.next(u.from)).value:u=(s=o.next(i.from)).value}return!1}function tr(e){var t=Jn(e)?null:{s:0,n:e};return{next:function(e){for(var n=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Vn(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Vn(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function nr(e){var t,n,i=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),o=i>1?"r":i<-1?"l":"";if(o){var s="r"===o?"l":"r",u=r({},e),a=e[o];e.from=a.from,e.to=a.to,e[o]=a[o],u[o]=a[s],e[s]=u,u.d=rr(u)}e.d=rr(e)}function rr(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}d(Qn.prototype,((Yn={add:function(e){return Zn(this,e),this},addKey:function(e){return Xn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach((function(e){return Xn(t,e,e)})),this}})[K]=function(){return tr(this)},Yn));var ir={stack:"dbcore",level:0,create:function(e){var t=e.schema.name,n=new Qn(e.MIN_KEY,e.MAX_KEY);return r(r({},e),{table:function(i){var o=e.table(i),a=o.schema,c=a.primaryKey,l=c.extractKey,f=c.outbound,d=r(r({},o),{mutate:function(e){var r=e.trans,s=r.mutatedParts||(r.mutatedParts={}),c=function(e){var n="idb://"+t+"/"+i+"/"+e;return s[n]||(s[n]=new Qn)},l=c(""),f=c(":dels"),d=e.type,h="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[],p=h[0],v=h[1],y=e.trans._cache;return o.mutate(e).then((function(e){if(u(p)){"delete"!==d&&(p=e.results),l.addKeys(p);var t=zn(p,y);t||"add"===d||f.addKeys(p),(t||v)&&function(e,t,n,r){function i(t){var i=e(t.name||"");function o(e){return null!=e?t.extractKey(e):null}var s=function(e){return t.multiEntry&&u(e)?e.forEach((function(e){return i.addKey(e)})):i.addKey(e)};(n||r).forEach((function(e,t){var i=n&&o(n[t]),u=r&&o(r[t]);0!==Vn(i,u)&&(null!=i&&s(i),null!=u&&s(u))}))}t.indexes.forEach(i)}(c,a,t,v)}else if(p){var r={from:p.lower,to:p.upper};f.add(r),l.add(r)}else l.add(n),f.add(n),a.indexes.forEach((function(e){return c(e.name).add(n)}));return e}))}}),h=function(t){var n,r,i=t.query,o=i.index,s=i.range;return[o,new Qn(null!==(n=s.lower)&&void 0!==n?n:e.MIN_KEY,null!==(r=s.upper)&&void 0!==r?r:e.MAX_KEY)]},p={get:function(e){return[c,new Qn(e.key)]},getMany:function(e){return[c,(new Qn).addKeys(e.keys)]},count:h,query:h,openCursor:h};return s(p).forEach((function(e){d[e]=function(s){var u=Ae.subscr;if(u){var a=function(e){var n="idb://"+t+"/"+i+"/"+e;return u[n]||(u[n]=new Qn)},c=a(""),d=a(":dels"),h=p[e](s),v=h[0],y=h[1];if(a(v.name||"").add(y),!v.isPrimaryKey){if("count"!==e){var b="query"===e&&f&&s.values&&o.query(r(r({},s),{values:!1}));return o[e].apply(this,arguments).then((function(t){if("query"===e){if(f&&s.values)return b.then((function(e){var n=e.result;return c.addKeys(n),t}));var n=s.values?t.result.map(l):t.result;s.values?c.addKeys(n):d.addKeys(n)}else if("openCursor"===e){var r=t,i=s.values;return r&&Object.create(r,{key:{get:function(){return d.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return d.addKey(e),e}},value:{get:function(){return i&&c.addKey(r.primaryKey),r.value}}})}return t}))}d.add(n)}}return o[e].apply(this,arguments)}})),d}})}};var or=function(){function e(t,n){var i=this;this._middlewares={},this.verno=0;var o=e.dependencies;this._options=n=r({addons:e.addons,autoOpen:!0,indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var s=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u,a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:oe,dbReadyPromise:null,cancelOpen:oe,openCanceller:null,autoSchema:!0};a.dbReadyPromise=new Ke((function(e){a.dbReadyResolve=e})),a.openCanceller=new Ke((function(e,t){a.cancelOpen=t})),this._state=a,this.name=t,this.on=Mt(this,"populate","blocked","versionchange","close",{ready:[he,oe]}),this.on.ready.subscribe=_(this.on.ready.subscribe,(function(t){return function(n,r){e.vip((function(){var e=i._state;if(e.openComplete)e.dbOpenError||Ke.resolve().then(n),r&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),r&&t(n);else{t(n);var o=i;r||t((function e(){o.on.ready.unsubscribe(n),o.on.ready.unsubscribe(e)}))}}))}})),this.Collection=(u=this,Lt(Yt.prototype,(function(e,t){this.db=u;var n=Kt,r=null;if(t)try{n=t()}catch(a){r=a}var i=e._ctx,o=i.table,s=o.hook.reading.fire;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:s!==se?s:null}}))),this.Table=function(e){return Lt(Ut.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Mt(null,{creating:[ce,oe],reading:[ue,se],updating:[fe,oe],deleting:[le,oe]})}))}(this),this.Transaction=function(e){return Lt(fn.prototype,(function(t,n,r,i,o){var s=this;this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Mt(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ke((function(e,t){s._resolve=e,s._reject=t})),this._completion.then((function(){s.active=!1,s.on.complete.fire()}),(function(e){var t=s.active;return s.active=!1,s.on.error.fire(e),s.parent?s.parent._reject(e):t&&s.idbtrans&&s.idbtrans.abort(),mt(e)}))}))}(this),this.Version=function(e){return Lt(Tn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Lt(on.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};var i=e._deps.indexedDB;if(!i)throw new ne.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=function(e,t){return i.cmp(t,e)},this._max=function(e,t){return i.cmp(e,t)>0?e:t},this._min=function(e,t){return i.cmp(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+i.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+i.name+"'. Closing db now to resume the delete request."),i.close()})),this.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+i.name+"') was blocked"):console.warn("Upgrade '"+i.name+"' blocked by other connection holding version "+e.oldVersion/10)})),this._maxKey=Rt(n.IDBKeyRange),this._createTransaction=function(e,t,n,r){return new i.Transaction(e,t,n,i._options.chromeTransactionDurability,r)},this._fireOnBlocked=function(e){i.on("blocked").fire(e),Ot.filter((function(e){return e.name===i.name&&e!==i&&!e._state.vcFired})).map((function(t){return t.on("versionchange").fire(e)}))},this.use(qn),this.use(Hn),this.use(ir),this.use(Gn),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach((function(e){return e(i)}))}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new ne.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ne.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter((function(t){return t._cfg.version===e}))[0];return n||(n=new this.Version(e),t.push(n),t.sort(Sn),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||Ae.letThrough||this._vip)?e():new Ke((function(e,n){if(t._state.openComplete)return n(new ne.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return void n(new ne.DatabaseClosed);t.open().catch(oe)}t._state.dbReadyPromise.then(e,n)})).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;i&&this.unuse({stack:t,name:i});var o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:n,level:null==r?10:r,name:i}),o.sort((function(e,t){return e.level-t.level})),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((function(e){return r?e.create!==r:!!n&&e.name!==n}))),this},e.prototype.open=function(){return Bn(this)},e.prototype._close=function(){var e=this._state,t=Ot.indexOf(this);if(t>=0&&Ot.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(vr){}this._novip.idbdb=null}e.dbReadyPromise=new Ke((function(t){e.dbReadyResolve=t})),e.openCanceller=new Ke((function(t,n){e.cancelOpen=n}))},e.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new ne.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},e.prototype.delete=function(){var e=this,t=arguments.length>0,n=this._state;return new Ke((function(r,i){var o=function(){e.close();var t=e._deps.indexedDB.deleteDatabase(e.name);t.onsuccess=Qe((function(){Nn(e._deps,e.name),r()})),t.onerror=sn(i),t.onblocked=e._fireOnBlocked};if(t)throw new ne.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(o):o()}))},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return s(this._allTables).map((function(t){return e._allTables[t]}))},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=Mn.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,i=Ae.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var o,s,u=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(s=t.map((function(e){var t=e instanceof r.Table?e.name:e;if("string"!==typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===At)o=At;else{if("rw"!=e&&e!=Dt)throw new ne.InvalidArgument("Invalid transaction mode: "+e);o=Dt}if(i){if(i.mode===At&&o===Dt){if(!u)throw new ne.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach((function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!u)throw new ne.SubTransaction("Table "+e+" not included in parent transaction.");i=null}})),u&&i&&!i.active&&(i=null)}}catch(vr){return i?i._promise(null,(function(t,n){n(vr)})):mt(vr)}var a=Ln.bind(null,this,o,s,i,n);return i?i._promise(o,a,"lock"):Ae.trans?dt(Ae.transless,(function(){return r._whenReady(a)})):this._whenReady(a)},e.prototype.table=function(e){if(!f(this._allTables,e))throw new ne.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},e}(),sr="undefined"!==typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",ur=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!==typeof e?e:{next:e,error:t,complete:n})},e.prototype[sr]=function(){return this},e}();function ar(e,t){return s(t).forEach((function(n){Zn(e[n]||(e[n]=new Qn),t[n])})),e}function cr(e){return new ur((function(t){var n=L(e);var r=!1,i={},o={},u={get closed(){return r},unsubscribe:function(){r=!0,ln.storagemutated.unsubscribe(f)}};t.start&&t.start(u);var a=!1,c=!1;function l(){return s(o).some((function(e){return i[e]&&er(i[e],o[e])}))}var f=function(e){ar(i,e),l()&&d()},d=function s(){if(!a&&!r){i={};var d={},h=function(t){n&&ot();var r=function(){return it(e,{subscr:t,trans:null})},i=Ae.trans?dt(Ae.transless,r):r();return n&&i.then(st,st),i}(d);c||(ln(an,f),c=!0),a=!0,Promise.resolve(h).then((function(e){a=!1,r||(l()?s():(i={},o=d,t.next&&t.next(e)))}),(function(e){a=!1,t.error&&t.error(e),u.unsubscribe()}))}};return d(),u}))}var lr=or;function fr(e){var t=dr;try{dr=!0,ln.storagemutated.fire(e)}finally{dr=t}}d(lr,r(r({},ie),{delete:function(e){return new lr(e,{addons:[]}).delete()},exists:function(e){return new lr(e,{addons:[]}).open().then((function(e){return e.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(e){try{return function(e){var t=e.indexedDB,n=e.IDBKeyRange;return Dn(t)?Promise.resolve(t.databases()).then((function(e){return e.map((function(e){return e.name})).filter((function(e){return e!==Tt}))})):An(t,n).toCollection().primaryKeys()}(lr.dependencies).then(e)}catch(Yn){return mt(new ne.MissingAPI)}},defineClass:function(){return function(e){a(this,e)}},ignoreTransaction:function(e){return Ae.trans?dt(Ae.transless,e):e()},vip:Rn,async:function(e){return function(){try{var t=Un(e.apply(this,arguments));return t&&"function"===typeof t.then?t:Ke.resolve(t)}catch(vr){return mt(vr)}}},spawn:function(e,t,n){try{var r=Un(e.apply(n,t||[]));return r&&"function"===typeof r.then?r:Ke.resolve(r)}catch(vr){return mt(vr)}},currentTransaction:{get:function(){return Ae.trans||null}},waitFor:function(e,t){var n=Ke.resolve("function"===typeof e?lr.ignoreTransaction(e):e).timeout(t||6e4);return Ae.trans?Ae.trans.waitFor(n):n},Promise:Ke,debug:{get:function(){return F},set:function(e){q(e,"dexie"===e?function(){return!0}:Pt)}},derive:v,extend:a,props:d,override:_,Events:Mt,on:ln,liveQuery:cr,extendObservabilitySet:ar,getByKeyPath:S,setByKeyPath:j,delByKeyPath:function(e,t){"string"===typeof t?j(e,t,void 0):"length"in t&&[].map.call(t,(function(t){j(e,t,void 0)}))},shallowClone:O,deepClone:A,getObjectDiff:Wn,asap:x,minKey:kt,addons:[],connections:Ot,errnames:ee,dependencies:_t,semVer:wt,version:wt.split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,n){return e+t/Math.pow(10,2*n)}))})),lr.maxKey=Rt(lr.dependencies.IDBKeyRange),"undefined"!==typeof dispatchEvent&&"undefined"!==typeof addEventListener&&(ln(an,(function(e){var t;dr||(Et?(t=document.createEvent("CustomEvent")).initCustomEvent(cn,!0,!0,e):t=new CustomEvent(cn,{detail:e}),dr=!0,dispatchEvent(t),dr=!1)})),addEventListener(cn,(function(e){var t=e.detail;dr||fr(t)})));var dr=!1;if("undefined"!==typeof BroadcastChannel){var hr=new BroadcastChannel(cn);ln(an,(function(e){dr||hr.postMessage(e)})),hr.onmessage=function(e){e.data&&fr(e.data)}}else if("undefined"!==typeof self&&"undefined"!==typeof navigator){ln(an,(function(e){try{dr||("undefined"!==typeof localStorage&&localStorage.setItem(cn,JSON.stringify({trig:Math.random(),changedParts:e})),"object"===typeof self.clients&&i([],self.clients.matchAll({includeUncontrolled:!0})).forEach((function(t){return t.postMessage({type:cn,changedParts:e})})))}catch(Yn){}})),addEventListener("storage",(function(e){if(e.key===cn){var t=JSON.parse(e.newValue);t&&fr(t.changedParts)}}));var pr=self.document&&navigator.serviceWorker;pr&&pr.addEventListener("message",(function(e){var t=e.data;t&&t.type===cn&&fr(t.changedParts)}))}Ke.rejectionMapper=function(e,t){if(!e||e instanceof J||e instanceof TypeError||e instanceof SyntaxError||!e.name||!re[e.name])return e;var n=new re[e.name](t||e.message,e);return"stack"in e&&p(n,"stack",{get:function(){return this.inner.stack}}),n},q(F,Pt),t.default=or},64:function(e,t,n){"use strict";(function(e,r){var i=n(9),o=n(5),s=n(16),u=n(61),a=n(30),c=n(19),l=n(31),f=n(72),d=n(12),h=n(97),p=n(73),v=function(e,t){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function y(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}v(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var b=function(){return(b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function m(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{a(r.next(e))}catch(oi){o(oi)}}function u(e){try{a(r.throw(e))}catch(oi){o(oi)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))}function g(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(oi){o=[6,oi],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function _(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}var w=crypto.getRandomValues;function x(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!==typeof t&&"length"in t){!function(e){if(!e)throw new Error("Assertion Failed")}("string"!==typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)x(e,t[r],n[r])}else{var o=t.indexOf(".");if(-1!==o){var s=t.substr(0,o),u=t.substr(o+1);if(""===u)void 0===n?Array.isArray(e)?isNaN(parseInt(s))||e.splice(parseInt(s),1):delete e[s]:e[s]=n;else{var a=e[s];a||(a=e[s]={}),x(a,u,n)}}else void 0===n?Array.isArray(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}var k="undefined"===typeof self?function(t){var n=e.alloc(t);return w(n),n.toString("base64")}:function(e){var t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode.apply(null,t))};function S(e){return"string"===typeof e||!!(Array.isArray(e)&&e.some((function(e){return S(e)}))&&e.every(j))}function j(e){return"string"===typeof e||"number"===typeof e||Array.isArray(e)&&e.every(j)}function O(e,t,n){var r=e[t]||(e[t]={});switch(n.type){case"insert":case"upsert":n.keys.forEach((function(e,t){r[e]={type:"ups",val:n.values[t]}}));break;case"update":case"modify":n.keys.forEach((function(e,t){var i="update"===n.type?n.changeSpecs[t]:n.changeSpec,o=r[e];if(o)switch(o.type){case"ups":for(var s=0,u=Object.entries(i);s<u.length;s++){var a=u[s],c=a[0],l=a[1];x(o.val,c,l)}break;case"del":break;case"upd":Object.assign(o.mod,i)}else r[e]={type:"upd",mod:i}}));break;case"delete":n.keys.forEach((function(e){r[e]={type:"del"}}))}return e}function E(e,t){for(var n=0,r=t;n<r.length;n++)for(var i=r[n],o=i.table,s=0,u=i.muts;s<u.length;s++){O(e,o,u[s])}}var I=function(e,t){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function C(e,t){function n(){this.constructor=e}I(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function P(e){return"function"===typeof e}var T=!1,A={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;T=e},get useDeprecatedSynchronousErrorHandling(){return T}};function D(e){setTimeout((function(){throw e}),0)}var N={closed:!0,next:function(e){},error:function(e){if(A.useDeprecatedSynchronousErrorHandling)throw e;D(e)},complete:function(){}},R=function(){return Array.isArray||function(e){return e&&"number"===typeof e.length}}();function K(e){return null!==e&&"object"===typeof e}var B=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),U=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,r=n._parentOrParents,i=n._ctorUnsubscribe,o=n._unsubscribe,s=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var u=0;u<r.length;++u){r[u].remove(this)}if(P(o)){i&&(this._unsubscribe=void 0);try{o.call(this)}catch(oi){t=oi instanceof B?M(oi.errors):[oi]}}if(R(s)){u=-1;for(var a=s.length;++u<a;){var c=s[u];if(K(c))try{c.unsubscribe()}catch(oi){t=t||[],oi instanceof B?t=t.concat(M(oi.errors)):t.push(oi)}}}if(t)throw new B(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!==typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function M(e){return e.reduce((function(e,t){return e.concat(t instanceof B?t.errors:t)}),[])}var L=function(){return"function"===typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),F=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=N;break;case 1:if(!n){o.destination=N;break}if("object"===typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new q(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new q(o,n,r,i)}return o}return C(t,e),t.prototype[L]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(U),q=function(e){function t(t,n,r,i){var o,s=e.call(this)||this;s._parentSubscriber=t;var u=s;return P(n)?o=n:n&&(o=n.next,r=n.error,i=n.complete,n!==N&&(P((u=Object.create(n)).unsubscribe)&&s.add(u.unsubscribe.bind(u)),u.unsubscribe=s.unsubscribe.bind(s))),s._context=u,s._next=o,s._error=r,s._complete=i,s}return C(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;A.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=A.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):D(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;D(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};A.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),A.useDeprecatedSynchronousErrorHandling)throw n;D(n)}},t.prototype.__tryOrSetError=function(e,t,n){if(!A.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return A.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(D(r),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(F);var W=function(){return"function"===typeof Symbol&&Symbol.observable||"@@observable"}();function $(e){return e}function H(e){return 0===e.length?$:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var V=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,i=function(e,t,n){if(e){if(e instanceof F)return e;if(e[L])return e[L]()}return e||t||n?new F(e,t,n):new F(N)}(e,t,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||A.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),A.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){A.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),!function(e){for(;e;){var t=e,n=t.closed,r=t.destination,i=t.isStopped;if(n||i)return!1;e=r&&r instanceof F?r:null}return!0}(e)?console.warn(t):e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=z(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(n){r(n),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[W]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:H(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=z(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function z(e){if(e||(e=Promise),!e)throw new Error("no Promise impl found");return e}var Y=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}};function G(){return"function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var J=G(),Q=function(e){return e&&"number"===typeof e.length&&"function"!==typeof e};function X(e){return!!e&&"function"!==typeof e.subscribe&&"function"===typeof e.then}var Z=function(e){if(e&&"function"===typeof e[W])return r=e,function(e){var t=r[W]();if("function"!==typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(Q(e))return Y(e);if(X(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,D),e};if(e&&"function"===typeof e[J])return t=e,function(e){for(var n=t[J]();;){var r=void 0;try{r=n.next()}catch(i){return e.error(i),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"===typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,i=K(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},ee=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return C(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(F),te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return C(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(F);function ne(e,t){if(!t.closed){if(e instanceof V)return e.subscribe(t);var n;try{n=Z(e)(t)}catch(r){t.error(r)}return n}}var re=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return C(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(oi){n=!0,r=!!oi&&oi||new Error(oi)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return C(t,e),t.prototype.schedule=function(e,t){return this},t}(U)),ie=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),oe=new(function(e){function t(n,r){void 0===r&&(r=ie.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return C(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(ie))(re);function se(e){return e&&"function"===typeof e.schedule}function ue(e){return function(t){var n=new ae(e),r=t.lift(n);return n.caught=r}}var ae=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new ce(e,this.selector,this.caught))},e}(),ce=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.selector=n,i.caught=r,i}return C(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(o){return void e.prototype.error.call(this,o)}this._unsubscribeAndRecycle();var r=new ee(this);this.add(r);var i=ne(n,r);i!==r&&this.add(i)}},t}(te);function le(e,t){return new V((function(n){var r=new U,i=0;return r.add(t.schedule((function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function fe(e,t){return t?le(e,t):new V(Y(e))}function de(e,t){if(null!=e){if(function(e){return e&&"function"===typeof e[W]}(e))return function(e,t){return new V((function(n){var r=new U;return r.add(t.schedule((function(){var i=e[W]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if(X(e))return function(e,t){return new V((function(n){var r=new U;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(Q(e))return le(e,t);if(function(e){return e&&"function"===typeof e[J]}(e)||"string"===typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new V((function(n){var r,i=new U;return i.add((function(){r&&"function"===typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[J](),i.add(t.schedule((function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(o){return void n.error(o)}t?n.complete():(n.next(e),this.schedule())}})))}))),i}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function he(e,t){return t?de(e,t):e instanceof V?e:new V(Z(e))}function pe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return se(n)?(e.pop(),le(e,n)):fe(e)}function ve(e,t){return function(n){if("function"!==typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new ye(e,t))}}var ye=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new be(e,this.project,this.thisArg))},e}(),be=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return C(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(F);function me(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"===typeof t?function(r){return r.pipe(me((function(n,r){return he(e(n,r)).pipe(ve((function(e,i){return t(n,e,r,i)})))}),n))}:("number"===typeof t&&(n=t),function(t){return t.lift(new ge(e,n))})}var ge=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new _e(e,this.project,this.concurrent))},e}(),_e=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return C(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new ee(this),n=this.destination;n.add(t);var r=ne(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(te);function we(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),me($,e)}function xe(){return we(1)}function ke(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return xe()(pe.apply(void 0,e))}function Se(e,t){return void 0===t&&(t=oe),function(n){return n.lift(new je(e,t))}}var je=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Oe(e,this.dueTime,this.scheduler))},e}(),Oe=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return C(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Ee,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(F);function Ee(e){e.debouncedNext()}function Ie(e){return e instanceof Date&&!isNaN(+e)}var Ce=new V((function(e){return e.complete()}));function Pe(e){return e?function(e){return new V((function(t){return e.schedule((function(){return t.complete()}))}))}(e):Ce}function Te(e,t){return new V(t?function(n){return t.schedule(Ae,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function Ae(e){var t=e.error;e.subscriber.error(t)}var De=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"===typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return pe(this.value);case"E":return Te(this.error);case"C":return Pe()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return"undefined"!==typeof t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();function Ne(e,t){void 0===t&&(t=oe);var n=Ie(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new Re(n,t))}}var Re=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Ke(e,this.delay,this.scheduler))},e}(),Ke=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return C(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(e,o)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new Be(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(De.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(De.createComplete()),this.unsubscribe()},t}(F),Be=function(){return function(e,t){this.time=e,this.notification=t}}();var Ue=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Me(e,this.compare,this.keySelector))},e}(),Me=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"===typeof n&&(i.compare=n),i}return C(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(i){return this.destination.error(i)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(i){return this.destination.error(i)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))},t}(F),Le=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}();function Fe(e,t){return function(n){return n.lift(new qe(e,t))}}var qe=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new We(e,this.predicate,this.thisArg))},e}(),We=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return C(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)},t}(F);function $e(e){return function(t){return 0===e?Pe():t.lift(new He(e))}}var He=function(){function e(e){if(this.total=e,this.total<0)throw new Le}return e.prototype.call=function(e,t){return t.subscribe(new Ve(e,this.total))},e}(),Ve=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return C(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(F);function ze(e){return function(t){return t.lift(new Ye(e))}}var Ye=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new Ge(e,this.total))},e}(),Ge=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return C(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(F);function Je(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return se(n)?(e.pop(),function(t){return ke(e,t,n)}):function(t){return ke(e,t)}}function Qe(e,t){return"function"===typeof t?function(n){return n.pipe(Qe((function(n,r){return he(e(n,r)).pipe(ve((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new Xe(e))}}var Xe=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Ze(e,this.project))},e}(),Ze=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return C(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new ee(this),r=this.destination;r.add(n),this.innerSubscription=ne(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(te);function et(){}function tt(e,t,n){return function(r){return r.lift(new nt(e,t,n))}}var nt=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new rt(e,this.nextOrObserver,this.error,this.complete))},e}(),rt=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o._tapNext=et,o._tapError=et,o._tapComplete=et,o._tapError=r||et,o._tapComplete=i||et,P(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||et,o._tapError=n.error||et,o._tapComplete=n.complete||et),o}return C(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(F),it=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}();var ot=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new st(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),st=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.absoluteTimeout=n,s.waitFor=r,s.withObservable=i,s.scheduler=o,s.scheduleTimeout(),s}return C(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(ne(t,new ee(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(te);function ut(e,t){return void 0===t&&(t=oe),function(e,t,n){return void 0===n&&(n=oe),function(r){var i=Ie(e),o=i?+e-n.now():Math.abs(e);return r.lift(new ot(o,i,t,n))}}(e,Te(new it),t)}var at=!1;function ct(e,t){return m(this,void 0,void 0,(function(){var n,r;return g(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),[4,navigator.serviceWorker.ready];case 1:return n=i.sent(),"push"===t&&n.sync?[4,n.sync.register("dexie-cloud:"+e.name)]:[3,3];case 2:i.sent(),i.label=3;case 3:return n.active?n.active.postMessage({type:"dexie-cloud-sync",dbName:e.name,purpose:t}):console.error("Dexie Cloud: There's no active service worker. Can this ever happen??"),[2];case 4:return r=i.sent(),at||(console.debug("Dexie Cloud: Could not register sync event",r),at=!0),[3,5];case 5:return[2]}}))}))}function lt(e,t){e.cloud.usingServiceWorker?ct(e,t):e.localSyncEvent.next({purpose:t})}var ft="undefined"!==typeof e?function(t){return e.from(t,"base64")}:function(e){for(var t=atob(e),n=t.length,r=new Uint8Array(n),i=0;i<n;i++)r[i]=t.charCodeAt(i);return r},dt="undefined"!==typeof e?function(t){return ArrayBuffer.isView(t)?e.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"):e.from(t).toString("base64")}:function(e){return btoa(String.fromCharCode.apply(null,e))};function ht(e,t){return new Promise((function(n,r){var o=b(b({},t),{onSubmit:function(t){e.next(void 0),n(t)},onCancel:function(){e.next(void 0),r(new i.a.AbortError("User cancelled"))}});e.next(o)}))}function pt(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return ht(e,{type:"message-alert",title:t,alerts:n,fields:{}})}function vt(e,t,n){return m(this,void 0,void 0,(function(){var r;return g(this,(function(i){switch(i.label){case 0:r=n||"",i.label=1;case 1:return r&&/^[\w-\.]+@([\w-]+\.)+[\w-]{2,10}$/.test(r)?[3,3]:[4,ht(e,{type:"email",title:t,alerts:r?[{type:"error",messageCode:"INVALID_EMAIL",message:"Please enter a valid email address",messageParams:{}}]:[],fields:{email:{type:"email",placeholder:"you@somedomain.com"}}})];case 2:return r=i.sent().email,[3,1];case 3:return[2,r]}}))}))}function yt(e,t,n){return m(this,void 0,void 0,(function(){var r;return g(this,(function(i){switch(i.label){case 0:return r=[{type:"info",messageCode:"OTP_SENT",message:"A One-Time password has been sent to {email}",messageParams:{email:t}}],n&&r.push(n),[4,ht(e,{type:"otp",title:"Enter OTP",alerts:r,fields:{otp:{type:"otp",label:"OTP",placeholder:"Paste OTP here"}}})];case 1:return[2,i.sent().otp]}}))}))}function bt(e){return m(this,void 0,void 0,(function(){var t,n,r,i,o,s,u,a,c;return g(this,(function(l){switch(l.label){case 0:return[4,e.getCurrentUser()];case 1:if(r=l.sent(),i=r.accessToken,o=r.accessTokenExpiration,s=r.refreshToken,u=r.refreshTokenExpiration,a=r.claims,!i)return[2];if((null!==(t=null===o||void 0===o?void 0:o.getTime())&&void 0!==t?t:1/0)>Date.now())return[2,i];if(!s)throw new Error("Refresh token missing");if((null!==(n=null===u||void 0===u?void 0:u.getTime())&&void 0!==n?n:1/0)<=Date.now())throw new Error("Refresh token has expired");return[4,gt(e.cloud.options.databaseUrl,r)];case 2:return c=l.sent(),[4,e.table("$logins").update(a.sub,{accessToken:c.accessToken,accessTokenExpiration:c.accessTokenExpiration})];case 3:return l.sent(),[2,c.accessToken]}}))}))}function mt(e,t,n,r,i){return m(this,void 0,void 0,(function(){return g(this,(function(o){switch(o.label){case 0:return t.accessToken&&t.accessTokenExpiration.getTime()>Date.now()?[2,t]:[3,1];case 1:return t.refreshToken&&(!t.refreshTokenExpiration||t.refreshTokenExpiration.getTime()>Date.now())?[4,gt(e,t)]:[3,3];case 2:return[2,o.sent()];case 3:return[4,_t(t,n,r,i)];case 4:return[2,o.sent()]}}))}))}function gt(e,t){return m(this,void 0,void 0,(function(){var n,r,i,o,s,u,a,c,l;return g(this,(function(f){switch(f.label){case 0:if(!t.refreshToken)throw new Error("Cannot refresh token - refresh token is missing.");if(!t.nonExportablePrivateKey)throw new Error("login.nonExportablePrivateKey is missing - cannot sign refresh token without a private key.");return n=Date.now(),r="RSASSA-PKCS1-v1_5",i=new TextEncoder,o=i.encode(t.refreshToken+n),[4,crypto.subtle.sign(r,t.nonExportablePrivateKey,o)];case 1:return s=f.sent(),u=dt(s),a={grant_type:"refresh_token",refresh_token:t.refreshToken,scopes:["ACCESS_DB"],signature:u,signing_algorithm:r,time_stamp:n},[4,fetch(e+"/token",{body:JSON.stringify(a),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})];case 2:if(200!==(c=f.sent()).status)throw new Error("RefreshToken: Status "+c.status+" from "+e+"/token");return[4,c.json()];case 3:return l=f.sent(),t.accessToken=l.accessToken,t.accessTokenExpiration=l.accessTokenExpiration?new Date(l.accessTokenExpiration):void 0,[2,t]}}))}))}function _t(e,t,n,r){return m(this,void 0,void 0,(function(){var i,o,s,u,a,c,l;return g(this,(function(f){switch(f.label){case 0:return[4,crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"])];case 1:return i=f.sent(),o=i.privateKey,s=i.publicKey,e.nonExportablePrivateKey=o,[4,crypto.subtle.exportKey("spki",s)];case 2:u=f.sent(),a=function(e){for(var t="-----BEGIN PUBLIC KEY-----\n";e.length>0;)t+=e.substring(0,64)+"\n",e=e.substring(64);return t+="-----END PUBLIC KEY-----"}(dt(u)),e.publicKey=s,f.label=3;case 3:return f.trys.push([3,7,,9]),[4,t({public_key:a,hints:r})];case 4:if("tokens"!==(c=f.sent()).type)throw new Error("Unexpected response type from token endpoint: "+c.type);return e.accessToken=c.accessToken,e.accessTokenExpiration=new Date(c.accessTokenExpiration),e.refreshToken=c.refreshToken,c.refreshTokenExpiration&&(e.refreshTokenExpiration=new Date(c.refreshTokenExpiration)),e.userId=c.claims.sub,e.email=c.claims.email,e.name=c.claims.name,e.claims=c.claims,c.alerts&&c.alerts.length>0?[4,ht(n,{type:"message-alert",title:"Authentication Alert",fields:{},alerts:c.alerts})]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,e];case 7:return l=f.sent(),[4,pt(n,"Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:"We're having a problem to authenticate rigth now.",messageParams:{}}).catch((function(){}))];case 8:throw f.sent(),l;case 9:return[2]}}))}))}var wt=new WeakMap,xt=function(){function e(e,t){wt.set(this,e),Object.assign(this,t)}return e.load=function(t,n){return t.table("$logins").get(n).then((function(r){return new e(t,r||{userId:n,claims:{sub:n},lastLogin:new Date(0)})}))},e.prototype.save=function(){return m(this,void 0,void 0,(function(){return g(this,(function(e){return wt.get(this).table("$logins").put(this),[2]}))}))},e}(),kt=function(e){function t(t,n){var r=e.call(this,n||t.status+" "+t.statusText)||this;return r.httpStatus=t.status,r}return y(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"HttpError"},enumerable:!1,configurable:!0}),t}(Error);function St(e){var t=e.cloud.userInteraction;return function(n){var r=n.public_key,i=n.hints;return m(this,void 0,void 0,(function(){var n,o,s,u,a,c,l,f,d,h,p,v;return g(this,(function(y){switch(y.label){case 0:if(!(s=null===(n=e.cloud.options)||void 0===n?void 0:n.databaseUrl))throw new Error("No database URL given.");return"demo"!==(null===i||void 0===i?void 0:i.grant_type)?[3,2]:[4,vt(t,"Enter a demo user email",(null===i||void 0===i?void 0:i.email)||(null===i||void 0===i?void 0:i.userId))];case 1:return u=y.sent(),o={demo_user:u,grant_type:"demo",scopes:["ACCESS_DB"],public_key:r},[3,4];case 2:return[4,vt(t,"Enter email address",null===i||void 0===i?void 0:i.email)];case 3:a=y.sent(),o={email:a,grant_type:"otp",scopes:["ACCESS_DB"],public_key:r},y.label=4;case 4:return[4,fetch(s+"/token",{body:JSON.stringify(o),method:"post",headers:{"Content-Type":"application/json",mode:"cors"}})];case 5:return 200===(c=y.sent()).status?[3,8]:[4,c.text()];case 6:return v=y.sent(),[4,pt(t,"Token request failed",{type:"error",messageCode:"GENERIC_ERROR",message:v,messageParams:{}}).catch((function(){}))];case 7:throw y.sent(),new kt(c,v);case 8:return[4,c.json()];case 9:return"tokens"!==(l=y.sent()).type?[3,10]:[2,l];case 10:if("otp"!==o.grant_type)return[3,22];if("otp-sent"!==l.type)throw new Error("Unexpected response from "+s+"/token");return[4,yt(t,o.email)];case 11:return f=y.sent(),o.otp=f||"",o.otp_id=l.otp_id,[4,fetch(s+"/token",{body:JSON.stringify(o),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})];case 12:d=y.sent(),y.label=13;case 13:return 401!==d.status?[3,17]:[4,d.text()];case 14:return h=y.sent(),p=o,[4,yt(t,o.email,{type:"error",messageCode:"INVALID_OTP",message:h,messageParams:{}})];case 15:return p.otp=y.sent(),[4,fetch(s+"/token",{body:JSON.stringify(o),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})];case 16:return d=y.sent(),[3,13];case 17:return 200===d.status?[3,20]:[4,d.text()];case 18:return v=y.sent(),[4,pt(t,"OTP Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:v,messageParams:{}}).catch((function(){}))];case 19:throw y.sent(),new kt(d,v);case 20:return[4,d.json()];case 21:return[2,y.sent()];case 22:throw new Error("Unexpected response from "+s+"/token")}}))}))}}function jt(e,t){return m(this,void 0,void 0,(function(){var n,r=this;return g(this,(function(i){switch(i.label){case 0:return t.userId===e.cloud.currentUserId?[2]:(n=e.table("$logins"),[4,e.transaction("rw",n,(function(e){return m(r,void 0,void 0,(function(){var e;return g(this,(function(r){switch(r.label){case 0:return[4,n.toArray()];case 1:return e=r.sent(),[4,Promise.all(e.filter((function(e){return e.userId!==t.userId&&e.isLoggedIn})).map((function(e){return e.isLoggedIn=!1,n.put(e)})))];case 2:return r.sent(),t.isLoggedIn=!0,t.lastLogin=new Date,[4,t.save()];case 3:return r.sent(),console.debug("Saved new user",t.email),[2]}}))}))}))]);case 1:return i.sent(),[4,new Promise((function(n){if(e.cloud.currentUserId===t.userId)n(null);else var r=e.cloud.currentUser.subscribe((function(e){e.userId===t.userId&&(r.unsubscribe(),n(null))}))}))];case 2:return i.sent(),[2]}}))}))}function Ot(e,t){return m(this,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return[4,e.getCurrentUser()];case 1:if(r.sent().isLoggedIn){if(t){if(t.email&&e.cloud.currentUser.value.email!==t.email)throw new Error("Must logout before changing user");if(t.userId&&e.cloud.currentUserId!==t.userId)throw new Error("Must logout before changing user")}return[2]}return n=new xt(e,{claims:{},lastLogin:new Date(0)}),[4,mt(e.cloud.options.databaseUrl,n,e.cloud.options.fetchTokens||St(e),e.cloud.userInteraction,t)];case 2:return r.sent(),[4,n.save()];case 3:return r.sent(),[4,jt(e,n)];case 4:return r.sent(),lt(e,"pull"),[2]}}))}))}var Et={userId:"unauthorized",name:"Unauthorized",claims:{sub:"unauthorized"},lastLogin:new Date(0)};try{Object.freeze(Et),Object.freeze(Et.claims)}catch(wi){}var It={},Ct=self.document&&navigator.serviceWorker;Ct&&Ct.ready.then((function(e){return It.registration=e})),"undefined"!==typeof self&&"clients"in self&&!self.document&&addEventListener("message",(function(e){var t,n;(null===(n=null===(t=e.data)||void 0===t?void 0:t.type)||void 0===n?void 0:n.startsWith("sw-broadcast-"))&&_([],self.clients.matchAll({includeUncontrolled:!0})).forEach((function(t){var n;return t.id!==(null===(n=e.source)||void 0===n?void 0:n.id)&&t.postMessage(e.data)}))}));var Pt=function(){function e(e){this.name=e}return e.prototype.subscribe=function(e){var t=this;if(!Ct)return function(){};var n=function(n){var r;(null===(r=n.data)||void 0===r?void 0:r.type)==="sw-broadcast-"+t.name&&e(n.data.message)};return Ct.addEventListener("message",n),function(){return Ct.removeEventListener("message",n)}},e.prototype.postMessage=function(e){var t,n=this;"object"===typeof self.clients?_([],self.clients.matchAll({includeUncontrolled:!0})).forEach((function(t){return t.postMessage({type:"sw-broadcast-"+n.name,message:e})})):It.registration&&(null===(t=It.registration.active)||void 0===t||t.postMessage({type:"sw-broadcast-"+this.name,message:e}))},e}(),Tt=function(e){function t(t){var n=this,r="undefined"===typeof BroadcastChannel?new Pt(t):new BroadcastChannel(t);return(n=e.call(this,(function(e){function n(t){e.next(t.detail)}function i(t){console.debug("BroadcastedAndLocalEvent: onMessageEvent",t),e.next(t.data)}var o;return self.addEventListener("lbc-"+t,n),r instanceof Pt?o=r.subscribe((function(t){return e.next(t)})):(console.debug("BroadcastedAndLocalEvent: bc.addEventListener()",t,"bc is a",r),r.addEventListener("message",i)),function(){self.removeEventListener("lbc-"+t,n),r instanceof Pt?o():r.removeEventListener("message",i)}}))||this).name=t,n.bc=r,n}return y(t,e),t.prototype.next=function(e){console.debug("BroadcastedAndLocalEvent: bc.postMessage()",b({},e),"bc is a",this.bc),this.bc.postMessage(e);var t=new CustomEvent("lbc-"+this.name,{detail:e});self.dispatchEvent(t)},t}(o.a);function At(e){var t=e.realms,n=e.inviteRealms;return m(this,void 0,void 0,(function(){var e,r,i;return g(this,(function(o){switch(o.label){case 0:return e=JSON.stringify(_(_([],t.map((function(e){return{realmId:e,accepted:!0}}))),n.map((function(e){return{realmId:e,accepted:!1}}))).sort((function(e,t){return e.realmId<t.realmId?-1:e.realmId>t.realmId?1:0}))),r=(new TextEncoder).encode(e),[4,crypto.subtle.digest("SHA-1",r)];case 1:return i=o.sent(),[2,dt(i)]}}))}))}function Dt(e){return Object.entries(e.cloud.schema||{}).filter((function(e){return e[1].markedForSync})).map((function(t){var n=t[0];return e.table(n)}))}function Nt(e){return"$"+e+"_mutations"}function Rt(e){var t,n=null===(t=/^\$(.*)_mutations$/.exec(e))||void 0===t?void 0:t[1];if(!n)throw new Error("Given mutationTable "+e+" is not correct");return n}function Kt(e,t,n){var r=void 0===n?{}:n,i=r.since,o=void 0===i?{}:i,s=r.limit,u=void 0===s?1/0:s;return m(this,void 0,void 0,(function(){var t=this;return g(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return m(t,void 0,void 0,(function(){var t,n,r,i;return g(this,(function(s){switch(s.label){case 0:return t=Rt(e.name),n=o[t],r=n?e.where("rev").above(n):e,u<1/0&&(r=r.limit(u)),[4,r.toArray()];case 1:return i=s.sent(),[2,{table:t,muts:i}]}}))}))})))];case 1:return[2,n.sent().filter((function(e){return e.muts.length>0}))]}}))}))}function Bt(e,t,n,r){return m(this,void 0,void 0,(function(){var i,o=this;return g(this,(function(s){switch(s.label){case 0:return t.isLoggedIn&&e.length>0?(i=new Set(r||[]),[4,Promise.all(e.map((function(e){return m(o,void 0,void 0,(function(){var r,o,s,u;return g(this,(function(a){switch(a.label){case 0:return(r=e.core.schema.primaryKey.extractKey)?(o=n[e.name],[4,((null===o||void 0===o?void 0:o.generatedGlobalId)?e.filter((function(e){return!i.has(e.realmId||"")&&S(r(e))})):e.filter((function(e){return!i.has(e.realmId||"")&&(t=r(e),!(n=null===o||void 0===o?void 0:o.idPrefix)||"string"===typeof t&&t.startsWith(n));var t,n}))).toArray()]):[2,{table:e.name,muts:[]}];case 1:return(s=a.sent()).length>0?(u={type:"insert",values:s,keys:s.map(r),userId:t.userId},[2,{table:e.name,muts:[u]}]):[2,{table:e.name,muts:[]}]}}))}))})))]):[3,2];case 1:return[2,s.sent().filter((function(e){return e.muts.length>0}))];case 2:return[2,[]]}}))}))}var Ut={}.toString;function Mt(e){return Ut.call(e).slice(8,-1)}var Lt={replace:function(e){for(var t=Object.keys(e),n=null,r=0,i=t.length;r<i;++r)"$"===t[r][0]&&(n=n||[]).push(t[r]);if(!n)return e;for(var o=b({},e),s=0,u=n;s<u.length;s++){var a=u[s];delete o[a],o["$"+a]=e[a]}return o}};function Ft(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.reduce((function(e,t){return b(b({},e),t)}),e.reduce((function(e,t){return b(b({},t),e)}),{})),r=new WeakMap;return{stringify:function(e,t,r){return JSON.stringify(e,(function(e){var r=this[e],o=i(r);return o?o.replace(r,t,n):r}),r)},parse:function(e,t){var r=null,i=[];return JSON.parse(e,(function(e,o){var s=null===o||void 0===o?void 0:o.$t;if(s){var u=n[s];o=u?u.revive(o,t,n):o}if(o===r){if(i.length>0){o=b({},o);for(var a=0,c=i;a<c.length;a++){var l=c[a];o[l.substr(1)]=o[l],delete o[l]}}return i=[],o}return"$"===e[0]&&"$t"!==e&&(r=this,i.push(e)),o}))}};function i(e){var t=typeof e;switch(typeof e){case"object":case"function":if(null===e)return null;var i=Object.getPrototypeOf(e);if(!i)return Lt;var o=r.get(i);if(void 0!==o)return o;var s=Mt(e),u=Object.entries(n).find((function(t){var n,r,i=t[0],o=t[1];return null!==(r=null===(n=null===o||void 0===o?void 0:o.test)||void 0===n?void 0:n.call(o,e,s))&&void 0!==r?r:i===s}));return(o=null===u||void 0===u?void 0:u[1])||(o=Array.isArray(e)?null:"function"===typeof e?n.function||null:Lt),r.set(i,o),o;default:return n[t]}}}var qt={Blob:{test:function(e,t){return"Blob"===t},replace:function(e,t){var n=t.length;return t.push(e),{$t:"Blob",mimeType:e.type,i:n}},revive:function(e,t){var n=e.i,r=e.mimeType;return new Blob([t[n]],{type:r})}}},Wt={number:{replace:function(e){switch(!0){case isNaN(e):return{$t:"number",v:"NaN"};case e===1/0:return{$t:"number",v:"Infinity"};case e===-1/0:return{$t:"number",v:"-Infinity"};default:return e}},revive:function(e){var t=e.v;return Number(t)}}},$t={bigint:{replace:function(e){return{$t:"bigint",v:""+e}},revive:function(e){return BigInt(e.v)}}},Ht={Date:{replace:function(e){return{$t:"Date",v:isNaN(e.getTime())?"NaN":e.toISOString()}},revive:function(e){var t=e.v;return new Date("NaN"===t?NaN:Date.parse(t))}}},Vt={Set:{replace:function(e){return{$t:"Set",v:Array.from(e.entries())}},revive:function(e){var t=e.v;return new Set(t)}}},zt={Map:{replace:function(e){return{$t:"Map",v:Array.from(e.entries())}},revive:function(e){var t=e.v;return new Map(t)}}},Yt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"===typeof r?r:void 0,Gt=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","DataView","BigInt64Array","BigUint64Array"].reduce((function(e,t){var n;return b(b({},e),((n={})[t]={replace:function(e,n,r){return{$t:t,v:r.ArrayBuffer.replace(0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength),n,r).v}},revive:function(e,n,r){var i=e.v,o=Yt[t];return o&&new o(r.ArrayBuffer.revive({v:i},n,r))}},n))}),{});function Jt(e){return function(e){for(var t="",n=0,r=e.length;n<r;n++)t+=Zt[e[n]];return t}(dt(e))}function Qt(e){return ft(function(e){if("string"!==typeof e)throw new Error("invalid decoder input: "+e);for(var t="",n=0,r=e.length;n<r;n++)t+=Xt[e[n]];return t}(e))}for(var Xt={"-":"=",0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",A:"K",B:"L",C:"M",D:"N",E:"O",F:"P",G:"Q",H:"R",I:"S",J:"T",K:"U",L:"V",M:"W",N:"X",O:"Y",P:"Z",Q:"a",R:"b",S:"c",T:"d",U:"e",V:"f",W:"g",X:"h",Y:"i",Z:"j",_:"k",a:"l",b:"m",c:"n",d:"o",e:"p",f:"q",g:"r",h:"s",i:"t",j:"u",k:"v",l:"w",m:"x",n:"y",o:"z",p:"0",q:"1",r:"2",s:"3",t:"4",u:"5",v:"6",w:"7",x:"8",y:"9",z:"+","|":"/"},Zt={},en=0,tn=Object.keys(Xt);en<tn.length;en++){var nn=tn[en];Zt[Xt[nn]]=nn}var rn={ArrayBuffer:{replace:function(e){return{$t:"ArrayBuffer",v:Jt(e)}},revive:function(e){var t=Qt(e.v);return t.buffer.byteLength===t.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}}},on=function(e,t){this.buf=e,this.type=t};function sn(e){var t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",URL.createObjectURL(e),!1),t.send(),200!==t.status&&0!==t.status)throw new Error("Bad Blob access: "+t.status);return t.responseText}function un(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t.buffer}var an={Blob:{test:function(e,t){return"Blob"===t||e instanceof on},replace:function(e){return{$t:"Blob",v:dt(e instanceof on?e.buf:un(sn(e))),type:e.type}},revive:function(e){var t=e.type,n=e.v,r=ft(n);return void 0!==typeof Blob?new Blob([r]):new on(r.buffer,t)}}},cn=b(b(b(b(b(b(b(b({},Wt),$t),Ht),Vt),zt),Gt),rn),an);function ln(e){return new Promise((function(t,n){var r=new FileReader;r.onabort=function(e){return n(new Error("file read aborted"))},r.onerror=function(e){return n(e.target.error)},r.onload=function(e){return t(e.target.result)},r.readAsText(e)}))}function fn(e){return new Promise((function(t,n){var r=new FileReader;r.onabort=function(e){return n(new Error("file read aborted"))},r.onerror=function(e){return n(e.target.error)},r.onload=function(e){return t(e.target.result)},r.readAsArrayBuffer(e)}))}var dn={undefined:{replace:function(){},revive:function(){}}},hn="bigint"===typeof BigInt(0),pn=function(){function e(e){this.v=e}return e.prototype.toString=function(){return this.v},e}(),vn=b(b({},dn),hn?{}:{bigint:{test:function(e){return e instanceof pn},replace:function(e){return b({$t:"bigint"},e)},revive:function(e){var t=e.v;return new pn(t)}}}),yn=Ft(cn,vn),bn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Ft.apply(void 0,_([cn,qt],e));return{toBinary:function(e){var t=this.stringify(e),n=t[0],r=t[1],i=new ArrayBuffer(4);return new DataView(i).setUint32(0,n.size),new Blob([i,n,r])},stringify:function(e){var t=[],r=n.stringify(e,t);return[new Blob(t.map((function(e){var t=new ArrayBuffer(4);return new DataView(t).setUint32(0,"byteLength"in e?e.byteLength:e.size),new Blob([t,e])}))),r]},parse:function(e,t){return m(this,void 0,void 0,(function(){var r,i,o,s,u,a;return g(this,(function(c){switch(c.label){case 0:return r=0,i=[],[4,fn(t)];case 1:for(o=c.sent(),s=new DataView(o);r<o.byteLength;)u=s.getUint32(r),r+=4,a=o.slice(r,r+u),r+=u,i.push(a);return[2,n.parse(e,i)]}}))}))},fromBinary:function(e){return m(this,void 0,void 0,(function(){var t,n,r,i;return g(this,(function(o){switch(o.label){case 0:return n=DataView.bind,[4,fn(e.slice(0,4))];case 1:return t=(new(n.apply(DataView,[void 0,o.sent()]))).getUint32(0),r=e.slice(4,t+4),[4,ln(e.slice(t+4))];case 2:return i=o.sent(),[4,this.parse(i,r)];case 3:return[2,o.sent()]}}))}))}}}(vn);function mn(e,t,n,r,i,o,s){return m(this,void 0,void 0,(function(){var u,a,c,l,f,d,h;return g(this,(function(p){switch(p.label){case 0:return u={Accept:"application/json, application/x-bison, application/x-bison-stream","Content-Type":"application/tson"},[4,bt(r)];case 1:return(a=p.sent())&&(u.Authorization="Bearer "+a),c={v:2,dbID:null===t||void 0===t?void 0:t.remoteDbId,clientIdentity:s,schema:o||{},lastPull:t?{serverRevision:t.serverRevision,realms:t.realms,inviteRealms:t.inviteRealms}:void 0,baseRevs:n,changes:e},console.debug("Sync request",c),r.syncStateChangedEvent.next({phase:"pushing"}),[4,fetch(i+"/sync",{method:"post",headers:u,body:yn.stringify(c)})];case 2:if(l=p.sent(),r.syncStateChangedEvent.next({phase:"pulling"}),!l.ok)throw new kt(l);switch(l.headers.get("content-type")){case"application/x-bison":return[3,3];case"application/x-bison-stream":case"application/json":return[3,5]}return[3,5];case 3:return d=(f=bn).fromBinary,[4,l.blob()];case 4:return[2,d.apply(f,[p.sent()])];case 5:return[4,l.text()];case 6:return h=p.sent(),[2,yn.parse(h)]}}))}))}function gn(e,t,n){return m(this,void 0,void 0,(function(){var r,i,o,s;return g(this,(function(u){switch(u.label){case 0:r=new Set(n||[]),i=0,o=e,u.label=1;case 1:return i<o.length?"members"!==(s=o[i]).name?[3,3]:[4,s.toCollection().modify((function(e){r.has(e.realmId)||e.userId!==Et.userId||(e.userId=t.userId)}))]:[3,9];case 2:return u.sent(),[3,8];case 3:return"roles"!==s.name?[3,4]:[3,8];case 4:return"realms"!==s.name?[3,6]:[4,s.toCollection().modify((function(e){(r.has(e.realmId)||e.owner)&&e.owner!==Et.userId||(e.owner=t.userId)}))];case 5:return u.sent(),[3,8];case 6:return[4,s.toCollection().modify((function(e){e.realmId&&r.has(e.realmId)||(e.owner&&e.owner!==Et.userId||(e.owner=t.userId),e.realmId&&e.realmId!==Et.userId||(e.realmId=t.userId))}))];case 7:u.sent(),u.label=8;case 8:return i++,[3,1];case 9:return[2]}}))}))}function _n(e,t,n){return m(this,void 0,void 0,(function(){var r,o,s;return g(this,(function(u){switch(u.label){case 0:return[4,e.bulkGet(t)];case 1:return r=u.sent(),o=[],s=[],t.forEach((function(t,u){var a=r[u];if(a){for(var c=0,l=Object.entries(n[u]);c<l.length;c++){var f=l[c],d=f[0],h=f[1];if(d===e.schema.primKey.keyPath)throw new Error("Cannot change primary key");i.a.setByKeyPath(a,d,h)}o.push(t),s.push(a)}})),[4,null==e.schema.primKey.keyPath?e.bulkPut(s,o):e.bulkPut(s)];case 2:return u.sent(),[2]}}))}))}function wn(e){if(null===e||void 0===e?void 0:e.cancelled)throw new i.a.AbortError("Operation was cancelled")}var xn=navigator.onLine;function kn(e,t,n,r){return m(this,void 0,void 0,(function(){return g(this,(function(i){switch(i.label){case 0:return[4,e.$baseRevs.bulkPut(Object.keys(t).filter((function(e){return t[e].markedForSync})).map((function(e){return{tableName:e,clientRev:(n[e]||0)+1,serverRev:r}})))];case 1:return i.sent(),[2]}}))}))}function Sn(e,t){void 0===t&&(t={});for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i.table,s=i.muts,u=s.length>0?s[s.length-1].rev:null;t[o]=u||t[o]||0}return t}self.addEventListener("online",(function(){return xn=!0})),self.addEventListener("offline",(function(){return xn=!1}));function jn(e,t,n,r){var i=this;return On.apply(this,arguments).then((function(){(null===r||void 0===r?void 0:r.justCheckIfNeeded)||e.syncStateChangedEvent.next({phase:"in-sync"})})).catch((function(o){return m(i,void 0,void 0,(function(){return g(this,(function(i){switch(i.label){case 0:return(null===r||void 0===r?void 0:r.justCheckIfNeeded)?[2,Promise.reject(o)]:(console.debug("Error from _sync",{isOnline:xn,syncOptions:r,error:o}),xn&&(null===r||void 0===r?void 0:r.retryImmediatelyOnFetchError)&&"TypeError"===(null===o||void 0===o?void 0:o.name)&&/fetch/.test(null===o||void 0===o?void 0:o.message)?(e.syncStateChangedEvent.next({phase:"error",error:o}),[4,new Promise((function(e){return setTimeout(e,500)}))]):[3,3]);case 1:return i.sent(),[4,jn(e,t,n,b(b({},r),{retryImmediatelyOnFetchError:!1}))];case 2:return[2,i.sent()];case 3:return[4,e.$syncState.update("syncState",{timestamp:new Date,error:""+o})];case 4:return i.sent(),e.syncStateChangedEvent.next({phase:xn?"error":"offline",error:o}),[2,Promise.reject(o)]}}))}))}))}function On(e,t,n,r){var i=void 0===r?{isInitialSync:!1}:r,o=i.isInitialSync,s=i.cancelToken,u=i.justCheckIfNeeded,a=i.purpose;return m(this,void 0,void 0,(function(){var r,i,c,l,f,d,h,p,v,y,b,_,w,x,S,j,O=this;return g(this,(function(E){switch(E.label){case 0:if(u||console.debug("SYNC STARTED",{isInitialSync:o,purpose:a}),!(null===(r=e.cloud.options)||void 0===r?void 0:r.databaseUrl))throw new Error("Internal error: sync must not be called when no databaseUrl is configured");return i=t.databaseUrl,[4,e.getCurrentUser()];case 1:return c=E.sent(),l=c.isLoggedIn?Dt(e):[],f=l.map((function(t){return e.table(Nt(t.name))})),[4,e.getPersistedSyncState()];case 2:return d=E.sent(),h=!o&&c.isLoggedIn?function(e,t){var n=(null===t||void 0===t?void 0:t.syncedTables)||[];return Dt(e).filter((function(e){return!n.includes(e.name)}))}(e,d):[],wn(s),(p=h.length>0)?u?[2,!0]:(console.debug("sync doSyncify is true"),[4,e.transaction("rw",h,(function(e){return m(O,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return e.idbtrans.disableChangeTracking=!0,e.idbtrans.disableAccessControl=!0,[4,gn(h,c,null===d||void 0===d?void 0:d.realms)];case 1:return t.sent(),[2]}}))}))}))]):[3,4];case 3:E.sent(),wn(s),E.label=4;case 4:return[4,e.transaction("r",e.tables,(function(){return m(O,void 0,void 0,(function(){var t,r,i,o;return g(this,(function(u){switch(u.label){case 0:return[4,e.getPersistedSyncState()];case 1:return t=u.sent(),[4,e.$baseRevs.toArray()];case 2:return r=u.sent(),[4,Kt(f)];case 3:return i=u.sent(),wn(s),p?[4,Bt(h,c,n,null===d||void 0===d?void 0:d.realms)]:[3,5];case 4:return o=u.sent(),wn(s),[2,[i=i.concat(o),t,r]];case 5:return[2,[i,t,r]]}}))}))}))];case 5:return v=E.sent(),y=v[0],b=v[1],_=v[2],w=y.some((function(e){return e.muts.some((function(e){return e.keys.length>0}))})),u?(console.debug("Sync is needed:",w),[2,w]):"push"!==a||w?(x=Sn(y,null===b||void 0===b?void 0:b.latestRevisions),S=(null===b||void 0===b?void 0:b.clientIdentity)||k(16),wn(s),[4,mn(y,b,_,e,i,n,S)]):[2,!1];case 6:return j=E.sent(),console.debug("Sync response",j),[4,e.transaction("rw",e.tables,(function(t){return m(O,void 0,void 0,(function(){var r,i,o,s,u,a,c,d,p,v;return g(this,(function(y){switch(y.label){case 0:for(t.idbtrans.disableChangeTracking=!0,t.idbtrans.disableAccessControl=!0,r=0,i=Object.keys(n);r<i.length;r++)o=i[r],j.schema[o]&&(n[o]=j.schema[o]);return[4,e.$syncState.put(n,"schema")];case 1:return y.sent(),[4,Kt(f,0,{since:x})];case 2:s=y.sent(),u=function(t){var n,r;return g(this,(function(i){switch(i.label){case 0:return n=Rt(t.name),s.some((function(e){return e.table===n&&e.muts.length>0}))?[3,2]:[4,Promise.all([t.clear(),e.$baseRevs.where({tableName:n}).delete()])];case 1:return i.sent(),[3,5];case 2:return x[t.name]?(r=x[t.name]||0,[4,Promise.all([t.where("rev").belowOrEqual(r).delete(),e.$baseRevs.where(":id").between([n,-1/0],[n,r+1],!0,!0).reverse().offset(1).delete()])]):[3,4];case 3:return i.sent(),[3,5];case 4:i.label=5;case 5:return[2]}}))},a=0,c=f,y.label=3;case 3:return a<c.length?(d=c[a],[5,u(d)]):[3,6];case 4:y.sent(),y.label=5;case 5:return a++,[3,3];case 6:return Sn(s,x),[4,kn(e,n,x,j.serverRevision)];case 7:return y.sent(),[4,e.getPersistedSyncState()];case 8:return p=y.sent(),[4,En(e,j,p)];case 9:return y.sent(),(v=p||{syncedTables:[],latestRevisions:{},realms:[],inviteRealms:[],clientIdentity:S}).syncedTables=l.map((function(e){return e.name})).concat(h.map((function(e){return e.name}))),v.latestRevisions=x,v.remoteDbId=j.dbId,v.initiallySynced=!0,v.realms=j.realms,v.inviteRealms=j.inviteRealms,v.serverRevision=j.serverRevision,v.timestamp=new Date,delete v.error,[4,In(Cn(j.changes,s),e)];case 10:return y.sent(),e.$syncState.put(v,"syncState"),[2,0===s.length]}}))}))}))];case 7:return E.sent()?[3,9]:(console.debug("MORE SYNC NEEDED. Go for it again!"),[4,On(e,t,n,{isInitialSync:o,cancelToken:s})]);case 8:return[2,E.sent()];case 9:return console.debug("SYNC DONE",{isInitialSync:o}),[2,!1]}}))}))}function En(e,t,n){return m(this,void 0,void 0,(function(){var r,i,o,s,u,a,c,l,f,d,h;return g(this,(function(p){switch(p.label){case 0:for(r=[],i=n?n.realms.concat(n.inviteRealms):[],o=new Set(_(_([],t.realms),t.inviteRealms)),s=0,u=i;s<u.length;s++)a=u[s],o.has(a)||r.push(a);if(!(r.length>0))return[3,6];c=new Set(r),l=Dt(e),f=0,d=l,p.label=1;case 1:return f<d.length?(h=d[f]).schema.indexes.some((function(e){return"realmId"===e.keyPath||Array.isArray(e.keyPath)&&"realmId"===e.keyPath[0]}))?[4,h.where("realmId").anyOf(r).delete()]:[3,3]:[3,6];case 2:return p.sent(),[3,5];case 3:return[4,h.filter((function(e){return!!(null===e||void 0===e?void 0:e.realmId)&&c.has(e.realmId)})).delete()];case 4:p.sent(),p.label=5;case 5:return f++,[3,1];case 6:return[2]}}))}))}function In(e,t){return m(this,void 0,void 0,(function(){var n,r,o,s,u,a;return g(this,(function(c){switch(c.label){case 0:console.debug("Applying server changes",e,i.a.currentTransaction),n=function(e,n){var r,o,s,u,a,c;return g(this,(function(l){switch(l.label){case 0:if(!(r=t.table(e)))return[2,"continue"];o=r.core.schema.primaryKey,s=function(e){return g(this,(function(t){switch(t.label){case 0:switch(e.type){case"insert":return[3,1];case"upsert":return[3,6];case"modify":return[3,11];case"update":return[3,16];case"delete":return[3,18]}return[3,20];case 1:return o.outbound?[4,r.bulkAdd(e.values,e.keys)]:[3,3];case 2:return t.sent(),[3,5];case 3:return e.keys.forEach((function(t,n){i.a.setByKeyPath(e.values[n],o.keyPath,t)})),[4,r.bulkAdd(e.values)];case 4:t.sent(),t.label=5;case 5:return[3,20];case 6:return o.outbound?[4,r.bulkPut(e.values,e.keys)]:[3,8];case 7:return t.sent(),[3,10];case 8:return e.keys.forEach((function(t,n){i.a.setByKeyPath(e.values[n],o.keyPath,t)})),[4,r.bulkPut(e.values)];case 9:t.sent(),t.label=10;case 10:return[3,20];case 11:return 1!==e.keys.length?[3,13]:[4,r.update(e.keys[0],e.changeSpec)];case 12:return t.sent(),[3,15];case 13:return[4,r.where(":id").anyOf(e.keys).modify(e.changeSpec)];case 14:t.sent(),t.label=15;case 15:return[3,20];case 16:return[4,_n(r,e.keys,e.changeSpecs)];case 17:return t.sent(),[3,20];case 18:return[4,r.bulkDelete(e.keys)];case 19:return t.sent(),[3,20];case 20:return[2]}}))},u=0,a=n,l.label=1;case 1:return u<a.length?(c=a[u],[5,s(c)]):[3,4];case 2:l.sent(),l.label=3;case 3:return u++,[3,1];case 4:return[2]}}))},r=0,o=e,c.label=1;case 1:return r<o.length?(s=o[r],u=s.table,a=s.muts,[5,n(u,a)]):[3,4];case 2:c.sent(),c.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}))}function Cn(e,t){var n={};E(n,e);var r={};return E(r,t),function(e,t){for(var n,r,i,o=0,s=Object.entries(t);o<s.length;o++)for(var u=s[o],a=u[0],c=u[1],l=0,f=Object.entries(c);l<f.length;l++){var d=f[l],h=d[0],p=d[1];switch(p.type){case"ups":if(v=null===(n=e[a])||void 0===n?void 0:n[h])switch(v.type){case"ups":delete e[a][h];break;case"del":break;case"upd":delete e[a][h]}break;case"del":null===(r=e[a])||void 0===r||delete r[h];break;case"upd":var v;if(v=null===(i=e[a])||void 0===i?void 0:i[h])switch(v.type){case"ups":for(var y=0,b=Object.entries(p.mod);y<b.length;y++){var m=b[y],g=m[0],_=m[1];x(v.val,g,_)}break;case"del":break;case"upd":for(var w=0,k=Object.keys(p.mod);w<k.length;w++)g=k[w],delete v.mod[g]}}}}(n,r),function(e){for(var t=k(16),n={},r=0,i=Object.entries(e);r<i.length;r++)for(var o=i[r],s=o[0],u=o[1],a=0,c=Object.entries(u);a<c.length;a++){var l=c[a],f=l[0],d=l[1],h=n[s]||(n[s]={});(h[d.type]||(h[d.type]=[])).push(Object.assign({key:f},d))}for(var p=[],v=0,y=Object.entries(n);v<y.length;v++){for(var b=y[v],m=(s=b[0],u=b[1],{table:s,muts:[]}),g=0,_=Object.entries(u);g<_.length;g++){var w=_[g],x=w[0],S=w[1];switch(x){case"ups":d={type:"upsert",keys:S.map((function(e){return e.key})),values:S.map((function(e){return e.val})),txid:t},m.muts.push(d);break;case"upd":d={type:"update",keys:S.map((function(e){return e.key})),changeSpecs:S.map((function(e){return e.mod})),txid:t},m.muts.push(d);break;case"del":d={type:"delete",keys:S.map((function(e){return e.key})),txid:t},m.muts.push(d)}}p.push(m)}return p}(n)}var Pn=new WeakMap,Tn={realms:"@realmId",members:"@id",roles:"[realmId+name]",$jobs:"",$syncState:"",$baseRevs:"[tableName+clientRev]",$logins:"claims.sub, lastLogin"},An=0;function Dn(e){"vip"in e&&(e=e.vip);var t=Pn.get(e.cloud);if(!t){var n=new u.a,r=new Tt("syncstatechanged-"+e.name);n.id=++An;var o=!1;t={get name(){return e.name},close:function(){return e.close()},transaction:e.transaction.bind(e),table:e.table.bind(e),get tables(){return e.tables},cloud:e.cloud,get $jobs(){return e.table("$jobs")},get $syncState(){return e.table("$syncState")},get $baseRevs(){return e.table("$baseRevs")},get $logins(){return e.table("$logins")},get realms(){return e.realms},get members(){return e.members},get roles(){return e.roles},get initiallySynced(){return o},localSyncEvent:n,get syncStateChangedEvent(){return r},dx:e};var a={getCurrentUser:function(){return t.$logins.toArray().then((function(e){return e.find((function(e){return e.isLoggedIn}))||Et}))},getPersistedSyncState:function(){return t.$syncState.get("syncState")},getSchema:function(){return t.$syncState.get("schema")},getOptions:function(){return t.$syncState.get("options")},setInitiallySynced:function(e){o=e},reconfigure:function(){r=new Tt("syncstatechanged-"+e.name)}};Object.assign(t,a),t.messageConsumer=function(e){var t=this,n=[],r=new s.a(!0),o=new s.a(null),u=!1,a=0,c=[0,0,0,0,0,0,0,0,0,Date.now()];function l(){return m(this,void 0,void 0,(function(){var t,r,o,s,u=this;return g(this,(function(a){switch(a.label){case 0:s=function(){var s,a,c,l,f;return g(this,(function(d){switch(d.label){case 0:s=n.shift(),d.label=1;case 1:return d.trys.push([1,12,,13]),console.debug("processing msg",s),[4,e.cloud.syncState.pipe(Fe((function(e){var t=e.phase;return"in-sync"===t||"error"===t})),$e(1)).toPromise()];case 2:if(d.sent(),console.debug("processing msg",s),a=e.cloud.persistedSyncState.value,!s)return[2,"continue"];switch(s.type){case"token-expired":return[3,3];case"realm-added":return[3,6];case"realm-removed":return[3,7];case"realms-changed":return[3,8];case"changes":return[3,9]}return[3,11];case 3:return console.debug("WebSocket observable: Token expired. Refreshing token..."),c=e.cloud.currentUser.value,[4,gt(e.cloud.options.databaseUrl,c)];case 4:return l=d.sent(),[4,e.table("$logins").update(c.userId,{accessToken:l.accessToken,accessTokenExpiration:l.accessTokenExpiration})];case 5:return d.sent(),[3,11];case 6:return(null===(t=null===a||void 0===a?void 0:a.realms)||void 0===t?void 0:t.includes(s.realm))||lt(e,"pull"),[3,11];case 7:return(null===(r=null===a||void 0===a?void 0:a.realms)||void 0===r?void 0:r.includes(s.realm))&&lt(e,"pull"),[3,11];case 8:return lt(e,"pull"),[3,11];case 9:return console.debug("changes"),"error"===(null===(o=e.cloud.syncState.value)||void 0===o?void 0:o.phase)?(lt(e,"pull"),[3,11]):[4,e.transaction("rw",e.dx.tables,(function(t){return m(u,void 0,void 0,(function(){var n,r,o,u,a,c,l;return g(this,(function(f){switch(f.label){case 0:return t.idbtrans.disableChangeTracking=!0,t.idbtrans.disableAccessControl=!0,[4,Promise.all([e.getSchema(),e.getPersistedSyncState(),e.getCurrentUser()])];case 1:return n=f.sent(),r=n[0],o=n[1],u=n[2],console.debug("ws message queue: in transaction"),o&&r&&u?s.baseRev!==o.serverRevision?(console.debug("baseRev ("+s.baseRev+") differs from our serverRevision in syncState ("+o.serverRevision+")"),"string"!==typeof s.baseRev||"bigint"!==typeof o.serverRevision&&"object"!==typeof o.serverRevision||lt(e,"pull"),[2]):[4,i.a.waitFor(At(o))]:(console.debug("required vars not present",{syncState:o,schema:r,currentUser:u}),[2]);case 2:return a=f.sent(),console.debug("ourRealmSetHash",a),a!==s.realmSetHash?(console.debug("not same realmSetHash",s.realmSetHash),lt(e,"pull"),[2]):(c=[],u.isLoggedIn?[4,Kt(Dt(e).map((function(t){return e.table(Nt(t.name))})))]:[3,4]);case 3:c=f.sent(),console.debug("msg queue: client changes",c),f.label=4;case 4:return s.changes.length>0?(l=Cn(s.changes,c),console.debug("applying filtered server changes",l),[4,In(l,e)]):[3,6];case 5:f.sent(),f.label=6;case 6:return o.latestRevisions=Sn(c,o.latestRevisions),o.serverRevision=s.newRev,console.debug("Updating baseRefs",o.latestRevisions),[4,kn(e,r,o.latestRevisions,s.newRev)];case 7:return f.sent(),console.debug("Updating syncState",o),[4,e.$syncState.put(o,"syncState")];case 8:return f.sent(),[2]}}))}))}))];case 10:return d.sent(),console.debug("msg queue: done with rw transaction"),[3,11];case 11:return[3,13];case 12:return f=d.sent(),console.error("Error in msg queue",f),[3,13];case 13:return[2]}}))},a.label=1;case 1:return n.length>0?[5,s()]:[3,3];case 2:return a.sent(),[3,1];case 3:return[2]}}))}))}return o.subscribe((function(){return m(t,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:if(u)return[2];if(!(n.length>0))return[3,8];u=!0,c.shift(),c.push(Date.now()),r.next(!1),e.label=1;case 1:return e.trys.push([1,,3,8]),[4,l()];case 2:return e.sent(),[3,8];case 3:return c[c.length-1]-c[0]<1e4?Date.now()-a<5e3?(console.warn("Slowing down websocket loop for one minute"),a=Date.now()+6e4,[4,new Promise((function(e){return setTimeout(e,6e4)}))]):[3,5]:[3,7];case 4:return e.sent(),[3,7];case 5:return console.warn("Slowing down websocket loop for 10 seconds"),a=Date.now()+1e4,[4,new Promise((function(e){return setTimeout(e,1e4)}))];case 6:e.sent(),e.label=7;case 7:return u=!1,r.next(!0),[7];case 8:return[2]}}))}))})),{enqueue:function(e){n.push(e),o.next(null)},readyToServe:r}}(t),Pn.set(e.cloud,t)}return t}var Nn="undefined"!==typeof InstallTrigger,Rn="undefined"!==typeof navigator&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\/|Edge\//.test(navigator.userAgent),Kn=Rn?[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]:NaN,Bn=Rn&&Kn<=605||Nn;var Un="undefined"!==typeof self&&"clients"in self&&!self.document;function Mn(){throw new i.a.SchemaError("Version increment needed to allow dexie-cloud change tracking")}var Ln={}.toString;function Fn(e){return Ln.call(e).slice(8,-1)}function qn(e,t){var n;return"delete"===t.type?t.keys:(null===(n=t.keys)||void 0===n?void 0:n.slice())||t.values.map(e.extractKey)}var Wn=/b|c|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|x|y|z/i;var $n=0;function Hn(e){return{stack:"dbcore",name:"idGenerationMiddleware",level:1,create:function(t){return b(b({},t),{table:function(n){var r=t.table(n);function o(t,o){var s=null,u=qn(r.schema.primaryKey,t);return u.forEach((function(a,c){if(void 0===a){var l=t.values[c].realmId||e.cloud.currentUserId,f=l.substr(l.length-3);u[c]=function(e,t){var n=new Uint8Array(18),r=new Uint8Array(n.buffer,0,6),i=Date.now();$n>=i?++$n:$n=i,r[0]=$n/1099511627776,r[1]=$n/4294967296,r[2]=$n/16777216,r[3]=$n/65536,r[4]=$n/256,r[5]=$n;var o=new Uint8Array(n.buffer,6);return crypto.getRandomValues(o),e+Jt(new Uint8Array(n.buffer))+(t||"")}(o,f),r.schema.primaryKey.outbound||(s||(s=t.values.slice()),s[c]=i.a.deepClone(s[c]),i.a.setByKeyPath(s[c],r.schema.primaryKey.keyPath,u[c]))}else if("string"!==typeof a||!a.startsWith(o))throw new i.a.ConstraintError('The ID "'+a+'" is not valid for table "'+n+"\". Primary '@' keys requires the key to be prefixed with \""+o+".\n\"If you want to generate IDs programmatically, remove '@' from the schema to get rid of this constraint. Dexie Cloud supports custom IDs as long as they are random and globally unique.")})),r.mutate(b(b({},t),{keys:u,values:s||t.values}))}return b(b({},r),{mutate:function(t){var s,u;if(t.trans.disableChangeTracking)return r.mutate(t);if("add"===t.type||"put"===t.type){var a=null===(s=e.cloud.schema)||void 0===s?void 0:s[n];if(null===a||void 0===a?void 0:a.generatedGlobalId){if((null===(u=e.cloud.options)||void 0===u?void 0:u.databaseUrl)&&!e.initiallySynced){var c=qn(r.schema.primaryKey,t);return r.getMany({keys:c,trans:t.trans,cache:"immutable"}).then((function(e){if(e.length<c.length)throw new Error("Unable to create new objects without an initial sync having been performed.");return r.mutate(t)}))}return o(t,a.idPrefix)}(null===a||void 0===a?void 0:a.markedForSync)&&qn(r.schema.primaryKey,t).forEach((function(e,t){if(!S(e)){var r=Array.isArray(e)?e.map(Fn).join(","):Fn(e);throw new i.a.ConstraintError("Invalid primary key type "+r+" for table "+n+". Tables marked for sync has primary keys of type string or Array of string (and optional numbers)")}}))}return r.mutate(t)}})}})}}}function Vn(e){var t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode.apply(null,t))}var zn=0;function Yn(e,t){return function(n){var r=n.trans[t]||(n.trans[t]={writers:[],readers:[]}),i=r.readers,o=r.writers,s=o.length,u=(s>0?o[s-1].then((function(){return e(n)}),(function(){return e(n)})):e(n)).finally((function(){return i.splice(i.indexOf(u))}));return i.push(u),u}}function Gn(e,t){return function(n){var r,i=n.trans[t]||(n.trans[t]={writers:[],readers:[]}),o=i.readers,s=i.writers,u=(s.length>0?s[s.length-1].then((function(){return e(n)}),(function(){return e(n)})):o.length>0?(r=o,new Promise((function(e){0===r.length&&e([]);var t=r.length,n=new Array(t);r.forEach((function(r,i){return Promise.resolve(r).then((function(e){return n[i]={status:"fulfilled",value:e}}),(function(e){return n[i]={status:"rejected",reason:e}})).then((function(){return--t||e(n)}))}))}))).then((function(){return e(n)})):e(n)).finally((function(){return s.shift()}));return s.push(u),u}}var Jn=new s.a(new Set);function Qn(e){var t=e.currentUserObservable,n=e.db;return{stack:"dbcore",name:"MutationTrackingMiddleware",level:1,create:function(e){var r,i=e.schema.tables.filter((function(e){return!/^\$/.test(e.name)}));try{r=new Map(i.map((function(t){return[t.name,e.table("$"+t.name+"_mutations")]})))}catch(wi){Mn()}return b(b({},e),{transaction:function(r,i){var o;if("readwrite"===i){var s=r.filter((function(e){var t,r;return null===(r=null===(t=n.cloud.schema)||void 0===t?void 0:t[e])||void 0===r?void 0:r.markedForSync})).map((function(e){return Nt(e)}));o=e.transaction(_(_([],r),s),i)}else o=e.transaction(r,i);if("readwrite"===i){o.txid=Vn(16),o.currentUser=t.value,Jn.value.add(o),Jn.next(Jn.value);var u=function e(){o.removeEventListener("complete",a),o.removeEventListener("error",e),o.removeEventListener("abort",e),Jn.value.delete(o),Jn.next(Jn.value)},a=function(){var e;o.mutationsAdded&&(null===(e=n.cloud.options)||void 0===e?void 0:e.databaseUrl)&&(n.cloud.usingServiceWorker?(console.debug("registering sync event"),ct(n,"push")):n.localSyncEvent.next({purpose:"push"})),u()};o.addEventListener("complete",a),o.addEventListener("error",u),o.addEventListener("abort",u)}return o},table:function(t){var n=e.table(t);if(/^\$/.test(t))return t.endsWith("_mutations")?b(b({},n),{mutate:function(e){return"add"!==e.type&&"put"!==e.type||(e.trans.mutationsAdded=!0),n.mutate(e)}}):"$logins"===t?b(b({},n),{mutate:function(e){return console.debug("Mutating $logins table",e),n.mutate(e).then((function(t){return console.debug("Mutating $logins"),e.trans.mutationsAdded=!0,console.debug("$logins mutated"),t})).catch((function(e){return console.debug("Failed mutation $logins",e),Promise.reject(e)}))}}):n;var i=n.schema,o=r.get(t);return function(e){var t="$lock"+ ++zn;return b(b({},e),{count:Yn(e.count,t),get:Yn(e.get,t),getMany:Yn(e.getMany,t),openCursor:Yn(e.openCursor,t),query:Yn(e.query,t),mutate:Gn(e.mutate,t)})}(b(b({},n),{mutate:function(e){var t,r=e.trans;return r.txid?r.disableChangeTracking?n.mutate(e):(null===(t=r.currentUser)||void 0===t?void 0:t.isLoggedIn)?"deleteRange"===e.type?n.query({query:{range:e.range,index:i.primaryKey},trans:e.trans,values:!1}).then((function(t){return s({type:"delete",keys:t.result,trans:e.trans,criteria:{index:null,range:e.range}})})):s(e):n.mutate(e):n.mutate(e)}}));function s(e){var t=e.trans;t.mutationsAdded=!0;var r=t.txid,i=t.currentUser.userId,s=e.type;return n.mutate(e).then((function(n){var u=n.numFailures,a=n.failures,c="delete"===s?e.keys:n.results,l="values"in e?e.values:[],f="changeSpecs"in e?e.changeSpecs:[];u&&(c=c.filter((function(e,t){return!a[t]})),l=l.filter((function(e,t){return!a[t]})),f=f.filter((function(e,t){return!a[t]})));var d=Date.now(),h="delete"===e.type?{type:"delete",ts:d,keys:c,criteria:e.criteria,txid:r,userId:i}:"add"===e.type?{type:"insert",ts:d,keys:c,txid:r,userId:i,values:l}:e.criteria&&e.changeSpec?{type:"modify",ts:d,keys:c,criteria:e.criteria,changeSpec:e.changeSpec,txid:r,userId:i}:e.changeSpecs?{type:"update",ts:d,keys:c,changeSpecs:f,txid:r,userId:i}:{type:"upsert",ts:d,keys:c,values:l,txid:r,userId:i};return c.length>0||"criteria"in e&&e.criteria?o.mutate({type:"add",trans:t,values:[h]}).then((function(){return n})):n}))}}})}}}function Xn(e,t){return function(n,r){var i=b(b({},Tn),n),o=t.cloud.schema||(t.cloud.schema={}),s=new Set;return Object.keys(i).forEach((function(e){var t=i[e],n=o[e]||(o[e]={});null!=t?(/^\@/.test(t)&&(i[e]=i[e].substr(1),n.generatedGlobalId=!0,n.idPrefix=function(e,t){for(var n,r,i,o=e[0].toLocaleLowerCase(),s=1,u=e.length;s<u&&o.length<3;++s)(Wn.test(e[s])||(n=e[s])>="A"&&n<="Z")&&(o+=e[s].toLowerCase());for(;t.has(o);){if(/\d/g.test(o)){if(!((o=o.substr(0,o.length-1)+(o[o.length-1]+1)).length>3))continue;o=o.substr(0,3)}else if(o.length<3){o+="2";continue}for(var a=1,c=o;t.has(c)&&a<8;)r=o,c=(1&(i=a)?r[0].toUpperCase():r[0].toLowerCase())+(2&i?r[1].toUpperCase():r[1].toLowerCase())+(4&i?r[2].toUpperCase():r[2].toLowerCase()),++a;if(a<8)o=c;else{var l=o.charCodeAt(2)+1&127;o=o.substr(0,2)+String.fromCharCode(l)}}return o}(e,s),s.add(n.idPrefix)),/^\$/.test(e)||(i["$"+e+"_mutations"]="++rev",n.markedForSync=!0),n.deleted&&(n.deleted=!1)):(n.deleted=!0,n.markedForSync=!1,i["$"+e+"_mutations"]=null)})),e.call(this,i,r)}}var Zn=Vn(16);function er(e,t,n,r,o){var s=(void 0===o?{}:o).awaitRemoteJob;return m(this,void 0,void 0,(function(){function o(){return m(this,void 0,void 0,(function(){var r,c=this;return g(this,(function(l){switch(l.label){case 0:return[4,e.transaction("rw!",n,(function(){return m(c,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return[4,u.get(t)];case 1:return(e=n.sent())?[3,3]:[4,u.add({nodeId:Zn,started:new Date,heartbeat:new Date},t)];case 2:return n.sent(),[2,!0];case 3:return e.heartbeat.getTime()<Date.now()-6e4?(console.warn("Latest "+t+" worker seem to have died.\n","The dead job started:",e.started,"\n","Last heart beat was:",e.heartbeat,"\n","We're now taking over!"),[4,u.put({nodeId:Zn,started:new Date,heartbeat:new Date},t)]):[3,5];case 4:return n.sent(),[2,!0];case 5:return[2,!1]}}))}))}))];case 1:if(l.sent())return[2,!0];if(!s)return[3,6];l.label=2;case 2:return l.trys.push([2,4,,6]),[4,Object(a.a)(Object(i.b)((function(){return u.get(t)}))).pipe(ut(6e4),Fe((function(e){return!e}))).toPromise()];case 3:return l.sent(),[2,!1];case 4:if("TimeoutError"!==(r=l.sent()).name)throw r;return[4,o()];case 5:return[2,l.sent()];case 6:return[2,!1]}}))}))}var u,c,l=this;return g(this,(function(i){switch(i.label){case 0:return u=e.table(n),[4,o()];case 1:if(!i.sent())return[3,6];c=setInterval((function(){u.update(t,(function(e){return e.nodeId===Zn&&(e.heartbeat=new Date)}))}),1e3),i.label=2;case 2:return i.trys.push([2,,4,6]),[4,r()];case 3:return[2,i.sent()];case 4:return clearInterval(c),[4,e.transaction("rw!",n,(function(){return m(l,void 0,void 0,(function(){var e;return g(this,(function(n){switch(n.label){case 0:return[4,u.get(t)];case 1:return(e=n.sent())&&e.nodeId===Zn&&u.delete(t),[2]}}))}))}))];case 5:return i.sent(),[7];case 6:return[2]}}))}))}function tr(e,t,n){return m(this,void 0,void 0,(function(){var r=this;return g(this,(function(i){switch(i.label){case 0:return console.debug("Performing initial sync"),[4,er(e,"initialSync","$jobs",(function(){return m(r,void 0,void 0,(function(){var r;return g(this,(function(i){switch(i.label){case 0:return[4,e.getPersistedSyncState()];case 1:return(null===(r=i.sent())||void 0===r?void 0:r.initiallySynced)?[3,3]:[4,jn(e,t,n,{isInitialSync:!0})];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}),{awaitRemoteJob:!0})];case 1:return i.sent(),console.debug("Done initial sync"),[2]}}))}))}var nr,rr,ir=new s.a(!0),or=new s.a(!0);ir.pipe(Qe((function(e){return e?Object(c.a)(!0):Object(c.a)(!1).pipe(Ne(2e4))})),(function(e){return e.lift(new Ue(nr,rr))})).subscribe(or);var sr="undefined"!==typeof document?Object(l.a)(document,"visibilitychange"):Object(c.a)({}),ur=sr.pipe(Fe((function(){return"hidden"===document.visibilityState}))),ar=sr.pipe(Fe((function(){return"visible"===document.visibilityState}))),cr="undefined"!==typeof window?Object(f.a)(ar,Object(l.a)(window,"mousemove"),Object(l.a)(window,"keydown"),Object(l.a)(window,"wheel"),Object(l.a)(window,"touchmove")):Object(c.a)({});"undefined"!==typeof document&&Object(f.a)(Object(c.a)(!0),ur,cr).pipe(ve((function(){return"visible"===document.visibilityState})),tt((function(e){ir.value!==e&&ir.next(e)})),Qe((function(e){return e?Object(c.a)(0).pipe(Ne(28e4),tt((function(){return ir.next(!1)}))):Object(c.a)(0)}))).subscribe((function(){}));var lr=function(e){function t(){var t=e.apply(this,arguments)||this;return t.name="TokenExpiredError",t}return y(t,e),t}(Error),fr=function(e){function t(t,n,r,i,o,s,u,a){return e.call(this,(function(e){return new hr(t,n,r,i,u,a,e,o,s)}))||this}return y(t,e),t}(o.a),dr=0,hr=function(e){function t(t,n,r,i,o,s,u,a,c){var l=e.call(this,(function(){return l.teardown()}))||this;return l.id=++dr,console.debug("New WebSocket Connection",l.id,o?"authorized":"unauthorized"),l.databaseUrl=t,l.rev=n,l.realmSetHash=r,l.clientIdentity=i,l.token=o,l.tokenExpiration=s,l.subscriber=u,l.lastUserActivity=new Date,l.messageProducer=a,l.messageProducerSubscription=null,l.webSocketStatus=c,l.connect(),l}return y(t,e),t.prototype.teardown=function(){console.debug("Teardown WebSocket Connection",this.id),this.disconnect()},t.prototype.disconnect=function(){if(this.webSocketStatus.next("disconnected"),this.pinger&&(clearInterval(this.pinger),this.pinger=null),this.ws)try{this.ws.close()}catch(wi){}this.ws=null,this.messageProducerSubscription&&(this.messageProducerSubscription.unsubscribe(),this.messageProducerSubscription=null)},t.prototype.reconnect=function(){this.disconnect(),this.connect()},t.prototype.connect=function(){return m(this,void 0,void 0,(function(){var e,t,n,r=this;return g(this,(function(i){switch(i.label){case 0:if(this.webSocketStatus.next("connecting"),this.lastServerActivity=new Date,this.pauseUntil&&this.pauseUntil>new Date)return console.debug("WS not reconnecting just yet",{id:this.id,pauseUntil:this.pauseUntil}),[2];if(this.ws)throw new Error("Called connect() when a connection is already open");if(!this.databaseUrl)throw new Error("Cannot connect without a database URL");if(this.closed)return[2];if(this.tokenExpiration&&this.tokenExpiration<new Date)return this.subscriber.error(new lr),[2];if(this.pinger=setInterval((function(){return m(r,void 0,void 0,(function(){var e=this;return g(this,(function(t){if(this.closed)return console.debug("pinger check",this.id,"CLOSED."),this.teardown(),[2];if(this.ws)try{this.ws.send(JSON.stringify({type:"ping"})),setTimeout((function(){if(console.debug("pinger setTimeout",e.id,e.pinger?"alive":"dead"),e.pinger)return e.closed?(console.debug("pinger setTimeout",e.id,"subscription is closed"),void e.teardown()):void(e.lastServerActivity<new Date(Date.now()-2e4)?(console.debug("pinger: server is inactive"),console.debug("pinger reconnecting"),e.reconnect()):console.debug("pinger: server still active"))}),2e4)}catch(wi){console.debug("pinger catch error",this.id,"reconnecting"),this.reconnect()}else console.debug("pinger",this.id,"reconnecting"),this.reconnect();return[2]}))}))}),3e4),(e=new URL(this.databaseUrl)).protocol="http:"===e.protocol?"ws":"wss",t=new URLSearchParams,this.subscriber.closed)return[2];t.set("v","2"),t.set("rev",this.rev),t.set("realmsHash",this.realmSetHash),t.set("clientId",this.clientIdentity),this.token&&t.set("token",this.token),console.debug("dexie-cloud WebSocket create"),(n=this.ws=new WebSocket(e+"/changes?"+t)).onclose=function(e){r.pinger&&(console.debug("dexie-cloud WebSocket onclosed",r.id),r.reconnect())},n.onmessage=function(e){if(r.pinger){console.debug("dexie-cloud WebSocket onmessage",e.data),r.lastServerActivity=new Date;try{var t=yn.parse(e.data);if("error"===t.type)throw new Error("Error message from dexie-cloud: "+t.error);"rev"===t.type&&(r.rev=t.rev),"pong"!==t.type&&r.subscriber.next(t)}catch(oi){r.subscriber.error(oi)}}},i.label=1;case 1:return i.trys.push([1,3,,4]),[4,new Promise((function(e,t){n.onopen=function(t){console.debug("dexie-cloud WebSocket onopen"),e(null)},n.onerror=function(e){var n=e.error||new Error("WebSocket Error");r.disconnect(),r.subscriber.error(n),r.webSocketStatus.next("error"),t(n)}}))];case 2:return i.sent(),this.messageProducerSubscription=this.messageProducer.subscribe((function(e){var t;r.closed||("ready"===e.type&&"connected"!==r.webSocketStatus.value&&r.webSocketStatus.next("connected"),null===(t=r.ws)||void 0===t||t.send(yn.stringify(e)))})),[3,4];case 3:return i.sent(),this.pauseUntil=new Date(Date.now()+6e4),[3,4];case 4:return[2]}}))}))},t}(d.a);function pr(e){var t;if(!(null===(t=e.cloud.options)||void 0===t?void 0:t.databaseUrl))throw new Error("No database URL to connect WebSocket to");var n=e.messageConsumer.readyToServe.pipe(Fe((function(e){return e})),Qe((function(){return e.getPersistedSyncState()})),Fe((function(e){return e&&e.serverRevision})),ve((function(e){return{type:"ready",rev:e.serverRevision}})));return function t(){var r=this;return e.cloud.persistedSyncState.pipe(Fe((function(e){return null===e||void 0===e?void 0:e.serverRevision})),$e(1),Qe((function(t){return e.cloud.currentUser.pipe(ve((function(e){return[e,t]})))})),Qe((function(e){var t=e[0],n=e[1];return or.pipe(ve((function(e){return[e?t:null,n]})))})),Qe((function(e){var t=e[0],n=e[1];return m(r,void 0,void 0,(function(){var e;return g(this,(function(r){switch(r.label){case 0:return e=[t],[4,At(n)];case 1:return[2,e.concat([r.sent()])]}}))}))})),Qe((function(t){var r=t[0],i=t[1];return r?new fr(e.cloud.options.databaseUrl,e.cloud.persistedSyncState.value.serverRevision,i,e.cloud.persistedSyncState.value.clientIdentity,n,e.cloud.webSocketStatus,r.accessToken,r.accessTokenExpiration):Object(a.a)([])})),ue((function(n){return"TokenExpiredError"===(null===n||void 0===n?void 0:n.name)?(console.debug("WebSocket observable: Token expired. Refreshing token..."),Object(c.a)(!0).pipe(Qe((function(){return m(r,void 0,void 0,(function(){var t,n;return g(this,(function(r){switch(r.label){case 0:return[4,e.getCurrentUser()];case 1:return t=r.sent(),[4,gt(e.cloud.options.databaseUrl,t)];case 2:return n=r.sent(),[4,e.table("$logins").update(t.userId,{accessToken:n.accessToken,accessTokenExpiration:n.accessTokenExpiration})];case 3:return r.sent(),[2]}}))}))})),Qe((function(){return t()})))):Object(h.a)(n)})),ue((function(e){return Object(a.a)(function(e){return m(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return console.error("WebSocket observable: error but revive when user does some active thing...",e),[4,(n=3e3,new Promise((function(e){return setTimeout(e,n)})))];case 1:return t.sent(),console.debug("waiting for someone to do something"),[4,cr.pipe($e(1)).toPromise()];case 2:return t.sent(),console.debug("someone did something!"),[2]}var n}))}))}(e)).pipe(Qe((function(){return t()})))})))}().subscribe((function(t){t&&(console.debug("WS got message",t),e.messageConsumer.enqueue(t))}),(function(e){console.error("Oops! The main observable errored!",e)}),(function(){console.error("Oops! The main observable completed!")}))}function vr(e){return m(this,void 0,void 0,(function(){var t,n;return g(this,(function(r){switch(r.label){case 0:return(null===(t=e.cloud.options)||void 0===t?void 0:t.databaseUrl)&&e.cloud.schema?[4,jn(e,e.cloud.options,e.cloud.schema,{justCheckIfNeeded:!0})]:[3,2];case 1:return n=r.sent(),[3,3];case 2:n=!1,r.label=3;case 3:return[2,n]}}))}))}var yr=new WeakMap;function br(e,t,n,r){var i=yr.get(e);if(i){if(i.pull||"push"===(null===r||void 0===r?void 0:r.purpose))return console.debug("syncIfPossible(): returning the ongoing sync promise."),i.promise;var o=!1,s=e.cloud.syncState.subscribe((function(e){"pulling"===e.phase&&(o=!0)}));return i.promise.then((function(){s.unsubscribe()})).catch((function(e){return s.unsubscribe(),Promise.reject(e)})).then((function(){if(!o)return br(e,t,n,r)}))}var u=function(){return m(this,void 0,void 0,(function(){var i;return g(this,(function(o){switch(o.label){case 0:return o.trys.push([0,6,,7]),e.cloud.usingServiceWorker?Un?[4,jn(e,t,n,r)]:[3,2]:[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return[4,er(e,"currentSyncWorker","$jobs",(function(){return jn(e,t,n,r)}))];case 4:o.sent(),o.label=5;case 5:return yr.delete(e),console.debug("Done sync"),[3,7];case 6:throw i=o.sent(),yr.delete(e),console.error("Failed to sync client changes",i),i;case 7:return[2]}}))}))}();return yr.set(e,{promise:u,pull:"push"!==(null===r||void 0===r?void 0:r.purpose)}),u}function mr(e,t,n){var r=null,i={cancelled:!1};function o(r,u){void 0===u&&(u=1),setTimeout((function(){br(e,t,n,{cancelToken:i,retryImmediatelyOnFetchError:!0,purpose:r}).catch((function(e){console.error("error in syncIfPossible()",e),i.cancelled?s():u<3&&setTimeout((function(){return o(r,u+1)}),6e4*[0,5,15][u])}))}),0)}var s=function(){console.debug("Stopping LocalSyncWorker"),i.cancelled=!0,r&&r.unsubscribe()};return{start:function(){console.debug("Starting LocalSyncWorker",e.localSyncEvent.id),r=e.localSyncEvent.subscribe((function(e){var t=e.purpose;try{o(t||"pull")}catch(n){console.error("What-the....",n)}}))},stop:s}}function gr(e,t){if(e&&t&&t.unsyncedTables)for(var n=0,r=t.unsyncedTables;n<r.length;n++){var i=r[n];e[i]&&(e[i].markedForSync=!1)}}var _r,wr,xr,kr,Sr={},jr=[],Or=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function Er(e,t){for(var n in t)e[n]=t[n];return e}function Ir(e){var t=e.parentNode;t&&t.removeChild(e)}function Cr(e,t,n){var r,i,o,s=arguments,u={};for(o in t)"key"==o?r=t[o]:"ref"==o?i=t[o]:u[o]=t[o];if(arguments.length>3)for(n=[n],o=3;o<arguments.length;o++)n.push(s[o]);if(null!=n&&(u.children=n),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===u[o]&&(u[o]=e.defaultProps[o]);return Pr(e,u,r,i,null)}function Pr(e,t,n,r,i){var o={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==i?++_r.__v:i};return null!=_r.vnode&&_r.vnode(o),o}function Tr(e){return e.children}function Ar(e,t){this.props=e,this.context=t}function Dr(e,t){if(null==t)return e.__?Dr(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?Dr(e):null}function Nr(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return Nr(e)}}function Rr(e){(!e.__d&&(e.__d=!0)&&wr.push(e)&&!Kr.__r++||kr!==_r.debounceRendering)&&((kr=_r.debounceRendering)||xr)(Kr)}function Kr(){for(var e;Kr.__r=wr.length;)e=wr.sort((function(e,t){return e.__v.__b-t.__v.__b})),wr=[],e.some((function(e){var t,n,r,i,o,s;e.__d&&(o=(i=(t=e).__v).__e,(s=t.__P)&&(n=[],(r=Er({},i)).__v=i.__v+1,$r(s,i,r,t.__n,void 0!==s.ownerSVGElement,null!=i.__h?[o]:null,n,null==o?Dr(i):o,i.__h),Hr(n,i),i.__e!=o&&Nr(i)))}))}function Br(e,t,n,r,i,o,s,u,a,c){var l,f,d,h,p,v,y,b=r&&r.__k||jr,m=b.length;for(n.__k=[],l=0;l<t.length;l++)if(null!=(h=n.__k[l]=null==(h=t[l])||"boolean"==typeof h?null:"string"==typeof h||"number"==typeof h||"bigint"==typeof h?Pr(null,h,null,null,h):Array.isArray(h)?Pr(Tr,{children:h},null,null,null):h.__b>0?Pr(h.type,h.props,h.key,null,h.__v):h)){if(h.__=n,h.__b=n.__b+1,null===(d=b[l])||d&&h.key==d.key&&h.type===d.type)b[l]=void 0;else for(f=0;f<m;f++){if((d=b[f])&&h.key==d.key&&h.type===d.type){b[f]=void 0;break}d=null}$r(e,h,d=d||Sr,i,o,s,u,a,c),p=h.__e,(f=h.ref)&&d.ref!=f&&(y||(y=[]),d.ref&&y.push(d.ref,null,h),y.push(f,h.__c||p,h)),null!=p?(null==v&&(v=p),"function"==typeof h.type&&null!=h.__k&&h.__k===d.__k?h.__d=a=Ur(h,a,e):a=Mr(e,h,d,b,p,a),c||"option"!==n.type?"function"==typeof n.type&&(n.__d=a):e.value=""):a&&d.__e==a&&a.parentNode!=e&&(a=Dr(d))}for(n.__e=v,l=m;l--;)null!=b[l]&&("function"==typeof n.type&&null!=b[l].__e&&b[l].__e==n.__d&&(n.__d=Dr(r,l+1)),Yr(b[l],b[l]));if(y)for(l=0;l<y.length;l++)zr(y[l],y[++l],y[++l])}function Ur(e,t,n){var r,i;for(r=0;r<e.__k.length;r++)(i=e.__k[r])&&(i.__=e,t="function"==typeof i.type?Ur(i,t,n):Mr(n,i,i,e.__k,i.__e,t));return t}function Mr(e,t,n,r,i,o){var s,u,a;if(void 0!==t.__d)s=t.__d,t.__d=void 0;else if(null==n||i!=o||null==i.parentNode)e:if(null==o||o.parentNode!==e)e.appendChild(i),s=null;else{for(u=o,a=0;(u=u.nextSibling)&&a<r.length;a+=2)if(u==i)break e;e.insertBefore(i,o),s=o}return void 0!==s?s:i.nextSibling}function Lr(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||Or.test(t)?n:n+"px"}function Fr(e,t,n,r,i){var o;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||Lr(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||Lr(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])o=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?r||e.addEventListener(t,o?Wr:qr,o):e.removeEventListener(t,o?Wr:qr,o);else if("dangerouslySetInnerHTML"!==t){if(i)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function qr(e){this.l[e.type+!1](_r.event?_r.event(e):e)}function Wr(e){this.l[e.type+!0](_r.event?_r.event(e):e)}function $r(e,t,n,r,i,o,s,u,a){var c,l,f,d,h,p,v,y,b,m,g,_=t.type;if(void 0!==t.constructor)return null;null!=n.__h&&(a=n.__h,u=t.__e=n.__e,t.__h=null,o=[u]),(c=_r.__b)&&c(t);try{e:if("function"==typeof _){if(y=t.props,b=(c=_.contextType)&&r[c.__c],m=c?b?b.props.value:c.__:r,n.__c?v=(l=t.__c=n.__c).__=l.__E:("prototype"in _&&_.prototype.render?t.__c=l=new _(y,m):(t.__c=l=new Ar(y,m),l.constructor=_,l.render=Gr),b&&b.sub(l),l.props=y,l.state||(l.state={}),l.context=m,l.__n=r,f=l.__d=!0,l.__h=[]),null==l.__s&&(l.__s=l.state),null!=_.getDerivedStateFromProps&&(l.__s==l.state&&(l.__s=Er({},l.__s)),Er(l.__s,_.getDerivedStateFromProps(y,l.__s))),d=l.props,h=l.state,f)null==_.getDerivedStateFromProps&&null!=l.componentWillMount&&l.componentWillMount(),null!=l.componentDidMount&&l.__h.push(l.componentDidMount);else{if(null==_.getDerivedStateFromProps&&y!==d&&null!=l.componentWillReceiveProps&&l.componentWillReceiveProps(y,m),!l.__e&&null!=l.shouldComponentUpdate&&!1===l.shouldComponentUpdate(y,l.__s,m)||t.__v===n.__v){l.props=y,l.state=l.__s,t.__v!==n.__v&&(l.__d=!1),l.__v=t,t.__e=n.__e,t.__k=n.__k,t.__k.forEach((function(e){e&&(e.__=t)})),l.__h.length&&s.push(l);break e}null!=l.componentWillUpdate&&l.componentWillUpdate(y,l.__s,m),null!=l.componentDidUpdate&&l.__h.push((function(){l.componentDidUpdate(d,h,p)}))}l.context=m,l.props=y,l.state=l.__s,(c=_r.__r)&&c(t),l.__d=!1,l.__v=t,l.__P=e,c=l.render(l.props,l.state,l.context),l.state=l.__s,null!=l.getChildContext&&(r=Er(Er({},r),l.getChildContext())),f||null==l.getSnapshotBeforeUpdate||(p=l.getSnapshotBeforeUpdate(d,h)),g=null!=c&&c.type===Tr&&null==c.key?c.props.children:c,Br(e,Array.isArray(g)?g:[g],t,n,r,i,o,s,u,a),l.base=t.__e,t.__h=null,l.__h.length&&s.push(l),v&&(l.__E=l.__=null),l.__e=!1}else null==o&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=Vr(n.__e,t,n,r,i,o,s,a);(c=_r.diffed)&&c(t)}catch(e){t.__v=null,(a||null!=o)&&(t.__e=u,t.__h=!!a,o[o.indexOf(u)]=null),_r.__e(e,t,n)}}function Hr(e,t){_r.__c&&_r.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){_r.__e(e,t.__v)}}))}function Vr(e,t,n,r,i,o,s,u){var a,c,l,f,d=n.props,h=t.props,p=t.type,v=0;if("svg"===p&&(i=!0),null!=o)for(;v<o.length;v++)if((a=o[v])&&(a===e||(p?a.localName==p:3==a.nodeType))){e=a,o[v]=null;break}if(null==e){if(null===p)return document.createTextNode(h);e=i?document.createElementNS("http://www.w3.org/2000/svg",p):document.createElement(p,h.is&&h),o=null,u=!1}if(null===p)d===h||u&&e.data===h||(e.data=h);else{if(o=o&&jr.slice.call(e.childNodes),c=(d=n.props||Sr).dangerouslySetInnerHTML,l=h.dangerouslySetInnerHTML,!u){if(null!=o)for(d={},f=0;f<e.attributes.length;f++)d[e.attributes[f].name]=e.attributes[f].value;(l||c)&&(l&&(c&&l.__html==c.__html||l.__html===e.innerHTML)||(e.innerHTML=l&&l.__html||""))}if(function(e,t,n,r,i){var o;for(o in n)"children"===o||"key"===o||o in t||Fr(e,o,null,n[o],r);for(o in t)i&&"function"!=typeof t[o]||"children"===o||"key"===o||"value"===o||"checked"===o||n[o]===t[o]||Fr(e,o,t[o],n[o],r)}(e,h,d,i,u),l)t.__k=[];else if(v=t.props.children,Br(e,Array.isArray(v)?v:[v],t,n,r,i&&"foreignObject"!==p,o,s,e.firstChild,u),null!=o)for(v=o.length;v--;)null!=o[v]&&Ir(o[v]);u||("value"in h&&void 0!==(v=h.value)&&(v!==e.value||"progress"===p&&!v)&&Fr(e,"value",v,d.value,!1),"checked"in h&&void 0!==(v=h.checked)&&v!==e.checked&&Fr(e,"checked",v,d.checked,!1))}return e}function zr(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){_r.__e(e,n)}}function Yr(e,t,n){var r,i,o;if(_r.unmount&&_r.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||zr(r,null,t)),n||"function"==typeof e.type||(n=null!=(i=e.__e)),e.__e=e.__d=void 0,null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){_r.__e(e,t)}r.base=r.__P=null}if(r=e.__k)for(o=0;o<r.length;o++)r[o]&&Yr(r[o],t,n);null!=i&&Ir(i)}function Gr(e,t,n){return this.constructor(e,n)}_r={__e:function(e,t){for(var n,r,i;t=t.__;)if((n=t.__c)&&!n.__)try{if((r=n.constructor)&&null!=r.getDerivedStateFromError&&(n.setState(r.getDerivedStateFromError(e)),i=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e),i=n.__d),i)return n.__E=n}catch(t){e=t}throw e},__v:0},Ar.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=Er({},this.state),"function"==typeof e&&(e=e(Er({},n),this.props)),e&&Er(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),Rr(this))},Ar.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Rr(this))},Ar.prototype.render=Tr,wr=[],xr="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Kr.__r=0;var Jr={Error:{color:"red"},Alert:{error:{color:"red"},warning:{color:"yellow"},info:{color:"black"}},Darken:{position:"fixed",top:0,left:0,opacity:.5,backgroundColor:"#000",width:"100vw",height:"100vh",zIndex:150,webkitBackdropFilter:"blur(2px)",backdropFilter:"blur(2px)"},DialogOuter:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:150,alignItems:"center",display:"flex",justifyContent:"center"},DialogInner:{position:"relative",color:"#222",backgroundColor:"#fff",padding:"30px",marginBottom:"2em",maxWidth:"90%",maxHeight:"90%",overflowY:"auto",border:"3px solid #3d3d5d",borderRadius:"8px",boxShadow:"0 0 80px 10px #666",width:"auto"},Input:{height:"35px",width:"17em",borderColor:"#ccf4",outline:"none",fontSize:"17pt",padding:"8px"}};function Qr(e){var t=e.children;return Cr("div",null,Cr("div",{style:Jr.Darken}),Cr("div",{style:Jr.DialogOuter},Cr("div",{style:Jr.DialogInner},t)))}var Xr,Zr,ei,ti=0,ni=[],ri=_r.__b,ii=_r.__r,oi=_r.diffed,si=_r.__c,ui=_r.unmount;function ai(e,t){_r.__h&&_r.__h(Zr,e,ti||t),ti=0;var n=Zr.__H||(Zr.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function ci(e){return ti=1,function(e,t,n){var r=ai(Xr++,2);return r.t=e,r.__c||(r.__=[n?n(t):yi(void 0,t),function(e){var t=r.t(r.__[0],e);r.__[0]!==t&&(r.__=[t,r.__[1]],r.__c.setState({}))}],r.__c=Zr),r.__}(yi,e)}function li(e){return ti=5,function(e,t){var n=ai(Xr++,7);return vi(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}((function(){return{current:e}}),[])}function fi(){ni.forEach((function(e){if(e.__P)try{e.__H.__h.forEach(hi),e.__H.__h.forEach(pi),e.__H.__h=[]}catch(Zr){e.__H.__h=[],_r.__e(Zr,e.__v)}})),ni=[]}_r.__b=function(e){Zr=null,ri&&ri(e)},_r.__r=function(e){ii&&ii(e),Xr=0;var t=(Zr=e.__c).__H;t&&(t.__h.forEach(hi),t.__h.forEach(pi),t.__h=[])},_r.diffed=function(e){oi&&oi(e);var t=e.__c;t&&t.__H&&t.__H.__h.length&&(1!==ni.push(t)&&ei===_r.requestAnimationFrame||((ei=_r.requestAnimationFrame)||function(e){var t,n=function(){clearTimeout(r),di&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);di&&(t=requestAnimationFrame(n))})(fi)),Zr=void 0},_r.__c=function(e,t){t.some((function(e){try{e.__h.forEach(hi),e.__h=e.__h.filter((function(e){return!e.__||pi(e)}))}catch(ei){t.some((function(e){e.__h&&(e.__h=[])})),t=[],_r.__e(ei,e.__v)}})),si&&si(e,t)},_r.unmount=function(e){ui&&ui(e);var t=e.__c;if(t&&t.__H)try{t.__H.__.forEach(hi)}catch(e){_r.__e(e,t.__v)}};var di="function"==typeof requestAnimationFrame;function hi(e){var t=Zr;"function"==typeof e.__c&&e.__c(),Zr=t}function pi(e){var t=Zr;e.__c=e.__(),Zr=t}function vi(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function yi(e,t){return"function"==typeof t?t(e):t}function bi(e){var t=e.title,n=e.alerts,r=e.fields,i=e.onCancel,o=e.onSubmit,s=ci({}),u=s[0],a=s[1],c=li();return function(e,t){var n=ai(Xr++,4);!_r.__s&&vi(n.__H,t)&&(n.__=e,n.__H=t,Zr.__h.push(n))}((function(){var e;return null===(e=c.current)||void 0===e?void 0:e.focus()}),[]),Cr(Qr,null,Cr(Tr,null,Cr("h3",{style:Jr.WindowHeader},t),n.map((function(e){return Cr("p",{style:Jr.Alert[e.type]},function(e){var t=e.message;e.messageCode;var n=e.messageParams;return t.replace(/\{\w+\}/gi,(function(e){return n[e.substr(1,e.length-2)]}))}(e))})),Cr("form",{onSubmit:function(e){e.preventDefault(),o(u)}},Object.entries(r).map((function(e,t){var n=e[0],r=e[1],i=r.type,o=r.label,s=r.placeholder;return Cr("label",{style:Jr.Label},o?o+": ":"",Cr("input",{ref:0===t?c:void 0,type:i,name:n,autoComplete:"on",style:Jr.Input,autoFocus:!0,placeholder:s,value:u[n]||"",onInput:function(e){var t,r;return a(b(b({},u),((t={})[n]=function(e,t){switch(e){case"email":return t.toLowerCase();case"otp":return t.toUpperCase();default:return t}}(i,null===(r=e.target)||void 0===r?void 0:r.value),t)))}}))})))),Cr("div",{style:Jr.ButtonsDiv},Cr("button",{type:"submit",style:Jr.Button,onClick:function(){return o(u)}},"Submit"),Cr("button",{style:Jr.Button,onClick:i},"Cancel")))}var mi=function(e){function t(t){var n=e.call(this,t)||this;return n.observer=function(e){return n.setState({userInteraction:e})},n.state={userInteraction:void 0},n}return y(t,e),t.prototype.componentDidMount=function(){this.subscription=Object(a.a)(this.props.db.cloud.userInteraction).subscribe(this.observer)},t.prototype.componentWillUnmount=function(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)},t.prototype.render=function(e,t){var n=t.userInteraction;return n?Cr(bi,Object.assign({},n)):null},t}(Ar);function gi(e){var t=document.createElement("div");document.body.appendChild(t),function(e,t,n){var r,i,o;_r.__&&_r.__(e,t),i=(r="function"==typeof n)?null:n&&n.__k||t.__k,o=[],$r(t,e=(!r&&n||t).__k=Cr(Tr,null,[e]),i||Sr,Sr,void 0!==t.ownerSVGElement,!r&&n?[n]:i?null:t.firstChild?jr.slice.call(t.childNodes):null,o,!r&&n?n:i?i.__e:t.firstChild,r),Hr(o,e)}(Cr(mi,{db:e.vip}),t);var n=!1;return{unsubscribe:function(){t.remove(),n=!0},get closed(){return n}}}function _i(e){var t=this,n=e.name,r=new s.a(Et),o=[],u=null;e.on("ready",(function(e){return m(t,void 0,void 0,(function(){var t;return g(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,v(e)];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),console.error(t),[3,3];case 3:return[2]}}))}))}),!0);var f,d=!1;function h(){if(d)throw new i.a.DatabaseClosedError}function v(e){return m(this,void 0,void 0,(function(){var t,n,s,a,f,v,y,_,w,x,k=this;return g(this,(function(S){switch(S.label){case 0:return d=!1,y=Dn(e),Un||((null===(t=y.cloud.options)||void 0===t?void 0:t.customLoginGui)||o.push(gi(e)),o.push(function(e){var t=e.cloud.webSocketStatus.value,n=e.cloud.webSocketStatus.pipe(Qe((function(e){var n=t;t=e;var r=Object(c.a)(e);switch(e){case"disconnected":return ir.value?r.pipe(Se(500)):r;case"connecting":return"not-started"===n||"error"===n?r:r.pipe(Se(4e3));default:return r}})));return Object(p.a)([n,e.syncStateChangedEvent.pipe(Je({phase:"initial"})),or]).pipe(ve((function(t){var n=t[0],r=t[1],i=t[2],o=r.phase,s=r.error,u=r.progress,a=n;return"error"===o&&(a="error"),"not-started"===n&&("pushing"!==o&&"pulling"!==o||(a="connecting")),"error"!==e.cloud.syncState.value.phase||"pushing"!==r.phase&&"pulling"!==r.phase||(a="connecting"),i||(a="disconnected"),{phase:o,error:s,progress:u,status:xn?a:"offline"}})))}(y).subscribe(e.cloud.syncState))),y.tables.every((function(e){return e.core}))||Mn(),"serviceWorker"in navigator?[4,navigator.serviceWorker.getRegistrations()]:[3,2];case 1:return w=S.sent(),[3,3];case 2:w=[],S.label=3;case 3:return _=w,[4,y.transaction("rw",y.$syncState,(function(){return m(k,void 0,void 0,(function(){var e,t,n,r,i,o,s,u,a,c,l,f,d,h,p,v;return g(this,(function(m){switch(m.label){case 0:return n=y.cloud,r=n.options,i=n.schema,[4,Promise.all([y.getOptions(),y.getSchema(),y.getPersistedSyncState()])];case 1:return o=m.sent(),s=o[0],u=o[1],a=o[2],r?[3,2]:(y.cloud.options=s||null,[3,4]);case 2:return s&&JSON.stringify(s)===JSON.stringify(r)?[3,4]:[4,y.$syncState.put(r,"options")];case 3:m.sent(),m.label=4;case 4:return(null===(e=y.cloud.options)||void 0===e?void 0:e.tryUseServiceWorker)&&"serviceWorker"in navigator&&_.length>0&&!Bn?(console.debug("Dexie Cloud Addon: Using service worker"),y.cloud.usingServiceWorker=!0):((null===(t=y.cloud.options)||void 0===t?void 0:t.tryUseServiceWorker)&&!Un&&console.debug("dexie-cloud-addon: Not using service worker.",0===_.length?"No SW registrations found.":"serviceWorker"in navigator&&Bn?"Avoiding SW background sync and SW periodic bg sync for this browser due to browser bugs.":"navigator.serviceWorker not present"),y.cloud.usingServiceWorker=!1),gr(i,y.cloud.options),gr(u,y.cloud.options),i?[3,5]:(y.cloud.schema=u||null,[3,7]);case 5:if(u&&JSON.stringify(u)===JSON.stringify(i))return[3,7];for(c=u||{},l=0,f=Object.entries(i);l<f.length;l++)d=f[l],h=d[0],p=d[1],(v=c[h])?(v.markedForSync=p.markedForSync,p.deleted=v.deleted,v.generatedGlobalId=p.generatedGlobalId):c[h]=b({},p);return[4,y.$syncState.put(c,"schema")];case 6:m.sent(),Object.assign(i,c),m.label=7;case 7:return[2,null===a||void 0===a?void 0:a.initiallySynced]}}))}))}))];case 4:return(x=S.sent())&&y.setInitiallySynced(!0),function(e){for(var t,n,r=0,o=e.tables;r<o.length;r++){var s=o[r];if(null===(n=null===(t=e.cloud.schema)||void 0===t?void 0:t[s.name])||void 0===n?void 0:n.markedForSync){if(s.schema.primKey.auto)throw new i.a.SchemaError("Table "+s.name+" is both autoIncremented and synced. Use db.cloud.configure({unsyncedTables: ["+JSON.stringify(s.name)+"]}) to blacklist it from sync");if(!s.schema.primKey.keyPath)throw new i.a.SchemaError("Table "+s.name+" cannot be both synced and outbound. Use db.cloud.configure({unsyncedTables: ["+JSON.stringify(s.name)+"]}) to blacklist it from sync")}}}(y),!(null===(n=y.cloud.options)||void 0===n?void 0:n.databaseUrl)||x?[3,6]:[4,tr(y,y.cloud.options,y.cloud.schema)];case 5:S.sent(),y.setInitiallySynced(!0),S.label=6;case 6:return h(),Un?[3,8]:(o.push(Object(i.b)((function(){return y.getCurrentUser()})).subscribe(r)),o.push(Object(i.b)((function(){return y.getPersistedSyncState()})).subscribe(y.cloud.persistedSyncState)),[4,Object(p.a)([r.pipe(ze(1),$e(1)),y.cloud.persistedSyncState.pipe(ze(1),$e(1))]).toPromise()]);case 7:S.sent(),S.label=8;case 8:return(null===(s=y.cloud.options)||void 0===s?void 0:s.requireAuth)?[4,Ot(y)]:[3,10];case 9:S.sent(),S.label=10;case 10:return u&&u.stop(),u=null,h(),y.cloud.usingServiceWorker&&(null===(a=y.cloud.options)||void 0===a?void 0:a.databaseUrl)?(ct(y,"push").catch((function(){})),function(e){return m(this,void 0,void 0,(function(){var t,n,r,i;return g(this,(function(o){switch(o.label){case 0:return o.trys.push([0,8,,9]),[4,navigator.serviceWorker.ready];case 1:if(!(n=o.sent().periodicSync))return[3,6];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,n.register("dexie-cloud:"+e.name,null===(t=e.cloud.options)||void 0===t?void 0:t.periodicSync)];case 3:return o.sent(),console.debug("Dexie Cloud: Successfully registered periodicsync event for "+e.name),[3,5];case 4:return r=o.sent(),console.debug("Dexie Cloud: Failed to register periodic sync. Your PWA must be installed to allow background sync.",r),[3,5];case 5:return[3,7];case 6:console.debug("Dexie Cloud: periodicSync not supported."),o.label=7;case 7:return[3,9];case 8:return i=o.sent(),console.debug("Dexie Cloud: Could not register periodicSync for "+e.name,i),[3,9];case 9:return[2]}}))}))}(y).catch((function(){}))):(null===(f=y.cloud.options)||void 0===f?void 0:f.databaseUrl)&&y.cloud.schema&&!Un&&((u=mr(y,y.cloud.options,y.cloud.schema)).start(),lt(y,"push")),h(),Un||o.push(Object(l.a)(self,"online").subscribe((function(){console.debug("online!"),y.syncStateChangedEvent.next({phase:"not-in-sync"}),lt(y,"push")})),Object(l.a)(self,"offline").subscribe((function(){console.debug("offline!"),y.syncStateChangedEvent.next({phase:"offline"})}))),"undefined"!==typeof window&&!Un&&(null===(v=y.cloud.options)||void 0===v?void 0:v.databaseUrl)&&o.push(pr(y)),[2]}}))}))}!function(e,t){e.on.close.subscribe(t);var n=e.close;e.close=function(){n.call(this),t()}}(e,(function(){o.forEach((function(e){return e.unsubscribe()})),d=!0,u&&u.stop(),u=null,r.next(Et)})),e.cloud={version:"1.0.0-beta.10",options:null,schema:null,serverState:null,get currentUserId(){return r.value.userId||Et.userId},currentUser:r,syncState:new s.a({phase:"initial",status:"not-started"}),persistedSyncState:new s.a(void 0),userInteraction:new s.a(void 0),webSocketStatus:new s.a("not-started"),login:function(t){return m(this,void 0,void 0,(function(){var n;return g(this,(function(r){switch(r.label){case 0:return[4,(n=Dn(e)).cloud.sync()];case 1:return r.sent(),[4,Ot(n,t)];case 2:return r.sent(),[2]}}))}))},configure:function(t){e.cloud.options=t,t.databaseUrl&&(e.name=n+"-"+function(e){var t=new URL(e);return"/"===t.pathname?t.hostname.split(".")[0]:t.pathname.split("/")[1]}(t.databaseUrl),Dn(e).reconfigure()),gr(e.cloud.schema,e.cloud.options)},sync:function(t){var n=void 0===t?{wait:!0,purpose:"push"}:t,r=n.wait,o=n.purpose;return m(this,void 0,void 0,(function(){var t,n,s,u,c=this;return g(this,(function(l){switch(l.label){case 0:return void 0===r&&(r=!0),t=Dn(e),"pull"!==o?[3,3]:(n=t.cloud.persistedSyncState.value,lt(t,o),r?[4,t.cloud.persistedSyncState.pipe(Fe((function(e){return null!=(null===e||void 0===e?void 0:e.timestamp)&&(!n||e.timestamp>n.timestamp)})),$e(1)).toPromise()]:[3,2]);case 1:if(null===(s=l.sent())||void 0===s?void 0:s.error)throw new Error("Sync error: "+s.error);l.label=2;case 2:return[3,6];case 3:return[4,vr(t)];case 4:return l.sent()?(u=t.cloud.persistedSyncState.value,lt(t,o),r?(console.debug("db.cloud.login() is waiting for sync completion..."),[4,Object(a.a)(Object(i.b)((function(){return m(c,void 0,void 0,(function(){var e,n;return g(this,(function(r){switch(r.label){case 0:return[4,vr(t)];case 1:return e=r.sent(),[4,t.getPersistedSyncState()];case 2:if((null===(n=r.sent())||void 0===n?void 0:n.timestamp)!==(null===u||void 0===u?void 0:u.timestamp)&&(null===n||void 0===n?void 0:n.error))throw new Error("Sync error: "+n.error);return[2,e]}}))}))}))).pipe(Fe((function(e){return!e})),$e(1)).toPromise()]):[3,6]):[3,6];case 5:l.sent(),console.debug("Done waiting for sync completion because we have nothing to push anymore"),l.label=6;case 6:return[2]}}))}))}},e.Version.prototype._parseStoresSpec=i.a.override(e.Version.prototype._parseStoresSpec,(function(t){return Xn(t,e)})),e.use(Qn({currentUserObservable:e.cloud.currentUser,db:Dn(e)})),e.use((f=Dn(e),{stack:"dbcore",name:"implicitPropSetterMiddleware",level:1,create:function(e){return b(b({},e),{table:function(t){var n=e.table(t);return b(b({},n),{mutate:function(e){var r,i,o,s=e.trans;if((null===(i=null===(r=f.cloud.schema)||void 0===r?void 0:r[t])||void 0===i?void 0:i.markedForSync)&&(null===(o=s.currentUser)||void 0===o?void 0:o.isLoggedIn)&&("add"===e.type||"put"===e.type))for(var u=0,a=e.values;u<a.length;u++){var c=a[u];"owner"in c||(c.owner=s.currentUser.userId),"realmId"in c||(c.realmId=s.currentUser.userId)}return n.mutate(e)}})}})}})),e.use(Hn(Dn(e)))}_i.version="1.0.0-beta.10",i.a.Cloud=_i,t.a=_i}).call(this,n(81).Buffer,n(43))},65:function(e){e.exports=JSON.parse('{"demoUsers":{"foo@demo.local":{},"bar@demo.local":{}}}')},79:function(e,t,n){},91:function(e,t,n){},92:function(e,t,n){},95:function(e,t,n){},96:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=n(24),s=n.n(o),u=(n(79),n(32)),a=n(17),c=n.n(a),l=n(33),f=n(62),d=n(63),h=n(71),p=n(69),v=n(44),y=n(64);function b(){return(b=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=new(function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(f.a)(this,n),(e=t.call(this,"TodoDBCloud",{addons:[y.a]})).todoLists=void 0,e.todoItems=void 0,e.version(1).stores({todoLists:"@id",todoItems:"@id, todoListId"}),e.cloud.configure({databaseUrl:"https://z0lesejpr.dexie.cloud",tryUseServiceWorker:!0,requireAuth:!1}),e}return Object(d.a)(n,[{key:"deleteList",value:function(e){var t=this;return this.transaction("rw",this.todoItems,this.todoLists,(function(){t.todoItems.where({todoListId:e}).delete(),t.todoLists.delete(e)}))}}]),n}(v.default));function g(){return _.apply(this,arguments)}function _(){return(_=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.delete();case 2:window.location.reload();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}m.on("populate",(function(){return b.apply(this,arguments)}));var w=n(21),x=n(22),k=n(1);function S(e){var t=e.item;return Object(k.jsxs)("div",{className:"row "+(t.done?"done":""),children:[Object(k.jsx)("div",{className:"narrow",children:Object(k.jsx)("input",{type:"checkbox",checked:!!t.done,onChange:function(e){return m.todoItems.update(t,{done:e.target.checked})}})}),Object(k.jsx)("div",{className:"todo-item-text",children:t.title}),Object(k.jsx)("div",{className:"todo-item-trash",children:Object(k.jsx)("button",{onClick:function(){return m.todoItems.delete(t.id)},title:"Delete item",children:Object(k.jsx)(w.a,{icon:x.c})})})]})}var j=n(60),O=n(46);function E(e){var t=e.todoList,n=Object(r.useState)({todoListId:t.id,title:""}),i=Object(O.a)(n,2),o=i[0],s=i[1];return Object(k.jsxs)("div",{className:"row add-item",children:[Object(k.jsx)("div",{className:"narrow",children:Object(k.jsx)("input",{type:"checkbox",disabled:!0})}),Object(k.jsx)("div",{className:"todo-item-input",children:Object(k.jsx)("input",{type:"text",placeholder:"Add todo item ...",value:o.title,onChange:function(e){return s((function(t){return Object(j.a)(Object(j.a)({},t),{},{title:e.target.value})}))},onKeyUp:function(e){"Enter"===e.key&&(m.todoItems.add(o),s({todoListId:t.id,title:""}))}})})]})}function I(e){var t=e.todoList,n=Object(u.useLiveQuery)((function(){return m.todoItems.where({todoListId:t.id}).toArray()}),[t.id]);return n?Object(k.jsxs)("div",{className:"box",children:[Object(k.jsxs)("div",{className:"grid-row",children:[Object(k.jsx)("h2",{children:t.title}),Object(k.jsx)("div",{className:"todo-list-trash",children:Object(k.jsx)("button",{onClick:function(){return m.deleteList(t.id)},title:"Delete list",children:Object(k.jsx)(w.a,{icon:x.d})})})]}),Object(k.jsx)("div",{children:n.map((function(e){return Object(k.jsx)(S,{item:e},e.id)}))}),Object(k.jsx)("div",{children:Object(k.jsx)(E,{todoList:t})})]}):null}function C(){var e=Object(u.useLiveQuery)((function(){return m.todoLists.toArray()}));return e?Object(k.jsx)("div",{children:e.map((function(e){return Object(k.jsx)(I,{todoList:e},e.id)}))}):null}function P(){var e=Object(r.useState)(!1),t=Object(O.a)(e,2),n=t[0],i=t[1],o=Object(r.useState)(""),s=Object(O.a)(o,2),a=s[0],f=s[1],d=Object(u.useLiveQuery)(Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.todoLists.count();case 2:return t=e.sent,e.abrupt("return",t>0);case 4:case"end":return e.stop()}}),e)}))));return n?Object(k.jsxs)("div",{className:"box",children:[Object(k.jsx)("h2",{children:"Give your list a name:"}),Object(k.jsx)("div",{className:"todo-item-input",children:Object(k.jsx)("input",{type:"text",autoFocus:!0,placeholder:"Name of list...",value:a,onChange:function(e){return f(e.target.value)},onKeyUp:function(e){"Enter"===e.key&&(m.todoLists.add({title:a}),f(""),i(!1))}})})]}):Object(k.jsxs)("button",{className:"large-button",onClick:function(){return i(!n)},children:[Object(k.jsx)(w.a,{icon:x.b})," ",d?"Add another list":"Create ToDo List"]})}function T(){return Object(k.jsxs)("button",{className:"large-button",onClick:function(){g()},children:[Object(k.jsx)(w.a,{icon:x.a})," Reset Database"]})}var A=n(105),D=n(104),N=n(70),R=n(68),K=n(106),B=function(){return Object(k.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",x:"0px",y:"0px",viewBox:"0 0 100 125",xmlSpace:"preserve",children:[Object(k.jsx)("g",{children:Object(k.jsx)("path",{d:"M81.2,38.9c-3.5-12.9-15.3-22-28.9-22c-11.4,0-21.9,6.7-26.9,16.8C12.6,34.6,2.5,45.3,2.5,58.4     c0,13.6,11.1,24.7,24.7,24.7h47.7c12.4,0,22.6-10.1,22.6-22.6C97.5,50.3,90.8,41.6,81.2,38.9z M74.9,75.4H27.2     c-9.4,0-17-7.6-17-17s7.6-17,17-17c0.2,0,0.4,0,0.6,0c1.6,0,3.2-0.9,3.7-2.5c3.3-8.5,11.6-14.3,20.8-14.3     c10.7,0,19.9,7.6,21.9,18.1c0.3,1.6,1.6,2.9,3.2,3.1c7.2,1.2,12.4,7.3,12.4,14.6C89.8,68.7,83.1,75.4,74.9,75.4z"})}),Object(k.jsxs)("g",{transform:"translate(14,-958.36218)",children:[Object(k.jsx)("path",{id:"third",d:"m 35,1000.3621 c -8.058,0 -15.4484,2.7386 -21.2188,7.1875 a 2.0002,2.0002 0 1 0 2.4376,3.1562 c 5.0947,-3.9281 11.635,-6.3437 18.7812,-6.3437 7.1462,0 13.6865,2.4156 18.7812,6.3437 a 2.0002,2.0002 0 1 0 2.4376,-3.1562 C 50.4484,1003.1007 43.058,1000.3621 35,1000.3621"}),Object(k.jsx)("path",{id:"second",d:"m 35,1009.3621 c -5.8189,0 -11.3007,1.7801 -15.5625,5.2812 a 2.0002,2.0002 0 1 0 2.5313,3.0938 c 3.4852,-2.8633 8.0339,-4.375 13.0312,-4.375 4.9973,0 9.546,1.5117 13.0312,4.375 a 2.0002,2.0002 0 1 0 2.5313,-3.0938 c -4.2618,-3.5011 -9.7436,-5.2812 -15.5625,-5.2812"}),Object(k.jsx)("path",{opacity:"0.4",id:"first",d:"m 35,1018.9376 c -3.6493,0 -7.1142,1.1668 -9.8125,3.3437 a 2.0009763,2.0009763 0 0 0 2.5,3.125 c 1.9329,-1.5594 4.5256,-2.4687 7.3125,-2.4687 2.7869,0 5.3796,0.9093 7.3125,2.4687 a 2.0009763,2.0009763 0 1 0 2.5,-3.125 c -2.6983,-2.1769 -6.1632,-3.3437 -9.8125,-3.3437 z m 0,8.0625 z"})]}),Object(k.jsx)("animate",{xlinkHref:"#first",attributeName:"opacity",dur:"3s",begin:"0s",calcMode:"discrete",from:"0.2",to:"1",repeatDur:"indefinite"}),Object(k.jsx)("animate",{xlinkHref:"#second",attributeName:"opacity",dur:"3s",begin:"0.7s",calcMode:"discrete",from:"0.2",to:"1",repeatDur:"indefinite"}),Object(k.jsx)("animate",{xlinkHref:"#third",attributeName:"opacity",dur:"3s",begin:"1.4s",calcMode:"discrete",from:"0.2",to:"1",repeatDur:"indefinite"})]})},U=function(){return Object(k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlSpace:"preserve",version:"1.1",style:{shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",imageRendering:"optimizeQuality"},viewBox:"0 0 755 633.75",x:"0px",y:"0px",fillRule:"evenodd",clipRule:"evenodd",children:Object(k.jsx)("g",{children:Object(k.jsx)("path",{d:"M205 111c69,-162 315,-141 357,29 47,9 88,40 108,84 139,63 99,283 -63,283l-459 0c-155,0 -201,-204 -76,-276 14,-64 68,-112 133,-120zm41 287c-15,16 -40,-8 -24,-24 38,-39 102,-54 155,-54 53,0 118,15 156,54 15,16 -9,40 -24,24 -32,-32 -88,-44 -132,-44 -43,0 -100,12 -131,44zm235 -190c-18,0 -33,15 -33,33 0,17 15,32 33,32 17,0 32,-15 32,-32 0,-18 -15,-33 -32,-33zm-207 0c18,0 33,15 33,33 0,17 -15,32 -33,32 -18,0 -32,-15 -32,-32 0,-18 14,-33 32,-33zm364 49c116,36 90,207 -31,207l-459 0c-117,0 -148,-163 -37,-204 3,-60 52,-108 113,-108 4,0 8,0 11,0 41,-161 280,-140 290,27 2,0 5,0 8,0 49,0 91,33 105,78z"})})})},M=function(){return Object(k.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",viewBox:"0 0 100 125",x:"0px",y:"0px",children:[Object(k.jsx)("path",{d:"M88.17,69.32A22,22,0,0,0,77.79,37.77a22,22,0,0,0-21.91-20.2,20.29,20.29,0,0,0-13.67,4.81l4.57,5.3a13.31,13.31,0,0,1,9.1-3.11,15,15,0,0,1,15,15c0,.06,0,.13,0,.19s0,.26,0,.39l-.1,2.75,2.65.75a15,15,0,0,1,8.79,22.1Z"}),Object(k.jsx)("path",{d:"M28.76,80H60.44V73H28.76a15,15,0,0,1-15-15A17,17,0,0,1,23.6,42.7l-2.79-6.42A23.91,23.91,0,0,0,6.78,58,22,22,0,0,0,28.76,80Z"}),Object(k.jsx)("rect",{x:"45.53",y:"-4.58",width:"7",height:"106.75",transform:"translate(-20.14 48.96) rotate(-45)"})]})},L=function(){return Object(k.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",x:"0px",y:"0px",viewBox:"0 0 100 125",xmlSpace:"preserve",children:Object(k.jsxs)("g",{children:[Object(k.jsx)("path",{d:"M81.2,38.9c-3.5-12.9-15.3-22-28.9-22c-11.4,0-21.9,6.7-26.9,16.8C12.6,34.6,2.5,45.3,2.5,58.4     c0,13.6,11.1,24.7,24.7,24.7h47.7c12.4,0,22.6-10.1,22.6-22.6C97.5,50.3,90.8,41.6,81.2,38.9z M74.9,75.4H27.2     c-9.4,0-17-7.6-17-17s7.6-17,17-17c0.2,0,0.4,0,0.6,0c1.6,0,3.2-0.9,3.7-2.5c3.3-8.5,11.6-14.3,20.8-14.3     c10.7,0,19.9,7.6,21.9,18.1c0.3,1.6,1.6,2.9,3.2,3.1c7.2,1.2,12.4,7.3,12.4,14.6C89.8,68.7,83.1,75.4,74.9,75.4z"}),Object(k.jsx)("path",{d:"M60.8,39.5c-0.8-0.6-1.9-0.5-2.6,0.2L43.4,56.5l-4.5-5.2c-0.7-0.8-1.8-0.9-2.6-0.2l-3.2,2.6c-0.8,0.6-0.9,1.8-0.3,2.6     l6.6,8.9c0.4,0.5,0.9,0.7,1.5,0.8l4.9,0c0.6,0,1.2-0.3,1.5-0.8l15.9-21.3c0.6-0.8,0.5-1.9-0.3-2.6L60.8,39.5z"})]})})},F=function(){return Object(k.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",x:"0px",y:"0px",viewBox:"0 0 100 125",xmlSpace:"preserve",children:[Object(k.jsx)("g",{transform:"scale(1 0.95) translate(0 10)",children:Object(k.jsx)("path",{d:"M81.2,38.9c-3.5-12.9-15.3-22-28.9-22c-11.4,0-21.9,6.7-26.9,16.8C12.6,34.6,2.5,45.3,2.5,58.4     c0,13.6,11.1,24.7,24.7,24.7h47.7c12.4,0,22.6-10.1,22.6-22.6C97.5,50.3,90.8,41.6,81.2,38.9z M74.9,75.4H27.2     c-9.4,0-17-7.6-17-17s7.6-17,17-17c0.2,0,0.4,0,0.6,0c1.6,0,3.2-0.9,3.7-2.5c3.3-8.5,11.6-14.3,20.8-14.3     c10.7,0,19.9,7.6,21.9,18.1c0.3,1.6,1.6,2.9,3.2,3.1c7.2,1.2,12.4,7.3,12.4,14.6C89.8,68.7,83.1,75.4,74.9,75.4z"})}),Object(k.jsxs)("g",{transform:"translate(-40,-20) scale(1.5 1.5)",children:[Object(k.jsx)("polygon",{points:"84.453,20.676 87.936,20.687 84.442,23.66 84.433,25.766 91.565,25.793 91.572,23.755   88.007,23.741 91.58,20.701 91.591,18.665 84.458,18.636 "}),Object(k.jsx)("polygon",{points:"82.076,21.047 72.533,21.011 72.525,23.739 77.184,23.755 72.507,27.732 72.5,30.552 82.042,30.589   82.051,27.861 77.281,27.842 82.065,23.774 "})]}),Object(k.jsxs)("g",{transform:"translate(-29 -10) scale(1.5 1.5)",children:[Object(k.jsx)("path",{d:"M42.5,49.062h-3.75c-0.518,0-0.938,0.419-0.938,0.938s0.419,0.938,0.938,0.938h3.75  c0.518,0,0.938-0.419,0.938-0.938S43.018,49.062,42.5,49.062z"}),Object(k.jsx)("path",{d:"M61.25,49.062H57.5c-0.518,0-0.938,0.419-0.938,0.938s0.419,0.938,0.938,0.938h3.75  c0.518,0,0.938-0.419,0.938-0.938S61.768,49.062,61.25,49.062z"})]})]})};n(91);function q(e){var t=e.children,n=e.className,r=e.title;return Object(k.jsx)("div",{className:"svg-icon"+(n?" "+n:""),title:r,children:Object(k.jsx)("div",{children:t})})}function W(e){var t=e.className,n=Object(K.a)(m.cloud.syncState);switch(null===n||void 0===n?void 0:n.status){case"not-started":return Object(k.jsx)(q,{className:t});case"connecting":return Object(k.jsx)(q,{className:t,children:Object(k.jsx)(B,{})});case"connected":return Object(k.jsx)(q,{className:t,children:Object(k.jsx)(L,{})});case"disconnected":return Object(k.jsx)(q,{className:t,children:Object(k.jsx)(F,{})});case"offline":return Object(k.jsx)(q,{className:t,title:n.error&&""+n.error,children:Object(k.jsx)(M,{})});case"error":return Object(k.jsx)(q,{className:t,title:n.error&&""+n.error,children:Object(k.jsx)(U,{})});default:return Object(k.jsx)(q,{className:t,children:null===n||void 0===n?void 0:n.phase})}}n(92);var $=n(65);function H(e){return function(){return e.apply(void 0,arguments).catch((function(e){"AbortError"===(null===e||void 0===e?void 0:e.name)?console.debug(e):console.error(e)}))}}function V(){var e=Object(K.a)(m.cloud.currentUser);return Object(k.jsxs)(A.a,{fixed:"top",sticky:"top",collapseOnSelect:!0,expand:"lg",bg:"dark",variant:"dark",children:[Object(k.jsx)(A.a.Brand,{children:"Dexie Cloud ToDo App"}),Object(k.jsx)(A.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),Object(k.jsx)(A.a.Text,{className:"d-inline-flex d-lg-none status-icons-collapsed",children:Object(k.jsx)(W,{})}),Object(k.jsx)(A.a.Collapse,{id:"responsive-navbar-nav",className:"justify-content-end",children:(null===e||void 0===e?void 0:e.isLoggedIn)?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(A.a.Text,{className:"d-none d-lg-inline-flex status-icons-not-collapsed",children:Object(k.jsx)(W,{})}),Object(k.jsx)(D.a,{title:e.name,id:"basic-nav-dropdown",children:Object(k.jsx)(D.a.Item,{onClick:function(){return g()},children:"Logout"})})]}):Object(k.jsxs)(D.a,{id:"basic-nav-dropdown",title:"Sign in or create your account",children:[Object(k.jsx)(D.a.Header,{children:"Sign in a demo user"}),Object(k.jsx)(k.Fragment,{children:Object.keys($.demoUsers).map((function(e){return Object(k.jsx)(D.a.Item,{children:Object(k.jsx)(N.a,{onClick:H((function(){return m.cloud.login({grant_type:"demo",email:e})})),children:e})},e)}))}),Object(k.jsx)(D.a.Divider,{}),Object(k.jsx)(D.a.Header,{children:"Sign in real user"}),Object(k.jsx)(D.a.Item,{children:Object(k.jsx)(R.a,{onClick:H((function(){return m.cloud.login()})),children:"Sign in / sign up yourself"})})]})})]})}n(94),n(95);var z=function(){return Object(k.jsxs)("div",{children:[Object(k.jsx)(V,{}),Object(k.jsx)(C,{}),Object(k.jsx)(P,{}),Object(k.jsx)(T,{})]})},Y=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function G(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,107)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,o=t.getLCP,s=t.getTTFB;n(e),r(e),i(e),o(e),s(e)}))};window.Dexie=v.default,s.a.render(Object(k.jsx)(i.a.StrictMode,{children:Object(k.jsx)(z,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/service-worker.js");Y?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):G(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):G(t,e)}))}}(),J()}},[[96,1,2]]]);
//# sourceMappingURL=main.9f72120d.chunk.js.map