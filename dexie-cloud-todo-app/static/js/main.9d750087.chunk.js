/*! For license information please see main.9d750087.chunk.js.LICENSE.txt */
(this["webpackJsonpdexie-cloud-todo-app"]=this["webpackJsonpdexie-cloud-todo-app"]||[]).push([[0],{104:function(e,t,n){},105:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(31),a=n.n(i),u=(n(92),n(14)),s=n(4),c=n(26),l=n(22),f=n(17),d=n(1);function h(e){var t=e.item,n=Object(u.usePermissions)(s.db,"todoItems",t);return console.log("TodoItem",t.title,t.owner,t.realmId),Object(d.jsxs)("div",{className:"row "+(t.done?"done":""),children:[Object(d.jsx)("div",{className:"narrow",children:Object(d.jsx)("input",{type:"checkbox",disabled:!n.update("done"),checked:!!t.done,onChange:function(e){s.db.todoItems.update(t.id,{done:e.target.checked})}})}),Object(d.jsx)("div",{className:"todo-item-text",children:t.title}),Object(d.jsx)("div",{className:"todo-item-trash",children:Object(d.jsx)("button",{disabled:!n.delete(),onClick:function(){return s.db.todoItems.delete(t.id)},title:"Delete item",children:Object(d.jsx)(l.a,{icon:f.f})})})]})}var p=n(77);function v(e){var t=e.todoList,n=Object(r.useState)({title:""}),o=Object(c.a)(n,2),i=o[0],a=o[1];return Object(d.jsxs)("div",{className:"row add-item",children:[Object(d.jsx)("div",{className:"narrow",children:Object(d.jsx)("input",{type:"checkbox",disabled:!0})}),Object(d.jsx)("div",{className:"todo-item-input",children:Object(d.jsx)("input",{type:"text",placeholder:"Add todo item ...",value:i.title,onChange:function(e){return a((function(t){return Object(p.a)(Object(p.a)({},t),{},{title:e.target.value})}))},onKeyUp:function(e){"Enter"===e.key&&(s.db.todoItems.add({todoListId:t.id,realmId:t.realmId,title:i.title}),a({todoListId:t.id,title:""}))}})})]})}var b=n(9),y=n.n(b),m=n(13),g=n(28),w={owner:f.h,doer:f.a,manager:f.i,readonly:f.c};function _(e){var t=e.todoList,n=e.member,r=e.access;return Object(d.jsx)("select",{disabled:t.owner===n.userId&&n.userId===s.db.cloud.currentUserId,value:r,onChange:function(e){return function(e,t,n,r){var o=Object(g.b)(e.id);return s.db.transaction("rw",s.db.todoLists,s.db.members,s.db.realms,(function(){if("owner"!==n&&"owner"===r){if(!t.userId)throw new Error("Cannot give ownership to user before invite is accepted.");s.db.members.where({realmId:o,userId:e.owner}).modify({permissions:{manage:"*"}}),s.db.todoLists.update(e,{owner:t.userId}),s.db.realms.update(o,{owner:t.userId})}switch(r){case"doer":s.db.members.update(t,{permissions:{add:["todoItems"],update:{todoItems:["done"]}}});break;case"manager":s.db.members.update(t,{permissions:{manage:"*"}});break;case"readonly":s.db.members.update(t,{permissions:{}})}"owner"===n&&"owner"!==r&&(s.db.todoLists.update(e,{owner:s.db.cloud.currentUserId}),s.db.realms.update(o,{owner:s.db.cloud.currentUserId}))}))}(t,n,r,e.target.value)},children:Object.keys(w).map((function(e){return Object(d.jsx)("option",{value:e,disabled:"owner"===e&&!n.userId,children:e},e)}))})}function x(e){var t,n,r,o,i=e.member,a=e.todoList,c=Object(u.usePermissions)(s.db,"members",i),f=i.userId===a.owner?"owner":"*"===(null===(t=i.permissions)||void 0===t?void 0:t.manage)?"manager":"*"===(null===(n=i.permissions)||void 0===n?void 0:n.add)||(null===(r=i.permissions)||void 0===r||null===(o=r.add)||void 0===o?void 0:o.includes("todoItems"))?"doer":"readonly";return Object(d.jsxs)("fieldset",{className:"border p-1",children:[Object(d.jsx)(l.a,{icon:w[f]}),c.update("permissions")?Object(d.jsx)(_,{todoList:a,member:i,access:f}):f]})}function j(e){var t=e.todoList,n=Object(r.useState)(""),o=Object(c.a)(n,2),i=o[0],a=o[1],l=Object(r.useState)(""),f=Object(c.a)(l,2),h=f[0],p=f[1],v=Object(u.useLiveQuery)(Object(m.a)(y.a.mark((function e(){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.db.members.where({realmId:t.realmId}).toArray();case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),[t.realmId]),b=Object(u.usePermissions)(t);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("h5",{children:"Shared with"}),Object(d.jsx)("table",{children:Object(d.jsx)("tbody",{children:null===v||void 0===v?void 0:v.map((function(e){return Object(d.jsx)(k,{todoList:t,member:e},e.id)}))})}),Object(d.jsx)("hr",{}),b.add("members")&&Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("h4",{children:"Invite someone?"}),Object(d.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t.shareWith(i,h,!0)},children:[Object(d.jsx)("input",{type:"email",placeholder:"Email",value:h,onChange:function(e){return p(e.target.value)}}),Object(d.jsx)("input",{type:"text",placeholder:"Name",value:i,onChange:function(e){return a(e.target.value)}}),Object(d.jsx)("button",{type:"submit",disabled:!/@/.test(h),children:"Send invite"})]}),Object(d.jsx)("hr",{})]})]})}function k(e){var t,n,r=e.member,o=e.todoList,i=Object(u.usePermissions)(s.db,"members",r),a=r.userId===s.db.cloud.currentUserId,c=r.userId===o.owner,h=a?"Me":r.email?"".concat(r.name," <").concat(r.email,">"):r.userId;return Object(d.jsxs)("tr",{children:[Object(d.jsx)("td",{children:h}),Object(d.jsx)("td",{children:Object(d.jsx)(x,{member:r,todoList:o})}),Object(d.jsx)("td",{children:i.delete()&&!c?Object(d.jsx)("div",{className:"todo-list-trash",children:Object(d.jsx)("button",{className:"button",onClick:function(){return o.unshareWith(r)},children:Object(d.jsx)(l.a,{icon:f.f})})}):!c&&r.userId===s.db.cloud.currentUserId&&(((null===(t=r.accepted)||void 0===t?void 0:t.getTime())||0)>((null===(n=r.rejected)||void 0===n?void 0:n.getTime())||0)?Object(d.jsx)("button",{onClick:function(){return o.leave()},children:"Leave list"}):Object(d.jsx)("button",{onClick:function(){return s.db.members.update(r.id,{accepted:new Date,rejected:void 0})},children:"Accept invite"}))}),Object(d.jsx)("td",{})]})}function S(e){var t=e.todoList,n=Object(u.useLiveQuery)((function(){return s.db.todoItems.where({todoListId:t.id}).toArray()}),[t.id]),r=Object(u.usePermissions)(t),o=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return[null!==(n=Object(u.useLiveQuery)((function(){return s.db.openCloseStates.get([e,t])}),[e,t],r))&&void 0!==n?n:r,function(n){return s.db.openCloseStates.put(n,[e,t])}]}("sharing-menu",t.id,!1),i=Object(c.a)(o,2),a=i[0],p=i[1];return n?Object(d.jsxs)("div",{className:"box",children:[Object(d.jsxs)("div",{className:"grid-row",children:[Object(d.jsx)("h2",{children:t.title}),Object(d.jsx)("div",{className:"todo-list-trash",children:Object(d.jsx)("button",{disabled:!r.delete(),onClick:function(){return t.delete()},title:"Delete list",children:Object(d.jsx)(l.a,{icon:f.g})})}),!t.isPrivate()&&Object(d.jsx)("div",{className:"todo-list-trash",children:Object(d.jsx)("button",{onClick:function(){return p(!a)},children:Object(d.jsx)(l.a,{icon:f.e})})})]}),a&&Object(d.jsx)(j,{todoList:t}),Object(d.jsx)("div",{children:n.map((function(e){return Object(d.jsx)(h,{item:e},e.id)}))}),Object(d.jsx)("div",{children:r.add("todoItems")&&Object(d.jsx)(v,{todoList:t})})]}):null}function O(){var e=Object(u.useLiveQuery)((function(){return s.db.todoLists.toArray()}));return e?Object(d.jsx)("div",{children:e.map((function(e){return Object(d.jsx)(S,{todoList:e},e.id)}))}):null}function I(){var e=Object(r.useState)(!1),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(""),a=Object(c.a)(i,2),h=a[0],p=a[1],v=Object(u.useLiveQuery)(Object(m.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.db.todoLists.count();case 2:return t=e.sent,e.abrupt("return",t>0);case 4:case"end":return e.stop()}}),e)}))));return n?Object(d.jsxs)("div",{className:"box",children:[Object(d.jsx)("h2",{children:"Give your list a name:"}),Object(d.jsx)("div",{className:"todo-item-input",children:Object(d.jsx)("input",{type:"text",autoFocus:!0,placeholder:"Name of list...",value:h,onChange:function(e){return p(e.target.value)},onKeyUp:function(e){"Enter"===e.key&&(s.db.todoLists.add({title:h}),p(""),o(!1))}})})]}):Object(d.jsxs)("button",{className:"large-button",onClick:function(){return o(!n)},children:[Object(d.jsx)(l.a,{icon:f.d})," ",v?"Add another list":"Create ToDo List"]})}function E(){return Object(d.jsxs)("button",{className:"large-button",onClick:Object(m.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.db.delete();case 2:window.location.reload();case 3:case"end":return e.stop()}}),e)}))),children:[Object(d.jsx)(l.a,{icon:f.b})," Factory reset client"]})}var P=n(121),C=n(120),A=n(86),T=n(85),D=n(122),R=function(){return Object(d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",x:"0px",y:"0px",viewBox:"0 0 100 125",xmlSpace:"preserve",children:[Object(d.jsx)("g",{children:Object(d.jsx)("path",{d:"M81.2,38.9c-3.5-12.9-15.3-22-28.9-22c-11.4,0-21.9,6.7-26.9,16.8C12.6,34.6,2.5,45.3,2.5,58.4     c0,13.6,11.1,24.7,24.7,24.7h47.7c12.4,0,22.6-10.1,22.6-22.6C97.5,50.3,90.8,41.6,81.2,38.9z M74.9,75.4H27.2     c-9.4,0-17-7.6-17-17s7.6-17,17-17c0.2,0,0.4,0,0.6,0c1.6,0,3.2-0.9,3.7-2.5c3.3-8.5,11.6-14.3,20.8-14.3     c10.7,0,19.9,7.6,21.9,18.1c0.3,1.6,1.6,2.9,3.2,3.1c7.2,1.2,12.4,7.3,12.4,14.6C89.8,68.7,83.1,75.4,74.9,75.4z"})}),Object(d.jsxs)("g",{transform:"translate(14,-958.36218)",children:[Object(d.jsx)("path",{id:"third",d:"m 35,1000.3621 c -8.058,0 -15.4484,2.7386 -21.2188,7.1875 a 2.0002,2.0002 0 1 0 2.4376,3.1562 c 5.0947,-3.9281 11.635,-6.3437 18.7812,-6.3437 7.1462,0 13.6865,2.4156 18.7812,6.3437 a 2.0002,2.0002 0 1 0 2.4376,-3.1562 C 50.4484,1003.1007 43.058,1000.3621 35,1000.3621"}),Object(d.jsx)("path",{id:"second",d:"m 35,1009.3621 c -5.8189,0 -11.3007,1.7801 -15.5625,5.2812 a 2.0002,2.0002 0 1 0 2.5313,3.0938 c 3.4852,-2.8633 8.0339,-4.375 13.0312,-4.375 4.9973,0 9.546,1.5117 13.0312,4.375 a 2.0002,2.0002 0 1 0 2.5313,-3.0938 c -4.2618,-3.5011 -9.7436,-5.2812 -15.5625,-5.2812"}),Object(d.jsx)("path",{opacity:"0.4",id:"first",d:"m 35,1018.9376 c -3.6493,0 -7.1142,1.1668 -9.8125,3.3437 a 2.0009763,2.0009763 0 0 0 2.5,3.125 c 1.9329,-1.5594 4.5256,-2.4687 7.3125,-2.4687 2.7869,0 5.3796,0.9093 7.3125,2.4687 a 2.0009763,2.0009763 0 1 0 2.5,-3.125 c -2.6983,-2.1769 -6.1632,-3.3437 -9.8125,-3.3437 z m 0,8.0625 z"})]}),Object(d.jsx)("animate",{xlinkHref:"#first",attributeName:"opacity",dur:"3s",begin:"0s",calcMode:"discrete",from:"0.2",to:"1",repeatDur:"indefinite"}),Object(d.jsx)("animate",{xlinkHref:"#second",attributeName:"opacity",dur:"3s",begin:"0.7s",calcMode:"discrete",from:"0.2",to:"1",repeatDur:"indefinite"}),Object(d.jsx)("animate",{xlinkHref:"#third",attributeName:"opacity",dur:"3s",begin:"1.4s",calcMode:"discrete",from:"0.2",to:"1",repeatDur:"indefinite"})]})},N=function(){return Object(d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlSpace:"preserve",version:"1.1",style:{shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",imageRendering:"optimizeQuality"},viewBox:"0 0 755 633.75",x:"0px",y:"0px",fillRule:"evenodd",clipRule:"evenodd",children:Object(d.jsx)("g",{children:Object(d.jsx)("path",{d:"M205 111c69,-162 315,-141 357,29 47,9 88,40 108,84 139,63 99,283 -63,283l-459 0c-155,0 -201,-204 -76,-276 14,-64 68,-112 133,-120zm41 287c-15,16 -40,-8 -24,-24 38,-39 102,-54 155,-54 53,0 118,15 156,54 15,16 -9,40 -24,24 -32,-32 -88,-44 -132,-44 -43,0 -100,12 -131,44zm235 -190c-18,0 -33,15 -33,33 0,17 15,32 33,32 17,0 32,-15 32,-32 0,-18 -15,-33 -32,-33zm-207 0c18,0 33,15 33,33 0,17 -15,32 -33,32 -18,0 -32,-15 -32,-32 0,-18 14,-33 32,-33zm364 49c116,36 90,207 -31,207l-459 0c-117,0 -148,-163 -37,-204 3,-60 52,-108 113,-108 4,0 8,0 11,0 41,-161 280,-140 290,27 2,0 5,0 8,0 49,0 91,33 105,78z"})})})},K=function(){return Object(d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",viewBox:"0 0 100 125",x:"0px",y:"0px",children:[Object(d.jsx)("path",{d:"M88.17,69.32A22,22,0,0,0,77.79,37.77a22,22,0,0,0-21.91-20.2,20.29,20.29,0,0,0-13.67,4.81l4.57,5.3a13.31,13.31,0,0,1,9.1-3.11,15,15,0,0,1,15,15c0,.06,0,.13,0,.19s0,.26,0,.39l-.1,2.75,2.65.75a15,15,0,0,1,8.79,22.1Z"}),Object(d.jsx)("path",{d:"M28.76,80H60.44V73H28.76a15,15,0,0,1-15-15A17,17,0,0,1,23.6,42.7l-2.79-6.42A23.91,23.91,0,0,0,6.78,58,22,22,0,0,0,28.76,80Z"}),Object(d.jsx)("rect",{x:"45.53",y:"-4.58",width:"7",height:"106.75",transform:"translate(-20.14 48.96) rotate(-45)"})]})},B=function(){return Object(d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",x:"0px",y:"0px",viewBox:"0 0 100 125",xmlSpace:"preserve",children:Object(d.jsxs)("g",{children:[Object(d.jsx)("path",{d:"M81.2,38.9c-3.5-12.9-15.3-22-28.9-22c-11.4,0-21.9,6.7-26.9,16.8C12.6,34.6,2.5,45.3,2.5,58.4     c0,13.6,11.1,24.7,24.7,24.7h47.7c12.4,0,22.6-10.1,22.6-22.6C97.5,50.3,90.8,41.6,81.2,38.9z M74.9,75.4H27.2     c-9.4,0-17-7.6-17-17s7.6-17,17-17c0.2,0,0.4,0,0.6,0c1.6,0,3.2-0.9,3.7-2.5c3.3-8.5,11.6-14.3,20.8-14.3     c10.7,0,19.9,7.6,21.9,18.1c0.3,1.6,1.6,2.9,3.2,3.1c7.2,1.2,12.4,7.3,12.4,14.6C89.8,68.7,83.1,75.4,74.9,75.4z"}),Object(d.jsx)("path",{d:"M60.8,39.5c-0.8-0.6-1.9-0.5-2.6,0.2L43.4,56.5l-4.5-5.2c-0.7-0.8-1.8-0.9-2.6-0.2l-3.2,2.6c-0.8,0.6-0.9,1.8-0.3,2.6     l6.6,8.9c0.4,0.5,0.9,0.7,1.5,0.8l4.9,0c0.6,0,1.2-0.3,1.5-0.8l15.9-21.3c0.6-0.8,0.5-1.9-0.3-2.6L60.8,39.5z"})]})})},U=function(){return Object(d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",x:"0px",y:"0px",viewBox:"0 0 100 125",xmlSpace:"preserve",children:[Object(d.jsx)("g",{transform:"scale(1 0.95) translate(0 10)",children:Object(d.jsx)("path",{d:"M81.2,38.9c-3.5-12.9-15.3-22-28.9-22c-11.4,0-21.9,6.7-26.9,16.8C12.6,34.6,2.5,45.3,2.5,58.4     c0,13.6,11.1,24.7,24.7,24.7h47.7c12.4,0,22.6-10.1,22.6-22.6C97.5,50.3,90.8,41.6,81.2,38.9z M74.9,75.4H27.2     c-9.4,0-17-7.6-17-17s7.6-17,17-17c0.2,0,0.4,0,0.6,0c1.6,0,3.2-0.9,3.7-2.5c3.3-8.5,11.6-14.3,20.8-14.3     c10.7,0,19.9,7.6,21.9,18.1c0.3,1.6,1.6,2.9,3.2,3.1c7.2,1.2,12.4,7.3,12.4,14.6C89.8,68.7,83.1,75.4,74.9,75.4z"})}),Object(d.jsxs)("g",{transform:"translate(-40,-20) scale(1.5 1.5)",children:[Object(d.jsx)("polygon",{points:"84.453,20.676 87.936,20.687 84.442,23.66 84.433,25.766 91.565,25.793 91.572,23.755   88.007,23.741 91.58,20.701 91.591,18.665 84.458,18.636 "}),Object(d.jsx)("polygon",{points:"82.076,21.047 72.533,21.011 72.525,23.739 77.184,23.755 72.507,27.732 72.5,30.552 82.042,30.589   82.051,27.861 77.281,27.842 82.065,23.774 "})]}),Object(d.jsxs)("g",{transform:"translate(-29 -10) scale(1.5 1.5)",children:[Object(d.jsx)("path",{d:"M42.5,49.062h-3.75c-0.518,0-0.938,0.419-0.938,0.938s0.419,0.938,0.938,0.938h3.75  c0.518,0,0.938-0.419,0.938-0.938S43.018,49.062,42.5,49.062z"}),Object(d.jsx)("path",{d:"M61.25,49.062H57.5c-0.518,0-0.938,0.419-0.938,0.938s0.419,0.938,0.938,0.938h3.75  c0.518,0,0.938-0.419,0.938-0.938S61.768,49.062,61.25,49.062z"})]})]})};n(104);function L(e){var t=e.children,n=e.className,r=e.title;return Object(d.jsx)("div",{className:"svg-icon"+(n?" "+n:""),title:r,children:Object(d.jsx)("div",{children:t})})}function M(e){var t=e.className,n=Object(D.a)(s.db.cloud.syncState);switch(null===n||void 0===n?void 0:n.status){case"not-started":return Object(d.jsx)(L,{className:t});case"connecting":return Object(d.jsx)(L,{className:t,children:Object(d.jsx)(R,{})});case"connected":return Object(d.jsx)(L,{className:t,children:Object(d.jsx)(B,{})});case"disconnected":return Object(d.jsx)(L,{className:t,children:Object(d.jsx)(U,{})});case"offline":return Object(d.jsx)(L,{className:t,title:n.error&&""+n.error,children:Object(d.jsx)(K,{})});case"error":return Object(d.jsx)(L,{className:t,title:n.error&&""+n.error,children:Object(d.jsx)(N,{})});default:return Object(d.jsx)(L,{className:t,children:null===n||void 0===n?void 0:n.phase})}}n(105);var F=n(82);function W(e){return function(){return e.apply(void 0,arguments).catch((function(e){"AbortError"===(null===e||void 0===e?void 0:e.name)?console.debug(e):console.error(e)}))}}var q=n(51);function $(){return($=Object(m.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q.a.delete();case 2:window.location.reload();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(){var e=Object(D.a)(s.db.cloud.currentUser);return Object(d.jsxs)(P.a,{fixed:"top",sticky:"top",collapseOnSelect:!0,expand:"lg",bg:"dark",variant:"dark",children:[Object(d.jsx)(P.a.Brand,{children:"Dexie Cloud ToDo App"}),Object(d.jsx)(P.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),Object(d.jsx)(P.a.Text,{className:"d-inline-flex d-lg-none status-icons-collapsed",children:Object(d.jsx)(M,{})}),Object(d.jsx)(P.a.Collapse,{id:"responsive-navbar-nav",className:"justify-content-end",children:(null===e||void 0===e?void 0:e.isLoggedIn)?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(P.a.Text,{className:"d-none d-lg-inline-flex status-icons-not-collapsed",children:Object(d.jsx)(M,{})}),Object(d.jsx)(C.a,{title:e.name,id:"basic-nav-dropdown",children:Object(d.jsx)(C.a.Item,{onClick:function(){return function(){return $.apply(this,arguments)}()},children:"Logout"})})]}):Object(d.jsxs)(C.a,{id:"basic-nav-dropdown",title:"Sign in or create your account",children:[Object(d.jsx)(C.a.Header,{children:"Sign in a demo user"}),Object(d.jsx)(d.Fragment,{children:Object.keys(F.demoUsers).map((function(e){return Object(d.jsx)(C.a.Item,{children:Object(d.jsx)(A.a,{onClick:W((function(){return s.db.cloud.login({grant_type:"demo",email:e})})),children:e})},e)}))}),Object(d.jsx)(C.a.Divider,{}),Object(d.jsx)(C.a.Header,{children:"Sign in real user"}),Object(d.jsx)(C.a.Item,{children:Object(d.jsx)(T.a,{onClick:W((function(){return s.db.cloud.login()})),children:"Sign in / sign up yourself"})})]})})]})}n(107),n(108);function H(){var e=Object(D.a)(s.db.cloud.currentUser),t=Object(D.a)(s.db.cloud.invites,[]);return 0===t.length?null:Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("h3",{children:"You've got invited!"}),Object(d.jsxs)("table",{children:[Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{}),Object(d.jsx)("th",{children:"Name of list"}),Object(d.jsx)("th",{children:"Invited by"})]}),t.map((function(t){var n,r;return Object(d.jsxs)("tr",{children:[Object(d.jsx)("td",{children:t.accepted?"\u2713":t.email===(null===e||void 0===e?void 0:e.email)?Object(d.jsx)("button",{onClick:function(){return s.db.members.update(t.id,{accepted:new Date})},children:"Accept"}):""}),Object(d.jsx)("td",{children:null===(n=t.realm)||void 0===n?void 0:n.name}),Object(d.jsx)("td",{children:null===(r=t.invitedBy)||void 0===r?void 0:r.name})]},t.id)}))]})]})}var V=function(){return Object(d.jsxs)("div",{children:[Object(d.jsx)(z,{}),Object(d.jsx)(H,{}),Object(d.jsx)(O,{}),Object(d.jsx)(I,{}),Object(d.jsx)(E,{})]})},G=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Y(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,123)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,i=t.getLCP,a=t.getTTFB;n(e),r(e),o(e),i(e),a(e)}))},Q=n(8);window.Dexie=Q.default,a.a.render(Object(d.jsx)(o.a.StrictMode,{children:Object(d.jsx)(V,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/service-worker.js");G?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Y(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):Y(t,e)}))}}(),J()},14:function(e,t,n){!function(e,t,n){"use strict";function r(e){return e&&"object"===typeof e&&"default"in e?e:{default:e}}var o=r(n);function i(e,t,n){var r,i;"function"===typeof e?(r=t||[],i=n):(r=[],i=t);var a=o.default.useRef({hasResult:!1,result:i,error:null}),u=o.default.useReducer((function(e){return e+1}),0);u[0];var s=u[1],c=o.default.useMemo((function(){var t="function"===typeof e?e():e;if(!t||"function"!==typeof t.subscribe)throw e===t?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!a.current.hasResult)if("function"===typeof t.getValue)a.current.result=t.getValue(),a.current.hasResult=!0;else{var n=t.subscribe((function(e){a.current.result=e,a.current.hasResult=!0}));"function"===typeof n?n():n.unsubscribe()}return t}),r);if(o.default.useDebugValue(a.current.result),o.default.useEffect((function(){var e=c.subscribe((function(e){var t=a.current;null===t.error&&t.result===e||(t.error=null,t.result=e,t.hasResult=!0,s())}),(function(e){var t=a.current;t.error!==e&&(t.error=e,s())}));return"function"===typeof e?e:e.unsubscribe.bind(e)}),r),a.current.error)throw a.current.error;return a.current.result}function a(e,n,r){return i((function(){return t.liveQuery(e)}),n||[],r)}function u(e,n,r){if(!e)throw new TypeError("Invalid arguments to usePermissions(): undefined or null");var o;if(arguments.length>=3){if(!("transaction"in e))throw new TypeError("Invalid arguments to usePermission(db, table, obj): 1st arg must be a Dexie instance");if("string"!==typeof n)throw new TypeError("Invalid arguments to usePermission(db, table, obj): 2nd arg must be string");if(!r||"object"!==typeof r)throw new TypeError("Invalid arguments to usePermission(db, table, obj): 3rd arg must be an object");o=e}else{if(e instanceof t.Dexie)throw new TypeError("Invalid arguments to usePermission(db, table, obj): Missing table and obj arguments.");if("function"!==typeof e.table||"object"!==typeof e.db)throw new TypeError("Invalid arguments to usePermissions(). Expected usePermissions(entity: DexieCloudEntity) or usePermissions(db: Dexie, table: string, obj: DexieCloudObject)");o=e.db,r=e,n=e.table()}if(!("cloud"in o))throw new Error("usePermissions() is only for Dexie Cloud but there's no dexie-cloud-addon active in given db.");if(!("permissions"in o.cloud))throw new Error("usePermissions() requires a newer version of dexie-cloud-addon. Please upgrade it.");return i((function(){return o.cloud.permissions(r,n)}),[r.realmId,r.owner,n])}e.useLiveQuery=a,e.useObservable=i,e.usePermissions=u,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(8),n(0))},28:function(e,t,n){"use strict";(function(e,r){n.d(t,"b",(function(){return Io}));var o=n(8),i=n(10),a=n(27),u=n(49),s=n(18),c=n(29),l=n(41),f=n(87),d=n(24),h=n(110),p=n(78),v=n(40),b=n(113),y=n(112),m=n(111),g=function(e,t){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function w(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}g(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var _=function(){return(_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function x(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(ro){i(ro)}}function u(e){try{s(r.throw(e))}catch(ro){i(ro)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}s((r=r.apply(e,t||[])).next())}))}function j(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(ro){i=[6,ro],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}function k(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}var S=crypto.getRandomValues;function O(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!==typeof t&&"length"in t){!function(e){if(!e)throw new Error("Assertion Failed")}("string"!==typeof n&&"length"in n);for(var r=0,o=t.length;r<o;++r)O(e,t[r],n[r])}else{var i=t.indexOf(".");if(-1!==i){var a=t.substr(0,i),u=t.substr(i+1);if(""===u)void 0===n?Array.isArray(e)?isNaN(parseInt(a))||e.splice(parseInt(a),1):delete e[a]:e[a]=n;else{var s=e[a];s||(s=e[a]={}),O(s,u,n)}}else void 0===n?Array.isArray(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}var I="undefined"===typeof self?function(t){var n=e.alloc(t);return S(n),n.toString("base64")}:function(e){var t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode.apply(null,t))};function E(e){return"string"===typeof e||!!(Array.isArray(e)&&e.some((function(e){return E(e)}))&&e.every(P))}function P(e){return"string"===typeof e||"number"===typeof e||Array.isArray(e)&&e.every(P)}function C(e,t,n){var r=e[t]||(e[t]={}),o=n.keys.map((function(e){return"string"===typeof e?e:JSON.stringify(e)}));switch(n.type){case"insert":case"upsert":o.forEach((function(e,t){r[e]={type:"ups",val:n.values[t]}}));break;case"update":case"modify":o.forEach((function(e,t){var o="update"===n.type?n.changeSpecs[t]:n.changeSpec,i=r[e];if(i)switch(i.type){case"ups":for(var a=0,u=Object.entries(o);a<u.length;a++){var s=u[a],c=s[0],l=s[1];O(i.val,c,l)}break;case"del":break;case"upd":Object.assign(i.mod,o)}else r[e]={type:"upd",mod:o}}));break;case"delete":o.forEach((function(e){r[e]={type:"del"}}))}return e}function A(e,t){for(var n=0,r=t;n<r.length;n++)for(var o=r[n],i=o.table,a=0,u=o.muts;a<u.length;a++){C(e,i,u[a])}}function T(e){return"function"===typeof e}function D(e){return function(t){if(function(e){return T(null===e||void 0===e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(n){this.error(n)}}));throw new TypeError("Unable to lift unknown Observable type")}}var R=function(e,t){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function N(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}R(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function K(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(ro){i(ro)}}function u(e){try{s(r.throw(e))}catch(ro){i(ro)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}s((r=r.apply(e,t||[])).next())}))}function B(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(ro){i=[6,ro],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}function U(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function L(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(u){o={error:u}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function M(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}function F(e){return this instanceof F?(this.v=e,this):new F(e)}function W(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||u(e,t)}))})}function u(e,t){try{!function(e){e.value instanceof F?Promise.resolve(e.value.v).then(s,c):l(i[0][2],e)}(o[e](t))}catch(ro){l(i[0][3],ro)}}function s(e){u("next",e)}function c(e){u("throw",e)}function l(e,t){e(t),i.shift(),i.length&&u(i[0][0],i[0][1])}}function q(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=U(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}var $=function(e){return e&&"number"===typeof e.length&&"function"!==typeof e};function z(e){return T(null===e||void 0===e?void 0:e.then)}function H(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var V=H((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function G(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Y=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var a=U(i),u=a.next();!u.done;u=a.next()){u.value.remove(this)}}catch(h){e={error:h}}finally{try{u&&!u.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else i.remove(this);var s=this.initialTeardown;if(T(s))try{s()}catch(ro){o=ro instanceof V?ro.errors:[ro]}var c=this._teardowns;if(c){this._teardowns=null;try{for(var l=U(c),f=l.next();!f.done;f=l.next()){var d=f.value;try{Q(d)}catch(p){o=null!==o&&void 0!==o?o:[],p instanceof V?o=M(M([],L(o)),L(p.errors)):o.push(p)}}}catch(v){n={error:v}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(o)throw new V(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Q(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&G(t,e)},e.prototype.remove=function(t){var n=this._teardowns;n&&G(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();function J(e){return e instanceof Y||e&&"closed"in e&&T(e.remove)&&T(e.add)&&T(e.unsubscribe)}function Q(e){T(e)?e():e.unsubscribe()}var X={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Z={setTimeout:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return setTimeout.apply(void 0,M([],L(e)))})),clearTimeout:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return clearTimeout(e)})),delegate:void 0};function ee(e){Z.setTimeout((function(){throw e}))}function te(){}var ne=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,J(t)&&t.add(n)):n.destination=ae,n}return N(t,e),t.create=function(e,t,n){return new re(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Y),re=function(e){function t(t,n,r){var o,i=e.call(this)||this;if(T(t))o=t;else if(t){var a;o=t.next,n=t.error,r=t.complete,i&&X.useDeprecatedNextContext?(a=Object.create(t)).unsubscribe=function(){return i.unsubscribe()}:a=t,o=null===o||void 0===o?void 0:o.bind(a),n=null===n||void 0===n?void 0:n.bind(a),r=null===r||void 0===r?void 0:r.bind(a)}return i.destination={next:o?oe(o):te,error:oe(null!==n&&void 0!==n?n:ie),complete:r?oe(r):te},i}return N(t,e),t}(ne);function oe(e,t){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{e.apply(void 0,M([],L(t)))}catch(r){ee(r)}}}function ie(e){throw e}var ae={closed:!0,next:te,error:ie,complete:te},ue="function"===typeof Symbol&&Symbol.observable||"@@observable";function se(e){return e}function ce(e){return 0===e.length?se:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var le=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof ne||function(e){return e&&T(e.next)&&T(e.error)&&T(e.complete)}(r)&&J(r)?e:new re(e,t,n);return function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))}(),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=fe(t))((function(t,r){var o;o=n.subscribe((function(t){try{e(t)}catch(n){r(n),null===o||void 0===o||o.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[ue]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ce(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=fe(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function fe(e){var t;return null!==(t=null!==e&&void 0!==e?e:X.Promise)&&void 0!==t?t:Promise}function de(e){return T(e[ue])}function he(e){return Symbol.asyncIterator&&T(null===e||void 0===e?void 0:e[Symbol.asyncIterator])}function pe(e){return new TypeError("You provided "+(null!==e&&"object"===typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var ve="function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function be(e){return T(null===e||void 0===e?void 0:e[ve])}function ye(e){return W(this,arguments,(function(){var t,n,r;return B(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,F(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,F(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,F(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function me(e){return T(null===e||void 0===e?void 0:e.getReader)}function ge(e){if(e instanceof le)return e;if(null!=e){if(de(e))return o=e,new le((function(e){var t=o[ue]();if(T(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if($(e))return r=e,new le((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(z(e))return n=e,new le((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,ee)}));if(he(e))return we(e);if(be(e))return t=e,new le((function(e){var n,r;try{for(var o=U(t),i=o.next();!i.done;i=o.next()){var a=i.value;if(e.next(a),e.closed)return}}catch(u){n={error:u}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(me(e))return we(ye(e))}var t,n,r,o;throw pe(e)}function we(e){return new le((function(t){(function(e,t){var n,r,o,i;return K(this,void 0,void 0,(function(){var a,u;return B(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),n=q(e),s.label=1;case 1:return[4,n.next()];case 2:if((r=s.sent()).done)return[3,4];if(a=r.value,t.next(a),t.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=s.sent(),o={error:u},[3,11];case 6:return s.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}var _e=function(e){function t(t,n,r,o,i){var a=e.call(this,t)||this;return a.onFinalize=i,a._next=n?function(e){try{n(e)}catch(r){t.error(r)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return N(t,e),t.prototype.unsubscribe=function(){var t,n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))},t}(ne),xe=function(e){function t(t,n){return e.call(this)||this}return N(t,e),t.prototype.schedule=function(e,t){return this},t}(Y),je={setInterval:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return setInterval.apply(void 0,M([],L(e)))})),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return clearInterval(e)})),delegate:void 0},ke=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return N(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),je.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;je.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(ro){r=!0,n=ro||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,G(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(xe),Se=function(){return Date.now()},Oe=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=Se,e}(),Ie=new(function(e){function t(t,n){void 0===n&&(n=Oe.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return N(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Oe))(ke),Ee=Ie;function Pe(e){return e&&T(e.schedule)}function Ce(e){return e instanceof Date&&!isNaN(e)}function Ae(e){return Pe((t=e)[t.length-1])?e.pop():void 0;var t}function Te(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=t.schedule((function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(i),!o)return i}function De(e){return D((function(t,n){var r,o=null,i=!1;o=t.subscribe(new _e(n,void 0,void 0,(function(a){r=ge(e(a,De(e)(t))),o?(o.unsubscribe(),o=null,r.subscribe(n)):i=!0}))),i&&(o.unsubscribe(),o=null,r.subscribe(n))}))}function Re(e,t){return void 0===t&&(t=0),D((function(n,r){n.subscribe(new _e(r,(function(n){return Te(r,e,(function(){return r.next(n)}),t)}),(function(){return Te(r,e,(function(){return r.complete()}),t)}),(function(n){return Te(r,e,(function(){return r.error(n)}),t)})))}))}function Ne(e,t){return void 0===t&&(t=0),D((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function Ke(e,t){if(!e)throw new Error("Iterable cannot be null");return new le((function(n){Te(n,t,(function(){var r=e[Symbol.asyncIterator]();Te(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Be(e,t){if(null!=e){if(de(e))return function(e,t){return ge(e).pipe(Ne(t),Re(t))}(e,t);if($(e))return function(e,t){return new le((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(z(e))return function(e,t){return ge(e).pipe(Ne(t),Re(t))}(e,t);if(he(e))return Ke(e,t);if(be(e))return function(e,t){return new le((function(n){var r;return Te(n,t,(function(){r=e[ve](),Te(n,t,(function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(i){return void n.error(i)}o?n.complete():n.next(t)}),0,!0)})),function(){return T(null===r||void 0===r?void 0:r.return)&&r.return()}}))}(e,t);if(me(e))return function(e,t){return Ke(ye(e),t)}(e,t)}throw pe(e)}function Ue(e,t){return t?Be(e,t):ge(e)}function Le(e,t){return D((function(n,r){var o=0;n.subscribe(new _e(r,(function(n){r.next(e.call(t,n,o++))})))}))}function Me(e,t,n){return void 0===n&&(n=1/0),T(t)?Me((function(n,r){return Le((function(e,o){return t(n,e,r,o)}))(ge(e(n,r)))}),n):("number"===typeof t&&(n=t),D((function(t,r){return function(e,t,n,r,o,i,a,u){var s=[],c=0,l=0,f=!1,d=function(){!f||s.length||c||t.complete()},h=function(e){return c<r?p(e):s.push(e)},p=function e(u){i&&t.next(u),c++;var f=!1;ge(n(u,l++)).subscribe(new _e(t,(function(e){null===o||void 0===o||o(e),i?h(e):t.next(e)}),(function(){f=!0}),void 0,(function(){if(f)try{c--;for(var n=function(){var n=s.shift();a?Te(t,a,(function(){return e(n)})):e(n)};s.length&&c<r;)n();d()}catch(o){t.error(o)}})))};return e.subscribe(new _e(t,h,(function(){f=!0,d()}))),function(){null===u||void 0===u||u()}}(t,r,e,n)})))}function Fe(){return void 0===(e=1)&&(e=1/0),Me(se,e);var e}function We(e,t){return void 0===t&&(t=Ie),D((function(n,r){var o=null,i=null,a=null,u=function(){if(o){o.unsubscribe(),o=null;var e=i;i=null,r.next(e)}};function s(){var n=a+e,i=t.now();if(i<n)return o=this.schedule(void 0,n-i),void r.add(o);u()}n.subscribe(new _e(r,(function(n){i=n,a=t.now(),o||(o=t.schedule(s,e),r.add(o))}),(function(){u(),r.complete()}),void 0,(function(){i=o=null})))}))}function qe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Fe()(Ue(e,Ae(e)))}var $e=new le((function(e){return e.complete()}));function ze(e){return e<=0?function(){return $e}:D((function(t,n){var r=0;t.subscribe(new _e(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}function He(e,t){return t?function(n){return qe(t.pipe(ze(1),D((function(e,t){e.subscribe(new _e(t,te))}))),n.pipe(He(e)))}:Me((function(t,n){return e(t,n).pipe(ze(1),function(e){return Le((function(){return e}))}(t))}))}function Ve(e,t){void 0===t&&(t=Ie);var n=function(e,t,n){void 0===e&&(e=0),void 0===n&&(n=Ee);var r=-1;return null!=t&&(Pe(t)?n=t:r=t),new le((function(t){var o=Ce(e)?+e-n.now():e;o<0&&(o=0);var i=0;return n.schedule((function(){t.closed||(t.next(i++),0<=r?this.schedule(void 0,r):t.complete())}),o)}))}(e,t);return He((function(){return n}))}function Ge(e,t){return e===t}function Ye(e,t){return D((function(n,r){var o=0;n.subscribe(new _e(r,(function(n){return e.call(t,n,o++)&&r.next(n)})))}))}function Je(e){return Ye((function(t,n){return e<=n}))}function Qe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Ae(e);return D((function(t,r){(n?qe(e,t,n):qe(e,t)).subscribe(r)}))}function Xe(e,t){return D((function(n,r){var o=null,i=0,a=!1,u=function(){return a&&!o&&r.complete()};n.subscribe(new _e(r,(function(n){null===o||void 0===o||o.unsubscribe();var a=0,s=i++;ge(e(n,s)).subscribe(o=new _e(r,(function(e){return r.next(t?t(n,e,s,a++):e)}),(function(){o=null,u()})))}),(function(){a=!0,u()})))}))}function Ze(e,t,n){var r=T(e)||t||n?{next:e,error:t,complete:n}:e;return r?D((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var o=!0;e.subscribe(new _e(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;o=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;o=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;o&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):se}var et=H((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function tt(e){throw new et(e)}var nt=!1;function rt(e,t){return x(this,void 0,void 0,(function(){var n,r;return j(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),[4,navigator.serviceWorker.ready];case 1:return n=o.sent(),"push"===t&&n.sync?[4,n.sync.register("dexie-cloud:".concat(e.name))]:[3,3];case 2:o.sent(),o.label=3;case 3:if(!n.active)throw new Error("Failed to trigger sync - there's no active service worker");return n.active.postMessage({type:"dexie-cloud-sync",dbName:e.name,purpose:t}),[2];case 4:return r=o.sent(),nt||(console.debug("Dexie Cloud: Could not register sync event",r),nt=!0),[3,5];case 5:return[2]}}))}))}function ot(e,t){e.cloud.usingServiceWorker?rt(e,t):e.localSyncEvent.next({purpose:t})}var it="undefined"!==typeof e?function(t){return e.from(t,"base64")}:function(e){for(var t=atob(e),n=t.length,r=new Uint8Array(n),o=0;o<n;o++)r[o]=t.charCodeAt(o);return r},at="undefined"!==typeof e?function(t){return ArrayBuffer.isView(t)?e.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"):e.from(t).toString("base64")}:function(e){return btoa(String.fromCharCode.apply(null,e))};function ut(e,t){return new Promise((function(n,r){var i=_(_({},t),{onSubmit:function(t){e.next(void 0),n(t)},onCancel:function(){e.next(void 0),r(new o.default.AbortError("User cancelled"))}});e.next(i)}))}function st(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return ut(e,{type:"message-alert",title:t,alerts:n,fields:{}})}function ct(e,t,n){return x(this,void 0,void 0,(function(){var r;return j(this,(function(o){switch(o.label){case 0:r=n||"",o.label=1;case 1:return r&&/^[\w-\.]+@([\w-]+\.)+[\w-]{2,10}$/.test(r)?[3,3]:[4,ut(e,{type:"email",title:t,alerts:r?[{type:"error",messageCode:"INVALID_EMAIL",message:"Please enter a valid email address",messageParams:{}}]:[],fields:{email:{type:"email",placeholder:"you@somedomain.com"}}})];case 2:return r=o.sent().email,[3,1];case 3:return[2,r]}}))}))}function lt(e,t,n){return x(this,void 0,void 0,(function(){var r;return j(this,(function(o){switch(o.label){case 0:return r=[{type:"info",messageCode:"OTP_SENT",message:"A One-Time password has been sent to {email}",messageParams:{email:t}}],n&&r.push(n),[4,ut(e,{type:"otp",title:"Enter OTP",alerts:r,fields:{otp:{type:"otp",label:"OTP",placeholder:"Paste OTP here"}}})];case 1:return[2,o.sent().otp]}}))}))}function ft(e){var t,n;return x(this,void 0,void 0,(function(){var r,o,i,a,u,s,c;return j(this,(function(l){switch(l.label){case 0:return[4,e.getCurrentUser()];case 1:if(r=l.sent(),o=r.accessToken,i=r.accessTokenExpiration,a=r.refreshToken,u=r.refreshTokenExpiration,s=r.claims,!o)return[2];if((null!==(t=null===i||void 0===i?void 0:i.getTime())&&void 0!==t?t:1/0)>Date.now())return[2,o];if(!a)throw new Error("Refresh token missing");if((null!==(n=null===u||void 0===u?void 0:u.getTime())&&void 0!==n?n:1/0)<=Date.now())throw new Error("Refresh token has expired");return[4,ht(e.cloud.options.databaseUrl,r)];case 2:return c=l.sent(),[4,e.table("$logins").update(s.sub,{accessToken:c.accessToken,accessTokenExpiration:c.accessTokenExpiration})];case 3:return l.sent(),[2,c.accessToken]}}))}))}function dt(e,t,n,r,o){return x(this,void 0,void 0,(function(){return j(this,(function(i){switch(i.label){case 0:return t.accessToken&&t.accessTokenExpiration.getTime()>Date.now()?[2,t]:[3,1];case 1:return t.refreshToken&&(!t.refreshTokenExpiration||t.refreshTokenExpiration.getTime()>Date.now())?[4,ht(e,t)]:[3,3];case 2:return[2,i.sent()];case 3:return[4,pt(t,n,r,o)];case 4:return[2,i.sent()]}}))}))}function ht(e,t){return x(this,void 0,void 0,(function(){var n,r,o,i,a,u,s,c,l;return j(this,(function(f){switch(f.label){case 0:if(!t.refreshToken)throw new Error("Cannot refresh token - refresh token is missing.");if(!t.nonExportablePrivateKey)throw new Error("login.nonExportablePrivateKey is missing - cannot sign refresh token without a private key.");return n=Date.now(),r="RSASSA-PKCS1-v1_5",o=new TextEncoder,i=o.encode(t.refreshToken+n),[4,crypto.subtle.sign(r,t.nonExportablePrivateKey,i)];case 1:return a=f.sent(),u=at(a),s={grant_type:"refresh_token",refresh_token:t.refreshToken,scopes:["ACCESS_DB"],signature:u,signing_algorithm:r,time_stamp:n},[4,fetch("".concat(e,"/token"),{body:JSON.stringify(s),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})];case 2:if(200!==(c=f.sent()).status)throw new Error("RefreshToken: Status ".concat(c.status," from ").concat(e,"/token"));return[4,c.json()];case 3:return l=f.sent(),t.accessToken=l.accessToken,t.accessTokenExpiration=l.accessTokenExpiration?new Date(l.accessTokenExpiration):void 0,[2,t]}}))}))}function pt(e,t,n,r){return x(this,void 0,void 0,(function(){var o,i,a,u,s,c,l;return j(this,(function(f){switch(f.label){case 0:return[4,crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"])];case 1:if(o=f.sent(),i=o.privateKey,a=o.publicKey,!i||!a)throw new Error("Could not generate RSA keypair");return e.nonExportablePrivateKey=i,[4,crypto.subtle.exportKey("spki",a)];case 2:u=f.sent(),s=function(e){for(var t="-----BEGIN PUBLIC KEY-----\n";e.length>0;)t+=e.substring(0,64)+"\n",e=e.substring(64);return t+="-----END PUBLIC KEY-----"}(at(u)),e.publicKey=a,f.label=3;case 3:return f.trys.push([3,7,,9]),[4,t({public_key:s,hints:r})];case 4:if("tokens"!==(c=f.sent()).type)throw new Error("Unexpected response type from token endpoint: ".concat(c.type));return e.accessToken=c.accessToken,e.accessTokenExpiration=new Date(c.accessTokenExpiration),e.refreshToken=c.refreshToken,c.refreshTokenExpiration&&(e.refreshTokenExpiration=new Date(c.refreshTokenExpiration)),e.userId=c.claims.sub,e.email=c.claims.email,e.name=c.claims.name,e.claims=c.claims,c.alerts&&c.alerts.length>0?[4,ut(n,{type:"message-alert",title:"Authentication Alert",fields:{},alerts:c.alerts})]:[3,6];case 5:f.sent(),f.label=6;case 6:return[2,e];case 7:return l=f.sent(),[4,st(n,"Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:"We're having a problem authenticating right now.",messageParams:{}}).catch((function(){}))];case 8:throw f.sent(),l;case 9:return[2]}}))}))}var vt=new WeakMap,bt=function(){function e(e,t){vt.set(this,e),Object.assign(this,t)}return e.load=function(t,n){return t.table("$logins").get(n).then((function(r){return new e(t,r||{userId:n,claims:{sub:n},lastLogin:new Date(0)})}))},e.prototype.save=function(){return x(this,void 0,void 0,(function(){return j(this,(function(e){return vt.get(this).table("$logins").put(this),[2]}))}))},e}(),yt=function(e){function t(t,n){var r=e.call(this,n||"".concat(t.status," ").concat(t.statusText))||this;return r.httpStatus=t.status,r}return w(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"HttpError"},enumerable:!1,configurable:!0}),t}(Error);function mt(e){var t=e.cloud.userInteraction;return function(n){var r,o=n.public_key,i=n.hints;return x(this,void 0,void 0,(function(){var n,a,u,s,c,l,f,d,h,p,v;return j(this,(function(b){switch(b.label){case 0:if(!(a=null===(r=e.cloud.options)||void 0===r?void 0:r.databaseUrl))throw new Error("No database URL given.");return"demo"!==(null===i||void 0===i?void 0:i.grant_type)?[3,2]:[4,ct(t,"Enter a demo user email",(null===i||void 0===i?void 0:i.email)||(null===i||void 0===i?void 0:i.userId))];case 1:return u=b.sent(),n={demo_user:u,grant_type:"demo",scopes:["ACCESS_DB"],public_key:o},[3,4];case 2:return[4,ct(t,"Enter email address",null===i||void 0===i?void 0:i.email)];case 3:s=b.sent(),n={email:s,grant_type:"otp",scopes:["ACCESS_DB"],public_key:o},b.label=4;case 4:return[4,fetch("".concat(a,"/token"),{body:JSON.stringify(n),method:"post",headers:{"Content-Type":"application/json",mode:"cors"}})];case 5:return 200===(c=b.sent()).status?[3,8]:[4,c.text()];case 6:return v=b.sent(),[4,st(t,"Token request failed",{type:"error",messageCode:"GENERIC_ERROR",message:v,messageParams:{}}).catch((function(){}))];case 7:throw b.sent(),new yt(c,v);case 8:return[4,c.json()];case 9:return"tokens"!==(l=b.sent()).type?[3,10]:[2,l];case 10:if("otp"!==n.grant_type)return[3,22];if("otp-sent"!==l.type)throw new Error("Unexpected response from ".concat(a,"/token"));return[4,lt(t,n.email)];case 11:return f=b.sent(),n.otp=f||"",n.otp_id=l.otp_id,[4,fetch("".concat(a,"/token"),{body:JSON.stringify(n),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})];case 12:d=b.sent(),b.label=13;case 13:return 401!==d.status?[3,17]:[4,d.text()];case 14:return h=b.sent(),p=n,[4,lt(t,n.email,{type:"error",messageCode:"INVALID_OTP",message:h,messageParams:{}})];case 15:return p.otp=b.sent(),[4,fetch("".concat(a,"/token"),{body:JSON.stringify(n),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})];case 16:return d=b.sent(),[3,13];case 17:return 200===d.status?[3,20]:[4,d.text()];case 18:return v=b.sent(),[4,st(t,"OTP Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:v,messageParams:{}}).catch((function(){}))];case 19:throw b.sent(),new yt(d,v);case 20:return[4,d.json()];case 21:return[2,b.sent()];case 22:throw new Error("Unexpected response from ".concat(a,"/token"))}}))}))}}function gt(e,t){return x(this,void 0,void 0,(function(){var n,r=this;return j(this,(function(o){switch(o.label){case 0:return t.userId===e.cloud.currentUserId?[2]:(n=e.table("$logins"),[4,e.transaction("rw",n,(function(e){return x(r,void 0,void 0,(function(){var e;return j(this,(function(r){switch(r.label){case 0:return[4,n.toArray()];case 1:return e=r.sent(),[4,Promise.all(e.filter((function(e){return e.userId!==t.userId&&e.isLoggedIn})).map((function(e){return e.isLoggedIn=!1,n.put(e)})))];case 2:return r.sent(),t.isLoggedIn=!0,t.lastLogin=new Date,[4,t.save()];case 3:return r.sent(),console.debug("Saved new user",t.email),[2]}}))}))}))]);case 1:return o.sent(),[4,new Promise((function(n){if(e.cloud.currentUserId===t.userId)n(null);else var r=e.cloud.currentUser.subscribe((function(e){e.userId===t.userId&&(r.unsubscribe(),n(null))}))}))];case 2:return o.sent(),[2]}}))}))}function wt(e,t){return x(this,void 0,void 0,(function(){var n;return j(this,(function(r){switch(r.label){case 0:return[4,e.getCurrentUser()];case 1:if(r.sent().isLoggedIn){if(t){if(t.email&&e.cloud.currentUser.value.email!==t.email)throw new Error("Must logout before changing user");if(t.userId&&e.cloud.currentUserId!==t.userId)throw new Error("Must logout before changing user")}return[2]}return n=new bt(e,{claims:{},lastLogin:new Date(0)}),[4,dt(e.cloud.options.databaseUrl,n,e.cloud.options.fetchTokens||mt(e),e.cloud.userInteraction,t)];case 2:return r.sent(),[4,n.save()];case 3:return r.sent(),[4,gt(e,n)];case 4:return r.sent(),ot(e,"pull"),[2]}}))}))}var _t={userId:"unauthorized",name:"Unauthorized",claims:{sub:"unauthorized"},lastLogin:new Date(0)};try{Object.freeze(_t),Object.freeze(_t.claims)}catch(Co){}var xt={},jt=self.document&&navigator.serviceWorker;jt&&jt.ready.then((function(e){return xt.registration=e})),"undefined"!==typeof self&&"clients"in self&&!self.document&&addEventListener("message",(function(e){var t,n;(null===(n=null===(t=e.data)||void 0===t?void 0:t.type)||void 0===n?void 0:n.startsWith("sw-broadcast-"))&&k([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach((function(t){var n;return t.id!==(null===(n=e.source)||void 0===n?void 0:n.id)&&t.postMessage(e.data)}))}));var kt=function(){function e(e){this.name=e}return e.prototype.subscribe=function(e){var t=this;if(!jt)return function(){};var n=function(n){var r;(null===(r=n.data)||void 0===r?void 0:r.type)==="sw-broadcast-".concat(t.name)&&e(n.data.message)};return jt.addEventListener("message",n),function(){return jt.removeEventListener("message",n)}},e.prototype.postMessage=function(e){var t,n=this;"object"===typeof self.clients?k([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach((function(t){return t.postMessage({type:"sw-broadcast-".concat(n.name),message:e})})):xt.registration&&(null===(t=xt.registration.active)||void 0===t||t.postMessage({type:"sw-broadcast-".concat(this.name),message:e}))},e}(),St=function(e){function t(t){var n=this,r="undefined"===typeof BroadcastChannel?new kt(t):new BroadcastChannel(t);return(n=e.call(this,(function(e){function n(t){e.next(t.detail)}function o(t){console.debug("BroadcastedAndLocalEvent: onMessageEvent",t),e.next(t.data)}var i;return self.addEventListener("lbc-".concat(t),n),r instanceof kt?i=r.subscribe((function(t){return e.next(t)})):(console.debug("BroadcastedAndLocalEvent: bc.addEventListener()",t,"bc is a",r),r.addEventListener("message",o)),function(){self.removeEventListener("lbc-".concat(t),n),r instanceof kt?i():r.removeEventListener("message",o)}}))||this).name=t,n.bc=r,n}return w(t,e),t.prototype.next=function(e){console.debug("BroadcastedAndLocalEvent: bc.postMessage()",_({},e),"bc is a",this.bc),this.bc.postMessage(e);var t=new CustomEvent("lbc-".concat(this.name),{detail:e});self.dispatchEvent(t)},t}(i.a);function Ot(e){var t=e.realms,n=e.inviteRealms;return x(this,void 0,void 0,(function(){var e,r,o;return j(this,(function(i){switch(i.label){case 0:return e=JSON.stringify(k(k([],t.map((function(e){return{realmId:e,accepted:!0}})),!0),n.map((function(e){return{realmId:e,accepted:!1}})),!0).sort((function(e,t){return e.realmId<t.realmId?-1:e.realmId>t.realmId?1:0}))),r=(new TextEncoder).encode(e),[4,crypto.subtle.digest("SHA-1",r)];case 1:return o=i.sent(),[2,at(o)]}}))}))}function It(e){return Object.entries(e.cloud.schema||{}).filter((function(e){return e[1].markedForSync})).map((function(t){var n=t[0];return e.tables.filter((function(e){return e.name===n}))[0]})).filter((function(e){return e}))}function Et(e){return"$".concat(e,"_mutations")}function Pt(e){var t,n=null===(t=/^\$(.*)_mutations$/.exec(e))||void 0===t?void 0:t[1];if(!n)throw new Error("Given mutationTable ".concat(e," is not correct"));return n}var Ct=[].concat;function At(e,t,n){var r=void 0===n?{}:n,o=r.since,i=void 0===o?{}:o,a=r.limit,u=void 0===a?1/0:a;return x(this,void 0,void 0,(function(){var t,n,r,o,a,s,c,l,f,d,h=this;return j(this,(function(p){switch(p.label){case 0:return[4,Promise.all(e.map((function(e){return x(h,void 0,void 0,(function(){var t,n,r;return j(this,(function(o){switch(o.label){case 0:return t=Pt(e.name),n=i[t],r=n?e.where("rev").above(n):e,u<1/0&&(r=r.limit(u)),[4,r.toArray()];case 1:return[2,o.sent().map((function(e){return{table:t,mut:e}}))]}}))}))})))];case 1:for(t=p.sent(),n=function(e){return Ct.apply([],e)}(t).sort((function(e,t){return e.mut.ts-t.mut.ts})),r=[],o=null,a=null,s=0,c=n;s<c.length;s++)l=c[s],f=l.table,d=l.mut,o&&o.table===f&&a===d.txid?o.muts.push(d):(o={table:f,muts:[d]},a=d.txid,r.push(o));return[2,r]}}))}))}function Tt(e){var t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode.apply(null,t))}function Dt(e,t,n,r){return x(this,void 0,void 0,(function(){var o,i,a=this;return j(this,(function(u){switch(u.label){case 0:return o="upload-".concat(Tt(8)),t.isLoggedIn?e.length>0?(i=new Set(r||[]),[4,Promise.all(e.map((function(e){return x(a,void 0,void 0,(function(){var r,a,u,s;return j(this,(function(c){switch(c.label){case 0:return(r=e.core.schema.primaryKey.extractKey)?(a=n[e.name],[4,((null===a||void 0===a?void 0:a.generatedGlobalId)?e.filter((function(e){var t=r(e);return!i.has(e.realmId||"")&&E(t)})):e.filter((function(e){return r(e),!i.has(e.realmId||"")&&(t=r(e),!(n=null===a||void 0===a?void 0:a.idPrefix)||"string"===typeof t&&t.startsWith(n));var t,n}))).toArray()]):[2,{table:e.name,muts:[]}];case 1:return(u=c.sent()).length>0?(s={type:"upsert",values:u,keys:u.map(r),userId:t.userId,txid:o},[2,{table:e.name,muts:[s]}]):[2,{table:e.name,muts:[]}]}}))}))})))]):[3,2]:[3,2];case 1:return[2,u.sent().filter((function(e){return e.muts.length>0}))];case 2:return[2,[]]}}))}))}var Rt={}.toString;function Nt(e){return Rt.call(e).slice(8,-1)}var Kt={replace:function(e){for(var t=Object.keys(e),n=null,r=0,o=t.length;r<o;++r)"$"===t[r][0]&&(n=n||[]).push(t[r]);if(!n)return e;for(var i=_({},e),a=0,u=n;a<u.length;a++){delete i[u[a]]}for(var s=0,c=n;s<c.length;s++){var l=c[s];i["$"+l]=e[l]}return i}};function Bt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.reduce((function(e,t){return _(_({},e),t)}),e.reduce((function(e,t){return _(_({},t),e)}),{})),r=new WeakMap;return{stringify:function(e,t,r){return JSON.stringify(e,(function(e){var r=this[e],i=o(r);return i?i.replace(r,t,n):r}),r)},parse:function(e,t){var r=[];return JSON.parse(e,(function(e,o){var i=null===o||void 0===o?void 0:o.$t;if(i){var a=n[i];o=a?a.revive(o,t,n):o}var u=r[r.length-1];if(u&&u[0]===o){o=_({},o);for(var s=0,c=u[1];s<c.length;s++){delete o[c[s]]}for(var l=0,f=Object.entries(u[2]);l<f.length;l++){var d=f[l],h=d[0],p=d[1];o[h]=p}r.pop()}if(void 0===o||"$"===e[0]&&"$t"!==e){var v=void 0,b=void 0;(u=r[r.length-1])&&u[0]===this?(v=u[1],b=u[2]):r.push([this,v=[],b={}]),"$"===e[0]&&"$t"!==e?(v.push(e),b[e.substr(1)]=o):b[e]=void 0}return o}))}};function o(e){var t=typeof e;switch(typeof e){case"object":case"function":if(null===e)return null;var o=Object.getPrototypeOf(e);if(!o)return Kt;var i=r.get(o);if(void 0!==i)return i;var a=Nt(e),u=Object.entries(n).find((function(t){var n,r,o=t[0],i=t[1];return null!==(r=null===(n=null===i||void 0===i?void 0:i.test)||void 0===n?void 0:n.call(i,e,a))&&void 0!==r?r:o===a}));return(i=null===u||void 0===u?void 0:u[1])||(i=Array.isArray(e)?null:"function"===typeof e?n.function||null:Kt),r.set(o,i),i;default:return n[t]}}}var Ut={Blob:{test:function(e,t){return"Blob"===t},replace:function(e,t){var n=t.length;return t.push(e),{$t:"Blob",mimeType:e.type,i:n}},revive:function(e,t){var n=e.i,r=e.mimeType;return new Blob([t[n]],{type:r})}}},Lt={number:{replace:function(e){switch(!0){case isNaN(e):return{$t:"number",v:"NaN"};case e===1/0:return{$t:"number",v:"Infinity"};case e===-1/0:return{$t:"number",v:"-Infinity"};default:return e}},revive:function(e){var t=e.v;return Number(t)}}},Mt={bigint:{replace:function(e){return{$t:"bigint",v:""+e}},revive:function(e){return BigInt(e.v)}}},Ft={Date:{replace:function(e){return{$t:"Date",v:isNaN(e.getTime())?"NaN":e.toISOString()}},revive:function(e){var t=e.v;return new Date("NaN"===t?NaN:Date.parse(t))}}},Wt={Set:{replace:function(e){return{$t:"Set",v:Array.from(e.entries())}},revive:function(e){var t=e.v;return new Set(t)}}},qt={Map:{replace:function(e){return{$t:"Map",v:Array.from(e.entries())}},revive:function(e){var t=e.v;return new Map(t)}}},$t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"===typeof r?r:void 0,zt=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","DataView","BigInt64Array","BigUint64Array"].reduce((function(e,t){var n;return _(_({},e),((n={})[t]={replace:function(e,n,r){return{$t:t,v:r.ArrayBuffer.replace(0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength),n,r).v}},revive:function(e,n,r){var o=e.v,i=$t[t];return i&&new i(r.ArrayBuffer.revive({v:o},n,r))}},n))}),{});function Ht(e){return function(e){for(var t="",n=0,r=e.length;n<r;n++)t+=Yt[e[n]];return t}(at(e))}function Vt(e){return it(function(e){if("string"!==typeof e)throw new Error("invalid decoder input: "+e);for(var t="",n=0,r=e.length;n<r;n++)t+=Gt[e[n]];return t}(e))}for(var Gt={"-":"=",0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",A:"K",B:"L",C:"M",D:"N",E:"O",F:"P",G:"Q",H:"R",I:"S",J:"T",K:"U",L:"V",M:"W",N:"X",O:"Y",P:"Z",Q:"a",R:"b",S:"c",T:"d",U:"e",V:"f",W:"g",X:"h",Y:"i",Z:"j",_:"k",a:"l",b:"m",c:"n",d:"o",e:"p",f:"q",g:"r",h:"s",i:"t",j:"u",k:"v",l:"w",m:"x",n:"y",o:"z",p:"0",q:"1",r:"2",s:"3",t:"4",u:"5",v:"6",w:"7",x:"8",y:"9",z:"+","|":"/"},Yt={},Jt=0,Qt=Object.keys(Gt);Jt<Qt.length;Jt++){var Xt=Qt[Jt];Yt[Gt[Xt]]=Xt}var Zt={ArrayBuffer:{replace:function(e){return{$t:"ArrayBuffer",v:Ht(e)}},revive:function(e){var t=Vt(e.v);return t.buffer.byteLength===t.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}}},en=function(e,t){this.buf=e,this.type=t};function tn(e){var t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",URL.createObjectURL(e),!1),t.send(),200!==t.status&&0!==t.status)throw new Error("Bad Blob access: "+t.status);return t.responseText}function nn(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t.buffer}var rn={Blob:{test:function(e,t){return"Blob"===t||e instanceof en},replace:function(e){return{$t:"Blob",v:at(e instanceof en?e.buf:nn(tn(e))),type:e.type}},revive:function(e){var t=e.type,n=e.v,r=it(n);return void 0!==typeof Blob?new Blob([r]):new en(r.buffer,t)}}},on=_(_(_(_(_(_(_(_({},Lt),Mt),Ft),Wt),qt),zt),Zt),rn);function an(e){return new Promise((function(t,n){var r=new FileReader;r.onabort=function(e){return n(new Error("file read aborted"))},r.onerror=function(e){return n(e.target.error)},r.onload=function(e){return t(e.target.result)},r.readAsText(e)}))}function un(e){return new Promise((function(t,n){var r=new FileReader;r.onabort=function(e){return n(new Error("file read aborted"))},r.onerror=function(e){return n(e.target.error)},r.onload=function(e){return t(e.target.result)},r.readAsArrayBuffer(e)}))}var sn={undefined:{replace:function(){return{$t:"undefined"}},revive:function(){}}},cn="bigint"===typeof BigInt(0),ln=function(){function e(e){this.v=e}return e.prototype.toString=function(){return this.v},e}(),fn=_(_({},sn),cn?{}:{bigint:{test:function(e){return e instanceof ln},replace:function(e){return _({$t:"bigint"},e)},revive:function(e){var t=e.v;return new ln(t)}}}),dn=Bt(on,fn),hn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Bt.apply(void 0,k([on,Ut],e,!1));return{toBinary:function(e){var t=this.stringify(e),n=t[0],r=t[1],o=new ArrayBuffer(4);return new DataView(o).setUint32(0,n.size),new Blob([o,n,r])},stringify:function(e){var t=[],r=n.stringify(e,t);return[new Blob(t.map((function(e){var t=new ArrayBuffer(4);return new DataView(t).setUint32(0,"byteLength"in e?e.byteLength:e.size),new Blob([t,e])}))),r]},parse:function(e,t){return x(this,void 0,void 0,(function(){var r,o,i,a,u,s;return j(this,(function(c){switch(c.label){case 0:return r=0,o=[],[4,un(t)];case 1:for(i=c.sent(),a=new DataView(i);r<i.byteLength;)u=a.getUint32(r),r+=4,s=i.slice(r,r+u),r+=u,o.push(s);return[2,n.parse(e,o)]}}))}))},fromBinary:function(e){return x(this,void 0,void 0,(function(){var t,n,r,o;return j(this,(function(i){switch(i.label){case 0:return n=DataView.bind,[4,un(e.slice(0,4))];case 1:return t=(new(n.apply(DataView,[void 0,i.sent()]))).getUint32(0),r=e.slice(4,t+4),[4,an(e.slice(t+4))];case 2:return o=i.sent(),[4,this.parse(o,r)];case 3:return[2,i.sent()]}}))}))}}}(fn);function pn(e,t,n){for(var r=[],i=function(n){var i=n.table,a=n.muts,u=e.tables.find((function(e){return e.name===i}));if(!u)throw new Error("Internal error: table ".concat(i," not found in DBCore schema"));var s=u.primaryKey,c=n;a.forEach((function(e,r){var i=!s.outbound&&("upsert"===e.type||"insert"===e.type);e.keys.forEach((function(e,a){if(Array.isArray(e)){c===n&&(c=vn(n,i));var u=c.muts[r],l=JSON.stringify(e);u.keys[a]=l,i&&o.default.setByKeyPath(u.values[a],s.keyPath,l)}else if("#"===e[0]){c===n&&(c=vn(n,i));u=c.muts[r];if(!t.isLoggedIn)throw new Error("Internal error: Cannot sync private IDs before authenticated");l="".concat(e,":").concat(t.userId);u.keys[a]=l,i&&o.default.setByKeyPath(u.values[a],s.keyPath,l)}}))})),r.push(c)},a=0,u=n;a<u.length;a++){i(u[a])}return r}function vn(e,t){return _(_({},e),{muts:t?e.muts.map((function(e){return _(_({},e),{keys:e.keys.slice(),values:e.values.slice()})})):e.muts.map((function(e){return _(_({},e),{keys:e.keys.slice()})}))})}function bn(e,t,n,r,o,i,a,u){return x(this,void 0,void 0,(function(){var s,c,l,f,d,h,p;return j(this,(function(v){switch(v.label){case 0:return s={Accept:"application/json, application/x-bison, application/x-bison-stream","Content-Type":"application/tson"},[4,ft(r)];case 1:return(c=v.sent())&&(s.Authorization="Bearer ".concat(c)),l={v:2,dbID:null===t||void 0===t?void 0:t.remoteDbId,clientIdentity:a,schema:i||{},lastPull:t?{serverRevision:t.serverRevision,realms:t.realms,inviteRealms:t.inviteRealms}:void 0,baseRevs:n,changes:pn(r.dx.core.schema,u,e)},console.debug("Sync request",l),r.syncStateChangedEvent.next({phase:"pushing"}),[4,fetch("".concat(o,"/sync"),{method:"post",headers:s,body:dn.stringify(l)})];case 2:if(f=v.sent(),r.syncStateChangedEvent.next({phase:"pulling"}),!f.ok)throw new yt(f);switch(f.headers.get("content-type")){case"application/x-bison":return[3,3];case"application/x-bison-stream":case"application/json":return[3,5]}return[3,5];case 3:return h=(d=hn).fromBinary,[4,f.blob()];case 4:return[2,h.apply(d,[v.sent()])];case 5:return[4,f.text()];case 6:return p=v.sent(),[2,dn.parse(p)]}}))}))}function yn(e,t,n){return x(this,void 0,void 0,(function(){var r,o,i,a;return j(this,(function(u){switch(u.label){case 0:r=new Set(n||[]),o=0,i=e,u.label=1;case 1:return o<i.length?"members"!==(a=i[o]).name?[3,3]:[4,a.toCollection().modify((function(e){r.has(e.realmId)||e.userId&&e.userId!==_t.userId||(e.userId=t.userId)}))]:[3,9];case 2:return u.sent(),[3,8];case 3:return"roles"!==a.name?[3,4]:[3,8];case 4:return"realms"!==a.name?[3,6]:[4,a.toCollection().modify((function(e){r.has(e.realmId)||void 0!==e.owner&&e.owner!==_t.userId||(e.owner=t.userId)}))];case 5:return u.sent(),[3,8];case 6:return[4,a.toCollection().modify((function(e){e.realmId&&r.has(e.realmId)||(e.owner&&e.owner!==_t.userId||(e.owner=t.userId),e.realmId&&e.realmId!==_t.userId||(e.realmId=t.userId))}))];case 7:u.sent(),u.label=8;case 8:return o++,[3,1];case 9:return[2]}}))}))}function mn(e){if(null===e||void 0===e?void 0:e.cancelled)throw new o.default.AbortError("Operation was cancelled")}var gn=navigator.onLine;function wn(e,t,n,r){return x(this,void 0,void 0,(function(){return j(this,(function(o){switch(o.label){case 0:return[4,e.$baseRevs.bulkPut(Object.keys(t).filter((function(e){return t[e].markedForSync})).map((function(e){return{tableName:e,clientRev:(n[e]||0)+1,serverRev:r}})))];case 1:return o.sent(),[2]}}))}))}function _n(e,t){void 0===t&&(t={});for(var n=0,r=e;n<r.length;n++){var o=r[n],i=o.table,a=o.muts,u=a.length>0?a[a.length-1].rev:null;t[i]=u||t[i]||0}return t}function xn(e,t,n){return x(this,void 0,void 0,(function(){var r,i,a;return j(this,(function(u){switch(u.label){case 0:return[4,e.bulkGet(t)];case 1:return r=u.sent(),i=[],a=[],t.forEach((function(t,u){var s=r[u];if(s){for(var c=0,l=Object.entries(n[u]);c<l.length;c++){var f=l[c],d=f[0],h=f[1];if(d===e.schema.primKey.keyPath){if(0!==Object(o.cmp)(h,t))throw new Error("Cannot change primary key")}else o.default.setByKeyPath(s,d,h)}i.push(t),a.push(s)}})),[4,null==e.schema.primKey.keyPath?e.bulkPut(a,i):e.bulkPut(a)];case 2:return u.sent(),[2]}}))}))}function jn(e,t){return x(this,void 0,void 0,(function(){var n,r,i,a,u,s;return j(this,(function(c){switch(c.label){case 0:console.debug("Applying server changes",e,o.default.currentTransaction),n=function(e,n){var i,a,u,s,c,l,f;return j(this,(function(d){switch(d.label){case 0:if(!(i=t.table(e)))return[2,"continue"];a=i.core.schema.primaryKey,u=function(e){switch(e[0]){case"[":if(e.endsWith("]"))try{return JSON.parse(e)}catch(r){}return e;case"#":return e.endsWith(":"+t.cloud.currentUserId)?e.substr(0,e.length-t.cloud.currentUserId.length-1):e;default:return e}},s=function(e){var t;return j(this,(function(n){switch(n.label){case 0:switch(t=e.keys.map(u),e.type){case"insert":return[3,1];case"upsert":return[3,6];case"modify":return[3,11];case"update":return[3,16];case"delete":return[3,18]}return[3,20];case 1:return a.outbound?[4,i.bulkAdd(e.values,t)]:[3,3];case 2:return n.sent(),[3,5];case 3:return t.forEach((function(t,n){o.default.setByKeyPath(e.values[n],a.keyPath,t)})),[4,i.bulkAdd(e.values)];case 4:n.sent(),n.label=5;case 5:return[3,20];case 6:return a.outbound?[4,i.bulkPut(e.values,t)]:[3,8];case 7:return n.sent(),[3,10];case 8:return t.forEach((function(t,n){o.default.setByKeyPath(e.values[n],a.keyPath,t)})),[4,i.bulkPut(e.values)];case 9:n.sent(),n.label=10;case 10:return[3,20];case 11:return 1!==t.length?[3,13]:[4,i.update(t[0],e.changeSpec)];case 12:return n.sent(),[3,15];case 13:return[4,i.where(":id").anyOf(t).modify(e.changeSpec)];case 14:n.sent(),n.label=15;case 15:return[3,20];case 16:return[4,xn(i,t,e.changeSpecs)];case 17:return n.sent(),[3,20];case 18:return[4,i.bulkDelete(t)];case 19:return n.sent(),[3,20];case 20:return[2]}}))},c=0,l=n,d.label=1;case 1:return c<l.length?(f=l[c],[5,s(f)]):[3,4];case 2:d.sent(),d.label=3;case 3:return c++,[3,1];case 4:return[2]}}))},r=0,i=e,c.label=1;case 1:return r<i.length?(a=i[r],u=a.table,s=a.muts,[5,n(u,s)]):[3,4];case 2:c.sent(),c.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}))}self.addEventListener("online",(function(){return gn=!0})),self.addEventListener("offline",(function(){return gn=!1}));function kn(e,t,n,r){var o=this;return Sn.apply(this,arguments).then((function(){(null===r||void 0===r?void 0:r.justCheckIfNeeded)||e.syncStateChangedEvent.next({phase:"in-sync"})})).catch((function(i){return x(o,void 0,void 0,(function(){return j(this,(function(o){switch(o.label){case 0:return(null===r||void 0===r?void 0:r.justCheckIfNeeded)?[2,Promise.reject(i)]:(console.debug("Error from _sync",{isOnline:gn,syncOptions:r,error:i}),gn&&(null===r||void 0===r?void 0:r.retryImmediatelyOnFetchError)&&"TypeError"===(null===i||void 0===i?void 0:i.name)&&/fetch/.test(null===i||void 0===i?void 0:i.message)?(e.syncStateChangedEvent.next({phase:"error",error:i}),[4,new Promise((function(e){return setTimeout(e,500)}))]):[3,3]);case 1:return o.sent(),[4,kn(e,t,n,_(_({},r),{retryImmediatelyOnFetchError:!1}))];case 2:return[2,o.sent()];case 3:return[4,e.$syncState.update("syncState",{timestamp:new Date,error:""+i})];case 4:return o.sent(),e.syncStateChangedEvent.next({phase:gn?"error":"offline",error:i}),[2,Promise.reject(i)]}}))}))}))}function Sn(e,t,n,r){var o,i=void 0===r?{isInitialSync:!1}:r,a=i.isInitialSync,u=i.cancelToken,s=i.justCheckIfNeeded,c=i.purpose;return x(this,void 0,void 0,(function(){var r,i,l,f,d,h,p,v,b,y,m,g,w,_,S,O=this;return j(this,(function(E){switch(E.label){case 0:if(s||console.debug("SYNC STARTED",{isInitialSync:a,purpose:c}),!(null===(o=e.cloud.options)||void 0===o?void 0:o.databaseUrl))throw new Error("Internal error: sync must not be called when no databaseUrl is configured");return r=t.databaseUrl,[4,e.getCurrentUser()];case 1:return i=E.sent(),l=i.isLoggedIn?It(e):[],f=l.map((function(t){return e.table(Et(t.name))})),[4,e.getPersistedSyncState()];case 2:return d=E.sent(),h=!a&&i.isLoggedIn?function(e,t){var n=(null===t||void 0===t?void 0:t.syncedTables)||[];return It(e).filter((function(e){return!n.includes(e.name)}))}(e,d):[],mn(u),(p=h.length>0)?s?[2,!0]:[4,e.transaction("rw",h,(function(e){return x(O,void 0,void 0,(function(){return j(this,(function(t){switch(t.label){case 0:return e.idbtrans.disableChangeTracking=!0,e.idbtrans.disableAccessControl=!0,[4,yn(h,i,null===d||void 0===d?void 0:d.realms)];case 1:return t.sent(),[2]}}))}))}))]:[3,4];case 3:E.sent(),mn(u),E.label=4;case 4:return[4,e.transaction("r",e.tables,(function(){return x(O,void 0,void 0,(function(){var t,r,o,a,s;return j(this,(function(c){switch(c.label){case 0:return[4,e.getPersistedSyncState()];case 1:return t=c.sent(),[4,e.$baseRevs.toArray()];case 2:return r=c.sent(),[4,At(f)];case 3:return o=c.sent(),mn(u),p?(a=k(k([],(null===d||void 0===d?void 0:d.realms)||[],!0),(null===d||void 0===d?void 0:d.inviteRealms)||[],!0),[4,Dt(h,i,n,a)]):[3,5];case 4:return s=c.sent(),mn(u),[2,[o=o.concat(s),t,r]];case 5:return[2,[o,t,r]]}}))}))}))];case 5:return v=E.sent(),b=v[0],y=v[1],m=v[2],g=b.some((function(e){return e.muts.some((function(e){return e.keys.length>0}))})),s?(console.debug("Sync is needed:",g),[2,g]):"push"!==c||g?(w=_n(b,null===y||void 0===y?void 0:y.latestRevisions),_=(null===y||void 0===y?void 0:y.clientIdentity)||I(16),mn(u),[4,bn(b,y,m,e,r,n,_,i)]):[2,!1];case 6:return S=E.sent(),console.debug("Sync response",S),[4,e.transaction("rw",e.tables,(function(t){return x(O,void 0,void 0,(function(){var r,o,i,a,u,s,c,d,p,v;return j(this,(function(b){switch(b.label){case 0:for(t.idbtrans.disableChangeTracking=!0,t.idbtrans.disableAccessControl=!0,r=0,o=Object.keys(n);r<o.length;r++)i=o[r],S.schema[i]&&(n[i]=S.schema[i]);return[4,e.$syncState.put(n,"schema")];case 1:return b.sent(),[4,At(f,0,{since:w})];case 2:a=b.sent(),u=function(t){var n,r;return j(this,(function(o){switch(o.label){case 0:return n=Pt(t.name),a.some((function(e){return e.table===n&&e.muts.length>0}))?[3,2]:[4,Promise.all([t.clear(),e.$baseRevs.where({tableName:n}).delete()])];case 1:return o.sent(),[3,5];case 2:return w[n]?(r=w[n]||0,[4,Promise.all([t.where("rev").belowOrEqual(r).delete(),e.$baseRevs.where(":id").between([n,-1/0],[n,r+1],!0,!0).reverse().offset(1).delete()])]):[3,4];case 3:return o.sent(),[3,5];case 4:o.label=5;case 5:return[2]}}))},s=0,c=f,b.label=3;case 3:return s<c.length?(d=c[s],[5,u(d)]):[3,6];case 4:b.sent(),b.label=5;case 5:return s++,[3,3];case 6:return _n(a,w),[4,wn(e,n,w,S.serverRevision)];case 7:return b.sent(),[4,e.getPersistedSyncState()];case 8:return p=b.sent(),[4,On(e,S,p)];case 9:return b.sent(),(v=p||{syncedTables:[],latestRevisions:{},realms:[],inviteRealms:[],clientIdentity:_}).syncedTables=l.map((function(e){return e.name})).concat(h.map((function(e){return e.name}))),v.latestRevisions=w,v.remoteDbId=S.dbId,v.initiallySynced=!0,v.realms=S.realms,v.inviteRealms=S.inviteRealms,v.serverRevision=S.serverRevision,v.timestamp=new Date,delete v.error,[4,jn(In(S.changes,a),e)];case 10:return b.sent(),e.$syncState.put(v,"syncState"),[2,0===a.length]}}))}))}))];case 7:return E.sent()?[3,9]:(console.debug("MORE SYNC NEEDED. Go for it again!"),[4,Sn(e,t,n,{isInitialSync:a,cancelToken:u})]);case 8:return[2,E.sent()];case 9:return console.debug("SYNC DONE",{isInitialSync:a}),[2,!1]}}))}))}function On(e,t,n){return x(this,void 0,void 0,(function(){var r,o,i,a,u,s,c,l,f,d,h,p,v,b,y,m;return j(this,(function(g){switch(g.label){case 0:for(r=new Set,o=new Set,i=n?n.realms:[],a=n?n.inviteRealms:[],u=new Set(t.realms),s=new Set(t.realms.concat(t.inviteRealms)),c=0,l=i;c<l.length;c++)h=l[c],u.has(h)||(o.add(h),s.has(h)||r.add(h));for(f=0,d=a.concat(i);f<d.length;f++)h=d[f],s.has(h)||r.add(h);if(!(r.size>0||o.size>0))return[3,4];p=It(e),v=function(e){var t;return j(this,(function(n){switch(n.label){case 0:return 0===(t=["realms","members","roles"].includes(e.name)?r:o).size?[2,"continue"]:e.schema.indexes.some((function(e){return"realmId"===e.keyPath||Array.isArray(e.keyPath)&&"realmId"===e.keyPath[0]}))?[4,e.where("realmId").anyOf(k([],t,!0)).delete()]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,e.filter((function(e){return!!(null===e||void 0===e?void 0:e.realmId)&&t.has(e.realmId)})).delete()];case 3:n.sent(),n.label=4;case 4:return[2]}}))},b=0,y=p,g.label=1;case 1:return b<y.length?(m=y[b],[5,v(m)]):[3,4];case 2:g.sent(),g.label=3;case 3:return b++,[3,1];case 4:return[2]}}))}))}function In(e,t){var n={};A(n,e);var r={};return A(r,t),function(e,t){for(var n,r,o,i=0,a=Object.entries(t);i<a.length;i++)for(var u=a[i],s=u[0],c=u[1],l=0,f=Object.entries(c);l<f.length;l++){var d=f[l],h=d[0],p=d[1];switch(p.type){case"ups":if(v=null===(n=e[s])||void 0===n?void 0:n[h])switch(v.type){case"ups":delete e[s][h];break;case"del":break;case"upd":delete e[s][h]}break;case"del":null===(r=e[s])||void 0===r||delete r[h];break;case"upd":var v;if(v=null===(o=e[s])||void 0===o?void 0:o[h])switch(v.type){case"ups":for(var b=0,y=Object.entries(p.mod);b<y.length;b++){var m=y[b],g=m[0],w=m[1];O(v.val,g,w)}break;case"del":break;case"upd":for(var _=0,x=Object.keys(p.mod);_<x.length;_++)g=x[_],delete v.mod[g]}}}}(n,r),function(e){for(var t=I(16),n={},r=0,o=Object.entries(e);r<o.length;r++)for(var i=o[r],a=i[0],u=i[1],s=0,c=Object.entries(u);s<c.length;s++){var l=c[s],f=l[0],d=l[1],h=n[a]||(n[a]={});(h[d.type]||(h[d.type]=[])).push(Object.assign({key:f},d))}for(var p=[],v=0,b=Object.entries(n);v<b.length;v++){for(var y=b[v],m=(a=y[0],u=y[1],{table:a,muts:[]}),g=0,w=Object.entries(u);g<w.length;g++){var _=w[g],x=_[0],j=_[1];switch(x){case"ups":d={type:"upsert",keys:j.map((function(e){return e.key})),values:j.map((function(e){return e.val})),txid:t},m.muts.push(d);break;case"upd":d={type:"update",keys:j.map((function(e){return e.key})),changeSpecs:j.map((function(e){return e.mod})),txid:t},m.muts.push(d);break;case"del":d={type:"delete",keys:j.map((function(e){return e.key})),txid:t},m.muts.push(d)}}p.push(m)}return p}(n)}var En=new WeakMap,Pn={members:"@id, [userId+realmId], [email+realmId], realmId",roles:"[realmId+name]",realms:"@realmId",$jobs:"",$syncState:"",$baseRevs:"[tableName+clientRev]",$logins:"claims.sub, lastLogin"},Cn=0;function An(e){"vip"in e&&(e=e.vip);var t=En.get(e.cloud);if(!t){var n=new u.a,r=new St("syncstatechanged-".concat(e.name));n.id=++Cn;var i=!1;t={get name(){return e.name},close:function(){return e.close()},transaction:e.transaction.bind(e),table:e.table.bind(e),get tables(){return e.tables},cloud:e.cloud,get $jobs(){return e.table("$jobs")},get $syncState(){return e.table("$syncState")},get $baseRevs(){return e.table("$baseRevs")},get $logins(){return e.table("$logins")},get realms(){return e.realms},get members(){return e.members},get roles(){return e.roles},get initiallySynced(){return i},localSyncEvent:n,get syncStateChangedEvent(){return r},dx:e};var s={getCurrentUser:function(){return t.$logins.toArray().then((function(e){return e.find((function(e){return e.isLoggedIn}))||_t}))},getPersistedSyncState:function(){return t.$syncState.get("syncState")},getSchema:function(){return t.$syncState.get("schema")},getOptions:function(){return t.$syncState.get("options")},setInitiallySynced:function(e){i=e},reconfigure:function(){r=new St("syncstatechanged-".concat(e.name))}};Object.assign(t,s),t.messageConsumer=function(e){var t=this,n=[],r=new a.a(!0),i=new a.a(null),u=!1,s=0,c=[0,0,0,0,0,0,0,0,0,Date.now()];function l(){var t,r,i;return x(this,void 0,void 0,(function(){var a,u=this;return j(this,(function(s){switch(s.label){case 0:a=function(){var a,s,c,l,f;return j(this,(function(d){switch(d.label){case 0:a=n.shift(),d.label=1;case 1:return d.trys.push([1,13,,14]),[4,e.cloud.syncState.pipe(Ye((function(e){var t=e.phase;return"in-sync"===t||"error"===t})),ze(1)).toPromise()];case 2:if(d.sent(),console.debug("processing msg",a),s=e.cloud.persistedSyncState.value,!a)return[2,"continue"];switch(a.type){case"token-expired":return[3,3];case"realm-added":return[3,6];case"realm-accepted":return[3,7];case"realm-removed":return[3,8];case"realms-changed":return[3,9];case"changes":return[3,10]}return[3,12];case 3:return console.debug("WebSocket observable: Token expired. Refreshing token..."),c=e.cloud.currentUser.value,[4,ht(e.cloud.options.databaseUrl,c)];case 4:return l=d.sent(),[4,e.table("$logins").update(c.userId,{accessToken:l.accessToken,accessTokenExpiration:l.accessTokenExpiration})];case 5:return d.sent(),[3,12];case 6:case 7:return ot(e,"pull"),[3,12];case 8:return(null===(t=null===s||void 0===s?void 0:s.realms)||void 0===t?void 0:t.includes(a.realm))||null===(r=null===s||void 0===s?void 0:s.inviteRealms)||void 0===r||r.includes(a.realm),ot(e,"pull"),[3,12];case 9:return ot(e,"pull"),[3,12];case 10:return console.debug("changes"),"error"===(null===(i=e.cloud.syncState.value)||void 0===i?void 0:i.phase)?(ot(e,"pull"),[3,12]):[4,e.transaction("rw",e.dx.tables,(function(t){return x(u,void 0,void 0,(function(){var n,r,i,u,s,c,l;return j(this,(function(f){switch(f.label){case 0:return t.idbtrans.disableChangeTracking=!0,t.idbtrans.disableAccessControl=!0,[4,Promise.all([e.getSchema(),e.getPersistedSyncState(),e.getCurrentUser()])];case 1:return n=f.sent(),r=n[0],i=n[1],u=n[2],console.debug("ws message queue: in transaction"),i&&r&&u?a.baseRev!==i.serverRevision?(console.debug("baseRev (".concat(a.baseRev,") differs from our serverRevision in syncState (").concat(i.serverRevision,")")),"string"!==typeof a.baseRev||"bigint"!==typeof i.serverRevision&&"object"!==typeof i.serverRevision||ot(e,"pull"),[2]):[4,o.default.waitFor(Ot(i))]:(console.debug("required vars not present",{syncState:i,schema:r,currentUser:u}),[2]);case 2:return s=f.sent(),console.debug("ourRealmSetHash",s),s!==a.realmSetHash?(console.debug("not same realmSetHash",a.realmSetHash),ot(e,"pull"),[2]):(c=[],u.isLoggedIn?[4,At(It(e).map((function(t){return e.table(Et(t.name))})))]:[3,4]);case 3:c=f.sent(),console.debug("msg queue: client changes",c),f.label=4;case 4:return a.changes.length>0?(l=In(a.changes,c),console.debug("applying filtered server changes",l),[4,jn(l,e)]):[3,6];case 5:f.sent(),f.label=6;case 6:return i.latestRevisions=_n(c,i.latestRevisions),i.serverRevision=a.newRev,console.debug("Updating baseRefs",i.latestRevisions),[4,wn(e,r,i.latestRevisions,a.newRev)];case 7:return f.sent(),console.debug("Updating syncState",i),[4,e.$syncState.put(i,"syncState")];case 8:return f.sent(),[2]}}))}))}))];case 11:return d.sent(),console.debug("msg queue: done with rw transaction"),[3,12];case 12:return[3,14];case 13:return f=d.sent(),console.error("Error in msg queue",f),[3,14];case 14:return[2]}}))},s.label=1;case 1:return n.length>0?[5,a()]:[3,3];case 2:return s.sent(),[3,1];case 3:return[2]}}))}))}return i.subscribe((function(){return x(t,void 0,void 0,(function(){return j(this,(function(e){switch(e.label){case 0:if(u)return[2];if(!(n.length>0))return[3,8];u=!0,c.shift(),c.push(Date.now()),r.next(!1),e.label=1;case 1:return e.trys.push([1,,3,8]),[4,l()];case 2:return e.sent(),[3,8];case 3:return c[c.length-1]-c[0]<1e4?Date.now()-s<5e3?(console.warn("Slowing down websocket loop for one minute"),s=Date.now()+6e4,[4,new Promise((function(e){return setTimeout(e,6e4)}))]):[3,5]:[3,7];case 4:return e.sent(),[3,7];case 5:return console.warn("Slowing down websocket loop for 10 seconds"),s=Date.now()+1e4,[4,new Promise((function(e){return setTimeout(e,1e4)}))];case 6:e.sent(),e.label=7;case 7:return u=!1,r.next(!0),[7];case 8:return[2]}}))}))})),{enqueue:function(e){n.push(e),i.next(null)},readyToServe:r}}(t),En.set(e.cloud,t)}return t}var Tn="undefined"!==typeof InstallTrigger,Dn="undefined"!==typeof navigator&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\/|Edge\//.test(navigator.userAgent),Rn=Dn?[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]:NaN,Nn=Dn&&Rn<=605||Tn;var Kn="undefined"!==typeof self&&"clients"in self&&!self.document;function Bn(){throw new o.default.SchemaError("Version increment needed to allow dexie-cloud change tracking")}var Un={}.toString;function Ln(e){return Un.call(e).slice(8,-1)}function Mn(e,t){var n;return"delete"===t.type?t.keys:(null===(n=t.keys)||void 0===n?void 0:n.slice())||t.values.map(e.extractKey)}var Fn=/b|c|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|x|y|z/i;var Wn=0;function qn(e,t){var n=new Uint8Array(18),r=new Uint8Array(n.buffer,0,6),o=Date.now();Wn>=o?++Wn:Wn=o,r[0]=Wn/1099511627776,r[1]=Wn/4294967296,r[2]=Wn/16777216,r[3]=Wn/65536,r[4]=Wn/256,r[5]=Wn;var i=new Uint8Array(n.buffer,6);return crypto.getRandomValues(i),e+Ht(new Uint8Array(n.buffer))+(t||"")}function $n(e){return{stack:"dbcore",name:"idGenerationMiddleware",level:1,create:function(t){return _(_({},t),{table:function(n){var r=t.table(n);return _(_({},r),{mutate:function(t){var i,a;if(t.trans.disableChangeTracking)return r.mutate(t);if("add"===t.type||"put"===t.type){var u=null===(i=e.cloud.schema)||void 0===i?void 0:i[n];if(null===u||void 0===u?void 0:u.generatedGlobalId){if((null===(a=e.cloud.options)||void 0===a?void 0:a.databaseUrl)&&!e.initiallySynced){var s=Mn(r.schema.primaryKey,t);return r.getMany({keys:s,trans:t.trans,cache:"immutable"}).then((function(e){if(e.length<s.length)throw new Error("Unable to create new objects without an initial sync having been performed.");return r.mutate(t)}))}return function(t,i){var a=null,u=Mn(r.schema.primaryKey,t);return u.forEach((function(s,c){if(void 0===s){var l=t.values[c].realmId||e.cloud.currentUserId,f=l.substr(l.length-3);u[c]=qn(i,f),r.schema.primaryKey.outbound||(a||(a=t.values.slice()),a[c]=o.default.deepClone(a[c]),o.default.setByKeyPath(a[c],r.schema.primaryKey.keyPath,u[c]))}else if("string"!==typeof s||!s.startsWith(i)&&!s.startsWith("#"+i))throw new o.default.ConstraintError('The ID "'.concat(s,'" is not valid for table "').concat(n,'". ')+"Primary '@' keys requires the key to be prefixed with \"".concat(i,'" (or "#').concat(i,").\n")+"If you want to generate IDs programmatically, remove '@' from the schema to get rid of this constraint. Dexie Cloud supports custom IDs as long as they are random and globally unique.")})),r.mutate(_(_({},t),{keys:u,values:a||t.values}))}(t,u.idPrefix)}(null===u||void 0===u?void 0:u.markedForSync)&&Mn(r.schema.primaryKey,t).forEach((function(e,t){if(!E(e)){var r=Array.isArray(e)?e.map(Ln).join(","):Ln(e);throw new o.default.ConstraintError("Invalid primary key type ".concat(r," for table ").concat(n,". Tables marked for sync has primary keys of type string or Array of string (and optional numbers)"))}}))}return r.mutate(t)}})}})}}}var zn=0;function Hn(e,t){return function(n){var r=n.trans[t]||(n.trans[t]={writers:[],readers:[]}),o=r.readers,i=r.writers,a=i.length,u=(a>0?i[a-1].then((function(){return e(n)}),(function(){return e(n)})):e(n)).finally((function(){return o.splice(o.indexOf(u))}));return o.push(u),u}}function Vn(e,t){return function(n){var r,o=n.trans[t]||(n.trans[t]={writers:[],readers:[]}),i=o.readers,a=o.writers,u=(a.length>0?a[a.length-1].then((function(){return e(n)}),(function(){return e(n)})):i.length>0?(r=i,new Promise((function(e){0===r.length&&e([]);var t=r.length,n=new Array(t);r.forEach((function(r,o){return Promise.resolve(r).then((function(e){return n[o]={status:"fulfilled",value:e}}),(function(e){return n[o]={status:"rejected",reason:e}})).then((function(){return--t||e(n)}))}))}))).then((function(){return e(n)})):e(n)).finally((function(){return a.shift()}));return a.push(u),u}}var Gn=new a.a(new Set);function Yn(e){var t=e.currentUserObservable,n=e.db;return{stack:"dbcore",name:"MutationTrackingMiddleware",level:1,create:function(r){var o,i=r.schema.tables.filter((function(e){return!/^\$/.test(e.name)}));try{o=new Map(i.map((function(e){return[e.name,r.table("$".concat(e.name,"_mutations"))]})))}catch(e){Bn()}return _(_({},r),{transaction:function(e,o){var i;if("readwrite"===o){var a=e.filter((function(e){var t,r;return null===(r=null===(t=n.cloud.schema)||void 0===t?void 0:t[e])||void 0===r?void 0:r.markedForSync})).map((function(e){return Et(e)}));i=r.transaction(k(k([],e,!0),a,!0),o)}else i=r.transaction(e,o);if("readwrite"===o){i.txid=Tt(16),i.currentUser=t.value,Gn.value.add(i),Gn.next(Gn.value);var u=function e(){i.removeEventListener("complete",s),i.removeEventListener("error",e),i.removeEventListener("abort",e),Gn.value.delete(i),Gn.next(Gn.value)},s=function(){var e;i.mutationsAdded&&(null===(e=n.cloud.options)||void 0===e?void 0:e.databaseUrl)&&(n.cloud.usingServiceWorker?(console.debug("registering sync event"),rt(n,"push")):n.localSyncEvent.next({purpose:"push"})),u()};i.addEventListener("complete",s),i.addEventListener("error",u),i.addEventListener("abort",u)}return i},table:function(e){var t=r.table(e);if(/^\$/.test(e))return e.endsWith("_mutations")?_(_({},t),{mutate:function(e){return"add"!==e.type&&"put"!==e.type||(e.trans.mutationsAdded=!0),t.mutate(e)}}):"$logins"===e?_(_({},t),{mutate:function(e){return t.mutate(e).then((function(t){return e.trans.mutationsAdded=!0,t})).catch((function(e){return console.debug("Failed mutation $logins",e),Promise.reject(e)}))}}):t;var i=t.schema,a=o.get(e);return function(e){var t="$lock"+ ++zn;return _(_({},e),{count:Hn(e.count,t),get:Hn(e.get,t),getMany:Hn(e.getMany,t),openCursor:Hn(e.openCursor,t),query:Hn(e.query,t),mutate:Vn(e.mutate,t)})}(_(_({},t),{mutate:function(r){var o,a,s,c=r.trans;return c.txid?c.disableChangeTracking?t.mutate(r):(null===(a=null===(o=n.cloud.schema)||void 0===o?void 0:o[e])||void 0===a?void 0:a.markedForSync)&&(null===(s=c.currentUser)||void 0===s?void 0:s.isLoggedIn)?"deleteRange"===r.type?t.query({query:{range:r.range,index:i.primaryKey},trans:r.trans,values:!1}).then((function(e){return u({type:"delete",keys:e.result,trans:r.trans,criteria:{index:null,range:r.range}})})):u(r):t.mutate(r):t.mutate(r)}}));function u(e){var n=e.trans;n.mutationsAdded=!0;var r=n.txid,o=n.currentUser.userId,i=e.type;return t.mutate(e).then((function(t){var u=t.numFailures,s=t.failures,c="delete"===i?e.keys:t.results,l="values"in e?e.values:[],f="changeSpecs"in e?e.changeSpecs:[];u&&(c=c.filter((function(e,t){return!s[t]})),l=l.filter((function(e,t){return!s[t]})),f=f.filter((function(e,t){return!s[t]})));var d=Date.now(),h="delete"===e.type?{type:"delete",ts:d,keys:c,criteria:e.criteria,txid:r,userId:o}:"add"===e.type?{type:"insert",ts:d,keys:c,txid:r,userId:o,values:l}:e.criteria&&e.changeSpec?{type:"modify",ts:d,keys:c,criteria:e.criteria,changeSpec:e.changeSpec,txid:r,userId:o}:e.changeSpecs?{type:"update",ts:d,keys:c,changeSpecs:f,txid:r,userId:o}:{type:"upsert",ts:d,keys:c,values:l,txid:r,userId:o};return c.length>0||"criteria"in e&&e.criteria?a.mutate({type:"add",trans:n,values:[h]}).then((function(){return t})):t}))}}})}}}function Jn(e,t){return function(n,r){var o=_(_({},Pn),n),i=t.cloud.schema||(t.cloud.schema={}),a=new Set;return Object.keys(o).forEach((function(e){var t=o[e],n=i[e]||(i[e]={});null!=t?(/^\@/.test(t)&&(o[e]=o[e].substr(1),n.generatedGlobalId=!0,n.idPrefix=function(e,t){for(var n,r,o,i=e[0].toLocaleLowerCase(),a=1,u=e.length;a<u&&i.length<3;++a)(Fn.test(e[a])||(n=e[a])>="A"&&n<="Z")&&(i+=e[a].toLowerCase());for(;t.has(i);){if(/\d/g.test(i)){if(!((i=i.substr(0,i.length-1)+(i[i.length-1]+1)).length>3))continue;i=i.substr(0,3)}else if(i.length<3){i+="2";continue}for(var s=1,c=i;t.has(c)&&s<8;)r=i,c=(1&(o=s)?r[0].toUpperCase():r[0].toLowerCase())+(2&o?r[1].toUpperCase():r[1].toLowerCase())+(4&o?r[2].toUpperCase():r[2].toLowerCase()),++s;if(s<8)i=c;else{var l=i.charCodeAt(2)+1&127;i=i.substr(0,2)+String.fromCharCode(l)}}return i}(e,a),a.add(n.idPrefix)),/^\$/.test(e)||(o["$".concat(e,"_mutations")]="++rev",n.markedForSync=!0),n.deleted&&(n.deleted=!1)):(n.deleted=!0,n.markedForSync=!1,o["$".concat(e,"_mutations")]=null)})),e.call(this,o,r)}}var Qn=Tt(16);function Xn(e,t,n,r,i){var a=(void 0===i?{}:i).awaitRemoteJob;return x(this,void 0,void 0,(function(){function i(){return x(this,void 0,void 0,(function(){var r,c=this;return j(this,(function(l){switch(l.label){case 0:return[4,e.transaction("rw!",n,(function(){return x(c,void 0,void 0,(function(){var e;return j(this,(function(n){switch(n.label){case 0:return[4,u.get(t)];case 1:return(e=n.sent())?[3,3]:[4,u.add({nodeId:Qn,started:new Date,heartbeat:new Date},t)];case 2:return n.sent(),[2,!0];case 3:return e.heartbeat.getTime()<Date.now()-6e4?(console.warn("Latest ".concat(t," worker seem to have died.\n"),"The dead job started:",e.started,"\n","Last heart beat was:",e.heartbeat,"\n","We're now taking over!"),[4,u.put({nodeId:Qn,started:new Date,heartbeat:new Date},t)]):[3,5];case 4:return n.sent(),[2,!0];case 5:return[2,!1]}}))}))}))];case 1:if(l.sent())return[2,!0];if(!a)return[3,6];l.label=2;case 2:return l.trys.push([2,4,,6]),[4,Object(s.a)(Object(o.liveQuery)((function(){return u.get(t)}))).pipe(function(e,t){var n=Ce(e)?{first:e}:"number"===typeof e?{each:e}:e,r=n.first,o=n.each,i=n.with,a=void 0===i?tt:i,u=n.scheduler,s=void 0===u?null!==t&&void 0!==t?t:Ie:u,c=n.meta,l=void 0===c?null:c;if(null==r&&null==o)throw new TypeError("No timeout provided.");return D((function(e,t){var n,i,u=null,c=0,f=function(e){i=Te(t,s,(function(){try{n.unsubscribe(),ge(a({meta:l,lastValue:u,seen:c})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe(new _e(t,(function(e){null===i||void 0===i||i.unsubscribe(),c++,t.next(u=e),o>0&&f(o)}),void 0,void 0,(function(){(null===i||void 0===i?void 0:i.closed)||null===i||void 0===i||i.unsubscribe(),u=null}))),f(null!=r?"number"===typeof r?r:+r-s.now():o)}))}(6e4),Ye((function(e){return!e}))).toPromise()];case 3:return l.sent(),[2,!1];case 4:if("TimeoutError"!==(r=l.sent()).name)throw r;return[4,i()];case 5:return[2,l.sent()];case 6:return[2,!1]}}))}))}var u,c,l=this;return j(this,(function(o){switch(o.label){case 0:return u=e.table(n),[4,i()];case 1:if(!o.sent())return[3,6];c=setInterval((function(){u.update(t,(function(e){e.nodeId===Qn&&(e.heartbeat=new Date)}))}),1e3),o.label=2;case 2:return o.trys.push([2,,4,6]),[4,r()];case 3:return[2,o.sent()];case 4:return clearInterval(c),[4,e.transaction("rw!",n,(function(){return x(l,void 0,void 0,(function(){var e;return j(this,(function(n){switch(n.label){case 0:return[4,u.get(t)];case 1:return(e=n.sent())&&e.nodeId===Qn&&u.delete(t),[2]}}))}))}))];case 5:return o.sent(),[7];case 6:return[2]}}))}))}function Zn(e,t,n){return x(this,void 0,void 0,(function(){var r=this;return j(this,(function(o){switch(o.label){case 0:return console.debug("Performing initial sync"),[4,Xn(e,"initialSync","$jobs",(function(){return x(r,void 0,void 0,(function(){var r;return j(this,(function(o){switch(o.label){case 0:return[4,e.getPersistedSyncState()];case 1:return(null===(r=o.sent())||void 0===r?void 0:r.initiallySynced)?[3,3]:[4,kn(e,t,n,{isInitialSync:!0})];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}),{awaitRemoteJob:!0})];case 1:return o.sent(),console.debug("Done initial sync"),[2]}}))}))}var er,tr,nr=new a.a(!0),rr=new a.a(!0);nr.pipe(Xe((function(e){return e?Object(c.a)(!0):Object(c.a)(!1).pipe(Ve(2e4))})),(void 0===tr&&(tr=se),er=null!==er&&void 0!==er?er:Ge,D((function(e,t){var n,r=!0;e.subscribe(new _e(t,(function(e){var o=tr(e);!r&&er(n,o)||(r=!1,n=o,t.next(e))})))})))).subscribe(rr);var or="undefined"!==typeof document?Object(l.a)(document,"visibilitychange"):Object(c.a)({}),ir=or.pipe(Ye((function(){return"hidden"===document.visibilityState}))),ar=or.pipe(Ye((function(){return"visible"===document.visibilityState}))),ur="undefined"!==typeof window?Object(f.a)(ar,Object(l.a)(window,"mousemove"),Object(l.a)(window,"keydown"),Object(l.a)(window,"wheel"),Object(l.a)(window,"touchmove")):Object(c.a)({});"undefined"!==typeof document&&Object(f.a)(Object(c.a)(!0),ir,ur).pipe(Le((function(){return"visible"===document.visibilityState})),Ze((function(e){nr.value!==e&&nr.next(e)})),Xe((function(e){return e?Object(c.a)(0).pipe(Ve(28e4),Ze((function(){return nr.next(!1)}))):Object(c.a)(0)}))).subscribe((function(){}));var sr=function(e){function t(){var t=e.apply(this,arguments)||this;return t.name="TokenExpiredError",t}return w(t,e),t}(Error),cr=function(e){function t(t,n,r,o,i,a,u,s){return e.call(this,(function(e){return new fr(t,n,r,o,u,s,e,i,a)}))||this}return w(t,e),t}(i.a),lr=0,fr=function(e){function t(t,n,r,o,i,a,u,s,c){var l=e.call(this,(function(){return l.teardown()}))||this;return l.id=++lr,console.debug("New WebSocket Connection",l.id,i?"authorized":"unauthorized"),l.databaseUrl=t,l.rev=n,l.realmSetHash=r,l.clientIdentity=o,l.token=i,l.tokenExpiration=a,l.subscriber=u,l.lastUserActivity=new Date,l.messageProducer=s,l.messageProducerSubscription=null,l.webSocketStatus=c,l.connect(),l}return w(t,e),t.prototype.teardown=function(){console.debug("Teardown WebSocket Connection",this.id),this.disconnect()},t.prototype.disconnect=function(){if(this.webSocketStatus.next("disconnected"),this.pinger&&(clearInterval(this.pinger),this.pinger=null),this.ws)try{this.ws.close()}catch(Co){}this.ws=null,this.messageProducerSubscription&&(this.messageProducerSubscription.unsubscribe(),this.messageProducerSubscription=null)},t.prototype.reconnect=function(){this.disconnect(),this.connect()},t.prototype.connect=function(){return x(this,void 0,void 0,(function(){var e,t,n,r=this;return j(this,(function(o){switch(o.label){case 0:if(this.webSocketStatus.next("connecting"),this.lastServerActivity=new Date,this.pauseUntil&&this.pauseUntil>new Date)return console.debug("WS not reconnecting just yet",{id:this.id,pauseUntil:this.pauseUntil}),[2];if(this.ws)throw new Error("Called connect() when a connection is already open");if(!this.databaseUrl)throw new Error("Cannot connect without a database URL");if(this.closed)return[2];if(this.tokenExpiration&&this.tokenExpiration<new Date)return this.subscriber.error(new sr),[2];if(this.pinger=setInterval((function(){return x(r,void 0,void 0,(function(){var e=this;return j(this,(function(t){if(this.closed)return console.debug("pinger check",this.id,"CLOSED."),this.teardown(),[2];if(this.ws)try{this.ws.send(JSON.stringify({type:"ping"})),setTimeout((function(){if(console.debug("pinger setTimeout",e.id,e.pinger?"alive":"dead"),e.pinger)return e.closed?(console.debug("pinger setTimeout",e.id,"subscription is closed"),void e.teardown()):void(e.lastServerActivity<new Date(Date.now()-2e4)?(console.debug("pinger: server is inactive"),console.debug("pinger reconnecting"),e.reconnect()):console.debug("pinger: server still active"))}),2e4)}catch(Jt){console.debug("pinger catch error",this.id,"reconnecting"),this.reconnect()}else console.debug("pinger",this.id,"reconnecting"),this.reconnect();return[2]}))}))}),3e4),(e=new URL(this.databaseUrl)).protocol="http:"===e.protocol?"ws":"wss",t=new URLSearchParams,this.subscriber.closed)return[2];t.set("v","2"),t.set("rev",this.rev),t.set("realmsHash",this.realmSetHash),t.set("clientId",this.clientIdentity),this.token&&t.set("token",this.token),console.debug("dexie-cloud WebSocket create"),(n=this.ws=new WebSocket("".concat(e,"/changes?").concat(t))).onclose=function(e){r.pinger&&(console.debug("dexie-cloud WebSocket onclosed",r.id),r.reconnect())},n.onmessage=function(e){if(r.pinger){console.debug("dexie-cloud WebSocket onmessage",e.data),r.lastServerActivity=new Date;try{var t=dn.parse(e.data);if("error"===t.type)throw new Error("Error message from dexie-cloud: ".concat(t.error));"rev"===t.type&&(r.rev=t.rev),"pong"!==t.type&&r.subscriber.next(t)}catch(ro){r.subscriber.error(ro)}}},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,new Promise((function(e,t){n.onopen=function(t){console.debug("dexie-cloud WebSocket onopen"),e(null)},n.onerror=function(e){var n=e.error||new Error("WebSocket Error");r.disconnect(),r.subscriber.error(n),r.webSocketStatus.next("error"),t(n)}}))];case 2:return o.sent(),this.messageProducerSubscription=this.messageProducer.subscribe((function(e){var t;r.closed||("ready"===e.type&&"connected"!==r.webSocketStatus.value&&r.webSocketStatus.next("connected"),null===(t=r.ws)||void 0===t||t.send(dn.stringify(e)))})),[3,4];case 3:return o.sent(),this.pauseUntil=new Date(Date.now()+6e4),[3,4];case 4:return[2]}}))}))},t}(d.b);function dr(e){var t;if(!(null===(t=e.cloud.options)||void 0===t?void 0:t.databaseUrl))throw new Error("No database URL to connect WebSocket to");var n=e.messageConsumer.readyToServe.pipe(Ye((function(e){return e})),Xe((function(){return e.getPersistedSyncState()})),Ye((function(e){return e&&e.serverRevision})),Le((function(e){return{type:"ready",rev:e.serverRevision}})));return function t(){var r=this;return e.cloud.persistedSyncState.pipe(Ye((function(e){return null===e||void 0===e?void 0:e.serverRevision})),ze(1),Xe((function(t){return e.cloud.currentUser.pipe(Le((function(e){return[e,t]})))})),Xe((function(e){var t=e[0],n=e[1];return rr.pipe(Le((function(e){return[e?t:null,n]})))})),Xe((function(e){var t=e[0],n=e[1];return x(r,void 0,void 0,(function(){var e;return j(this,(function(r){switch(r.label){case 0:return e=[t],[4,Ot(n)];case 1:return[2,e.concat([r.sent()])]}}))}))})),Xe((function(t){var r=t[0],o=t[1];return r?new cr(e.cloud.options.databaseUrl,e.cloud.persistedSyncState.value.serverRevision,o,e.cloud.persistedSyncState.value.clientIdentity,n,e.cloud.webSocketStatus,r.accessToken,r.accessTokenExpiration):Object(s.a)([])})),De((function(n){return"TokenExpiredError"===(null===n||void 0===n?void 0:n.name)?(console.debug("WebSocket observable: Token expired. Refreshing token..."),Object(c.a)(!0).pipe(Xe((function(){return x(r,void 0,void 0,(function(){var t,n;return j(this,(function(r){switch(r.label){case 0:return[4,e.getCurrentUser()];case 1:return t=r.sent(),[4,ht(e.cloud.options.databaseUrl,t)];case 2:return n=r.sent(),[4,e.table("$logins").update(t.userId,{accessToken:n.accessToken,accessTokenExpiration:n.accessTokenExpiration})];case 3:return r.sent(),[2]}}))}))})),Xe((function(){return t()})))):Object(h.a)(n)})),De((function(e){return Object(s.a)(function(e){return x(this,void 0,void 0,(function(){return j(this,(function(t){switch(t.label){case 0:return console.error("WebSocket observable: error but revive when user does some active thing...",e),[4,(n=3e3,new Promise((function(e){return setTimeout(e,n)})))];case 1:return t.sent(),console.debug("waiting for someone to do something"),[4,ur.pipe(ze(1)).toPromise()];case 2:return t.sent(),console.debug("someone did something!"),[2]}var n}))}))}(e)).pipe(Xe((function(){return t()})))})))}().subscribe((function(t){t&&(console.debug("WS got message",t),e.messageConsumer.enqueue(t))}),(function(e){console.error("Oops! The main observable errored!",e)}),(function(){console.error("Oops! The main observable completed!")}))}function hr(e){var t;return x(this,void 0,void 0,(function(){var n;return j(this,(function(r){switch(r.label){case 0:return(null===(t=e.cloud.options)||void 0===t?void 0:t.databaseUrl)&&e.cloud.schema?[4,kn(e,e.cloud.options,e.cloud.schema,{justCheckIfNeeded:!0})]:[3,2];case 1:return n=r.sent(),[3,3];case 2:n=!1,r.label=3;case 3:return[2,n]}}))}))}var pr=new WeakMap;function vr(e,t,n,r){var o=pr.get(e);if(o){if(o.pull||"push"===(null===r||void 0===r?void 0:r.purpose))return console.debug("syncIfPossible(): returning the ongoing sync promise."),o.promise;var i=!1,a=e.cloud.syncState.subscribe((function(e){"pulling"===e.phase&&(i=!0)}));return o.promise.then((function(){a.unsubscribe()})).catch((function(e){return a.unsubscribe(),Promise.reject(e)})).then((function(){if(!i)return vr(e,t,n,r)}))}var u=function(){return x(this,void 0,void 0,(function(){var o;return j(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),e.cloud.usingServiceWorker?Kn?[4,kn(e,t,n,r)]:[3,2]:[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return[4,Xn(e,"currentSyncWorker","$jobs",(function(){return kn(e,t,n,r)}))];case 4:i.sent(),i.label=5;case 5:return pr.delete(e),console.debug("Done sync"),[3,7];case 6:throw o=i.sent(),pr.delete(e),console.error("Failed to sync client changes",o),o;case 7:return[2]}}))}))}();return pr.set(e,{promise:u,pull:"push"!==(null===r||void 0===r?void 0:r.purpose)}),u}function br(e,t,n){var r=null,o={cancelled:!1};function i(r,u){void 0===u&&(u=1),setTimeout((function(){vr(e,t,n,{cancelToken:o,retryImmediatelyOnFetchError:!0,purpose:r}).catch((function(e){console.error("error in syncIfPossible()",e),o.cancelled?a():u<3&&setTimeout((function(){return i(r,u+1)}),6e4*[0,5,15][u])}))}),0)}var a=function(){console.debug("Stopping LocalSyncWorker"),o.cancelled=!0,r&&r.unsubscribe()};return{start:function(){console.debug("Starting LocalSyncWorker",e.localSyncEvent.id),r=e.localSyncEvent.subscribe((function(e){var t=e.purpose;try{i(t||"pull")}catch(n){console.error("What-the....",n)}}))},stop:a}}function yr(e,t){if(e&&t&&t.unsyncedTables)for(var n=0,r=t.unsyncedTables;n<r.length;n++){var o=r[n];e[o]&&(e[o].markedForSync=!1)}}var mr,gr,wr,_r,xr={},jr=[],kr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function Sr(e,t){for(var n in t)e[n]=t[n];return e}function Or(e){var t=e.parentNode;t&&t.removeChild(e)}function Ir(e,t,n){var r,o,i,a=arguments,u={};for(i in t)"key"==i?r=t[i]:"ref"==i?o=t[i]:u[i]=t[i];if(arguments.length>3)for(n=[n],i=3;i<arguments.length;i++)n.push(a[i]);if(null!=n&&(u.children=n),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===u[i]&&(u[i]=e.defaultProps[i]);return Er(e,u,r,o,null)}function Er(e,t,n,r,o){var i={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==o?++mr.__v:o};return null!=mr.vnode&&mr.vnode(i),i}function Pr(e){return e.children}function Cr(e,t){this.props=e,this.context=t}function Ar(e,t){if(null==t)return e.__?Ar(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?Ar(e):null}function Tr(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return Tr(e)}}function Dr(e){(!e.__d&&(e.__d=!0)&&gr.push(e)&&!Rr.__r++||_r!==mr.debounceRendering)&&((_r=mr.debounceRendering)||wr)(Rr)}function Rr(){for(var e;Rr.__r=gr.length;)e=gr.sort((function(e,t){return e.__v.__b-t.__v.__b})),gr=[],e.some((function(e){var t,n,r,o,i,a;e.__d&&(i=(o=(t=e).__v).__e,(a=t.__P)&&(n=[],(r=Sr({},o)).__v=o.__v+1,Wr(a,o,r,t.__n,void 0!==a.ownerSVGElement,null!=o.__h?[i]:null,n,null==i?Ar(o):i,o.__h),qr(n,o),o.__e!=i&&Tr(o)))}))}function Nr(e,t,n,r,o,i,a,u,s,c){var l,f,d,h,p,v,b,y=r&&r.__k||jr,m=y.length;for(n.__k=[],l=0;l<t.length;l++)if(null!=(h=n.__k[l]=null==(h=t[l])||"boolean"==typeof h?null:"string"==typeof h||"number"==typeof h||"bigint"==typeof h?Er(null,h,null,null,h):Array.isArray(h)?Er(Pr,{children:h},null,null,null):h.__b>0?Er(h.type,h.props,h.key,null,h.__v):h)){if(h.__=n,h.__b=n.__b+1,null===(d=y[l])||d&&h.key==d.key&&h.type===d.type)y[l]=void 0;else for(f=0;f<m;f++){if((d=y[f])&&h.key==d.key&&h.type===d.type){y[f]=void 0;break}d=null}Wr(e,h,d=d||xr,o,i,a,u,s,c),p=h.__e,(f=h.ref)&&d.ref!=f&&(b||(b=[]),d.ref&&b.push(d.ref,null,h),b.push(f,h.__c||p,h)),null!=p?(null==v&&(v=p),"function"==typeof h.type&&null!=h.__k&&h.__k===d.__k?h.__d=s=Kr(h,s,e):s=Br(e,h,d,y,p,s),c||"option"!==n.type?"function"==typeof n.type&&(n.__d=s):e.value=""):s&&d.__e==s&&s.parentNode!=e&&(s=Ar(d))}for(n.__e=v,l=m;l--;)null!=y[l]&&("function"==typeof n.type&&null!=y[l].__e&&y[l].__e==n.__d&&(n.__d=Ar(r,l+1)),Hr(y[l],y[l]));if(b)for(l=0;l<b.length;l++)zr(b[l],b[++l],b[++l])}function Kr(e,t,n){var r,o;for(r=0;r<e.__k.length;r++)(o=e.__k[r])&&(o.__=e,t="function"==typeof o.type?Kr(o,t,n):Br(n,o,o,e.__k,o.__e,t));return t}function Br(e,t,n,r,o,i){var a,u,s;if(void 0!==t.__d)a=t.__d,t.__d=void 0;else if(null==n||o!=i||null==o.parentNode)e:if(null==i||i.parentNode!==e)e.appendChild(o),a=null;else{for(u=i,s=0;(u=u.nextSibling)&&s<r.length;s+=2)if(u==o)break e;e.insertBefore(o,i),a=i}return void 0!==a?a:o.nextSibling}function Ur(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||kr.test(t)?n:n+"px"}function Lr(e,t,n,r,o){var i;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||Ur(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||Ur(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])i=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=n,n?r||e.addEventListener(t,i?Fr:Mr,i):e.removeEventListener(t,i?Fr:Mr,i);else if("dangerouslySetInnerHTML"!==t){if(o)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function Mr(e){this.l[e.type+!1](mr.event?mr.event(e):e)}function Fr(e){this.l[e.type+!0](mr.event?mr.event(e):e)}function Wr(e,t,n,r,o,i,a,u,s){var c,l,f,d,h,p,v,b,y,m,g,w=t.type;if(void 0!==t.constructor)return null;null!=n.__h&&(s=n.__h,u=t.__e=n.__e,t.__h=null,i=[u]),(c=mr.__b)&&c(t);try{e:if("function"==typeof w){if(b=t.props,y=(c=w.contextType)&&r[c.__c],m=c?y?y.props.value:c.__:r,n.__c?v=(l=t.__c=n.__c).__=l.__E:("prototype"in w&&w.prototype.render?t.__c=l=new w(b,m):(t.__c=l=new Cr(b,m),l.constructor=w,l.render=Vr),y&&y.sub(l),l.props=b,l.state||(l.state={}),l.context=m,l.__n=r,f=l.__d=!0,l.__h=[]),null==l.__s&&(l.__s=l.state),null!=w.getDerivedStateFromProps&&(l.__s==l.state&&(l.__s=Sr({},l.__s)),Sr(l.__s,w.getDerivedStateFromProps(b,l.__s))),d=l.props,h=l.state,f)null==w.getDerivedStateFromProps&&null!=l.componentWillMount&&l.componentWillMount(),null!=l.componentDidMount&&l.__h.push(l.componentDidMount);else{if(null==w.getDerivedStateFromProps&&b!==d&&null!=l.componentWillReceiveProps&&l.componentWillReceiveProps(b,m),!l.__e&&null!=l.shouldComponentUpdate&&!1===l.shouldComponentUpdate(b,l.__s,m)||t.__v===n.__v){l.props=b,l.state=l.__s,t.__v!==n.__v&&(l.__d=!1),l.__v=t,t.__e=n.__e,t.__k=n.__k,t.__k.forEach((function(e){e&&(e.__=t)})),l.__h.length&&a.push(l);break e}null!=l.componentWillUpdate&&l.componentWillUpdate(b,l.__s,m),null!=l.componentDidUpdate&&l.__h.push((function(){l.componentDidUpdate(d,h,p)}))}l.context=m,l.props=b,l.state=l.__s,(c=mr.__r)&&c(t),l.__d=!1,l.__v=t,l.__P=e,c=l.render(l.props,l.state,l.context),l.state=l.__s,null!=l.getChildContext&&(r=Sr(Sr({},r),l.getChildContext())),f||null==l.getSnapshotBeforeUpdate||(p=l.getSnapshotBeforeUpdate(d,h)),g=null!=c&&c.type===Pr&&null==c.key?c.props.children:c,Nr(e,Array.isArray(g)?g:[g],t,n,r,o,i,a,u,s),l.base=t.__e,t.__h=null,l.__h.length&&a.push(l),v&&(l.__E=l.__=null),l.__e=!1}else null==i&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=$r(n.__e,t,n,r,o,i,a,s);(c=mr.diffed)&&c(t)}catch(e){t.__v=null,(s||null!=i)&&(t.__e=u,t.__h=!!s,i[i.indexOf(u)]=null),mr.__e(e,t,n)}}function qr(e,t){mr.__c&&mr.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){mr.__e(e,t.__v)}}))}function $r(e,t,n,r,o,i,a,u){var s,c,l,f,d=n.props,h=t.props,p=t.type,v=0;if("svg"===p&&(o=!0),null!=i)for(;v<i.length;v++)if((s=i[v])&&(s===e||(p?s.localName==p:3==s.nodeType))){e=s,i[v]=null;break}if(null==e){if(null===p)return document.createTextNode(h);e=o?document.createElementNS("http://www.w3.org/2000/svg",p):document.createElement(p,h.is&&h),i=null,u=!1}if(null===p)d===h||u&&e.data===h||(e.data=h);else{if(i=i&&jr.slice.call(e.childNodes),c=(d=n.props||xr).dangerouslySetInnerHTML,l=h.dangerouslySetInnerHTML,!u){if(null!=i)for(d={},f=0;f<e.attributes.length;f++)d[e.attributes[f].name]=e.attributes[f].value;(l||c)&&(l&&(c&&l.__html==c.__html||l.__html===e.innerHTML)||(e.innerHTML=l&&l.__html||""))}if(function(e,t,n,r,o){var i;for(i in n)"children"===i||"key"===i||i in t||Lr(e,i,null,n[i],r);for(i in t)o&&"function"!=typeof t[i]||"children"===i||"key"===i||"value"===i||"checked"===i||n[i]===t[i]||Lr(e,i,t[i],n[i],r)}(e,h,d,o,u),l)t.__k=[];else if(v=t.props.children,Nr(e,Array.isArray(v)?v:[v],t,n,r,o&&"foreignObject"!==p,i,a,e.firstChild,u),null!=i)for(v=i.length;v--;)null!=i[v]&&Or(i[v]);u||("value"in h&&void 0!==(v=h.value)&&(v!==e.value||"progress"===p&&!v)&&Lr(e,"value",v,d.value,!1),"checked"in h&&void 0!==(v=h.checked)&&v!==e.checked&&Lr(e,"checked",v,d.checked,!1))}return e}function zr(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){mr.__e(e,n)}}function Hr(e,t,n){var r,o,i;if(mr.unmount&&mr.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||zr(r,null,t)),n||"function"==typeof e.type||(n=null!=(o=e.__e)),e.__e=e.__d=void 0,null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){mr.__e(e,t)}r.base=r.__P=null}if(r=e.__k)for(i=0;i<r.length;i++)r[i]&&Hr(r[i],t,n);null!=o&&Or(o)}function Vr(e,t,n){return this.constructor(e,n)}mr={__e:function(e,t){for(var n,r,o;t=t.__;)if((n=t.__c)&&!n.__)try{if((r=n.constructor)&&null!=r.getDerivedStateFromError&&(n.setState(r.getDerivedStateFromError(e)),o=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e),o=n.__d),o)return n.__E=n}catch(t){e=t}throw e},__v:0},Cr.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=Sr({},this.state),"function"==typeof e&&(e=e(Sr({},n),this.props)),e&&Sr(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),Dr(this))},Cr.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Dr(this))},Cr.prototype.render=Pr,gr=[],wr="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Rr.__r=0;var Gr={Error:{color:"red"},Alert:{error:{color:"red"},warning:{color:"yellow"},info:{color:"black"}},Darken:{position:"fixed",top:0,left:0,opacity:.5,backgroundColor:"#000",width:"100vw",height:"100vh",zIndex:150,webkitBackdropFilter:"blur(2px)",backdropFilter:"blur(2px)"},DialogOuter:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:150,alignItems:"center",display:"flex",justifyContent:"center"},DialogInner:{position:"relative",color:"#222",backgroundColor:"#fff",padding:"30px",marginBottom:"2em",maxWidth:"90%",maxHeight:"90%",overflowY:"auto",border:"3px solid #3d3d5d",borderRadius:"8px",boxShadow:"0 0 80px 10px #666",width:"auto"},Input:{height:"35px",width:"17em",borderColor:"#ccf4",outline:"none",fontSize:"17pt",padding:"8px"}};function Yr(e){var t=e.children;return Ir("div",null,Ir("div",{style:Gr.Darken}),Ir("div",{style:Gr.DialogOuter},Ir("div",{style:Gr.DialogInner},t)))}var Jr,Qr,Xr,Zr=0,eo=[],to=mr.__b,no=mr.__r,ro=mr.diffed,oo=mr.__c,io=mr.unmount;function ao(e,t){mr.__h&&mr.__h(Qr,e,Zr||t),Zr=0;var n=Qr.__H||(Qr.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function uo(e){return Zr=1,function(e,t,n){var r=ao(Jr++,2);return r.t=e,r.__c||(r.__=[n?n(t):vo(void 0,t),function(e){var t=r.t(r.__[0],e);r.__[0]!==t&&(r.__=[t,r.__[1]],r.__c.setState({}))}],r.__c=Qr),r.__}(vo,e)}function so(e){return Zr=5,function(e,t){var n=ao(Jr++,7);return po(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}((function(){return{current:e}}),[])}function co(){eo.forEach((function(e){if(e.__P)try{e.__H.__h.forEach(fo),e.__H.__h.forEach(ho),e.__H.__h=[]}catch(Qr){e.__H.__h=[],mr.__e(Qr,e.__v)}})),eo=[]}mr.__b=function(e){Qr=null,to&&to(e)},mr.__r=function(e){no&&no(e),Jr=0;var t=(Qr=e.__c).__H;t&&(t.__h.forEach(fo),t.__h.forEach(ho),t.__h=[])},mr.diffed=function(e){ro&&ro(e);var t=e.__c;t&&t.__H&&t.__H.__h.length&&(1!==eo.push(t)&&Xr===mr.requestAnimationFrame||((Xr=mr.requestAnimationFrame)||function(e){var t,n=function(){clearTimeout(r),lo&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);lo&&(t=requestAnimationFrame(n))})(co)),Qr=void 0},mr.__c=function(e,t){t.some((function(e){try{e.__h.forEach(fo),e.__h=e.__h.filter((function(e){return!e.__||ho(e)}))}catch(Xr){t.some((function(e){e.__h&&(e.__h=[])})),t=[],mr.__e(Xr,e.__v)}})),oo&&oo(e,t)},mr.unmount=function(e){io&&io(e);var t=e.__c;if(t&&t.__H)try{t.__H.__.forEach(fo)}catch(e){mr.__e(e,t.__v)}};var lo="function"==typeof requestAnimationFrame;function fo(e){var t=Qr;"function"==typeof e.__c&&e.__c(),Qr=t}function ho(e){var t=Qr;e.__c=e.__(),Qr=t}function po(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function vo(e,t){return"function"==typeof t?t(e):t}function bo(e){var t=e.title,n=e.alerts,r=e.fields,o=e.onCancel,i=e.onSubmit,a=uo({}),u=a[0],s=a[1],c=so();return function(e,t){var n=ao(Jr++,4);!mr.__s&&po(n.__H,t)&&(n.__=e,n.__H=t,Qr.__h.push(n))}((function(){var e;return null===(e=c.current)||void 0===e?void 0:e.focus()}),[]),Ir(Yr,null,Ir(Pr,null,Ir("h3",{style:Gr.WindowHeader},t),n.map((function(e){return Ir("p",{style:Gr.Alert[e.type]},function(e){var t=e.message;e.messageCode;var n=e.messageParams;return t.replace(/\{\w+\}/gi,(function(e){return n[e.substr(1,e.length-2)]}))}(e))})),Ir("form",{onSubmit:function(e){e.preventDefault(),i(u)}},Object.entries(r).map((function(e,t){var n=e[0],r=e[1],o=r.type,i=r.label,a=r.placeholder;return Ir("label",{style:Gr.Label},i?"".concat(i,": "):"",Ir("input",{ref:0===t?c:void 0,type:o,name:n,autoComplete:"on",style:Gr.Input,autoFocus:!0,placeholder:a,value:u[n]||"",onInput:function(e){var t,r;return s(_(_({},u),((t={})[n]=function(e,t){switch(e){case"email":return t.toLowerCase();case"otp":return t.toUpperCase();default:return t}}(o,null===(r=e.target)||void 0===r?void 0:r.value),t)))}}))})))),Ir("div",{style:Gr.ButtonsDiv},Ir("button",{type:"submit",style:Gr.Button,onClick:function(){return i(u)}},"Submit"),Ir("button",{style:Gr.Button,onClick:o},"Cancel")))}var yo=function(e){function t(t){var n=e.call(this,t)||this;return n.observer=function(e){return n.setState({userInteraction:e})},n.state={userInteraction:void 0},n}return w(t,e),t.prototype.componentDidMount=function(){this.subscription=Object(s.a)(this.props.db.cloud.userInteraction).subscribe(this.observer)},t.prototype.componentWillUnmount=function(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)},t.prototype.render=function(e,t){var n=t.userInteraction;return n?Ir(bo,_({},n)):null},t}(Cr);function mo(e){var t=document.createElement("div");document.body.appendChild(t),function(e,t,n){var r,o,i;mr.__&&mr.__(e,t),o=(r="function"==typeof n)?null:n&&n.__k||t.__k,i=[],Wr(t,e=(!r&&n||t).__k=Ir(Pr,null,[e]),o||xr,xr,void 0!==t.ownerSVGElement,!r&&n?[n]:o?null:t.firstChild?jr.slice.call(t.childNodes):null,i,!r&&n?n:o?o.__e:t.firstChild,r),qr(i,e)}(Ir(yo,{db:e.vip}),t);var n=!1;return{unsubscribe:function(){t.remove(),n=!0},get closed(){return n}}}function go(e){var t=new WeakMap;return function(n){var r=t.get(n);return r||(r=e(n),t.set(n,r)),r}}function wo(e,t){var n=t,r=Object(s.a)(e).pipe(Object(v.a)((function(e){return n=e})),Object(b.a)({resetOnRefCountZero:function(){return Object(y.a)(1e3)}})),o=new i.a((function(e){var t=!1,o=r.subscribe({next:function(n){t=!0,e.next(n)},error:function(t){e.error(t)},complete:function(){e.complete()}});return t||o.closed||e.next(n),o}));return o.getValue=function(){return n},o}var _o=go((function(e){return new a.a(_t)})),xo=go((function(e){return wo(_o(e._novip).pipe(Xe((function(t){return Object(o.liveQuery)((function(){return e.transaction("r","realms","members",(function(){return Promise.all([e.members.where({userId:t.userId}).toArray(),e.realms.toArray(),t.userId]).then((function(e){return{selfMembers:e[0],realms:e[1],userId:e[2]}}))}))}))}))),{selfMembers:[],realms:[],get userId(){return e.cloud.currentUserId}})}));function jo(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return{};var n=e.reduce((function(e,t){for(var n=_({},e),r=0,o=Object.entries(t);r<o.length;r++){var i=o[r],a=i[0],u=i[1];if(a in n&&n[a]){if("*"===n[a])continue;if("*"===u)n[a]="*";else if(Array.isArray(u)&&Array.isArray(n[a])){var s=n,c=s[a];s[a]=k([],new Set(k(k([],c,!0),u,!0)),!0)}else if("object"===typeof u&&u&&"object"===typeof n[a])for(var l=n[a],f=0,d=Object.entries(u);f<d.length;f++){var h=d[f],p=h[0],v=h[1];"*"!==l[p]&&("*"===v?l[p]="*":Array.isArray(l[p])&&Array.isArray(v)&&(l[p]=k([],new Set(k(k([],l[p],!0),v,!0)),!0)))}}else n[a]=t[a]}return n}));return n}var ko=go((function(e){return function(e,t){var n,r=e.pipe(Object(v.a)((function(e){return n=t(e)})));return r.getValue=function(){return void 0!==n?n:n=t(e.getValue())},r}(xo(e._novip),(function(e){var t,n=e.selfMembers,r=e.realms,o=e.userId;return r.map((function(e){return _(_({},e),{permissions:e.owner===o?{manage:"*"}:jo.apply(void 0,n.filter((function(t){return t.realmId===e.realmId})).map((function(e){return e.permissions})).filter((function(e){return e})))})})).reduce((function(e,t){var n;return _(_({},e),((n={})[t.realmId]=t,n))}),((t={})[o]={realmId:o,owner:o,name:o,permissions:{manage:"*"}},t))}))})),So=function(){function e(e,t,n){this.permissions=e||{},this.tableName=t,this.isOwner=n}return e.prototype.add=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return"*"===this.permissions.manage||(!!(null===(e=this.permissions.manage)||void 0===e?void 0:e.includes(this.tableName))||("*"===this.permissions.add||!!n.every((function(e){var n;return null===(n=t.permissions.add)||void 0===n?void 0:n.includes(e)}))))},e.prototype.update=function(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(this.isOwner||"*"===this.permissions.manage)return!0;if(null===(e=this.permissions.manage)||void 0===e?void 0:e.includes(this.tableName))return!0;if("*"===this.permissions.update)return n.every((function(e){return"owner"!==e}));var o=null===(t=this.permissions.update)||void 0===t?void 0:t[this.tableName];return"*"===o?n.every((function(e){return"owner"!==e})):n.every((function(e){return null===o||void 0===o?void 0:o.some((function(t){return t===e||"*"===t&&"owner"!==e}))}))},e.prototype.delete=function(){var e;return!(!this.isOwner&&"*"!==this.permissions.manage)||!!(null===(e=this.permissions.manage)||void 0===e?void 0:e.includes(this.tableName))},e}();var Oo=go((function(e){var t=_o(e._novip).pipe(Object(m.a)((function(t){return Object(o.liveQuery)((function(){return e.members.where({email:t.email||""}).toArray()}))}))),n=ko(e._novip),r=xo(e._novip);return wo(Object(p.a)([t,r,n]).pipe(Object(v.a)((function(e){var t=e[0],n=e[1],r=e[2],o=function(e,t){var n;return _(_({},e),((n={})[t.id]=_(_({},t),{realm:r[t.realmId]}),n))},i=t.reduce(o,{}),a=n.selfMembers.reduce(o,i);return Object.values(a).filter((function(e){return!e.accepted}))}))),[])}));function Io(e){return"rlm~"+e}var Eo={nameSuffix:!0};function Po(e){var t=this,n=e.name,r=_o(e),i=[],u=!1,f=null;e.on("ready",(function(e){return x(t,void 0,void 0,(function(){var t;return j(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,b(e)];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),console.error(t),[3,3];case 3:return[2]}}))}))}),!0);var d,h=!1;function v(){if(h)throw new o.default.DatabaseClosedError}function b(e){var t,n,a,s,d,b;return x(this,void 0,void 0,(function(){var y,m,g,w,k=this;return j(this,(function(S){switch(S.label){case 0:return h=!1,y=An(e),Kn||((null===(t=y.cloud.options)||void 0===t?void 0:t.customLoginGui)||i.push(mo(e)),i.push(function(e){var t=e.cloud.webSocketStatus.value,n=e.cloud.webSocketStatus.pipe(Xe((function(e){var n=t;t=e;var r=Object(c.a)(e);switch(e){case"disconnected":return nr.value?r.pipe(We(500)):r;case"connecting":return"not-started"===n||"error"===n?r:r.pipe(We(4e3));default:return r}})));return Object(p.a)([n,e.syncStateChangedEvent.pipe(Qe({phase:"initial"})),rr]).pipe(Le((function(t){var n=t[0],r=t[1],o=t[2],i=r.phase,a=r.error,u=r.progress,s=n;return"error"===i&&(s="error"),"not-started"===n&&("pushing"!==i&&"pulling"!==i||(s="connecting")),"error"!==e.cloud.syncState.value.phase||"pushing"!==r.phase&&"pulling"!==r.phase||(s="connecting"),o||(s="disconnected"),{phase:i,error:a,progress:u,status:gn?s:"offline"}})))}(y).subscribe(e.cloud.syncState))),y.tables.every((function(e){return e.core}))||Bn(),"serviceWorker"in navigator?[4,navigator.serviceWorker.getRegistrations()]:[3,2];case 1:return g=S.sent(),[3,3];case 2:g=[],S.label=3;case 3:return m=g,[4,y.transaction("rw",y.$syncState,(function(){return x(k,void 0,void 0,(function(){var e,t,n,r,o,i,a,s,c,l,f,d,h,p,v,b;return j(this,(function(g){switch(g.label){case 0:return e=y.cloud,t=e.options,n=e.schema,[4,Promise.all([y.getOptions(),y.getSchema(),y.getPersistedSyncState()])];case 1:return r=g.sent(),o=r[0],i=r[1],a=r[2],u?[3,2]:(y.cloud.options=o||null,[3,4]);case 2:if(o&&JSON.stringify(o)===JSON.stringify(t))return[3,4];if(!t)throw new Error("Internal error");return[4,y.$syncState.put(t,"options")];case 3:g.sent(),g.label=4;case 4:return(null===(v=y.cloud.options)||void 0===v?void 0:v.tryUseServiceWorker)&&"serviceWorker"in navigator&&m.length>0&&!Nn?(console.debug("Dexie Cloud Addon: Using service worker"),y.cloud.usingServiceWorker=!0):((null===(b=y.cloud.options)||void 0===b?void 0:b.tryUseServiceWorker)&&!Kn&&console.debug("dexie-cloud-addon: Not using service worker.",0===m.length?"No SW registrations found.":"serviceWorker"in navigator&&Nn?"Avoiding SW background sync and SW periodic bg sync for this browser due to browser bugs.":"navigator.serviceWorker not present"),y.cloud.usingServiceWorker=!1),yr(n,y.cloud.options),yr(i,y.cloud.options),n?[3,5]:(y.cloud.schema=i||null,[3,7]);case 5:if(i&&JSON.stringify(i)===JSON.stringify(n))return[3,7];for(s=i||{},c=0,l=Object.entries(n);c<l.length;c++)f=l[c],d=f[0],h=f[1],(p=s[d])?(p.markedForSync=h.markedForSync,h.deleted=p.deleted,p.generatedGlobalId=h.generatedGlobalId):s[d]=_({},h);return[4,y.$syncState.put(s,"schema")];case 6:g.sent(),Object.assign(n,s),g.label=7;case 7:return[2,null===a||void 0===a?void 0:a.initiallySynced]}}))}))}))];case 4:return(w=S.sent())&&y.setInitiallySynced(!0),function(e){for(var t,n,r=0,i=e.tables;r<i.length;r++){var a=i[r];if(null===(n=null===(t=e.cloud.schema)||void 0===t?void 0:t[a.name])||void 0===n?void 0:n.markedForSync){if(a.schema.primKey.auto)throw new o.default.SchemaError("Table ".concat(a.name," is both autoIncremented and synced. ")+"Use db.cloud.configure({unsyncedTables: [".concat(JSON.stringify(a.name),"]}) to blacklist it from sync"));if(!a.schema.primKey.keyPath)throw new o.default.SchemaError("Table ".concat(a.name," cannot be both synced and outbound. ")+"Use db.cloud.configure({unsyncedTables: [".concat(JSON.stringify(a.name),"]}) to blacklist it from sync"))}}}(y),!(null===(n=y.cloud.options)||void 0===n?void 0:n.databaseUrl)||w?[3,6]:[4,Zn(y,y.cloud.options,y.cloud.schema)];case 5:S.sent(),y.setInitiallySynced(!0),S.label=6;case 6:return v(),Kn?[3,8]:(i.push(Object(o.liveQuery)((function(){return y.getCurrentUser()})).subscribe(r)),i.push(Object(o.liveQuery)((function(){return y.getPersistedSyncState()})).subscribe(y.cloud.persistedSyncState)),[4,Object(p.a)([r.pipe(Je(1),ze(1)),y.cloud.persistedSyncState.pipe(Je(1),ze(1))]).toPromise()]);case 7:S.sent(),S.label=8;case 8:return(null===(a=y.cloud.options)||void 0===a?void 0:a.requireAuth)?[4,wt(y)]:[3,10];case 9:S.sent(),S.label=10;case 10:return f&&f.stop(),f=null,v(),y.cloud.usingServiceWorker&&(null===(s=y.cloud.options)||void 0===s?void 0:s.databaseUrl)?(rt(y,"push").catch((function(){})),function(e){var t;return x(this,void 0,void 0,(function(){var n,r,o;return j(this,(function(i){switch(i.label){case 0:return i.trys.push([0,8,,9]),[4,navigator.serviceWorker.ready];case 1:if(!(n=i.sent().periodicSync))return[3,6];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,n.register("dexie-cloud:".concat(e.name),null===(t=e.cloud.options)||void 0===t?void 0:t.periodicSync)];case 3:return i.sent(),console.debug("Dexie Cloud: Successfully registered periodicsync event for ".concat(e.name)),[3,5];case 4:return r=i.sent(),console.debug("Dexie Cloud: Failed to register periodic sync. Your PWA must be installed to allow background sync.",r),[3,5];case 5:return[3,7];case 6:console.debug("Dexie Cloud: periodicSync not supported."),i.label=7;case 7:return[3,9];case 8:return o=i.sent(),console.debug("Dexie Cloud: Could not register periodicSync for ".concat(e.name),o),[3,9];case 9:return[2]}}))}))}(y).catch((function(){}))):(null===(d=y.cloud.options)||void 0===d?void 0:d.databaseUrl)&&y.cloud.schema&&!Kn&&((f=br(y,y.cloud.options,y.cloud.schema)).start(),ot(y,"push")),v(),Kn||i.push(Object(l.a)(self,"online").subscribe((function(){console.debug("online!"),y.syncStateChangedEvent.next({phase:"not-in-sync"}),ot(y,"push")})),Object(l.a)(self,"offline").subscribe((function(){console.debug("offline!"),y.syncStateChangedEvent.next({phase:"offline"})}))),"undefined"!==typeof window&&!Kn&&(null===(b=y.cloud.options)||void 0===b?void 0:b.databaseUrl)&&i.push(dr(y)),[2]}}))}))}!function(e,t){e.on.close.subscribe(t);var n=e.close;e.close=function(){n.call(this),t()}}(e,(function(){i.forEach((function(e){return e.unsubscribe()})),h=!0,f&&f.stop(),f=null,r.next(_t)})),e.cloud={version:"4.0.0-beta.15",options:_({},Eo),schema:null,serverState:null,get currentUserId(){return r.value.userId||_t.userId},currentUser:r,syncState:new a.a({phase:"initial",status:"not-started"}),persistedSyncState:new a.a(void 0),userInteraction:new a.a(void 0),webSocketStatus:new a.a("not-started"),login:function(t){return x(this,void 0,void 0,(function(){var n;return j(this,(function(r){switch(r.label){case 0:return[4,(n=An(e)).cloud.sync()];case 1:return r.sent(),[4,wt(n,t)];case 2:return r.sent(),[2]}}))}))},invites:Oo(e),configure:function(t){t=e.cloud.options=_(_({},e.cloud.options),t),u=!0,t.databaseUrl&&t.nameSuffix&&(e.name="".concat(n,"-").concat(function(e){var t=new URL(e);return"/"===t.pathname?t.hostname.split(".")[0]:t.pathname.split("/")[1]}(t.databaseUrl)),An(e).reconfigure()),yr(e.cloud.schema,e.cloud.options)},sync:function(t){var n=void 0===t?{wait:!0,purpose:"push"}:t,r=n.wait,i=n.purpose;return x(this,void 0,void 0,(function(){var t,n,a,u,c=this;return j(this,(function(l){switch(l.label){case 0:return void 0===r&&(r=!0),t=An(e),"pull"!==i?[3,3]:(n=t.cloud.persistedSyncState.value,ot(t,i),r?[4,t.cloud.persistedSyncState.pipe(Ye((function(e){return null!=(null===e||void 0===e?void 0:e.timestamp)&&(!n||e.timestamp>n.timestamp)})),ze(1)).toPromise()]:[3,2]);case 1:if(null===(a=l.sent())||void 0===a?void 0:a.error)throw new Error("Sync error: "+a.error);l.label=2;case 2:return[3,6];case 3:return[4,hr(t)];case 4:return l.sent()?(u=t.cloud.persistedSyncState.value,ot(t,i),r?(console.debug("db.cloud.login() is waiting for sync completion..."),[4,Object(s.a)(Object(o.liveQuery)((function(){return x(c,void 0,void 0,(function(){var e,n;return j(this,(function(r){switch(r.label){case 0:return[4,hr(t)];case 1:return e=r.sent(),[4,t.getPersistedSyncState()];case 2:if((null===(n=r.sent())||void 0===n?void 0:n.timestamp)!==(null===u||void 0===u?void 0:u.timestamp)&&(null===n||void 0===n?void 0:n.error))throw new Error("Sync error: "+n.error);return[2,e]}}))}))}))).pipe(Ye((function(e){return!e})),ze(1)).toPromise()]):[3,6]):[3,6];case 5:l.sent(),console.debug("Done waiting for sync completion because we have nothing to push anymore"),l.label=6;case 6:return[2]}}))}))},permissions:function(t,n){return function(e,t,n){if(!t)throw new TypeError("Cannot check permissions of undefined or null. A Dexie Cloud object with realmId and owner expected.");var r=t.owner,o=t.realmId;if(!n){if("function"!==typeof t.table)throw new TypeError("Missing 'table' argument to permissions and table could not be extracted from entity");n=t.table()}var i=ko(e),a=function(t){var i=t[o||e.cloud.currentUserId];return new So(i?i.permissions:{},n,!r||r===e.cloud.currentUserId)},u=i.pipe(Le(a));return u.getValue=function(){return a(i.getValue())},u}(e._novip,t,n)}},e.Version.prototype._parseStoresSpec=o.default.override(e.Version.prototype._parseStoresSpec,(function(t){return Jn(t,e)})),e.Table.prototype.newId=function(t){var n=(void 0===t?{}:t).colocateWith,r=n&&n.substr(n.length-3);return qn(e.cloud.schema[this.name].idPrefix||"",r)},e.Table.prototype.idPrefix=function(){var e,t;return(null===(t=null===(e=this.db.cloud.schema)||void 0===e?void 0:e[this.name])||void 0===t?void 0:t.idPrefix)||""},e.use(Yn({currentUserObservable:e.cloud.currentUser,db:An(e)})),e.use((d=An(e),{stack:"dbcore",name:"implicitPropSetterMiddleware",level:1,create:function(e){return _(_({},e),{table:function(t){var n=e.table(t);return _(_({},n),{mutate:function(e){var r,o,i,a;if(e.trans.disableChangeTracking)return n.mutate(e);var u=e.trans;if((null===(o=null===(r=d.cloud.schema)||void 0===r?void 0:r[t])||void 0===o?void 0:o.markedForSync)&&("add"===e.type||"put"===e.type))for(var s=0,c=e.values;s<c.length;s++){var l=c[s];l.owner||(l.owner=u.currentUser.userId),l.realmId||(l.realmId=u.currentUser.userId);var f=null===(a=(i=n.schema.primaryKey).extractKey)||void 0===a?void 0:a.call(i,l);"string"===typeof f&&"#"===f[0]&&"put"===e.type&&(delete e.criteria,delete e.changeSpec,delete e.changeSpecs,l.$ts=Date.now())}return n.mutate(e)}})}})}})),e.use($n(An(e)))}Po.version="4.0.0-beta.15",o.default.Cloud=Po,t.a=Po}).call(this,n(93).Buffer,n(47))},4:function(e,t,n){"use strict";var r=n(51);n.d(t,"db",(function(){return r.a}));n(54),n(80),n(52)},51:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n(54).a)},52:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(9),o=n.n(r),i=n(13),a=n(55),u=n(81),s=n(73),c=n(72),l=n(8),f=n(28),d=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).id=void 0,e.realmId=void 0,e.owner=void 0,e.title=void 0,e}return Object(u.a)(n,[{key:"isSharable",value:function(){return this.realmId===Object(f.b)(this.id)}},{key:"isPrivate",value:function(){return"#"===this.id[0]}},{key:"makeSharable",value:function(){var e=Object(i.a)(o.a.mark((function e(){var t,n,r,a=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate()){e.next=2;break}throw new Error("Private lists cannot be made sharable");case 2:return t=this.realmId,n=Object(f.b)(this.id),r=this.db,e.next=7,this.db.transaction("rw",[r.todoLists,r.todoItems,r.realms],Object(i.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.realms.put({realmId:n,name:a.title,represents:"a to-do list"});case 2:return e.next=4,r.todoLists.update(a.id,{realmId:n});case 4:return e.next=6,r.todoItems.where({realmId:t,todoListId:a.id}).modify({realmId:n});case 6:case"end":return e.stop()}}),e)}))));case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unshareWithEveryone",value:function(){var e=Object(i.a)(o.a.mark((function e(){var t,n,r=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.db,n=Object(f.b)(this.id),e.next=4,t.transaction("rw",[t.todoLists,t.todoItems,t.members,t.realms],Object(i.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.todoItems.where({realmId:n,todoListId:r.id}).modify({realmId:t.cloud.currentUserId});case 2:return e.next=4,t.todoLists.update(r.id,{realmId:r.db.cloud.currentUserId});case 4:return e.next=6,t.members.where("realmId").equals(n).delete();case 6:return e.next=8,t.realms.delete(n);case 8:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"shareWith",value:function(){var e=Object(i.a)(o.a.mark((function e(t,n,r){var a,u=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.db,e.next=3,a.transaction("rw",[a.members,a.todoLists,a.todoItems,a.realms],Object(i.a)(o.a.mark((function e(){var i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=u.realmId,u.isSharable()){e.next=5;break}return e.next=4,u.makeSharable();case 4:i=e.sent;case 5:return e.next=7,u.db.members.add({realmId:i,name:t,email:n,invite:r,permissions:{add:["todoItems"],update:{todoItems:["done"]}}});case 7:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"unshareWith",value:function(){var e=Object(i.a)(o.a.mark((function e(t){var n,r=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.db,e.next=3,n.transaction("rw",[n.todoLists,n.todoItems,n.members,n.realms],Object(i.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.members.delete(t.id);case 2:return e.next=4,n.members.where({realmId:r.realmId}).filter((function(e){return e.userId!==n.cloud.currentUserId})).count();case 4:if(0!==e.sent){e.next=8;break}return e.next=8,r.unshareWithEveryone();case 8:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=Object(i.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.db,e.next=3,t.members.where({realmId:this.realmId,userId:t.cloud.currentUserId}).delete();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(i.a)(o.a.mark((function e(){var t,n=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.db,e.next=3,t.transaction("rw",[t.todoLists,t.todoItems,t.members,t.realms],(function(){t.todoItems.where({todoListId:n.id}).delete(),t.todoLists.delete(n.id);var e=Object(f.b)(n.id);t.members.where({realmId:e}).delete(),t.realms.delete(e)}));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(l.Entity)},54:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(55),o=n(56),i=n(73),a=n(72),u=n(8),s=n(28);var c=n(52),l=function(e){Object(i.a)(n,e);var t=Object(a.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this,"TodoDBCloud2",{addons:[s.a]})).todoLists=void 0,e.todoItems=void 0,e.openCloseStates=void 0,e.version(14).stores({todoLists:"@id",todoItems:"@id, [todoListId+realmId]",openCloseStates:""}),e.todoLists.mapToClass(c.a),e.on("populate",(function(){e.on("ready",(function(){Object(o.a)(e)}))})),e.cloud.configure({unsyncedTables:["openCloseStates"],databaseUrl:"https://z0lesejpr.dexie.cloud",tryUseServiceWorker:!0,requireAuth:!1}),e}return n}(u.default)},8:function(e,t,n){"use strict";n.r(t),n.d(t,"Dexie",(function(){return sr})),n.d(t,"Entity",(function(){return Bt})),n.d(t,"RangeSet",(function(){return Zn})),n.d(t,"cmp",(function(){return Gt})),n.d(t,"default",(function(){return sr})),n.d(t,"liveQuery",(function(){return dr})),n.d(t,"mergeRanges",(function(){return tr})),n.d(t,"rangesOverlap",(function(){return nr}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}var a="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,u=Object.keys,s=Array.isArray;function c(e,t){return"object"!==typeof t||u(t).forEach((function(n){e[n]=t[n]})),e}"undefined"===typeof Promise||a.Promise||(a.Promise=Promise);var l=Object.getPrototypeOf,f={}.hasOwnProperty;function d(e,t){return f.call(e,t)}function h(e,t){"function"===typeof t&&(t=t(l(e))),("undefined"===typeof Reflect?u:Reflect.ownKeys)(t).forEach((function(n){v(e,n,t[n])}))}var p=Object.defineProperty;function v(e,t,n,r){p(e,t,c(n&&d(n,"get")&&"function"===typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function b(e){return{from:function(t){return e.prototype=Object.create(t.prototype),v(e.prototype,"constructor",e),{extend:h.bind(null,e.prototype)}}}}var y=Object.getOwnPropertyDescriptor;function m(e,t){var n;return y(e,t)||(n=l(e))&&m(n,t)}var g=[].slice;function w(e,t,n){return g.call(e,t,n)}function _(e,t){return t(e)}function x(e){if(!e)throw new Error("Assertion Failed")}function j(e){a.setImmediate?setImmediate(e):setTimeout(e,0)}function k(e,t){return e.reduce((function(e,n,r){var o=t(n,r);return o&&(e[o[0]]=o[1]),e}),{})}function S(e,t){if(d(e,t))return e[t];if(!t)return e;if("string"!==typeof t){for(var n=[],r=0,o=t.length;r<o;++r){var i=S(e,t[r]);n.push(i)}return n}var a=t.indexOf(".");if(-1!==a){var u=e[t.substr(0,a)];return void 0===u?void 0:S(u,t.substr(a+1))}}function O(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!==typeof t&&"length"in t){x("string"!==typeof n&&"length"in n);for(var r=0,o=t.length;r<o;++r)O(e,t[r],n[r])}else{var i=t.indexOf(".");if(-1!==i){var a=t.substr(0,i),u=t.substr(i+1);if(""===u)void 0===n?s(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n;else{var c=e[a];c||(c=e[a]={}),O(c,u,n)}}else void 0===n?s(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function I(e){var t={};for(var n in e)d(e,n)&&(t[n]=e[n]);return t}var E=[].concat;function P(e){return E.apply([],e)}var C="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(P([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return a[e]})),A=C.map((function(e){return a[e]}));k(C,(function(e){return[e,!0]}));var T=null;function D(e){T="undefined"!==typeof WeakMap&&new WeakMap;var t=R(e);return T=null,t}function R(e){if(!e||"object"!==typeof e)return e;var t=T&&T.get(e);if(t)return t;if(s(e)){t=[],T&&T.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(R(e[n]))}else if(A.indexOf(e.constructor)>=0)t=e;else{var o=l(e);for(var i in t=o===Object.prototype?{}:Object.create(o),T&&T.set(e,t),e)d(e,i)&&(t[i]=R(e[i]))}return t}var N={}.toString;function K(e){return N.call(e).slice(8,-1)}var B="undefined"!==typeof Symbol?Symbol.iterator:"@@iterator",U="symbol"===typeof B?function(e){var t;return null!=e&&(t=e[B])&&t.apply(e)}:function(){return null},L={};function M(e){var t,n,r,o;if(1===arguments.length){if(s(e))return e.slice();if(this===L&&"string"===typeof e)return[e];if(o=U(e)){for(n=[];!(r=o.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"===typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var F="undefined"!==typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},W="undefined"!==typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function q(e,t){W=e,$=t}var $=function(){return!0},z=!new Error("").stack;function H(){if(z)try{throw H.arguments,new Error}catch(e){return e}return new Error}function V(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter($).map((function(e){return"\n"+e})).join("")):""}var G=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Y=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(G),J={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Q(e,t){this._e=H(),this.name=e,this.message=t}function X(e,t){return e+". Errors: "+Object.keys(t).map((function(e){return t[e].toString()})).filter((function(e,t,n){return n.indexOf(e)===t})).join("\n")}function Z(e,t,n,r){this._e=H(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=X(e,t)}function ee(e,t){this._e=H(),this.name="BulkError",this.failures=Object.keys(t).map((function(e){return t[e]})),this.failuresByPos=t,this.message=X(e,t)}b(Q).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+V(this._e,2))}},toString:function(){return this.name+": "+this.message}}),b(Z).from(Q),b(ee).from(Q);var te=Y.reduce((function(e,t){return e[t]=t+"Error",e}),{}),ne=Q,re=Y.reduce((function(e,t){var n=t+"Error";function r(e,r){this._e=H(),this.name=n,e?"string"===typeof e?(this.message=e+(r?"\n "+r:""),this.inner=r||null):"object"===typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=J[t]||n,this.inner=null)}return b(r).from(ne),e[t]=r,e}),{});re.Syntax=SyntaxError,re.Type=TypeError,re.Range=RangeError;var oe=G.reduce((function(e,t){return e[t+"Error"]=re[t],e}),{});var ie=Y.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=re[t]),e}),{});function ae(){}function ue(e){return e}function se(e,t){return null==e||e===ue?t:function(n){return t(e(n))}}function ce(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function le(e,t){return e===ae?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ce(r,this.onsuccess):r),o&&(this.onerror=this.onerror?ce(o,this.onerror):o),void 0!==i?i:n}}function fe(e,t){return e===ae?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ce(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ce(r,this.onerror):r)}}function de(e,t){return e===ae?t:function(n){var r=e.apply(this,arguments);c(n,r);var o=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?ce(o,this.onsuccess):o),i&&(this.onerror=this.onerror?ce(i,this.onerror):i),void 0===r?void 0===a?void 0:a:c(r,a)}}function he(e,t){return e===ae?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function pe(e,t){return e===ae?t:function(){var n=e.apply(this,arguments);if(n&&"function"===typeof n.then){for(var r=this,o=arguments.length,i=new Array(o);o--;)i[o]=arguments[o];return n.then((function(){return t.apply(r,i)}))}return t.apply(this,arguments)}}ie.ModifyError=Z,ie.DexieError=Q,ie.BulkError=ee;var ve={},be="undefined"===typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"===typeof crypto||!crypto.subtle)return[e,l(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,l(t),e]}(),ye=be[0],me=be[1],ge=be[2],we=me&&me.then,_e=ye&&ye.constructor,xe=!!ge,je=!1,ke=ge?function(){ge.then(Ve)}:a.setImmediate?setImmediate.bind(null,Ve):a.MutationObserver?function(){var e=document.createElement("div");new MutationObserver((function(){Ve(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(Ve,0)},Se=function(e,t){Re.push([e,t]),Ie&&(ke(),Ie=!1)},Oe=!0,Ie=!0,Ee=[],Pe=[],Ce=null,Ae=ue,Te={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:mt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(e){try{mt(e[0],e[1])}catch(t){}}))}},De=Te,Re=[],Ne=0,Ke=[];function Be(e){if("object"!==typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ae,this._lib=!1;var t=this._PSD=De;if(W&&(this._stackHolder=H(),this._prev=null,this._numPrev=0),"function"!==typeof e){if(e!==ve)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Fe(this,this._value))}this._state=null,this._value=null,++t.ref,Me(this,e)}var Ue={get:function(){var e=De,t=rt;function n(n,r){var o=this,i=!e.global&&(e!==De||t!==rt),a=i&&!ut(),u=new Be((function(t,u){qe(o,new Le(vt(n,e,i,a),vt(r,e,i,a),t,u,e))}));return W&&He(u,this),u}return n.prototype=ve,n},set:function(e){v(this,"then",e&&e.prototype===ve?Ue:{get:function(){return e},set:Ue.set})}};function Le(e,t,n,r,o){this.onFulfilled="function"===typeof e?e:null,this.onRejected="function"===typeof t?t:null,this.resolve=n,this.reject=r,this.psd=o}function Me(e,t){try{t((function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Ge();t&&"function"===typeof t.then?Me(e,(function(e,n){t instanceof Be?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,We(e)),n&&Ye()}}),Fe.bind(null,e))}catch(n){Fe(e,n)}}function Fe(e,t){if(Pe.push(t),null===e._state){var n=e._lib&&Ge();t=Ae(t),e._state=!1,e._value=t,W&&null!==t&&"object"===typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,n)}catch(r){t&&t(r)}}((function(){var n=m(t,"stack");t._promise=e,v(t,"stack",{get:function(){return je?n&&(n.get?n.get.apply(t):n.value):e.stack}})})),function(e){Ee.some((function(t){return t._value===e._value}))||Ee.push(e)}(e),We(e),n&&Ye()}}function We(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)qe(e,t[n]);var o=e._PSD;--o.ref||o.finalize(),0===Ne&&(++Ne,Se((function(){0===--Ne&&Je()}),[]))}function qe(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ne,Se($e,[n,e,t])}else e._listeners.push(t)}function $e(e,t,n){try{Ce=t;var r,o=t._value;t._state?r=e(o):(Pe.length&&(Pe=[]),r=e(o),-1===Pe.indexOf(o)&&function(e){var t=Ee.length;for(;t;)if(Ee[--t]._value===e._value)return void Ee.splice(t,1)}(t)),n.resolve(r)}catch(i){n.reject(i)}finally{Ce=null,0===--Ne&&Je(),--n.psd.ref||n.psd.finalize()}}function ze(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var o,i,a=e._value;null!=a?(o=a.name||"Error",i=a.message||a,r=V(a,0)):(o=a,i=""),t.push(o+(i?": "+i:"")+r)}return W&&((r=V(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&ze(e._prev,t,n)),t}function He(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Ve(){Ge()&&Ye()}function Ge(){var e=Oe;return Oe=!1,Ie=!1,e}function Ye(){var e,t,n;do{for(;Re.length>0;)for(e=Re,Re=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Re.length>0);Oe=!0,Ie=!0}function Je(){var e=Ee;Ee=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Ke.slice(0),n=t.length;n;)t[--n]()}function Qe(e){return new Be(ve,!1,e)}function Xe(e,t){var n=De;return function(){var r=Ge(),o=De;try{return ft(n,!0),e.apply(this,arguments)}catch(i){t&&t(i)}finally{ft(o,!1),r&&Ye()}}}h(Be.prototype,{then:Ue,_then:function(e,t){qe(this,new Le(null,null,e,t,De))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"===typeof t?this.then(null,(function(e){return e instanceof t?n(e):Qe(e)})):this.then(null,(function(e){return e&&e.name===t?n(e):Qe(e)}))},finally:function(e){return this.then((function(t){return e(),t}),(function(t){return e(),Qe(t)}))},stack:{get:function(){if(this._stack)return this._stack;try{je=!0;var e=ze(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{je=!1}}},timeout:function(e,t){var n=this;return e<1/0?new Be((function(r,o){var i=setTimeout((function(){return o(new re.Timeout(t))}),e);n.then(r,o).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!==typeof Symbol&&Symbol.toStringTag&&v(Be.prototype,Symbol.toStringTag,"Dexie.Promise"),Te.env=dt(),h(Be,{all:function(){var e=M.apply(null,arguments).map(st);return new Be((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((function(o,i){return Be.resolve(o).then((function(n){e[i]=n,--r||t(e)}),n)}))}))},resolve:function(e){if(e instanceof Be)return e;if(e&&"function"===typeof e.then)return new Be((function(t,n){e.then(t,n)}));var t=new Be(ve,!0,e);return He(t,Ce),t},reject:Qe,race:function(){var e=M.apply(null,arguments).map(st);return new Be((function(t,n){e.map((function(e){return Be.resolve(e).then(t,n)}))}))},PSD:{get:function(){return De},set:function(e){return De=e}},totalEchoes:{get:function(){return rt}},newPSD:it,usePSD:ht,scheduler:{get:function(){return Se},set:function(e){Se=e}},rejectionMapper:{get:function(){return Ae},set:function(e){Ae=e}},follow:function(e,t){return new Be((function(n,r){return it((function(t,n){var r=De;r.unhandleds=[],r.onunhandled=n,r.finalize=ce((function(){var e=this;!function(e){function t(){e(),Ke.splice(Ke.indexOf(t),1)}Ke.push(t),++Ne,Se((function(){0===--Ne&&Je()}),[])}((function(){0===e.unhandleds.length?t():n(e.unhandleds[0])}))}),r.finalize),e()}),t,n,r)}))}}),_e&&(_e.allSettled&&v(Be,"allSettled",(function(){var e=M.apply(null,arguments).map(st);return new Be((function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach((function(e,o){return Be.resolve(e).then((function(e){return r[o]={status:"fulfilled",value:e}}),(function(e){return r[o]={status:"rejected",reason:e}})).then((function(){return--n||t(r)}))}))}))})),_e.any&&"undefined"!==typeof AggregateError&&v(Be,"any",(function(){var e=M.apply(null,arguments).map(st);return new Be((function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,o=new Array(r);e.forEach((function(e,i){return Be.resolve(e).then((function(e){return t(e)}),(function(e){o[i]=e,--r||n(new AggregateError(o))}))}))}))})));var Ze={awaits:0,echoes:0,id:0},et=0,tt=[],nt=0,rt=0,ot=0;function it(e,t,n,r){var o=De,i=Object.create(o);i.parent=o,i.ref=0,i.global=!1,i.id=++ot;var a=Te.env;i.env=xe?{Promise:Be,PromiseProp:{value:Be,configurable:!0,writable:!0},all:Be.all,race:Be.race,allSettled:Be.allSettled,any:Be.any,resolve:Be.resolve,reject:Be.reject,nthen:bt(a.nthen,i),gthen:bt(a.gthen,i)}:{},t&&c(i,t),++o.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=ht(i,e,n,r);return 0===i.ref&&i.finalize(),u}function at(){return Ze.id||(Ze.id=++et),++Ze.awaits,Ze.echoes+=100,Ze.id}function ut(){return!!Ze.awaits&&(0===--Ze.awaits&&(Ze.id=0),Ze.echoes=100*Ze.awaits,!0)}function st(e){return Ze.echoes&&e&&e.constructor===_e?(at(),e.then((function(e){return ut(),e}),(function(e){return ut(),gt(e)}))):e}function ct(e){++rt,Ze.echoes&&0!==--Ze.echoes||(Ze.echoes=Ze.id=0),tt.push(De),ft(e,!0)}function lt(){var e=tt[tt.length-1];tt.pop(),ft(e,!1)}function ft(e,t){var n=De;if((t?!Ze.echoes||nt++&&e===De:!nt||--nt&&e===De)||pt(t?ct.bind(null,e):lt),e!==De&&(De=e,n===Te&&(Te.env=dt()),xe)){var r=Te.env.Promise,o=e.env;me.then=o.nthen,r.prototype.then=o.gthen,(n.global||e.global)&&(Object.defineProperty(a,"Promise",o.PromiseProp),r.all=o.all,r.race=o.race,r.resolve=o.resolve,r.reject=o.reject,o.allSettled&&(r.allSettled=o.allSettled),o.any&&(r.any=o.any))}}function dt(){var e=a.Promise;return xe?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:me.then,gthen:e.prototype.then}:{}}function ht(e,t,n,r,o){var i=De;try{return ft(e,!0),t(n,r,o)}finally{ft(i,!1)}}function pt(e){we.call(ye,e)}function vt(e,t,n,r){return"function"!==typeof e?e:function(){var o=De;n&&at(),ft(t,!0);try{return e.apply(this,arguments)}finally{ft(o,!1),r&&pt(ut)}}}function bt(e,t){return function(n,r){return e.call(this,vt(n,t),vt(r,t))}}-1===(""+we).indexOf("[native code]")&&(at=ut=ae);var yt="unhandledrejection";function mt(e,t){var n;try{n=t.onuncatched(e)}catch(i){}if(!1!==n)try{var r,o={promise:t,reason:e};if(a.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(yt,!0,!0),c(r,o)):a.CustomEvent&&c(r=new CustomEvent(yt,{detail:o}),o),r&&a.dispatchEvent&&(dispatchEvent(r),!a.PromiseRejectionEvent&&a.onunhandledrejection))try{a.onunhandledrejection(r)}catch(u){}W&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(e.stack||e))}catch(i){}}var gt=Be.reject;function wt(e,t,n,r){if(e.idbdb&&(e._state.openComplete||De.letThrough||e._vip)){var o=e._createTransaction(t,n,e._dbSchema);try{o.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===te.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((function(){return wt(e,t,n,r)}))):gt(i)}return o._promise(t,(function(e,t){return it((function(){return De.trans=o,r(e,t,o)}))})).then((function(e){return o._completion.then((function(){return e}))}))}if(e._state.openComplete)return gt(new re.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return gt(new re.DatabaseClosed);e.open().catch(ae)}return e._state.dbReadyPromise.then((function(){return wt(e,t,n,r)}))}var _t="3.2.1-beta.1",xt=String.fromCharCode(65535),jt=-1/0,kt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",St="String expected.",Ot=[],It="undefined"!==typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Et=It,Pt=It,Ct=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)},At="__dbnames",Tt="readonly",Dt="readwrite";function Rt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Nt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Kt(e){return"string"!==typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=D(t))[e],t}}function Bt(){throw re.Type()}var Ut=function(){function e(){}return e.prototype._trans=function(e,t,n){var r=this._tx||De.trans,o=this.name;function i(e,n,r){if(!r.schema[o])throw new re.NotFound("Table "+o+" not part of transaction");return t(r.idbtrans,r)}var a=Ge();try{return r&&r.db===this.db?r===De.trans?r._promise(e,i,n):it((function(){return r._promise(e,i,n)}),{trans:r,transless:De.transless||De}):wt(this.db,e,[this.name],i)}finally{a&&Ye()}},e.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(function(t){return n.core.get({trans:t,key:e}).then((function(e){return n.hook.reading.fire(e)}))})).then(t)},e.prototype.where=function(e){if("string"===typeof e)return new this.db.WhereClause(this,e);if(s(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var t=u(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(e){return e.compound&&t.every((function(t){return e.keyPath.indexOf(t)>=0}))&&e.keyPath.every((function(e){return t.indexOf(e)>=0}))}))[0];if(n&&this.db._maxKey!==xt)return this.where(n.name).equals(n.keyPath.map((function(t){return e[t]})));!n&&W&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+t.join("+")+"]");var r=this.schema.idxByName,o=this.db._deps.indexedDB;function i(e,t){try{return 0===o.cmp(e,t)}catch(n){return!1}}var a=t.reduce((function(t,n){var o=t[0],a=t[1],u=r[n],c=e[n];return[o||u,o||!u?Rt(a,u&&u.multi?function(e){var t=S(e,n);return s(t)&&t.some((function(e){return i(c,e)}))}:function(e){return i(c,S(e,n))}):a]}),[null,null]),c=a[0],l=a[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(l):n?this.filter(l):this.where(t).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,s(e)?"["+e.join("+")+"]":e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){var t=this.db,n=this.name;this.schema.mappedClass=e,e.prototype instanceof Bt&&(e=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(o,e),Object.defineProperty(o.prototype,"db",{get:function(){return t},enumerable:!1,configurable:!0}),o.prototype.table=function(){return n},o}(e));for(var o=new Set,i=e.prototype;i;i=l(i))Object.getOwnPropertyNames(i).forEach((function(e){return o.add(e)}));var a=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(!o.has(r))try{n[r]=t[r]}catch(i){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),e},e.prototype.defineClass=function(){return this.mapToClass((function(e){c(this,e)}))},e.prototype.add=function(e,t){var n=this,r=this.schema.primKey,o=r.auto,i=r.keyPath,a=e;return i&&o&&(a=Kt(i)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[a]})})).then((function(e){return e.numFailures?Be.reject(e.failures[0]):e.lastResult})).then((function(t){if(i)try{O(e,i,t)}catch(n){}return t}))},e.prototype.update=function(e,t){if("object"!==typeof e||s(e))return this.where(":id").equals(e).modify(t);var n=S(e,this.schema.primKey.keyPath);if(void 0===n)return gt(new re.InvalidArgument("Given object does not contain its primary key"));try{"function"!==typeof t?u(t).forEach((function(n){O(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(Jn){}return this.where(":id").equals(n).modify(t)},e.prototype.put=function(e,t){var n=this,r=this.schema.primKey,o=r.auto,i=r.keyPath,a=e;return i&&o&&(a=Kt(i)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"put",values:[a],keys:null!=t?[t]:null})})).then((function(e){return e.numFailures?Be.reject(e.failures[0]):e.lastResult})).then((function(t){if(i)try{O(e,i,t)}catch(n){}return t}))},e.prototype.delete=function(e){var t=this;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})})).then((function(e){return e.numFailures?Be.reject(e.failures[0]):void 0}))},e.prototype.clear=function(){var e=this;return this._trans("readwrite",(function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Nt})})).then((function(e){return e.numFailures?Be.reject(e.failures[0]):void 0}))},e.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",(function(n){return t.core.getMany({keys:e,trans:n}).then((function(e){return e.map((function(e){return t.hook.reading.fire(e)}))}))}))},e.prototype.bulkAdd=function(e,t,n){var r=this,o=Array.isArray(t)?t:void 0,i=(n=n||(o?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=r.schema.primKey,a=n.auto,u=n.keyPath;if(u&&o)throw new re.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var s=e.length,c=u&&a?e.map(Kt(u)):e;return r.core.mutate({trans:t,type:"add",keys:o,values:c,wantResults:i}).then((function(e){var t=e.numFailures,n=e.results,o=e.lastResult,a=e.failures;if(0===t)return i?n:o;throw new ee(r.name+".bulkAdd(): "+t+" of "+s+" operations failed",a)}))}))},e.prototype.bulkPut=function(e,t,n){var r=this,o=Array.isArray(t)?t:void 0,i=(n=n||(o?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=r.schema.primKey,a=n.auto,u=n.keyPath;if(u&&o)throw new re.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var s=e.length,c=u&&a?e.map(Kt(u)):e;return r.core.mutate({trans:t,type:"put",keys:o,values:c,wantResults:i}).then((function(e){var t=e.numFailures,n=e.results,o=e.lastResult,a=e.failures;if(0===t)return i?n:o;throw new ee(r.name+".bulkPut(): "+t+" of "+s+" operations failed",a)}))}))},e.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:e})})).then((function(e){var r=e.numFailures,o=e.lastResult,i=e.failures;if(0===r)return o;throw new ee(t.name+".bulkDelete(): "+r+" of "+n+" operations failed",i)}))},e}();function Lt(e){var t={},n=function(n,r){if(r){for(var o=arguments.length,i=new Array(o-1);--o;)i[o-1]=arguments[o];return t[n].subscribe.apply(null,i),e}if("string"===typeof n)return t[n]};n.addEventType=i;for(var r=1,o=arguments.length;r<o;++r)i(arguments[r]);return n;function i(e,r,o){if("object"===typeof e)return a(e);r||(r=he),o||(o=ae);var i={subscribers:[],fire:o,subscribe:function(e){-1===i.subscribers.indexOf(e)&&(i.subscribers.push(e),i.fire=r(i.fire,e))},unsubscribe:function(e){i.subscribers=i.subscribers.filter((function(t){return t!==e})),i.fire=i.subscribers.reduce(r,o)}};return t[e]=n[e]=i,i}function a(e){u(e).forEach((function(t){var n=e[t];if(s(n))i(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new re.InvalidArgument("Invalid event config");var r=i(t,ue,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){j((function(){e.apply(null,t)}))}))}))}}))}}function Mt(e,t){return b(t).from({prototype:e}),t}function Ft(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Wt(e,t){e.filter=Rt(e.filter,t)}function qt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Rt(r(),t())}:t,e.justLimit=n&&!r}function $t(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new re.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function zt(e,t,n){var r=$t(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Ht(e,t,n,r){var o=e.replayFilter?Rt(e.filter,e.replayFilter()):e.filter;if(e.or){var i={},a=function(e,n,r){if(!o||o(n,r,(function(e){return n.stop(e)}),(function(e){return n.fail(e)}))){var a=n.primaryKey,u=""+a;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(a)),d(i,u)||(i[u]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(a,n),Vt(zt(e,r,n),e.algorithm,a,!e.keysOnly&&e.valueMapper)])}return Vt(zt(e,r,n),Rt(e.algorithm,o),t,!e.keysOnly&&e.valueMapper)}function Vt(e,t,n,r){var o=Xe(r?function(e,t,o){return n(r(e),t,o)}:n);return e.then((function(e){if(e)return e.start((function(){var n=function(){return e.continue()};t&&!t(e,(function(e){return n=e}),(function(t){e.stop(t),n=ae}),(function(t){e.fail(t),n=ae}))||o(e.value,e,(function(e){return n=e})),n()}))}))}function Gt(e,t){try{var n=Yt(e),r=Yt(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){for(var n=e.length,r=t.length,o=n<r?n:r,i=0;i<o;++i)if(e[i]!==t[i])return e[i]<t[i]?-1:1;return n===r?0:n<r?-1:1}(Jt(e),Jt(t));case"Array":return function(e,t){for(var n=e.length,r=t.length,o=n<r?n:r,i=0;i<o;++i){var a=Gt(e[i],t[i]);if(0!==a)return a}return n===r?0:n<r?-1:1}(e,t)}}catch(Jn){}return NaN}function Yt(e){var t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";var n=K(e);return"ArrayBuffer"===n?"binary":n}function Jt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Qt=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,gt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,gt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Rt(t.algorithm,e)},e.prototype._iterate=function(e,t){return Ht(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&c(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read((function(n){return Ht(t,e,n,t.table.core)}))},e.prototype.count=function(e){var t=this;return this._read((function(e){var n=t._ctx,r=n.table.core;if(Ft(n,!0))return r.count({trans:e,query:{index:$t(n,r.schema),range:n.range}}).then((function(e){return Math.min(e,n.limit)}));var o=0;return Ht(n,(function(){return++o,!1}),e,r).then((function(){return o}))})).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],o=n.length-1;function i(e,t){return t?i(e[n[t]],t-1):e[r]}var a="next"===this._ctx.dir?1:-1;function u(e,t){var n=i(e,o),r=i(t,o);return n<r?-a:n>r?a:0}return this.toArray((function(e){return e.sort(u)})).then(t)},e.prototype.toArray=function(e){var t=this;return this._read((function(e){var n=t._ctx;if("next"===n.dir&&Ft(n,!0)&&n.limit>0){var r=n.valueMapper,o=$t(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:o,range:n.range}}).then((function(e){var t=e.result;return r?t.map(r):t}))}var i=[];return Ht(n,(function(e){return i.push(e)}),e,n.table.core).then((function(){return i}))}),e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Ft(t)?qt(t,(function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n((function(){e.advance(t),t=0})),!1))}})):qt(t,(function(){var t=e;return function(){return--t<0}}))),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),qt(this._ctx,(function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this},e.prototype.until=function(e,t){return Wt(this._ctx,(function(n,r,o){return!e(n.value)||(r(o),t)})),this},e.prototype.first=function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){var t,n;return Wt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=Rt(t.isMatch,n),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&Ft(t,!0)&&t.limit>0)return this._read((function(e){var n=$t(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((function(e){return e.result})).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Wt(this._ctx,(function(e){var t=e.primaryKey.toString(),r=d(n,t);return n[t]=!0,!r})),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write((function(r){var o;if("function"===typeof e)o=e;else{var i=u(e),a=i.length;o=function(t){for(var n=!1,r=0;r<a;++r){var o=i[r],u=e[o];S(t,o)!==u&&(O(t,o,u),n=!0)}return n}}var s=n.table.core,c=s.schema.primaryKey,l=c.outbound,f=c.extractKey,d=t.db._options.modifyChunkSize||200,h=[],p=0,v=[],b=function(e,t){var n=t.failures,r=t.numFailures;p+=e-r;for(var o=0,i=u(n);o<i.length;o++){var a=i[o];h.push(n[a])}};return t.clone().primaryKeys().then((function(t){return function i(a){var u=Math.min(d,t.length-a);return s.getMany({trans:r,keys:t.slice(a,a+u),cache:"immutable"}).then((function(c){for(var h=[],p=[],v=l?[]:null,y=[],m=0;m<u;++m){var g=c[m],w={value:D(g),primKey:t[a+m]};!1!==o.call(w,w.value,w)&&(null==w.value?y.push(t[a+m]):l||0===Gt(f(g),f(w.value))?(p.push(w.value),l&&v.push(t[a+m])):(y.push(t[a+m]),h.push(w.value)))}var _=Ft(n)&&n.limit===1/0&&("function"!==typeof e||e===Xt)&&{index:n.index,range:n.range};return Promise.resolve(h.length>0&&s.mutate({trans:r,type:"add",values:h}).then((function(e){for(var t in e.failures)y.splice(parseInt(t),1);b(h.length,e)}))).then((function(){return(p.length>0||_&&"object"===typeof e)&&s.mutate({trans:r,type:"put",keys:v,values:p,criteria:_,changeSpec:"function"!==typeof e&&e}).then((function(e){return b(p.length,e)}))})).then((function(){return(y.length>0||_&&e===Xt)&&s.mutate({trans:r,type:"delete",keys:y,criteria:_}).then((function(e){return b(y.length,e)}))})).then((function(){return t.length>a+u&&i(a+d)}))}))}(0).then((function(){if(h.length>0)throw new Z("Error modifying one or more objects",h,p,v);return t.length}))}))}))},e.prototype.delete=function(){var e=this._ctx,t=e.range;return Ft(e)&&(e.isPrimKey&&!Pt||3===t.type)?this._write((function(n){var r=e.table.core.schema.primaryKey,o=t;return e.table.core.count({trans:n,query:{index:r,range:o}}).then((function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then((function(e){var n=e.failures;e.lastResult,e.results;var r=e.numFailures;if(r)throw new Z("Could not delete some values",Object.keys(n).map((function(e){return n[e]})),t-r);return t-r}))}))})):this.modify(Xt)},e}(),Xt=function(e,t){return t.value=null};function Zt(e,t){return e<t?-1:e===t?0:1}function en(e,t){return e>t?-1:e===t?0:1}function tn(e,t,n){var r=e instanceof sn?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function nn(e){return new e.Collection(e,(function(){return un("")})).limit(0)}function rn(e,t,n,r,o,i){for(var a=Math.min(e.length,r.length),u=-1,s=0;s<a;++s){var c=t[s];if(c!==r[s])return o(e[s],n[s])<0?e.substr(0,s)+n[s]+n.substr(s+1):o(e[s],r[s])<0?e.substr(0,s)+r[s]+n.substr(s+1):u>=0?e.substr(0,u)+t[u]+n.substr(u+1):null;o(e[s],c)<0&&(u=s)}return a<r.length&&"next"===i?e+n.substr(e.length):a<e.length&&"prev"===i?e.substr(0,n.length):u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function on(e,t,n,r){var o,i,a,u,s,c,l,f=n.length;if(!n.every((function(e){return"string"===typeof e})))return tn(e,St);function d(e){o=function(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}(e),i=function(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}(e),a="next"===e?Zt:en;var t=n.map((function(e){return{lower:i(e),upper:o(e)}})).sort((function(e,t){return a(e.lower,t.lower)}));u=t.map((function(e){return e.upper})),s=t.map((function(e){return e.lower})),c=e,l="next"===e?"":r}d("next");var h=new e.Collection(e,(function(){return an(u[0],s[f-1]+r)}));h._ondirectionchange=function(e){d(e)};var p=0;return h._addAlgorithm((function(e,n,r){var o=e.key;if("string"!==typeof o)return!1;var d=i(o);if(t(d,s,p))return!0;for(var h=null,v=p;v<f;++v){var b=rn(o,d,u[v],s[v],a,c);null===b&&null===h?p=v+1:(null===h||a(h,b)>0)&&(h=b)}return n(null!==h?function(){e.continue(h+l)}:r),!1})),h}function an(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function un(e){return{type:1,lower:e,upper:e}}var sn=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?nn(this):new this.Collection(this,(function(){return an(e,t,!n,!r)}))}catch(o){return tn(this,kt)}},e.prototype.equals=function(e){return null==e?tn(this,kt):new this.Collection(this,(function(){return un(e)}))},e.prototype.above=function(e){return null==e?tn(this,kt):new this.Collection(this,(function(){return an(e,void 0,!0)}))},e.prototype.aboveOrEqual=function(e){return null==e?tn(this,kt):new this.Collection(this,(function(){return an(e,void 0,!1)}))},e.prototype.below=function(e){return null==e?tn(this,kt):new this.Collection(this,(function(){return an(void 0,e,!1,!0)}))},e.prototype.belowOrEqual=function(e){return null==e?tn(this,kt):new this.Collection(this,(function(){return an(void 0,e)}))},e.prototype.startsWith=function(e){return"string"!==typeof e?tn(this,St):this.between(e,e+xt,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):on(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],xt)},e.prototype.equalsIgnoreCase=function(e){return on(this,(function(e,t){return e===t[0]}),[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=M.apply(L,arguments);return 0===e.length?nn(this):on(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=M.apply(L,arguments);return 0===e.length?nn(this):on(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,xt)},e.prototype.anyOf=function(){var e=this,t=M.apply(L,arguments),n=this._cmp;try{t.sort(n)}catch(i){return tn(this,kt)}if(0===t.length)return nn(this);var r=new this.Collection(this,(function(){return an(t[0],t[t.length-1])}));r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var o=0;return r._addAlgorithm((function(e,r,i){for(var a=e.key;n(a,t[o])>0;)if(++o===t.length)return r(i),!1;return 0===n(a,t[o])||(r((function(){e.continue(t[o])})),!1)})),r},e.prototype.notEqual=function(e){return this.inAnyRange([[jt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=M.apply(L,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(n){return tn(this,kt)}var t=e.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[jt,t]]}),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,o=this._ascending,i=this._descending,a=this._min,u=this._max;if(0===e.length)return nn(this);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&o(e[0],e[1])<=0})))return tn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",re.InvalidArgument);var s=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;var l,f=o;function d(e,t){return f(e[0],t[0])}try{(l=e.reduce((function(e,t){for(var n=0,o=e.length;n<o;++n){var i=e[n];if(r(t[0],i[1])<0&&r(t[1],i[0])>0){i[0]=a(i[0],t[0]),i[1]=u(i[1],t[1]);break}}return n===o&&e.push(t),e}),[])).sort(d)}catch(m){return tn(this,kt)}var h=0,p=c?function(e){return o(e,l[h][1])>0}:function(e){return o(e,l[h][1])>=0},v=s?function(e){return i(e,l[h][0])>0}:function(e){return i(e,l[h][0])>=0};var b=p,y=new this.Collection(this,(function(){return an(l[0][0],l[l.length-1][1],!s,!c)}));return y._ondirectionchange=function(e){"next"===e?(b=p,f=o):(b=v,f=i),l.sort(d)},y._addAlgorithm((function(e,t,r){for(var i=e.key;b(i);)if(++h===l.length)return t(r),!1;return!!function(e){return!p(e)&&!v(e)}(i)||(0===n._cmp(i,l[h][1])||0===n._cmp(i,l[h][0])||t((function(){f===o?e.continue(l[h][0]):e.continue(l[h][1])})),!1)})),y},e.prototype.startsWithAnyOf=function(){var e=M.apply(L,arguments);return e.every((function(e){return"string"===typeof e}))?0===e.length?nn(this):this.inAnyRange(e.map((function(e){return[e,e+xt]}))):tn(this,"startsWithAnyOf() only works with strings")},e}();function cn(e){return Xe((function(t){return ln(t),e(t.target.error),!1}))}function ln(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var fn="storagemutated",dn="x-storagemutated-1",hn=Lt(null,fn),pn=function(){function e(){}return e.prototype._lock=function(){return x(!De.global),++this._reculock,1!==this._reculock||De.global||(De.lockOwnerFor=this),this},e.prototype._unlock=function(){if(x(!De.global),0===--this._reculock)for(De.global||(De.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ht(e[1],e[0])}catch(t){}}return this},e.prototype._locked=function(){return this._reculock&&De.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(x(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new re.DatabaseClosed(r);case"MissingAPIError":throw new re.MissingAPI(r.message,r);default:throw new re.OpenFailed(r)}if(!this.active)throw new re.TransactionInactive;return x(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Xe((function(n){ln(n),t._reject(e.error)})),e.onabort=Xe((function(n){ln(n),t.active&&t._reject(new re.Abort(e.error)),t.active=!1,t.on("abort").fire(n)})),e.oncomplete=Xe((function(){t.active=!1,t._resolve(),"mutatedParts"in e&&hn.storagemutated.fire(e.mutatedParts)})),this},e.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return gt(new re.ReadOnly("Transaction is readonly"));if(!this.active)return gt(new re.TransactionInactive);if(this._locked())return new Be((function(o,i){r._blockedFuncs.push([function(){r._promise(e,t,n).then(o,i)},De])}));if(n)return it((function(){var e=new Be((function(e,n){r._lock();var o=t(e,n,r);o&&o.then&&o.then(e,n)}));return e.finally((function(){return r._unlock()})),e._lib=!0,e}));var o=new Be((function(e,n){var o=t(e,n,r);o&&o.then&&o.then(e,n)}));return o._lib=!0,o},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=Be.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((function(){return n}));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var o=t._waitingFor;return new Be((function(e,r){n.then((function(n){return t._waitingQueue.push(Xe(e.bind(null,n)))}),(function(e){return t._waitingQueue.push(Xe(r.bind(null,e)))})).finally((function(){t._waitingFor===o&&(t._waitingFor=null)}))}))},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new re.Abort))},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(d(t,e))return t[e];var n=this.schema[e];if(!n)throw new re.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function vn(e,t,n,r,o,i,a){return{name:e,keyPath:t,unique:n,multi:r,auto:o,compound:i,src:(n&&!a?"&":"")+(r?"*":"")+(o?"++":"")+bn(t)}}function bn(e){return"string"===typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function yn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:k(n,(function(e){return[e.name,e]}))}}var mn=function(e){try{return e.only([[]]),mn=function(){return[[]]},[[]]}catch(t){return mn=function(){return xt},xt}};function gn(e){return null==e?function(){}:"string"===typeof e?function(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return S(t,e)}}(e):function(t){return S(t,e)}}function wn(e){return[].slice.call(e)}var _n=0;function xn(e){return null==e?":id":"string"===typeof e?e:"["+e.join("+")+"]"}function jn(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,o=e.lowerOpen,i=e.upperOpen;return void 0===n?void 0===r?null:t.upperBound(r,!!i):void 0===r?t.lowerBound(n,!!o):t.bound(n,r,!!o,!!i)}var o=function(e,t){var n=wn(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((function(e){return t.objectStore(e)})).map((function(e){var t=e.keyPath,n=e.autoIncrement,r=s(t),o=null==t,i={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:gn(t)},indexes:wn(e.indexNames).map((function(t){return e.index(t)})).map((function(e){var t=e.name,n=e.unique,r=e.multiEntry,o=e.keyPath,a={name:t,compound:s(o),keyPath:o,unique:n,multiEntry:r,extractKey:gn(o)};return i[xn(o)]=a,a})),getIndexByKeyPath:function(e){return i[xn(e)]}};return i[":id"]=a.primaryKey,null!=t&&(i[xn(t)]=a.primaryKey),a}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!==typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),i=o.schema,a=o.hasGetAll,u=i.tables.map((function(e){return function(e){var t=e.name;return{name:t,schema:e,mutate:function(e){var n=e.trans,o=e.type,i=e.keys,a=e.values,u=e.range;return new Promise((function(e,s){e=Xe(e);var c=n.objectStore(t),l=null==c.keyPath,f="put"===o||"add"===o;if(!f&&"delete"!==o&&"deleteRange"!==o)throw new Error("Invalid operation type: "+o);var d,h=(i||a||{length:1}).length;if(i&&a&&i.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],v=[],b=0,y=function(e){++b,ln(e)};if("deleteRange"===o){if(4===u.type)return e({numFailures:b,failures:v,results:[],lastResult:void 0});3===u.type?p.push(d=c.clear()):p.push(d=c.delete(r(u)))}else{var m=f?l?[a,i]:[a,null]:[i,null],g=m[0],w=m[1];if(f)for(var _=0;_<h;++_)p.push(d=w&&void 0!==w[_]?c[o](g[_],w[_]):c[o](g[_])),d.onerror=y;else for(_=0;_<h;++_)p.push(d=c[o](g[_])),d.onerror=y}var x=function(t){var n=t.target.result;p.forEach((function(e,t){return null!=e.error&&(v[t]=e.error)})),e({numFailures:b,failures:v,results:"delete"===o?i:p.map((function(e){return e.result})),lastResult:n})};d.onerror=function(e){y(e),x(e)},d.onsuccess=x}))},getMany:function(e){var n=e.trans,r=e.keys;return new Promise((function(e,o){e=Xe(e);for(var i,a=n.objectStore(t),u=r.length,s=new Array(u),c=0,l=0,f=function(t){var n=t.target;s[n._pos]=n.result,++l===c&&e(s)},d=cn(o),h=0;h<u;++h)null!=r[h]&&((i=a.get(r[h]))._pos=h,i.onsuccess=f,i.onerror=d,++c);0===c&&e(s)}))},get:function(e){var n=e.trans,r=e.key;return new Promise((function(e,o){e=Xe(e);var i=n.objectStore(t).get(r);i.onsuccess=function(t){return e(t.target.result)},i.onerror=cn(o)}))},query:function(e){return function(n){return new Promise((function(o,i){o=Xe(o);var a=n.trans,u=n.values,s=n.limit,c=n.query,l=s===1/0?void 0:s,f=c.index,d=c.range,h=a.objectStore(t),p=f.isPrimaryKey?h:h.index(f.name),v=r(d);if(0===s)return o({result:[]});if(e){var b=u?p.getAll(v,l):p.getAllKeys(v,l);b.onsuccess=function(e){return o({result:e.target.result})},b.onerror=cn(i)}else{var y=0,m=u||!("openKeyCursor"in p)?p.openCursor(v):p.openKeyCursor(v),g=[];m.onsuccess=function(e){var t=m.result;return t?(g.push(u?t.value:t.primaryKey),++y===s?o({result:g}):void t.continue()):o({result:g})},m.onerror=cn(i)}}))}}(a),openCursor:function(e){var n=e.trans,o=e.values,i=e.query,a=e.reverse,u=e.unique;return new Promise((function(e,s){e=Xe(e);var c=i.index,l=i.range,f=n.objectStore(t),d=c.isPrimaryKey?f:f.index(c.name),h=a?u?"prevunique":"prev":u?"nextunique":"next",p=o||!("openKeyCursor"in d)?d.openCursor(r(l),h):d.openKeyCursor(r(l),h);p.onerror=cn(s),p.onsuccess=Xe((function(t){var r=p.result;if(r){r.___id=++_n,r.done=!1;var o=r.continue.bind(r),i=r.continuePrimaryKey;i&&(i=i.bind(r));var a=r.advance.bind(r),u=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=function(){throw new Error("Cursor not started")},r.fail=Xe(s),r.next=function(){var e=this,t=1;return this.start((function(){return t--?e.continue():e.stop()})).then((function(){return e}))},r.start=function(e){var t=new Promise((function(e,t){e=Xe(e),p.onerror=cn(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=u,e(t)}})),n=function(){if(p.result)try{e()}catch(t){r.fail(t)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Xe((function(e){p.onsuccess=n,n()})),r.continue=o,r.continuePrimaryKey=i,r.advance=a,n(),t},e(r)}else e(null)}),s)}))},count:function(e){var n=e.query,o=e.trans,i=n.index,a=n.range;return new Promise((function(e,n){var u=o.objectStore(t),s=i.isPrimaryKey?u:u.index(i.name),c=r(a),l=c?s.count(c):s.count();l.onsuccess=Xe((function(t){return e(t.target.result)})),l.onerror=cn(n)}))}}}(e)})),c={};return u.forEach((function(e){return c[e.name]=e})),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!c[e])throw new Error("Table '"+e+"' not found");return c[e]},MIN_KEY:-1/0,MAX_KEY:mn(t),schema:i}}function kn(e,t,n,r){var i=n.IDBKeyRange;return n.indexedDB,{dbcore:function(e,t){return t.reduce((function(e,t){var n=t.create;return o(o({},e),n(e))}),e)}(jn(t,i,r),e.dbcore)}}function Sn(e,t){var n=e._novip,r=t.db,o=kn(n._middlewares,r,n._deps,t);n.core=o.dbcore,n.tables.forEach((function(e){var t=e.name;n.core.schema.tables.some((function(e){return e.name===t}))&&(e.core=n.core.table(t),n[t]instanceof n.Table&&(n[t].core=e.core))}))}function On(e,t,n,r){var o=e._novip;n.forEach((function(e){var n=r[e];t.forEach((function(t){var r=m(t,e);(!r||"value"in r&&void 0===r.value)&&(t===o.Transaction.prototype||t instanceof o.Transaction?v(t,e,{get:function(){return this.table(e)},set:function(t){p(this,e,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):t[e]=new o.Table(e,n))}))}))}function In(e,t){var n=e._novip;t.forEach((function(e){for(var t in e)e[t]instanceof n.Table&&delete e[t]}))}function En(e,t){return e._cfg.version-t._cfg.version}function Pn(e,t,n,r){var o=e._dbSchema,i=e._createTransaction("readwrite",e._storeNames,o);i.create(n),i._completion.catch(r);var a=i._reject.bind(i),s=De.transless||De;it((function(){De.trans=i,De.transless=s,0===t?(u(o).forEach((function(e){An(n,e,o[e].primKey,o[e].indexes)})),Sn(e,n),Be.follow((function(){return e.on.populate.fire(i)})).catch(a)):function(e,t,n,r){var o=e._novip,i=[],a=o._versions,s=o._dbSchema=Dn(o,o.idbdb,r),c=!1;function l(){return i.length?Be.resolve(i.shift()(n.idbtrans)).then(l):Be.resolve()}return a.filter((function(e){return e._cfg.version>=t})).forEach((function(e){i.push((function(){var i=s,a=e._cfg.dbschema;Rn(o,i,r),Rn(o,a,r),s=o._dbSchema=a;var l=Cn(i,a);l.add.forEach((function(e){An(r,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((function(e){if(e.recreate)throw new re.Upgrade("Not yet support for changing primary key");var t=r.objectStore(e.name);e.add.forEach((function(e){return Tn(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),Tn(t,e)})),e.del.forEach((function(e){return t.deleteIndex(e)}))}));var f=e._cfg.contentUpgrade;if(f&&e._cfg.version>t){Sn(o,r),n._memoizedTables={},c=!0;var d=I(a);l.del.forEach((function(e){d[e]=i[e]})),In(o,[o.Transaction.prototype]),On(o,[o.Transaction.prototype],u(d),d),n.schema=d;var h,p=F(f);p&&at();var v=Be.follow((function(){if((h=f(n))&&p){var e=ut.bind(null,null);h.then(e,e)}}));return h&&"function"===typeof h.then?Be.resolve(h):v.then((function(){return h}))}})),i.push((function(t){c&&Et||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((function(n){return null==e[n]&&t.db.deleteObjectStore(n)}))}(e._cfg.dbschema,t);In(o,[o.Transaction.prototype]),On(o,[o.Transaction.prototype],o._storeNames,o._dbSchema),n.schema=o._dbSchema}))})),l().then((function(){var e,t;t=r,u(e=s).forEach((function(n){t.db.objectStoreNames.contains(n)||An(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,i,n).catch(a)}))}function Cn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var o=e[n],i=t[n];if(o){var a={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!==""+(i.primKey.keyPath||"")||o.primKey.auto!==i.primKey.auto&&!It)a.recreate=!0,r.change.push(a);else{var u=o.idxByName,s=i.idxByName,c=void 0;for(c in u)s[c]||a.del.push(c);for(c in s){var l=u[c],f=s[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(a.del.length>0||a.add.length>0||a.change.length>0)&&r.change.push(a)}}else r.add.push([n,i])}return r}function An(e,t,n,r){var o=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(e){return Tn(o,e)})),o}function Tn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Dn(e,t,n){var r={};return w(t.objectStoreNames,0).forEach((function(e){for(var t=n.objectStore(e),o=t.keyPath,i=vn(bn(o),o||"",!1,!1,!!t.autoIncrement,o&&"string"!==typeof o,!0),a=[],u=0;u<t.indexNames.length;++u){var s=t.index(t.indexNames[u]);o=s.keyPath;var c=vn(s.name,o,!!s.unique,!!s.multiEntry,!1,o&&"string"!==typeof o,!1);a.push(c)}r[e]=yn(e,i,a)})),r}function Rn(e,t,n){for(var r=e._novip,o=n.db.objectStoreNames,i=0;i<o.length;++i){var u=o[i],s=n.objectStore(u);r._hasGetAll="getAll"in s;for(var c=0;c<s.indexNames.length;++c){var l=s.indexNames[c],f=s.index(l).keyPath,d="string"===typeof f?f:"["+w(f).join("+")+"]";if(t[u]){var h=t[u].idxByName[d];h&&(h.name=l,delete t[u].idxByName[d],t[u].idxByName[l]=h)}}}"undefined"!==typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}var Nn=function(){function e(){}return e.prototype._parseStoresSpec=function(e,t){u(e).forEach((function(n){if(null!==e[n]){var r=e[n].split(",").map((function(e,t){var n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return vn(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),s(r),0===t)})),o=r.shift();if(o.multi)throw new re.Schema("Primary key cannot be multi-valued");r.forEach((function(e){if(e.auto)throw new re.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new re.Schema("Index must have a name and cannot be an empty string")})),t[n]=yn(n,o,r)}}))},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?c(this._cfg.storesSource,e):e;var n=t._versions,r={},o={};return n.forEach((function(e){c(r,e._cfg.storesSource),o=e._cfg.dbschema={},e._parseStoresSpec(r,o)})),t._dbSchema=o,In(t,[t._allTables,t,t.Transaction.prototype]),On(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],u(o),o),t._storeNames=u(o),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=pe(this._cfg.contentUpgrade||ae,e),this},e}();function Kn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new sr(At,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Bn(e){return e&&"function"===typeof e.databases}function Un(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!Bn(n)&&t!==At&&Kn(n,r).delete(t).catch(ae)}function Ln(e){return it((function(){return De.letThrough=!0,e()}))}function Mn(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Fn(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((function(){return t.dbOpenError?gt(t.dbOpenError):e}));W&&(t.openCanceller._stackHolder=H()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller;function o(){if(t.openCanceller!==r)throw new re.DatabaseClosed("db.open() was cancelled")}var i=t.dbReadyResolve,a=null,s=!1;return Be.race([r,("undefined"===typeof navigator?Be.resolve():Mn()).then((function(){return new Be((function(r,i){if(o(),!n)throw new re.MissingAPI;var c=e.name,l=t.autoSchema?n.open(c):n.open(c,Math.round(10*e.verno));if(!l)throw new re.MissingAPI;l.onerror=cn(i),l.onblocked=Xe(e._fireOnBlocked),l.onupgradeneeded=Xe((function(r){if(a=l.transaction,t.autoSchema&&!e._options.allowEmptyDB){l.onerror=ln,a.abort(),l.result.close();var o=n.deleteDatabase(c);o.onsuccess=o.onerror=Xe((function(){i(new re.NoSuchDatabase("Database "+c+" doesnt exist"))}))}else{a.onerror=cn(i);var u=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;s=u<1,e._novip.idbdb=l.result,Pn(e,u/10,a,i)}}),i),l.onsuccess=Xe((function(){a=null;var n,o=e._novip.idbdb=l.result,i=w(o.objectStoreNames);if(i.length>0)try{var f=o.transaction(1===(n=i).length?n[0]:n,"readonly");t.autoSchema?function(e,t,n){var r=e._novip;r.verno=t.version/10;var o=r._dbSchema=Dn(0,t,n);r._storeNames=w(t.objectStoreNames,0),On(r,[r._allTables],u(o),o)}(e,o,f):(Rn(e,e._dbSchema,f),function(e,t){var n=Cn(Dn(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((function(e){return e.add.length||e.change.length})))}(e,f)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Sn(e,f)}catch(d){}Ot.push(e),o.onversionchange=Xe((function(n){t.vcFired=!0,e.on("versionchange").fire(n)})),o.onclose=Xe((function(t){e.on("close").fire(t)})),s&&function(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!Bn(n)&&t!==At&&Kn(n,r).put({name:t}).catch(ae)}(e._deps,c),r()}),i)}))}))]).then((function(){return o(),t.onReadyBeingFired=[],Be.resolve(Ln((function(){return e.on.ready.fire(e.vip)}))).then((function n(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(pe,ae);return t.onReadyBeingFired=[],Be.resolve(Ln((function(){return r(e.vip)}))).then(n)}}))})).finally((function(){t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((function(){return e})).catch((function(n){t.dbOpenError=n;try{a&&a.abort()}catch(Jn){}return r===t.openCanceller&&e._close(),gt(n)})).finally((function(){t.openComplete=!0,i()}))}function Wn(e){var t=function(t){return e.next(t)},n=o(t),r=o((function(t){return e.throw(t)}));function o(e){return function(t){var o=e(t),i=o.value;return o.done?i:i&&"function"===typeof i.then?i.then(n,r):s(i)?Promise.all(i).then(n,r):n(i)}}return o(t)()}function qn(e,t,n){var r=arguments.length;if(r<2)throw new re.InvalidArgument("Too few arguments");for(var o=new Array(r-1);--r;)o[r-1]=arguments[r];n=o.pop();var i=P(o);return[e,i,n]}function $n(e,t,n,r,o){return Be.resolve().then((function(){var i=De.transless||De,a=e._createTransaction(t,n,e._dbSchema,r),u={trans:a,transless:i};if(r)a.idbtrans=r.idbtrans;else try{a.create(),e._state.PR1398_maxLoop=3}catch(f){return f.name===te.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((function(){return $n(e,t,n,null,o)}))):gt(f)}var s,c=F(o);c&&at();var l=Be.follow((function(){if(s=o.call(a,a))if(c){var e=ut.bind(null,null);s.then(e,e)}else"function"===typeof s.next&&"function"===typeof s.throw&&(s=Wn(s))}),u);return(s&&"function"===typeof s.then?Be.resolve(s).then((function(e){return a.active?e:gt(new re.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):l.then((function(){return s}))).then((function(e){return r&&a._resolve(),a._completion.then((function(){return e}))})).catch((function(e){return a._reject(e),gt(e)}))}))}function zn(e,t,n){for(var r=s(e)?e.slice():[e],o=0;o<n;++o)r.push(t);return r}var Hn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return o(o({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function u(e,t,n){var r=xn(e),s=i[r]=i[r]||[],c=null==e?0:"string"===typeof e?1:e.length,l=t>0,f=o(o({},n),{isVirtual:l,keyTail:t,keyLength:c,extractKey:gn(e),unique:!l&&n.unique});(s.push(f),f.isPrimaryKey||a.push(f),c>1)&&u(2===c?e[0]:e.slice(0,c-1),t+1,n);return s.sort((function(e,t){return e.keyTail-t.keyTail})),f}var s=u(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var c=0,l=r.indexes;c<l.length;c++){var f=l[c];u(f.keyPath,0,f)}function d(t){var n,r,i=t.query.index;return i.isVirtual?o(o({},t),{query:{index:i,range:(n=t.query.range,r=i.keyTail,{type:1===n.type?2:n.type,lower:zn(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,r),lowerOpen:!0,upper:zn(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,r),upperOpen:!0})}}):t}return o(o({},n),{schema:o(o({},r),{primaryKey:s,indexes:a,getIndexByKeyPath:function(e){var t=i[xn(e)];return t&&t[0]}}),count:function(e){return n.count(d(e))},query:function(e){return n.query(d(e))},openCursor:function(t){var r=t.query.index,o=r.keyTail,i=r.isVirtual,a=r.keyLength;if(!i)return n.openCursor(t);return n.openCursor(d(t)).then((function(n){return n&&function(n){return Object.create(n,{continue:{value:function(r){null!=r?n.continue(zn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,o)):t.unique?n.continue(n.key.slice(0,a).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,o)):n.continue()}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(zn(t,e.MAX_KEY,o),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===a?e[0]:e.slice(0,a)}},value:{get:function(){return n.value}}})}(n)}))}})}})}};function Vn(e,t,n,r){return n=n||{},r=r||"",u(e).forEach((function(o){if(d(t,o)){var i=e[o],a=t[o];if("object"===typeof i&&"object"===typeof a&&i&&a){var u=K(i);u!==K(a)?n[r+o]=t[o]:"Object"===u?Vn(i,a,n,r+o+"."):i!==a&&(n[r+o]=t[o])}else i!==a&&(n[r+o]=t[o])}else n[r+o]=void 0})),u(t).forEach((function(o){d(e,o)||(n[r+o]=t[o])})),n}var Gn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return o(o({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return o(o({},n),{mutate:function(e){var a=De.trans,u=a.table(t).hook,s=u.deleting,c=u.creating,l=u.updating;switch(e.type){case"add":if(c.fire===ae)break;return a._promise("readwrite",(function(){return f(e)}),!0);case"put":if(c.fire===ae&&l.fire===ae)break;return a._promise("readwrite",(function(){return f(e)}),!0);case"delete":if(s.fire===ae)break;return a._promise("readwrite",(function(){return f(e)}),!0);case"deleteRange":if(s.fire===ae)break;return a._promise("readwrite",(function(){return function(e){return h(e.trans,e.range,1e4)}(e)}),!0)}return n.mutate(e);function f(e){var t=De.trans,a=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!a)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?o(o({},e),{keys:a}):o({},e)).type&&(e.values=i([],e.values,!0)),e.keys&&(e.keys=i([],e.keys,!0)),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,a).then((function(o){var i=a.map((function(n,i){var a=o[i],u={onerror:null,onsuccess:null};if("delete"===e.type)s.fire.call(u,n,a,t);else if("add"===e.type||void 0===a){var f=c.fire.call(u,n,e.values[i],t);null==n&&null!=f&&(n=f,e.keys[i]=n,r.outbound||O(e.values[i],r.keyPath,n))}else{var h=Vn(a,e.values[i]),p=l.fire.call(u,h,n,a,t);if(p){var v=e.values[i];Object.keys(p).forEach((function(e){d(v,e)?v[e]=p[e]:O(v,e,p[e])}))}}return u}));return n.mutate(e).then((function(t){for(var n=t.failures,r=t.results,u=t.numFailures,s=t.lastResult,c=0;c<a.length;++c){var l=r?r[c]:a[c],f=i[c];null==l?f.onerror&&f.onerror(n[c]):f.onsuccess&&f.onsuccess("put"===e.type&&o[c]?e.values[c]:l)}return{failures:n,results:r,numFailures:u,lastResult:s}})).catch((function(e){return i.forEach((function(t){return t.onerror&&t.onerror(e)})),Promise.reject(e)}))}))}function h(e,t,i){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:i}).then((function(n){var r=n.result;return f({type:"delete",keys:r,trans:e}).then((function(n){return n.numFailures>0?Promise.reject(n.failures[0]):r.length<i?{failures:[],numFailures:0,lastResult:void 0}:h(e,o(o({},t),{lower:r[r.length-1],lowerOpen:!0}),i)}))}))}}})}})}};function Yn(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],o=0,i=0;o<t.keys.length&&i<e.length;++o)0===Gt(t.keys[o],e[i])&&(r.push(n?D(t.values[o]):t.values[o]),++i);return r.length===e.length?r:null}catch(Jn){return null}}var Jn,Qn={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return o(o({},n),{getMany:function(e){if(!e.cache)return n.getMany(e);var t=Yn(e.keys,e.trans._cache,"clone"===e.cache);return t?Be.resolve(t):n.getMany(e).then((function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?D(t):t},t}))},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),n.mutate(e)}})}}}};function Xn(e){return!("from"in e)}var Zn=function e(t,n){if(!this){var r=new e;return t&&"d"in t&&c(r,t),r}c(this,arguments.length?{d:1,from:t,to:arguments.length>1?n:t}:{d:0})};function er(e,t,n){var r=Gt(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(Xn(e))return c(e,{from:t,to:n,d:1});var o=e.l,i=e.r;if(Gt(n,e.from)<0)return o?er(o,t,n):e.l={from:t,to:n,d:1,l:null,r:null},or(e);if(Gt(t,e.to)>0)return i?er(i,t,n):e.r={from:t,to:n,d:1,l:null,r:null},or(e);Gt(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),Gt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var a=!e.r;o&&!e.l&&tr(e,o),i&&a&&tr(e,i)}}function tr(e,t){Xn(t)||function e(t,n){var r=n.from,o=n.to,i=n.l,a=n.r;er(t,r,o),i&&e(t,i),a&&e(t,a)}(e,t)}function nr(e,t){var n=rr(t),r=n.next();if(r.done)return!1;for(var o=r.value,i=rr(e),a=i.next(o.from),u=a.value;!r.done&&!a.done;){if(Gt(u.from,o.to)<=0&&Gt(u.to,o.from)>=0)return!0;Gt(o.from,u.from)<0?o=(r=n.next(u.from)).value:u=(a=i.next(o.from)).value}return!1}function rr(e){var t=Xn(e)?null:{s:0,n:e};return{next:function(e){for(var n=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Gt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Gt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function or(e){var t,n,r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a="r"===i?"l":"r",u=o({},e),s=e[i];e.from=s.from,e.to=s.to,e[i]=s[i],u[i]=s[a],e[a]=u,u.d=ir(u)}e.d=ir(e)}function ir(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}h(Zn.prototype,((Jn={add:function(e){return tr(this,e),this},addKey:function(e){return er(this,e,e),this},addKeys:function(e){var t=this;return e.forEach((function(e){return er(t,e,e)})),this}})[B]=function(){return rr(this)},Jn));var ar={stack:"dbcore",level:0,create:function(e){var t=e.schema.name,n=new Zn(e.MIN_KEY,e.MAX_KEY);return o(o({},e),{table:function(r){var i=e.table(r),a=i.schema,c=a.primaryKey,l=c.extractKey,f=c.outbound,d=o(o({},i),{mutate:function(e){var o=e.trans,u=o.mutatedParts||(o.mutatedParts={}),c=function(e){var n="idb://"+t+"/"+r+"/"+e;return u[n]||(u[n]=new Zn)},l=c(""),f=c(":dels"),d=e.type,h="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[],p=h[0],v=h[1],b=e.trans._cache;return i.mutate(e).then((function(e){if(s(p)){"delete"!==d&&(p=e.results),l.addKeys(p);var t=Yn(p,b);t||"add"===d||f.addKeys(p),(t||v)&&function(e,t,n,r){function o(t){var o=e(t.name||"");function i(e){return null!=e?t.extractKey(e):null}var a=function(e){return t.multiEntry&&s(e)?e.forEach((function(e){return o.addKey(e)})):o.addKey(e)};(n||r).forEach((function(e,t){var o=n&&i(n[t]),u=r&&i(r[t]);0!==Gt(o,u)&&(null!=o&&a(o),null!=u&&a(u))}))}t.indexes.forEach(o)}(c,a,t,v)}else if(p){var r={from:p.lower,to:p.upper};f.add(r),l.add(r)}else l.add(n),f.add(n),a.indexes.forEach((function(e){return c(e.name).add(n)}));return e}))}}),h=function(t){var n,r,o=t.query,i=o.index,a=o.range;return[i,new Zn(null!==(n=a.lower)&&void 0!==n?n:e.MIN_KEY,null!==(r=a.upper)&&void 0!==r?r:e.MAX_KEY)]},p={get:function(e){return[c,new Zn(e.key)]},getMany:function(e){return[c,(new Zn).addKeys(e.keys)]},count:h,query:h,openCursor:h};return u(p).forEach((function(e){d[e]=function(a){var u=De.subscr;if(u){var s=function(e){var n="idb://"+t+"/"+r+"/"+e;return u[n]||(u[n]=new Zn)},c=s(""),d=s(":dels"),h=p[e](a),v=h[0],b=h[1];if(s(v.name||"").add(b),!v.isPrimaryKey){if("count"!==e){var y="query"===e&&f&&a.values&&i.query(o(o({},a),{values:!1}));return i[e].apply(this,arguments).then((function(t){if("query"===e){if(f&&a.values)return y.then((function(e){var n=e.result;return c.addKeys(n),t}));var n=a.values?t.result.map(l):t.result;a.values?c.addKeys(n):d.addKeys(n)}else if("openCursor"===e){var r=t,o=a.values;return r&&Object.create(r,{key:{get:function(){return d.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return d.addKey(e),e}},value:{get:function(){return o&&c.addKey(r.primaryKey),r.value}}})}return t}))}d.add(n)}}return i[e].apply(this,arguments)}})),d}})}};var ur,sr=function(){function e(t,n){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=n=o({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u,s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ae,dbReadyPromise:null,cancelOpen:ae,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new Be((function(e){s.dbReadyResolve=e})),s.openCanceller=new Be((function(e,t){s.cancelOpen=t})),this._state=s,this.name=t,this.on=Lt(this,"populate","blocked","versionchange","close",{ready:[pe,ae]}),this.on.ready.subscribe=_(this.on.ready.subscribe,(function(t){return function(n,o){e.vip((function(){var e=r._state;if(e.openComplete)e.dbOpenError||Be.resolve().then(n),o&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),o&&t(n);else{t(n);var i=r;o||t((function e(){i.on.ready.unsubscribe(n),i.on.ready.unsubscribe(e)}))}}))}})),this.Collection=(u=this,Mt(Qt.prototype,(function(e,t){this.db=u;var n=Nt,r=null;if(t)try{n=t()}catch(s){r=s}var o=e._ctx,i=o.table,a=i.hook.reading.fire;this._ctx={table:i,index:o.index,isPrimKey:!o.index||i.schema.primKey.keyPath&&o.index===i.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:o.or,valueMapper:a!==ue?a:null}}))),this.Table=function(e){return Mt(Ut.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Lt(null,{creating:[le,ae],reading:[se,ue],updating:[de,ae],deleting:[fe,ae]})}))}(this),this.Transaction=function(e){return Mt(pn.prototype,(function(t,n,r,o,i){var a=this;this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=Lt(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Be((function(e,t){a._resolve=e,a._reject=t})),this._completion.then((function(){a.active=!1,a.on.complete.fire()}),(function(e){var t=a.active;return a.active=!1,a.on.error.fire(e),a.parent?a.parent._reject(e):t&&a.idbtrans&&a.idbtrans.abort(),gt(e)}))}))}(this),this.Version=function(e){return Mt(Nn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Mt(sn.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};var o=e._deps.indexedDB;if(!o)throw new re.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=function(e,t){return o.cmp(t,e)},this._max=function(e,t){return o.cmp(e,t)>0?e:t},this._min=function(e,t){return o.cmp(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()})),this.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+e.oldVersion/10)})),this._maxKey=mn(n.IDBKeyRange),this._createTransaction=function(e,t,n,o){return new r.Transaction(e,t,n,r._options.chromeTransactionDurability,o)},this._fireOnBlocked=function(e){r.on("blocked").fire(e),Ot.filter((function(e){return e.name===r.name&&e!==r&&!e._state.vcFired})).map((function(t){return t.on("versionchange").fire(e)}))},this.use(Hn),this.use(Gn),this.use(ar),this.use(Qn),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach((function(e){return e(r)}))}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new re.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new re.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter((function(t){return t._cfg.version===e}))[0];return n||(n=new this.Version(e),t.push(n),t.sort(En),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||De.letThrough||this._vip)?e():new Be((function(e,n){if(t._state.openComplete)return n(new re.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return void n(new re.DatabaseClosed);t.open().catch(ae)}t._state.dbReadyPromise.then(e,n)})).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,o=e.name;o&&this.unuse({stack:t,name:o});var i=this._middlewares[t]||(this._middlewares[t]=[]);return i.push({stack:t,create:n,level:null==r?10:r,name:o}),i.sort((function(e,t){return e.level-t.level})),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((function(e){return r?e.create!==r:!!n&&e.name!==n}))),this},e.prototype.open=function(){return Fn(this)},e.prototype._close=function(){var e=this._state,t=Ot.indexOf(this);if(t>=0&&Ot.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(n){}this._novip.idbdb=null}e.dbReadyPromise=new Be((function(t){e.dbReadyResolve=t})),e.openCanceller=new Be((function(t,n){e.cancelOpen=n}))},e.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new re.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},e.prototype.delete=function(){var e=this,t=arguments.length>0,n=this._state;return new Be((function(r,o){var i=function(){e.close();var t=e._deps.indexedDB.deleteDatabase(e.name);t.onsuccess=Xe((function(){Un(e._deps,e.name),r()})),t.onerror=cn(o),t.onblocked=e._fireOnBlocked};if(t)throw new re.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(i):i()}))},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return u(this._allTables).map((function(t){return e._allTables[t]}))},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=qn.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,o=De.trans;o&&o.db===this&&-1===e.indexOf("!")||(o=null);var i,a,u=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(a=t.map((function(e){var t=e instanceof r.Table?e.name:e;if("string"!==typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===Tt)i=Tt;else{if("rw"!=e&&e!=Dt)throw new re.InvalidArgument("Invalid transaction mode: "+e);i=Dt}if(o){if(o.mode===Tt&&i===Dt){if(!u)throw new re.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&a.forEach((function(e){if(o&&-1===o.storeNames.indexOf(e)){if(!u)throw new re.SubTransaction("Table "+e+" not included in parent transaction.");o=null}})),u&&o&&!o.active&&(o=null)}}catch(c){return o?o._promise(null,(function(e,t){t(c)})):gt(c)}var s=$n.bind(null,this,i,a,o,n);return o?o._promise(i,s,"lock"):De.trans?ht(De.transless,(function(){return r._whenReady(s)})):this._whenReady(s)},e.prototype.table=function(e){if(!d(this._allTables,e))throw new re.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},e}(),cr="undefined"!==typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",lr=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!==typeof e?e:{next:e,error:t,complete:n})},e.prototype[cr]=function(){return this},e}();function fr(e,t){return u(t).forEach((function(n){tr(e[n]||(e[n]=new Zn),t[n])})),e}function dr(e){return new lr((function(t){var n=F(e);var r=!1,o={},i={},a={get closed(){return r},unsubscribe:function(){r=!0,hn.storagemutated.unsubscribe(f)}};t.start&&t.start(a);var s=!1,c=!1;function l(){return u(i).some((function(e){return o[e]&&nr(o[e],i[e])}))}var f=function(e){fr(o,e),l()&&d()},d=function u(){if(!s&&!r){o={};var d={},h=function(t){n&&at();var r=function(){return it(e,{subscr:t,trans:null})},o=De.trans?ht(De.transless,r):r();return n&&o.then(ut,ut),o}(d);c||(hn(fn,f),c=!0),s=!0,Promise.resolve(h).then((function(e){s=!1,r||(l()?u():(o={},i=d,t.next&&t.next(e)))}),(function(e){["DatabaseClosedError","AbortError"].includes(null===e||void 0===e?void 0:e.name)||(s=!1,t.error&&t.error(e),a.unsubscribe())}))}};return d(),a}))}try{ur={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch(mr){ur={indexedDB:null,IDBKeyRange:null}}var hr=sr;function pr(e){var t=vr;try{vr=!0,hn.storagemutated.fire(e)}finally{vr=t}}h(hr,o(o({},ie),{delete:function(e){return new hr(e,{addons:[]}).delete()},exists:function(e){return new hr(e,{addons:[]}).open().then((function(e){return e.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(e){try{return function(e){var t=e.indexedDB,n=e.IDBKeyRange;return Bn(t)?Promise.resolve(t.databases()).then((function(e){return e.map((function(e){return e.name})).filter((function(e){return e!==At}))})):Kn(t,n).toCollection().primaryKeys()}(hr.dependencies).then(e)}catch(Jn){return gt(new re.MissingAPI)}},defineClass:function(){return function(e){c(this,e)}},ignoreTransaction:function(e){return De.trans?ht(De.transless,e):e()},vip:Ln,async:function(e){return function(){try{var t=Wn(e.apply(this,arguments));return t&&"function"===typeof t.then?t:Be.resolve(t)}catch(mr){return gt(mr)}}},spawn:function(e,t,n){try{var r=Wn(e.apply(n,t||[]));return r&&"function"===typeof r.then?r:Be.resolve(r)}catch(mr){return gt(mr)}},currentTransaction:{get:function(){return De.trans||null}},waitFor:function(e,t){var n=Be.resolve("function"===typeof e?hr.ignoreTransaction(e):e).timeout(t||6e4);return De.trans?De.trans.waitFor(n):n},Promise:Be,debug:{get:function(){return W},set:function(e){q(e,"dexie"===e?function(){return!0}:Ct)}},derive:b,extend:c,props:h,override:_,Events:Lt,on:hn,liveQuery:dr,extendObservabilitySet:fr,getByKeyPath:S,setByKeyPath:O,delByKeyPath:function(e,t){"string"===typeof t?O(e,t,void 0):"length"in t&&[].map.call(t,(function(t){O(e,t,void 0)}))},shallowClone:I,deepClone:D,getObjectDiff:Vn,cmp:Gt,asap:j,minKey:jt,addons:[],connections:Ot,errnames:te,dependencies:ur,semVer:_t,version:_t.split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,n){return e+t/Math.pow(10,2*n)}))})),hr.maxKey=mn(hr.dependencies.IDBKeyRange),"undefined"!==typeof dispatchEvent&&"undefined"!==typeof addEventListener&&(hn(fn,(function(e){var t;vr||(It?(t=document.createEvent("CustomEvent")).initCustomEvent(dn,!0,!0,e):t=new CustomEvent(dn,{detail:e}),vr=!0,dispatchEvent(t),vr=!1)})),addEventListener(dn,(function(e){var t=e.detail;vr||pr(t)})));var vr=!1;if("undefined"!==typeof BroadcastChannel){var br=new BroadcastChannel(dn);hn(fn,(function(e){vr||br.postMessage(e)})),br.onmessage=function(e){e.data&&pr(e.data)}}else if("undefined"!==typeof self&&"undefined"!==typeof navigator){hn(fn,(function(e){try{vr||("undefined"!==typeof localStorage&&localStorage.setItem(dn,JSON.stringify({trig:Math.random(),changedParts:e})),"object"===typeof self.clients&&i([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach((function(t){return t.postMessage({type:dn,changedParts:e})})))}catch(Jn){}})),addEventListener("storage",(function(e){if(e.key===dn){var t=JSON.parse(e.newValue);t&&pr(t.changedParts)}}));var yr=self.document&&navigator.serviceWorker;yr&&yr.addEventListener("message",(function(e){var t=e.data;t&&t.type===dn&&pr(t.changedParts)}))}Be.rejectionMapper=function(e,t){if(!e||e instanceof Q||e instanceof TypeError||e instanceof SyntaxError||!e.name||!oe[e.name])return e;var n=new oe[e.name](t||e.message,e);return"stack"in e&&v(n,"stack",{get:function(){return this.inner.stack}}),n},q(W,Ct)},80:function(e,t){},82:function(e){e.exports=JSON.parse('{"demoUsers":{"alice@demo.local":{},"bob@demo.local":{},"foo@demo.local":{},"bar@demo.local":{}},"roles":{"manager":{"manage":"*"},"doer":{"update":{"todoItems":["done"]}},"commenter":{"add":["comments"]}},"data":{}}')},92:function(e,t,n){}},[[109,1,2]]]);
//# sourceMappingURL=main.9d750087.chunk.js.map